From 627bd29a83425c1cf7a75be3e7ad2efce9605dc0 Mon Sep 17 00:00:00 2001
From: Philippe Normand <philn@igalia.com>
Date: Thu, 21 Dec 2023 10:42:51 +0000
Subject: [PATCH] GStreamer: Bump to 1.22.9

---
 .../components/gstreamer-plugins-good.bst     |  1 +
 elements/include/gstreamer-source.yml         |  2 +-
 .../gstreamer/graceful-error-noopenh264.patch | 35 -------------------
 ...ins-bad-Optional-LRDF-dep-for-ladspa.patch | 13 -------
 4 files changed, 2 insertions(+), 49 deletions(-)
 delete mode 100644 patches/gstreamer/graceful-error-noopenh264.patch
 delete mode 100644 patches/gstreamer/gst-plugins-bad-Optional-LRDF-dep-for-ladspa.patch

diff --git a/elements/components/gstreamer-plugins-good.bst b/elements/components/gstreamer-plugins-good.bst
index cea2a32..5d5224a 100644
--- a/elements/components/gstreamer-plugins-good.bst
+++ b/elements/components/gstreamer-plugins-good.bst
@@ -45,6 +45,7 @@ variables:
     -Dtwolame=disabled
     -Dexamples=disabled
     -Drpicamsrc=disabled
+    -Dqt6=disabled
 
 public:
   cpe:
diff --git a/elements/include/gstreamer-source.yml b/elements/include/gstreamer-source.yml
index f36b91e..8fdb4f6 100644
--- a/elements/include/gstreamer-source.yml
+++ b/elements/include/gstreamer-source.yml
@@ -2,6 +2,6 @@ sources:
 - kind: git_repo
   url: freedesktop:gstreamer/gstreamer.git
   track: 1.*[02468].*
-  ref: 1.22.5-0-gbf6ce1d64a0697e7910826147b48f8f658366a5a
+  ref: 1.22.9-0-g3e41b8f18b7d19b0ca98a3437c2e27aa0cfe12bb
 - kind: patch_queue
   path: patches/gstreamer
diff --git a/patches/gstreamer/graceful-error-noopenh264.patch b/patches/gstreamer/graceful-error-noopenh264.patch
deleted file mode 100644
index 8fbe833..0000000
--- a/patches/gstreamer/graceful-error-noopenh264.patch
+++ /dev/null
@@ -1,35 +0,0 @@
-diff --git a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp
-index e42dc093b7..06e92c15f4 100644
---- a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp
-+++ b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp
-@@ -162,7 +162,11 @@ gst_openh264dec_start (GstVideoDecoder * decoder)
-     WelsDestroyDecoder (openh264dec->decoder);
-     openh264dec->decoder = NULL;
-   }
--  WelsCreateDecoder (&(openh264dec->decoder));
-+
-+  if (WelsCreateDecoder (&(openh264dec->decoder)) != 0) {
-+    GST_DEBUG_OBJECT (openh264dec, "openh264dec_start, cannot create decoder");
-+    return 0;
-+  }
- 
- #ifndef GST_DISABLE_GST_DEBUG
-   {
-diff --git a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp
-index 30af8e2677..b51d6e7fed 100644
---- a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp
-+++ b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp
-@@ -761,7 +761,12 @@ gst_openh264enc_set_format (GstVideoEncoder * encoder,
-     WelsDestroySVCEncoder (openh264enc->encoder);
-     openh264enc->encoder = NULL;
-   }
--  WelsCreateSVCEncoder (&openh264enc->encoder);
-+
-+  if (WelsCreateSVCEncoder (&openh264enc->encoder) != 0) {
-+    GST_ERROR_OBJECT (openh264enc, "openh264enc_set_format, cannot create encoder");
-+    return 0;
-+  }
-+
-   unsigned int uiTraceLevel = WELS_LOG_ERROR;
-   openh264enc->encoder->SetOption (ENCODER_OPTION_TRACE_LEVEL, &uiTraceLevel);
- 
diff --git a/patches/gstreamer/gst-plugins-bad-Optional-LRDF-dep-for-ladspa.patch b/patches/gstreamer/gst-plugins-bad-Optional-LRDF-dep-for-ladspa.patch
deleted file mode 100644
index a91cf04..0000000
--- a/patches/gstreamer/gst-plugins-bad-Optional-LRDF-dep-for-ladspa.patch
+++ /dev/null
@@ -1,13 +0,0 @@
-diff --git a/subprojects/gst-plugins-bad/ext/ladspa/meson.build b/subprojects/gst-plugins-bad/ext/ladspa/meson.build
-index adfd3459e2..3e8060796d 100644
---- a/subprojects/gst-plugins-bad/ext/ladspa/meson.build
-+++ b/subprojects/gst-plugins-bad/ext/ladspa/meson.build
-@@ -13,7 +13,7 @@ if get_option('ladspa').disabled()
- endif
- 
- # This is an optional dep, but we make it optional only in auto mode
--lrdf_dep = dependency('lrdf', required : get_option('ladspa'))
-+lrdf_dep = dependency('lrdf', required: false)
- if lrdf_dep.found()
-   ladspa_cargs = ['-DHAVE_LRDF']
- endif
-- 
2.43.0

