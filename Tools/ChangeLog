2022-03-07  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Derive branch name from bug title (Follow-up fix)
        https://bugs.webkit.org/show_bug.cgi?id=237284
        <rdar://problem/89578241>

        Unreviewed follow-up fix.

        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/test/branch_unittest.py:
        (TestBranch.test_basic_svn): Using an integer will attempt to find a bug number.
        (TestBranch.test_basic_git): Ditto.

2022-03-07  Jonathan Bedard  <jbedard@apple.com>

        [webkitbugspy] Allow creation of new issues
        https://bugs.webkit.org/show_bug.cgi?id=237123
        <rdar://problem/89388181>

        Reviewed by Dewei Zhu.

        * Scripts/libraries/webkitbugspy/setup.py: Bump version.
        * Scripts/libraries/webkitbugspy/webkitbugspy/__init__.py: Ditto.
        * Scripts/libraries/webkitbugspy/webkitbugspy/bugzilla.py:
        (Tracker.projects): Return a dictionary of projects, components and versions.
        (Tracker.create): Create a new bug, prompting user for product, component and version
        if needed.
        * Scripts/libraries/webkitbugspy/webkitbugspy/github.py:
        (Tracker.labels): Return a dictionary of all labels associated with the project.
        (Tracker.projects): Return an empty dictionary.
        (Tracker.create): Create a new issue.
        * Scripts/libraries/webkitbugspy/webkitbugspy/mocks/__init__.py: Export PROJECT data.
        * Scripts/libraries/webkitbugspy/webkitbugspy/mocks/base.py:
        (Base.__init__): Mock trackers should define a project dictionary.
        * Scripts/libraries/webkitbugspy/webkitbugspy/mocks/bugzilla.py:
        (Bugzilla.__init__):
        (Bugzilla._product_details): Derive product details from project dictionary.
        (Bugzilla._create): Create a new bug.
        (Bugzilla.request): Handle requests for product details and bug creation.
        * Scripts/libraries/webkitbugspy/webkitbugspy/mocks/data.py:
        * Scripts/libraries/webkitbugspy/webkitbugspy/mocks/github.py:
        (GitHub.__init__):
        (GitHub._labels): Return a list of project labels.
        (GitHub._create): Create a new issue.
        (GitHub.request): Handle requests for labels and issue creation.
        * Scripts/libraries/webkitbugspy/webkitbugspy/mocks/radar.py:
        (RadarClient.find_components): Mock radarclient's component search API.
        (RadarClient.create_radar): Mock radarclient's radar creation API.
        (Radar.Component): Added.
        (Radar.exceptions): Added.
        * Scripts/libraries/webkitbugspy/webkitbugspy/radar.py:
        (Tracker):
        (Tracker.Encoder.default): Pass 'projects' to radar instances.
        (Tracker.__init__): Callers should define projects to limit component scope.
        (Tracker.projects): Search radar components to provide a subset relevant to the declared projects.
        (Tracker.create): Create a radar, prompting user for component and version if needed.
        * Scripts/libraries/webkitbugspy/webkitbugspy/tests/bugzilla_unittest.py:
        (TestBugzilla.test_state_why):
        (TestBugzilla):
        (TestBugzilla.test_projects):
        (TestBugzilla.test_create):
        (TestBugzilla.test_create_prompt):
        * Scripts/libraries/webkitbugspy/webkitbugspy/tests/github_unittest.py:
        (TestGitHub.test_state_why):
        (TestGitHub):
        (TestGitHub.test_labels):
        (TestGitHub.test_projects):
        (TestGitHub.test_create):
        * Scripts/libraries/webkitbugspy/webkitbugspy/tests/radar_unittest.py:
        (TestRadar.test_state_why):
        (TestRadar):
        (TestRadar.test_projects):
        (TestRadar.test_create):
        (TestRadar.test_create_prompt):
        * Scripts/libraries/webkitbugspy/webkitbugspy/tracker.py:
        (Tracker.from_json): Pass 'projects' to radar instances.
        (Tracker.projects): Add base-class implementation.
        (Tracker.create): Ditto.

2022-03-06  Lauro Moura  <lmoura@igalia.com>

        [Flatpak SDK] Fix key expired treatment with Python3
        https://bugs.webkit.org/show_bug.cgi?id=237509

        Reviewed by Fujii Hironori.

        * flatpak/flatpakutils.py:
        (FlatpakObject.flatpak_update):

2022-03-06  Wenson Hsieh  <wenson_hsieh@apple.com>

        [iOS] Layer tree can get indefinitely frozen if WKWebView is unparented underneath -[UIWindow dealloc]
        https://bugs.webkit.org/show_bug.cgi?id=237505
        rdar://85563958

        Reviewed by Tim Horton.

        Add an API test to exercise the bug. This API test is comprised of the following series of steps:
        1. Create the web view and add it under window #1.
        2. Post a "did enter background" notification.
        3. Deallocate window #1 (thereby unparenting the web view in the process).
        4. Post a "will enter foreground" notification.
        5. Add the web view under window #2.
        6. Load some HTML content and wait for a presentation update.

        Before the fix, this test times out because the layer tree is permanently frozen after step (3), due to the
        `BackgroundApplication` reason, so the presentation update in step (6) never finishes.

        * TestWebKitAPI/TestWebKitAPI.xcodeproj/project.pbxproj:
        * TestWebKitAPI/Tests/ios/ApplicationStateTracking.mm: Added.
        (TestWebKitAPI::TEST):

2022-03-04  Sihui Liu  <sihui_liu@apple.com>

        Add null check for path in makeAllDirectories
        https://bugs.webkit.org/show_bug.cgi?id=237477

        Reviewed by Darin Adler.

        * TestWebKitAPI/Tests/WTF/FileSystem.cpp:
        (TestWebKitAPI::TEST_F):

2022-03-04  Myles C. Maxfield  <mmaxfield@apple.com>

        [iOS] Books ASSERTs upon opening a book with a debug build of WebKit
        https://bugs.webkit.org/show_bug.cgi?id=237445
        <rdar://problem/89776531>

        Reviewed by Alex Christensen.

        * TestWebKitAPI/Tests/WTF/FileSystem.cpp:
        (TestWebKitAPI::TEST_F):

2022-03-04  Chris Dumez  <cdumez@apple.com>

        URL's isolatedCopy() optimization when called on a r-value reference doesn't work
        https://bugs.webkit.org/show_bug.cgi?id=237481

        Reviewed by Geoffrey Garen.

        Add API test coverage.

        * TestWebKitAPI/Tests/WTF/URL.cpp:
        (TestWebKitAPI::TEST_F):

2022-03-04  Aditya Keerthi  <akeerthi@apple.com>

        [iOS] Unable to scroll to a found text range when there is an existing selection
        https://bugs.webkit.org/show_bug.cgi?id=237407
        rdar://89653213

        Reviewed by Wenson Hsieh.

        Add an API test that sets a selection in the document, finds some
        text outside the viewport, and scrolls to make the found text
        visible.

        * TestWebKitAPI/Tests/WebKitCocoa/FindInPage.mm:
        (-[TestScrollViewDelegate init]):
        (-[TestScrollViewDelegate scrollViewDidEndScrollingAnimation:]):
        (TEST):

2022-03-04  Philippe Normand  <pnormand@igalia.com>

        [Flatpak SDK] Upgrade from llvm12 to llvm13
        https://bugs.webkit.org/show_bug.cgi?id=237430

        Reviewed by Adrian Perez de Castro.

        * flatpak/flatpakutils.py:
        (WebkitFlatpak.run_in_sandbox):
        (WebkitFlatpak._get_dependency_packages):

2022-03-03  Ben Nham  <nham@apple.com>

        Enforce silent push quota
        https://bugs.webkit.org/show_bug.cgi?id=236863

        Reviewed by Brady Eidson.

        Modified existing push tests to show a notification. Added a new test case to make sure that
        subscriptions are removed when an origin reaches its quota of silent pushes.

        * TestWebKitAPI/TestNotificationProvider.cpp:
        (TestWebKitAPI::notificationPermissions):
        (TestWebKitAPI::TestNotificationProvider::TestNotificationProvider):
        (TestWebKitAPI::TestNotificationProvider::~TestNotificationProvider):
        (TestWebKitAPI::TestNotificationProvider::notificationPermissions):
        (TestWebKitAPI::TestNotificationProvider::setPermission):
        * TestWebKitAPI/Tests/WebCore/PushDatabase.cpp:
        (TestWebKitAPI::makeTemporaryDatabasePath):
        (TestWebKitAPI::getTopicsSync):
        (TestWebKitAPI::PushDatabaseTest::getTopics):
        (TestWebKitAPI::PushDatabaseTest::removeRecordsByBundleIdentifierAndSecurityOrigin):
        (TestWebKitAPI::PushDatabaseTest::incrementSilentPushCount):
        (TestWebKitAPI::operator==):
        (TestWebKitAPI::TEST_F):
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/cocoa/HTTPServer.mm:
        (TestWebKitAPI::HTTPServer::origin const):

2022-03-03  Dewei Zhu  <dewei_zhu@apple.com>

        'run-benchmark' script should log http requests during benchmark run.
        https://bugs.webkit.org/show_bug.cgi?id=237076
        <rdar://89270825>

        Reviewed by Jonathan Bedard.

        Relanding 290583 with fix.
        Add support to log http requests during benchmark run for diagnostic purpose.
        AutoInstall sets 'AUTOINSTALL_CA_CERT_PATH' to environment variables when certificate is specified,
        and uses 'AUTOINSTALL_CA_CERT_PATH' when it's present in environment variables. This ensures scripts invoked
        from subprocess can use autoinstalled correcctly.

        * Scripts/libraries/webkitcorepy/webkitcorepy/autoinstall.py:
        (AutoInstall):
        (AutoInstall.set_index):
        * Scripts/webkitpy/__init__.py: Update 'attr' package version to 20.3.0 so match upgraded twisted version
        * Scripts/webkitpy/autoinstalled/twisted.py: Upgrade twisted version to latest python2 & python3 compatibile
        version with specified implicit dependencies.
        * Scripts/webkitpy/benchmark_runner/benchmark_runner.py: Ensure benchmark diagnostic directory is created.
        (BenchmarkRunner.__init__):
        * Scripts/webkitpy/benchmark_runner/http_server_driver/http_server/twisted_http_server.py: Add '--log-path'
        arugment to allow specify logging output and it defaults to '/tmp/run-benchmark-http.log'
        * Scripts/webkitpy/benchmark_runner/http_server_driver/http_server_driver.py:
        (HTTPServerDriver.set_device_id):
        (HTTPServerDriver):
        (HTTPServerDriver.set_http_log):
        * Scripts/webkitpy/benchmark_runner/http_server_driver/simple_http_server_driver.py: Pass http log path to
        twisted http server if specified.
        (SimpleHTTPServerDriver.__init__):
        (SimpleHTTPServerDriver.serve):
        (SimpleHTTPServerDriver.set_http_log):
        * Scripts/webkitpy/benchmark_runner/run_benchmark.py: Fix a tiny bug that default_diagnose_dir() is involked twice in
        argument parser help message.
        (config_argument_parser):
        * Scripts/webkitpy/benchmark_runner/webserver_benchmark_runner.py: Set http request log path if diagnostic directory
        is specified.
        (WebServerBenchmarkRunner.__init__):

2022-03-03  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Handle new PR with old branch name
        https://bugs.webkit.org/show_bug.cgi?id=237457
        <rdar://problem/89788939>

        Reviewed by Dewei Zhu.

        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/pull_request.py:
        (PullRequest.main):

2022-03-03  Sihui Liu  <sihui_liu@apple.com>

        Text manipulation does not observe updated title element
        https://bugs.webkit.org/show_bug.cgi?id=237435
        rdar://87318842

        Reviewed by Wenson Hsieh.

        * TestWebKitAPI/Tests/WebKitCocoa/TextManipulation.mm:
        (TestWebKitAPI::TEST):

2022-03-03  Lauro Moura  <lmoura@igalia.com>

        [Python3] Switch a few more glib scripts to Python3
        https://bugs.webkit.org/show_bug.cgi?id=237442

        Reviewed by Adrian Perez de Castro.

        * Scripts/check-for-global-bss-symbols-in-webkitgtk-libs: Update
        shebang.
        (bss_symbols): Decode Popen bytes output.
        * gtk/jhbuildrc: Update shebang.
        * gtk/ycm_extra_conf.py: Ditto.
        * jhbuild/jhbuild-wrapper: Ditto.
        (jhbuild_at_expected_revision): Decode Popen bytes output.
        * jhbuild/jhbuildrc_common.py: Remove uneeded shebang.
        * wpe/jhbuildrc: Update shebang.

2022-03-03  Jonathan Bedard  <jbedard@apple.com>

        [webkitcorepy] Disable prompt when saving credentials
        https://bugs.webkit.org/show_bug.cgi?id=237438
        <rdar://problem/89764417>

        Reviewed by Aakash Jain.

        * Scripts/libraries/webkitbugspy/setup.py: Bump version.
        * Scripts/libraries/webkitbugspy/webkitbugspy/__init__.py: Ditto.
        * Scripts/libraries/webkitbugspy/webkitbugspy/github.py:
        (Tracker.credentials): Pass 'save' to webkitcorepy.credentials.
        * Scripts/libraries/webkitcorepy/setup.py: Bump version.
        * Scripts/libraries/webkitcorepy/webkitcorepy/__init__.py: Ditto.
        * Scripts/libraries/webkitcorepy/webkitcorepy/credentials.py:
        (credentials): Unless caller explicitly disables saving, assume that all credentials
        should be saved to a system's keyring.
        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/setup.py:
        (Setup.github): Automatically save any prompted credentials.
        (Setup.git): Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/remote/git_hub.py:
        (GitHub.credentials): Pass 'save' to github.Tracker.credentials.

2022-03-03  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Open pre-populated GitHub page for new tokens
        https://bugs.webkit.org/show_bug.cgi?id=237436
        <rdar://problem/89763053>

        Reviewed by Ryan Haddad.

        GitHub gives us a way to pre-populate its token generation web page. We should
        open this page with appropriate arguments during setup.

        * Scripts/libraries/webkitbugspy/setup.py: Bump version.
        * Scripts/libraries/webkitbugspy/webkitbugspy/__init__.py: Ditto.
        * Scripts/libraries/webkitbugspy/webkitbugspy/github.py:
        (Tracker.credentials): Make 'prompt' into a function, allowing us to open a url
        and change the prompt based on the success of opening the url.
        * Scripts/libraries/webkitcorepy/setup.py: Bump version.
        * Scripts/libraries/webkitcorepy/webkitcorepy/__init__.py: Ditto.
        * Scripts/libraries/webkitcorepy/webkitcorepy/credentials.py:
        (credentials): Allow 'prompt' to be callable.

2022-03-03  Lauro Moura  <lmoura@igalia.com>

        [build.webkit.org] Add GTK queue using clang
        https://bugs.webkit.org/show_bug.cgi?id=229637

        Reviewed by Michael Catanzaro.

        This commit adds a specific queue to build with clang in place of GCC.
        It will help cover both toolchains and catch bugs and warnings
        that happen to be raised by/to affect only clang.

        Initially, it'll be a build-only queue, moving to a complete build and
        tester in the future. It'll use clang-12, the version available in the
        current SDK used by GTK and WPE.

        * CISupport/build-webkit-org/config.json:
        * CISupport/build-webkit-org/factories_unittest.py:
        (TestExpectedBuildSteps):

2022-03-03  Myles C. Maxfield  <mmaxfield@apple.com>

        [Style] Forbid spaces between type names and protocol names in Objective-C
        https://bugs.webkit.org/show_bug.cgi?id=237406

        Reviewed by Darin Adler.

        According to https://lists.webkit.org/pipermail/webkit-dev/2022-February/032130.html.

        Because the style checker uses regexes, we don't know what's a type name and what's
        a protocol name, so the checker simplifies the problem and just checks for "id <".

        * Scripts/webkitpy/style/checkers/cpp.py:
        (check_objc_protocol):
        (check_style):

2022-03-03  Jonathan Bedard  <jbedard@apple.com>

        [Python-3] Invoke webkit-patch with Python 3 by default (Follow-up fix)
        https://bugs.webkit.org/show_bug.cgi?id=231591
        <rdar://problem/84153640>

        Unreviewed follow-up fix.

        * Scripts/webkitpy/tool/commands/download.py:
        (AbstractRevertPrepCommand._prepare_state): Reason may be spread accross multiple arguments.
        * Scripts/webkitpy/tool/commands/download_unittest.py:

2022-03-03  Philippe Normand  <pnormand@igalia.com>

        [Python3] Switch a couple glib/flatpak scripts to Python3
        https://bugs.webkit.org/show_bug.cgi?id=237377

        Reviewed by Carlos Garcia Campos.

        * Scripts/update-webkit-flatpak: Update shebang to Python3.
        * Scripts/webkit-flatpak: Ditto.
        * glib/api_test_runner.py: Ditto.
        * glib/common.py: Remove useless shebang.
        * glib/generate-inspector-gresource-manifest.py: Update shebang to Python3.
        * glib/svn-revision: Ditto.

2022-03-02  Lauro Moura  <lmoura@igalia.com>

        [Tools] Fix linux_get_crash_log.py error logging with python3
        https://bugs.webkit.org/show_bug.cgi?id=237404

        Reviewed by Fujii Hironori.

        Avoid issues generating error logs after 247736@main defaulted to
        python3.

        * Scripts/webkitpy/port/linux_get_crash_log.py:
        (GDBCrashLogGenerator._get_gdb_output): Encode returncode before
        appending to bytes.

2022-03-02  Jonathan Bedard  <jbedard@apple.com>

        [webkitcorepy] Add Terminal.open_url
        https://bugs.webkit.org/show_bug.cgi?id=237386
        <rdar://problem/89703756>

        Reviewed by Don Olmstead.

        Different platforms have different commands to open URLs.

        * Scripts/libraries/webkitcorepy/setup.py: Bump version.
        * Scripts/libraries/webkitcorepy/webkitcorepy/__init__.py: Ditto.
        * Scripts/libraries/webkitcorepy/webkitcorepy/terminal.py:
        (Terminal): Add list of valid URL prefixes.
        (Terminal.open_url): If terminal is interactive, open the provided URL.
        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/setup.py:
        (Setup.main): Invoke Terminal.open_url.

2022-03-02  Chris Dumez  <cdumez@apple.com>

        Unreviewed, address post-landing feedback from Darin on r290743

        * WebKitTestRunner/mac/EventSenderProxy.mm:
        (WTR::EventSenderProxy::mouseMoveTo):

2022-03-02  Jonathan Bedard  <jbedard@apple.com>

        [Python-3] Invoke webkit-patch with Python 3 by default
        https://bugs.webkit.org/show_bug.cgi?id=231591
        <rdar://problem/84153640>

        Reviewed by Ryan Haddad.
    
        * Scripts/webkit-patch: Change shebang to Python 3.

2022-03-02  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Derive branch name from bug title
        https://bugs.webkit.org/show_bug.cgi?id=237284
        <rdar://problem/89578241 >

        Reviewed by Dewei Zhu.

        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/branch.py:
        (Branch.to_branch_name): Convert string (particularly a bug title) to potential branch name.
        (Branch.main): If provided branch name is actually a bug number or URL, use the title
        of that bug as the branch name.
        * Scripts/libraries/webkitscmpy/webkitscmpy/test/branch_unittest.py:
        (TestBranch):
        (TestBranch.test_prompt_git):
        (TestBranch.test_prompt_number):
        (TestBranch.test_prompt_url):
        (TestBranch.test_invalid_branch):
        (TestBranch.test_to_branch_name):

2022-03-02  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Sync personal fork by default
        https://bugs.webkit.org/show_bug.cgi?id=237324
        <rdar://problem/89618617>

        Reviewed by Dewei Zhu.

        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/local/git.py:
        (Git): Add new webkitscmpy.update-fork option.
        * Scripts/libraries/webkitscmpy/webkitscmpy/mocks/local/git.py:
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/pull_request.py:
        (PullRequest.main): If we are rebasing the source branch, we should push that synced branch
        to a user's personal fork, if such a fork exists.
        * Scripts/libraries/webkitscmpy/webkitscmpy/test/pull_request_unittest.py:

2022-03-02  Chris Dumez  <cdumez@apple.com>

        Mousemove events double-firing in Safari
        https://bugs.webkit.org/show_bug.cgi?id=237342
        <rdar://88025610>

        Reviewed by Wenson Hsieh.

        Call [WKWebView _simulateMouseMove:] SPI instead of calling [WKWebView mouseMoved:]
        since the latter calls are now being ignored.

        * TestWebKitAPI/cocoa/TestWKWebView.mm:
        (-[TestWKWebView mouseMoveToPoint:withFlags:]):
        * TestWebKitAPI/mac/PlatformWebViewMac.mm:
        (TestWebKitAPI::PlatformWebView::simulateMouseMove):
        * WebKitTestRunner/mac/EventSenderProxy.mm:
        (WTR::EventSenderProxy::mouseMoveTo):

2022-03-02  Sihui Liu  <sihui_liu@apple.com>

        Add assertion that no two sessions share the same general storage directory
        https://bugs.webkit.org/show_bug.cgi?id=236844
        <rdar://problem/89178566>

        Reviewed by Chris Dumez.

        Update the tests where two WebsiteDataStores are created with the same general storage directory.

        * TestWebKitAPI/Tests/WebKitCocoa/PrivateClickMeasurement.mm:
        (emptyObservationsDBPath):
        (emptyPcmDBPath):
        (cleanUp):
        * TestWebKitAPI/Tests/WebKitCocoa/PushAPI.mm:
        * TestWebKitAPI/Tests/WebKitCocoa/ResourceLoadStatistics.mm:
        (TEST):
        * TestWebKitAPI/Tests/WebKitCocoa/WebPushDaemon.mm:
        * TestWebKitAPI/Tests/WebKitCocoa/WebsiteDataStoreCustomPaths.mm:
        (runWebsiteDataStoreCustomPaths):

2022-03-02  Sihui Liu  <sihui_liu@apple.com>

        Add test coverage for deleting FileSystem data when file is being written
        https://bugs.webkit.org/show_bug.cgi?id=237353

        Reviewed by Chris Dumez.

        Verify that file can be removed from disk, and active FileSystemSyncAccessHandle is invalidated in this case.

        * TestWebKitAPI/Tests/WebKitCocoa/FileSystemAccess.mm:

2022-03-02  Alex Christensen  <achristensen@webkit.org>

        Add SPI _WKDataTask
        https://bugs.webkit.org/show_bug.cgi?id=237234

        Reviewed by Tim Horton.

        * TestWebKitAPI/Tests/WebKitCocoa/NetworkProcess.mm:
        (-[TestDataTaskDelegate dataTask:didReceiveAuthenticationChallenge:completionHandler:]):
        (-[TestDataTaskDelegate dataTask:didReceiveResponse:decisionHandler:]):
        (-[TestDataTaskDelegate dataTask:didReceiveData:]):
        (-[TestDataTaskDelegate dataTask:didCompleteWithError:]):
        (TEST):

2022-03-01  Wenson Hsieh  <wenson_hsieh@apple.com>

        Clipboard Paste dialog doesn't show on external monitors
        https://bugs.webkit.org/show_bug.cgi?id=236395
        rdar://88943577

        Reviewed by Tim Horton.

        Adjust the swizzled implementation of `-popUpContextMenu:withEvent:forView:` to additionally verify that the
        NSEvent we're presenting the menu with isn't `nil`.

        * WebKitTestRunner/mac/TestControllerMac.mm:
        (WTR::swizzledPopUpContextMenu):

2022-03-01  Fujii Hironori  <Hironori.Fujii@sony.com>

        WTF::SentinelLinkedList::iterator should have operator++ for range-for loop
        https://bugs.webkit.org/show_bug.cgi?id=237265

        Reviewed by Yusuke Suzuki.

        * TestWebKitAPI/Tests/WTF/SentinelLinkedList.cpp:
        (TestWebKitAPI::TEST):

2022-03-01  Fujii Hironori  <Hironori.Fujii@sony.com>

        [WinCairo][pywebsocket3] UnicodeDecodeError: 'charmap' codec can't decode byte 0x9d in position 640: character maps to <undefined>
        https://bugs.webkit.org/show_bug.cgi?id=237339

        Reviewed by Jonathan Bedard.

        After r290580 started to use pywebsocket3 and Python 3, Windows
        Python couldn't start WebSocket server due to UnicodeDecodeError.

        * Scripts/webkitpy/port/win.py:
        (WinPort.setup_environ_for_server): Added PYTHONUTF8 environment variable.

2022-03-01  Andres Gonzalez  <andresg_22@apple.com>

        Make accessibility/aria-hidden-false-works-in-subtrees.html async to pass in isolated tree mode.
        https://bugs.webkit.org/show_bug.cgi?id=237051
        <rdar://problem/89312156>

        Reviewed by Chris Fleizach.

        * WebKitTestRunner/InjectedBundle/mac/AccessibilityControllerMac.mm:
        (WTR::AccessibilityController::accessibleElementById):
        Convert the JSStringRef to NSString on the main thread and capture the
        NSString to be used on the AX secondary thread. This may be safer since
        JSStringRefs are supposed to be used on the main thread.

2022-03-01  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Gate information URL on initial setup
        https://bugs.webkit.org/show_bug.cgi?id=237325
        <rdar://problem/89620175>

        Reviewed by Aakash Jain.

        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/setup.py:
        (Setup.main): Offer to open documentation URL if repository has not been setup.
        * Scripts/libraries/webkitscmpy/webkitscmpy/test/setup_unittest.py:
        (TestSetup.test_github):

2022-03-01  J Pascoe  <j_pascoe@apple.com>

        REGRESSION(r290539-r290538): [ iOS ] 3 TestWebKitAPI.WebAuthenticationPanel.* tests are constantly failing/crashing. 
        https://bugs.webkit.org/show_bug.cgi?id=237285
        rdar://problem/89579460

        Reviewed by Brent Fulgham.

        Remove obsolete API test and ensure another has clean state.

        * TestWebKitAPI/Tests/WebKitCocoa/_WKWebAuthenticationPanel.mm:
        (TestWebKitAPI::TEST):

2022-03-01  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, reverting r290325.
        https://bugs.webkit.org/show_bug.cgi?id=237326

        Broken patch

        Reverted changeset:

        "[GStreamer] Switch media player to playbin3"
        https://bugs.webkit.org/show_bug.cgi?id=236884
        https://commits.webkit.org/r290325

2022-03-01  Angelos Oikonomopoulos  <angelos@igalia.com>

        [JSC] Implement chunking for the GNU parallel runner
        https://bugs.webkit.org/show_bug.cgi?id=237028

        Reviewed by Adrian Perez de Castro.

        The GNU parallel runner can't keep up with the scheduling when using
        multiple fast remotes. This results in poor CPU utilization on the
        remotes and more waiting time.

        As a quick fix, allow the user to specify a --gnu-parallel-chunk-size,
        the value of which specifies the number of test jobs to schedule as a
        unit (defaults to 1). Specifying a higher value means longer-running
        jobs, so that GNU parallel can more efficiently schedule them.

        * Scripts/run-javascriptcore-tests:
        (runJSCStressTests):
        * Scripts/run-jsc-stress-tests:

2022-03-01  Sihui Liu  <sihui_liu@apple.com>

        Migrate third-party IndexedDB data to GeneralStorageDirectory
        https://bugs.webkit.org/show_bug.cgi?id=237283

        Reviewed by Chris Dumez.

        * TestWebKitAPI/TestWebKitAPI.xcodeproj/project.pbxproj:
        * TestWebKitAPI/Tests/WebKitCocoa/IndexedDBPersistence.mm:
        * TestWebKitAPI/Tests/WebKitCocoa/indexeddb-persistence-third-party.sqlite3: Added.

2022-02-28  Simon Fraser  <simon.fraser@apple.com>

        No animation when scroll snap scroller is navigated with the keyboard
        https://bugs.webkit.org/show_bug.cgi?id=236244

        Reviewed by Tim Horton.

        In fixing this bug I ran into the issue predicted in https://bugs.webkit.org/show_bug.cgi?id=234456#c6.
        As a workaround, explicitly set NSScrollAnimationEnabled to NO in both processes. This is a partial revert
        of r287228 which I tried, and failed to fix via bug 234488.

        * WebKitTestRunner/InjectedBundle/mac/InjectedBundleMac.mm:
        (WTR::InjectedBundle::platformInitialize):
        * WebKitTestRunner/mac/main.mm:
        (setDefaultsToConsistentValuesForTesting):

2022-02-28  Wenson Hsieh  <wenson_hsieh@apple.com>

        Add API testing infrastructure for "Markup Image" and "Copy Cropped Image"
        https://bugs.webkit.org/show_bug.cgi?id=236519
        rdar://89154213

        Reviewed by Tim Horton.

        Add API testing support (as well as a new API test) for the "Markup Image" flow.

        * TestWebKitAPI/Tests/WebKitCocoa/ImageAnalysisTests.mm:
        (TestWebKitAPI::TEST):
        (TestWebKitAPI::invokeImageMarkupAction):
        * TestWebKitAPI/Tests/WebKitCocoa/WKContentViewEditingActions.mm:

        Add an API test that triggers the "Markup Image" action, and verifies the following:
        - The first image is replaced with the canned image result (a 215-px-wide image of the WebKit logo).
        - The selection range is effectively unchanged.

        * TestWebKitAPI/cocoa/ImageAnalysisTestingUtilities.h:
        * TestWebKitAPI/cocoa/ImageAnalysisTestingUtilities.mm:

        Add a declaration for ImageAnalysisMarkupSwizzler, a helper class that is used in the new API test to make
        VisionKit return a canned image and cropped rect when invoking the SPI that corresponds to "Markup Image"; see
        WebKitAdditions change for more information.

        * TestWebKitAPI/cocoa/TestWKWebView.h:
        * TestWebKitAPI/cocoa/TestWKWebView.mm:
        (-[WKWebView selectedText]):
        * TestWebKitAPI/ios/TestUIMenuBuilder.h:
        * TestWebKitAPI/ios/TestUIMenuBuilder.mm:
        (-[TestUIMenuBuilder actionWithTitle:]):

        Refactor and rename this to return the found UIAction instead of just a BOOL indicating whether or not it could
        be found, and change existing call sites above to use `EXPECT_NULL` and `EXPECT_NOT_NULL`.

        (-[TestUIMenuBuilder containsActionWithTitle:]): Deleted.
        * TestWebKitAPI/ios/UIKitSPI.h:

2022-02-28  Christopher Reid  <chris.reid@sony.com>

        [Win] vswhere should search for Visual Studio Build tools
        https://bugs.webkit.org/show_bug.cgi?id=237229

        Reviewed by Ross Kirsling.

        * Scripts/webkitdirs.pm:

2022-02-28  Angelos Oikonomopoulos  <angelos@igalia.com>

        [webkit-patch] Allow user to opt out of browser for viewing the diff
        https://bugs.webkit.org/show_bug.cgi?id=220925

        Reviewed by Jonathan Bedard.

        The user may legitimately have a browser installed yet not want to
        use it to view the diff.

        * Scripts/webkitpy/common/system/user.py:
        (User.can_open_url):

2022-02-28  Jonathan Bedard  <jbedard@apple.com>

        Unreviewed, reverting r290583.

        Breaks webkit-patch

        Reverted changeset:

        "'run-benchmark' script should log http requests during
        benchmark run."
        https://bugs.webkit.org/show_bug.cgi?id=237076
        https://commits.webkit.org/r290583

2022-02-28  Pascal Abresch  <nep@packageloss.eu>

        Enable python3 for lighttpd
        https://bugs.webkit.org/show_bug.cgi?id=236938

        Reviewed by Darin Adler.

        This is needed for the Haiku port to use the python3 tests.
        This patch also removes the PHP support since all PHP tests have been removed and there are
        currently no plans to include new ones in the future.
        * Scripts/webkitpy/layout_tests/servers/http_server.py:
        (Lighttpd._prepare_config):
        * Scripts/webkitpy/layout_tests/servers/lighttpd.conf:

2022-02-22  Jonathan Bedard  <jbedard@apple.com>

        [run-webkit-tests] Use Python 3 (Part 3)
        https://bugs.webkit.org/show_bug.cgi?id=226658
        <rdar://problem/78882016 >

        Reviewed by Ryan Haddad.

        * CISupport/ews-build/steps.py:
        (RunWebKitTests): Change invocation to Python 3.
        * CISupport/ews-build/steps_unittest.py:
        (test_success):
        (test_warnings):

2022-02-27  Dewei Zhu  <dewei_zhu@apple.com>

        'run-benchmark' script should log http requests during benchmark run.
        https://bugs.webkit.org/show_bug.cgi?id=237076
        <rdar://89270825>

        Reviewed by Simon Fraser.

        Add support to log http requests during benchmark run for diagnostic purpose.
        * Scripts/webkitpy/__init__.py: Update 'attr' package version to 20.3.0 so match upgraded twisted version
        * Scripts/webkitpy/autoinstalled/twisted.py: Upgrade twisted version to latest python2 & python3 compatibile
        version.
        * Scripts/webkitpy/benchmark_runner/benchmark_runner.py: Ensure benchmark diagnostic directory is created.
        (BenchmarkRunner.__init__):
        * Scripts/webkitpy/benchmark_runner/http_server_driver/http_server/twisted_http_server.py: Add '--log-path'
        arugment to allow specify logging output and it defaults to '/tmp/run-benchmark-http.log'
        * Scripts/webkitpy/benchmark_runner/http_server_driver/http_server_driver.py:
        (HTTPServerDriver.set_device_id):
        (HTTPServerDriver):
        (HTTPServerDriver.set_http_log):
        * Scripts/webkitpy/benchmark_runner/http_server_driver/simple_http_server_driver.py: Pass http log path to
        twisted http server if specified.
        (SimpleHTTPServerDriver.__init__):
        (SimpleHTTPServerDriver.serve):
        (SimpleHTTPServerDriver.set_http_log):
        * Scripts/webkitpy/benchmark_runner/run_benchmark.py: Fix a tiny bug that default_diagnose_dir() is involked twice in
        argument parser help message.
        (config_argument_parser):
        * Scripts/webkitpy/benchmark_runner/webserver_benchmark_runner.py: Set http request log path if diagnostic directory
        is specified.
        (WebServerBenchmarkRunner.__init__):


2022-02-27  Jonathan Bedard  <jbedard@apple.com>

        webkitpy: WebSocket server doesn't support Python 3
        https://bugs.webkit.org/show_bug.cgi?id=230319
        <rdar://problem/58814743>

        Reviewed by Fujii Hironori.

        * Scripts/new-run-webkit-websocketserver: Change shebang.
        * Scripts/webkitpy/layout_tests/servers/websocket_server.py:
        (PyWebSocket._prepare_config): Invoke WebSocket server with Python 3.

2022-02-27  Chris Dumez  <cdumez@apple.com>

        Omit template parameter for SetForScope<> variables
        https://bugs.webkit.org/show_bug.cgi?id=237258

        Reviewed by Darin Adler.

        * TestWebKitAPI/Tests/WTF/SetForScope.cpp:
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/Tests/WebKitCocoa/WKInspectorDelegate.mm:
        (TEST):
        * TestWebKitAPI/mac/TestFontOptions.mm:
        (-[TestFontOptions setShadowWidth:]):
        (-[TestFontOptions setShadowHeight:]):
        (-[TestFontOptions setShadowBlurRadius:]):
        (-[TestFontOptions setHasShadow:]):
        (-[TestFontOptions setForegroundColor:]):
        (-[TestFontOptions setBackgroundColor:]):
        * WebKitTestRunner/TestController.cpp:
        (WTR::TestController::resetStateToConsistentValues):
        (WTR::TestController::reattachPageToWebProcess):

2022-02-27  Chris Dumez  <cdumez@apple.com>

        Call WKNavigationDelegate.didFailProvisionalNavigation even after a cross-origin navigation with COOP
        https://bugs.webkit.org/show_bug.cgi?id=237071
        <rdar://problem/89354367>

        Reviewed by Darin Adler.

        Add API test coverage (Test was written by Alex Christensen).

        * TestWebKitAPI/Tests/WebKitCocoa/Navigation.mm:
        (TEST):

2022-02-25  Sihui Liu  <sihui_liu@apple.com>

        [macOS] TestWebKitAPI.WebKit.MigrateLocalStorageDataToGeneralStorageDirectory is a flaky failure
        https://bugs.webkit.org/show_bug.cgi?id=237065
        <rdar://problem/89324250>

        Reviewed by Alexey Proskuryakov.

        * TestWebKitAPI/Tests/WebKitCocoa/WebsiteDataStoreCustomPaths.mm:
        (TEST):

2022-02-25  Wenson Hsieh  <wenson_hsieh@apple.com>

        Adjust -[WKContentView _requiresKeyboardWhenFirstResponder] to account for editable web views
        https://bugs.webkit.org/show_bug.cgi?id=237226
        rdar://89447095

        Reviewed by Aditya Keerthi.

        Add an API test to exercise the change. This new API test is comprised of 3 parts:
        - Verify that `-_requiresKeyboardWhenFirstResponder` is NO after loading the page.
        - Verify that `-_requiresKeyboardWhenFirstResponder` becomes YES after making the web view editable.
        - Verify that `-_requiresKeyboardWhenFirstResponder` is NO again after focusing a readonly input inside the
          now-editable web view.

        * TestWebKitAPI/Tests/ios/KeyboardInputTestsIOS.mm:
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/ios/UIKitSPI.h:

2022-02-25  J Pascoe  <j_pascoe@apple.com>

        [WebAuthn] Fallback to attestation=none whenever attestation fails
        https://bugs.webkit.org/show_bug.cgi?id=237223
        rdar://88767812

        Reviewed by Brent Fulgham.

        Add test for local authenticator attestation fallback behavior.

        * TestWebKitAPI/Tests/WebKitCocoa/_WKWebAuthenticationPanel.mm:
        (TestWebKitAPI::TEST):

2022-02-25  Brent Fulgham  <bfulgham@apple.com>

        WebKit continues to render PDF images in Captive Portal mode
        https://bugs.webkit.org/show_bug.cgi?id=237120
        <rdar://problem/89384234>

        Reviewed by Chris Dumez.

        WebKit should handle all PDF processing in PDF.JS when in Captive Portal mode. However, testing
        revealed that PDF images are still rendered natively. As a first step we should bypass the
        native PDF code path. A subsequent patch will handle in PDF.JS.

        We need to thread the state of the Captive Portal setting through the image loading code so that
        WebKit knows to bail out before consuming the PDF data in the native decoder.

        * TestWebKitAPI/TestWebKitAPI.xcodeproj/project.pbxproj:
        * TestWebKitAPI/Tests/WebKitCocoa/CaptivePortalPDF.html: Added.
        * TestWebKitAPI/Tests/WebKitCocoa/ProcessSwapOnNavigation.mm:
        (-[CaptivePortalMessageHandler userContentController:didReceiveScriptMessage:]): Add new test case.
        * TestWebKitAPI/Tests/WebKitCocoa/webkit-logo.pdf: Added.

2022-02-25  Sihui Liu  <sihui_liu@apple.com>

        Regression(r242729): m_origin in IDBDatabaseIdentifier is incorrect
        https://bugs.webkit.org/show_bug.cgi?id=237044

        Reviewed by Youenn Fablet.

        * TestWebKitAPI/Tests/WebKitCocoa/IndexedDBPersistence.mm:
        (-[IndexedDBMessageHandler userContentController:didReceiveScriptMessage:]):
        (TEST):

2022-02-25  Alex Christensen  <achristensen@webkit.org>

        Re-add YouTubePluginReplacement, removed in r285252
        https://bugs.webkit.org/show_bug.cgi?id=237182

        Reviewed by Chris Dumez.

        * TestWebKitAPI/TestWebKitAPI.xcodeproj/project.pbxproj:
        * TestWebKitAPI/Tests/WebCore/YouTubePluginReplacement.cpp:

2022-02-24  Jonathan Bedard  <jbedard@apple.com>

        [Python 3] Invoke validate-committer-lists with Python 3
        https://bugs.webkit.org/show_bug.cgi?id=237171
        <rdar://problem/89449485>

        Reviewed by Alexey Proskuryakov.

        * Scripts/validate-committer-lists:
        (CommitterListFromMailingList): Use https urls.
        (CommitterListFromMailingList._fetch_authors_and_last_commit_time_from_git_log):
        Handle commits in the canonical repository.
        (CommitterListFromGit.possibly_expired_committers): Use Python 3 sorting idioms.
        (CommitterListFromGit.possibly_inactive_reviewers): Declare process encoding.
        (CommitterListFromGit.print_possibly_expired_committers): Committers which are not in
        contributors.json or are only contributors cannot have expired committer status.
        (CommitterListFromGit.print_possibly_inactive_reviewers): String already utf-8.
        (CommitterListFromGit.print_committers_missing_from_committer_list): Check contributors,
        not committers.
        * Scripts/webkitpy/common/net/bugzilla/bugzilla.py:
        (BugzillaQueries.fetch_bugs_matching_quicksearch): Make urllib.quote invocations Python 3 compatible.
        (BugzillaQueries.fetch_bugs_matching_search): Ditto.
        (BugzillaQueries.fetch_bugs_from_review_queue): Ditto.
        (BugzillaQueries.fetch_login_userid_pairs_matching_substring): Ditto.
        (BugzillaQueries.is_invalid_bugzilla_email): Ditto.

2022-02-25  Kimmo Kinnunen  <kkinnunen@apple.com>

        REGRESSION(r289580): [ iOS macOS ] TestWebKitAPI.IPCTestingAPI.CanReceiveSharedMemory is a constant timeout
        https://bugs.webkit.org/show_bug.cgi?id=236744

        Reviewed by Antti Koivisto.

        * TestWebKitAPI/Tests/WebKitCocoa/IPCTestingAPI.mm:

2022-02-25  Carlos Garcia Campos  <cgarcia@igalia.com>

        AX: List item marker not exposed when not a direct child of a list item
        https://bugs.webkit.org/show_bug.cgi?id=236777
        <rdar://problem/89082485>

        Reviewed by Adrian Perez de Castro.

        * WebKitTestRunner/InjectedBundle/atspi/AccessibilityUIElementAtspi.cpp:
        (WTR::roleValueToString): Return AXStatic for Text role too.

2022-02-24  Alex Christensen  <achristensen@webkit.org>

        Unreviewed, reverting r290371.

        Caused assertion

        Reverted changeset:

        "Call WKNavigationDelegate.didFailProvisionalNavigation even
        after a cross-origin navigation with COOP"
        https://bugs.webkit.org/show_bug.cgi?id=237071
        https://commits.webkit.org/r290371

2022-02-24  Aditya Keerthi  <akeerthi@apple.com>

        [iOS] Add support for replacing WKFoundTextRanges
        https://bugs.webkit.org/show_bug.cgi?id=237151
        rdar://89258687

        Reviewed by Wenson Hsieh.

        Add a test that replaces found ranges.

        * TestWebKitAPI/Tests/WebKitCocoa/FindInPage.mm:
        (TEST):

2022-02-24  Jonathan Bedard  <jbedard@apple.com>

        [Python3] Remove shebangs from webkitpy files
        https://bugs.webkit.org/show_bug.cgi?id=237167
        <rdar://problem/89444955>

        Reviewed by Dewei Zhu.

        * Scripts/webkitpy/browserperfdash/browserperfdash_runner.py: Remove shebang.
        * Scripts/webkitpy/browserperfdash/browserperfdash_unittest.py: Ditto.
        * Scripts/webkitpy/common/attribute_saver.py: Ditto.
        * Scripts/webkitpy/common/attribute_saver_unittest.py: Ditto.
        * Scripts/webkitpy/common/net/bugzilla/test_expectation_updater.py: Ditto.
        * Scripts/webkitpy/common/net/bugzilla/test_expectation_updater_unittest.py: Ditto.
        * Scripts/webkitpy/layout_tests/servers/run_webkit_httpd.py: Ditto.
        * Scripts/webkitpy/layout_tests/views/buildbot_results.py: Ditto.
        * Scripts/webkitpy/w3c/test_converter.py: Ditto.
        * Scripts/webkitpy/w3c/test_importer.py: Ditto.
        * Scripts/webkitpy/w3c/test_parser.py: Ditto.
        * Scripts/webkitpy/xcode/sdk.py: Ditto.
        * Scripts/webkitpy/xcode/sdk_unittest.py: Ditto.

2022-02-24  Jonathan Bedard  <jbedard@apple.com>

        [Python3] Change shebang for various scripts
        https://bugs.webkit.org/show_bug.cgi?id=237155
        <rdar://problem/89436097>

        Reviewed by Ryan Haddad.

        * Scripts/lint-webkitpy: Change shebang to Python 3.
        * Scripts/open-layout-test: Ditto.
        * Scripts/run-imagediff: Ditto.
        * Scripts/run-minibrowser: Ditto.
        * Scripts/run-webkit-httpd: Ditto.
        * Scripts/test-webkit-scripts: Ditto.

2022-02-24  Jonathan Bedard  <jbedard@apple.com>

        [Python3] Make report-non-inclusive-language Python 3 compatible
        https://bugs.webkit.org/show_bug.cgi?id=237154
        <rdar://problem/89434987>

        Reviewed by Aakash Jain.

        * Scripts/report-non-inclusive-language: Make Python 3 compatible.

2022-02-24  Jonathan Bedard  <jbedard@apple.com>

        [Python3] Migrate Tools/CISupport to Python3
        https://bugs.webkit.org/show_bug.cgi?id=237148
        <rdar://problem/89430395>

        Reviewed by Aakash Jain.

        * CISupport/build-webkit-org/committer_auth_unittest_old.py: Removed.
        * CISupport/build-webkit-org/loadConfig_unittest.py: Change shebang to Python 3.
        * CISupport/build-webkit-org/make_passwords_json.py: Change shebang to Python 3,
        make Python 3 compatible.
        * CISupport/ews-build/email_unittest.py: Change shebang to Python 3.
        * CISupport/ews-build/loadConfig_unittest.py: Ditto.
        * CISupport/win/kill-old-processes: Ditto.

2022-02-24  Wenson Hsieh  <wenson_hsieh@apple.com>

        Refactor logic for showing "Markup Image" and Quick Note items in the callout bar
        https://bugs.webkit.org/show_bug.cgi?id=237127
        rdar://89396617

        Reviewed by Megan Gardner.

        Adjust a couple of existing API tests. See comments below.

        * TestWebKitAPI/TestWebKitAPI.xcodeproj/project.pbxproj:
        * TestWebKitAPI/Tests/WebKitCocoa/ImageAnalysisTests.mm:

        Refactor ImageAnalysisTests.MenuControllerItems to exercise `-buildMenuWithBuilder:` instead of swizzling
        UIMenuController methods and checking `-menuItems`.

        (TestWebKitAPI::swizzledSetMenuItems): Deleted.
        (): Deleted.
        * TestWebKitAPI/Tests/WebKitCocoa/WKContentViewEditingActions.mm:

        Refactor WebKit.AppHighlightsInImageOverlays to exercise `-buildMenuWithBuilder:` instead of passing in actions
        to `-targetForAction:withSender:`.

        * TestWebKitAPI/ios/TestUIMenuBuilder.h: Added.
        * TestWebKitAPI/ios/TestUIMenuBuilder.mm: Added.

        Add a helper class that conforms to UIMenuBuilder. This is used in the two API tests above as an argument to
        `-buildMenuWithBuilder:` in order to collect additional menu items that WKWebView adds to the callout bar.

        (-[TestUIMenuBuilder init]):
        (-[TestUIMenuBuilder system]):
        (-[TestUIMenuBuilder menuForIdentifier:]):
        (-[TestUIMenuBuilder findMatching:]):
        (-[TestUIMenuBuilder containsActionWithTitle:]):
        (-[TestUIMenuBuilder reset]):
        (-[TestUIMenuBuilder actionForIdentifier:]):
        (-[TestUIMenuBuilder commandForAction:propertyList:]):
        (-[TestUIMenuBuilder replaceMenuForIdentifier:withMenu:]):
        (-[TestUIMenuBuilder replaceChildrenOfMenuForIdentifier:fromChildrenBlock:]):
        (-[TestUIMenuBuilder insertChildMenu:atStartOfMenuForIdentifier:]):
        (-[TestUIMenuBuilder insertChildMenu:atEndOfMenuForIdentifier:]):
        (-[TestUIMenuBuilder removeMenuForIdentifier:]):
        (-[TestUIMenuBuilder insertSiblingMenu:beforeMenuForIdentifier:]):
        (-[TestUIMenuBuilder insertSiblingMenu:afterMenuForIdentifier:]):
        (-[TestUIMenuBuilder registerMenu:]):

2022-02-24  Jonathan Bedard  <jbedard@apple.com>

        [Python3] Convert shebangs in generate_xcfilelists_lib
        https://bugs.webkit.org/show_bug.cgi?id=237147
        <rdar://problem/89427981>

        Reviewed by Alexey Proskuryakov.

        * Scripts/webkitpy/generate_xcfilelists_lib/__init__.py: Change shebang to Python 3.
        * Scripts/webkitpy/generate_xcfilelists_lib/application.py: Ditto.
        * Scripts/webkitpy/generate_xcfilelists_lib/generators.py: Ditto.
        * Scripts/webkitpy/generate_xcfilelists_lib/util.py: Ditto.

2022-02-24  Devin Rousso  <drousso@apple.com>

        [MacCatalyst] REGRESSION(r290091): sometimes can crash if `WKWebView` is deallocated before the next visible content rect update
        https://bugs.webkit.org/show_bug.cgi?id=237126
        <rdar://problem/89345853>

        Reviewed by Tim Horton.

        * TestWebKitAPI/Tests/WebKitCocoa/WKWebViewResize.mm: Added.
        (TEST.WKWebViewResize.DoesNotAssertInDeallocAfterChangingFrame):
        (TEST.WKWebViewResize.DoesNotAssertInDeallocAfterChangingBounds):

        * TestWebKitAPI/SourcesCocoa.txt:
        * TestWebKitAPI/TestWebKitAPI.xcodeproj/project.pbxproj:

2022-02-24  J Pascoe  <j_pascoe@apple.com>

        Add myself (John Pascoe) to watchlist for authentication and WebCrypto
        https://bugs.webkit.org/show_bug.cgi?id=237121
        rdar://problem/89385797

        Reviewed by Alexey Proskuryakov.

        * Scripts/webkitpy/common/config/watchlist:

2022-02-22  Jonathan Bedard  <jbedard@apple.com>

        [run-webkit-tests] Use Python 3 (Part 2)
        https://bugs.webkit.org/show_bug.cgi?id=226658
        <rdar://problem/78882016>

        Reviewed by Ryan Haddad.

        * Scripts/run-webkit-tests: Change shebang to Python 3.

2022-02-24  Kimmo Kinnunen  <kkinnunen@apple.com>

        Thread safety analysis to assert "code is run sequentially" is not useful when code is mainly run with WorkQueues
        https://bugs.webkit.org/show_bug.cgi?id=236832

        Reviewed by Antti Koivisto.

        Test the added functionality to be able to use assertIsCurrent(thread/workQueue).

        Fix WTF_WorkQueue.DestroyDispatchedOnDispatchQueue test, it is now able to make the assertion correctly.
        - The object is created somewhere that is not the tested WorkQueue
        - The object is destroyed in the tested WorkQueue

        * Scripts/generate-gpup-webgl:
        * TestWebKitAPI/Tests/WTF/Threading.cpp:
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/Tests/WTF/WorkQueue.cpp:
        (TestWebKitAPI::TEST):

2022-02-23  Chris Dumez  <cdumez@apple.com>

        Adopt more widely the new URL constructor that takes in a String
        https://bugs.webkit.org/show_bug.cgi?id=237099

        Reviewed by Darin Adler.

        * TestWebKitAPI/Tests/WTF/URLParser.cpp:
        (TestWebKitAPI::checkURL):
        (TestWebKitAPI::checkURLDifferences):
        (TestWebKitAPI::testUserPassword):
        * TestWebKitAPI/Tests/WTF/cocoa/URLExtras.mm:
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/Tests/WebCore/ContentExtensions.cpp:
        (TestWebKitAPI::mainDocumentRequest):
        (TestWebKitAPI::subResourceRequest):
        (TestWebKitAPI::requestInTopAndFrameURLs):
        (TestWebKitAPI::TEST_F):
        * TestWebKitAPI/Tests/WebCore/RegistrableDomain.cpp:
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/Tests/WebCore/SecurityOrigin.cpp:
        (TestWebKitAPI::TEST_F):
        * TestWebKitAPI/Tests/WebCore/curl/Cookies.cpp:
        (TestWebKitAPI::Curl::TEST_F):
        * TestWebKitAPI/Tests/WebKitCocoa/ApplicationManifest.mm:
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/Tests/WebKitCocoa/TestSOAuthorization.mm:
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/Tests/mac/SSLKeyGenerator.mm:

2022-02-23  Wenson Hsieh  <wenson_hsieh@apple.com>

        REGRESSION (288925?): [iOS] TestWebKitAPI.RequestTextInputContext.TextInteraction_FocusingReadOnlyElementShouldScrollToReveal is failing
        https://bugs.webkit.org/show_bug.cgi?id=237069
        rdar://89325305

        Reviewed by Kate Cheney.

        This iOS API test occasionally fails in some test runners in automation, due to `didScroll` still being false at
        the end of the test. While I was unable to reproduce (both locally, and using EWS test runners), from code
        inspection this test appears to be inherently flaky since the scrolling is triggered via editor state updates
        propagated through remote layer tree commits; however, the test only verifies that scrolling occurs after one
        IPC round-trip between the web and UI processes (due to the call to `-stringByEvaluatingJavaScript:`).

        Since the regression point is suspiciously close to r288925, it's possible that the optimizations introduced in
        r288925 removed an extra sync IPC round-trip to the web process and back when requesting an autocorrection
        context after element focus, which would make this flakiness easier to reproduce in some configurations.

        In any case, one speculative fix for this test is to simply wait for the scrolling to occur, instead of assuming
        that it occurs after a single IPC round-trip.

        * TestWebKitAPI/Tests/WebKitCocoa/RequestTextInputContext.mm:
        (TestWebKitAPI::TEST):

2022-02-23  Jonathan Bedard  <jbedard@apple.com>

        [run-webkit-tests] Catch OSError when sampling
        https://bugs.webkit.org/show_bug.cgi?id=237087
        <rdar://problem/89357299>

        Reviewed by Aakash Jain.

        * Scripts/webkitpy/port/darwin.py:
        (DarwinPort.sample_process): Catch OSError when either sampling a
        process or running spindump. These errors indicate the error gathering process
        failed, but such a failure should not be fatal to the entire test run.

2022-02-23  J Pascoe  <j_pascoe@apple.com>

        [WebAuthn] userHandle not marked nullable in _WKWebAuthenticationAssertionResponse
        https://bugs.webkit.org/show_bug.cgi?id=237043
        rdar://89317740

        Reviewed by Brent Fulgham.

        Create tests to check for null userHandle.

        * TestWebKitAPI/Tests/WebKitCocoa/_WKWebAuthenticationPanel.mm:
        (TestWebKitAPI::TEST):

2022-02-23  Philippe Normand  <pnormand@igalia.com>

        [GStreamer] De-initialize GStreamer before terminating WebProcess
        https://bugs.webkit.org/show_bug.cgi?id=237084

        Reviewed by Carlos Garcia Campos.

        * flatpak/flatpakutils.py:
        (WebkitFlatpak.setup_gstbuild): Do not add extra quotes to GST_TRACERS, this is not supposed
        to store paths.

2022-02-23  Alex Christensen  <achristensen@webkit.org>

        Call WKNavigationDelegate.didFailProvisionalNavigation even after a cross-origin navigation with COOP
        https://bugs.webkit.org/show_bug.cgi?id=237071
        <rdar://88652375>

        Reviewed by Chris Dumez.

        * TestWebKitAPI/Tests/WebKitCocoa/Navigation.mm:
        (TEST):

2022-02-23  Angelos Oikonomopoulos  <angelos@igalia.com>

        [JSC] Set ssh keepalive in run-jsc-stress-tests
        https://bugs.webkit.org/show_bug.cgi?id=237031

        Reviewed by Adrian Perez de Castro.

        If a remote goes down after an ssh connection has been established, we
        need to be able to detect that. Keep the common ssh config options in
        one constant and add ServerAliveInterval=30 to it.

        While here, change sshRead to execute ssh directly (instead of
        going through the shell). Similarly, don't open-code the read
        loop, just call IO.read.

        * Scripts/run-jsc-stress-tests:

2022-02-23  Kimmo Kinnunen  <kkinnunen@apple.com>

        Fix GPUP WebGL generator script wrt uninitialised sized span
        https://bugs.webkit.org/show_bug.cgi?id=235889

        Reviewed by Antti Koivisto.
        Fix the generator. The r290328 only edited the generated files.
        Add a other hunk missing from r290175.

        * Scripts/generate-gpup-webgl:

2022-02-23  Zan Dobersek  <zdobersek@igalia.com>

        [GStreamer] Add WebKitDMABufVideoSink
        https://bugs.webkit.org/show_bug.cgi?id=236883

        Reviewed by Philippe Normand.

        * Scripts/webkitpy/style/checker.py:
        Add two additional files under the GObject-style exceptions.

2022-02-23  Kimmo Kinnunen  <kkinnunen@apple.com>

        Thread safety analysis macros are confusing for non-Lock use-cases
        https://bugs.webkit.org/show_bug.cgi?id=237022

        Reviewed by Chris Dumez.

        * Scripts/webkitpy/style/checkers/cpp.py:
        (check_identifier_name_in_declaration):
        * TestWebKitAPI/Tests/WTF/ThreadAssertionsTest.cpp:
        (TestWebKitAPI::WTF_REQUIRES_CAPABILITY):

2022-02-23  Youenn Fablet  <youenn@apple.com>

        Enable WebRTCRemoteVideoFrameEnabled by default in WebKitTestRunner
        https://bugs.webkit.org/show_bug.cgi?id=236969

        Reviewed by Eric Carlson.

        * WebKitTestRunner/TestOptions.cpp:

2022-02-22  Chris Dumez  <cdumez@apple.com>

        Drop StringHasher::hashMemory() and use the modern Hasher instead
        https://bugs.webkit.org/show_bug.cgi?id=237049

        Reviewed by Sam Weinig.

        * TestWebKitAPI/Tests/WTF/StringHasher.cpp:

2022-02-22  Ryan Haddad  <ryanhaddad@apple.com>

        REGRESSION(r289580): [ iOS macOS ] TestWebKitAPI.IPCTestingAPI.CanReceiveSharedMemory is a constant timeout
        https://bugs.webkit.org/show_bug.cgi?id=236744

        Unreviewed test gardening.

        * TestWebKitAPI/Tests/WebKitCocoa/IPCTestingAPI.mm: Disable the test.
        (TEST):

2022-02-17  Ryan Haddad  <ryanhaddad@apple.com>

        Remove dormant queues from bot watchers dashboard
        https://bugs.webkit.org/show_bug.cgi?id=236809

        Reviewed by Alexey Proskuryakov.

        * CISupport/build-webkit-org/public_html/dashboard/Scripts/Dashboard.js:
        * CISupport/build-webkit-org/public_html/dashboard/Scripts/WebKitBuildbot.js:
        (WebKitBuildbot):
        * Tools/CISupport/build-webkit-org/public_html/dashboard/Styles/Main.css:

2022-02-22  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Link to GitHub wiki
        https://bugs.webkit.org/show_bug.cgi?id=237048
        <rdar://problem/89307995>

        Reviewed by Ryan Haddad.

        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/setup.py:
        (Setup.main): Add GitHub wiki link.
        * Scripts/libraries/webkitscmpy/webkitscmpy/test/setup_unittest.py:
        (TestSetup.test_github):

2022-02-22  Philippe Normand  <pnormand@igalia.com>

        [GStreamer] Switch media player to playbin3
        https://bugs.webkit.org/show_bug.cgi?id=236884

        Reviewed by Xabier Rodriguez-Calvar.

        Replace WEBKIT_GST_USE_PLAYBIN3 with WEBKIT_GST_USE_PLAYBIN2 that allows to opt-out of
        playbin3, if this is desired.

        * Scripts/webkitpy/port/gtk.py:
        (GtkPort.setup_environ_for_server):
        * Scripts/webkitpy/port/wpe.py:
        (WPEPort.setup_environ_for_server):

2022-02-22  Jonathan Bedard  <jbedard@apple.com>

        [git-webkit] Extract revision from `git svn dcommit`
        https://bugs.webkit.org/show_bug.cgi?id=236849
        <rdar://problem/89155179>

        Reviewed by Ryan Haddad.

        * Scripts/libraries/webkitscmpy/setup.py: Bump version.
        * Scripts/libraries/webkitscmpy/webkitscmpy/__init__.py: Ditto.
        * Scripts/libraries/webkitscmpy/webkitscmpy/mocks/local/git.py:
        (Git): Thoroughly mock `dcommit`
        * Scripts/libraries/webkitscmpy/webkitscmpy/program/land.py:
        (Land.main): Extract committed SVN revision from `git svn dcommit` command to accurately
        match landed commits to the pull request that generated them.
        * Scripts/libraries/webkitscmpy/webkitscmpy/test/land_unittest.py:
        (repository): Add revision to local commit.

2022-02-22  Dean Jackson  <dino@apple.com>

        Filter some build output from JSC
        https://bugs.webkit.org/show_bug.cgi?id=236885

        Reviewed by Simon Fraser.

        Add some filter rules for recently added output. In particular:
        - whatever prints out the build command
        - python executables now having the version numbers in the binary
        - creating entitlements files

        * Scripts/filter-build-webkit:
        (shouldIgnoreLine):

2022-02-22  Aditya Keerthi  <akeerthi@apple.com>

        [iOS] Adopt new _UITextSearching method for range comparison
        https://bugs.webkit.org/show_bug.cgi?id=237012
        rdar://88442811

        Reviewed by Devin Rousso.

        Ensure TestSearchAggregator conforms to _UITextSearchAggregator.

        * TestWebKitAPI/Tests/WebKitCocoa/FindInPage.mm:
        (-[TestSearchAggregator initWithCompletionHandler:]):
        (-[TestSearchAggregator allFoundRanges]):
        (-[TestSearchAggregator invalidateFoundRange:inDocument:]):
        (-[TestSearchAggregator invalidate]):
        (textRangesForQueryString):
        (-[TestSearchAggregator foundRanges]): Deleted.

2022-02-22  Angelos Oikonomopoulos  <angelos@igalia.com>

        [JSC] Guard against dead remotes in numberOfProcessors
        https://bugs.webkit.org/show_bug.cgi?id=236643

        Reviewed by Adrian Perez de Castro.

        Instead of using only the first remote (and then defaulting to 1 when
        it happens to not respond), try all the remotes in sequence.

        Also, instead of trying the sysctl version on all hosts first and
        only try nproc after sysctl has failed on all hosts, combine
        sysctl and nproc in one command to speed things along.

        This change also removes the numProcessors == 0 typo in the rescue
        path.

        * Scripts/run-jsc-stress-tests:

2022-02-22  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Can't run performance tests due to a11y errors
        https://bugs.webkit.org/show_bug.cgi?id=230705

        Reviewed by Sergio Villar Senin.

        Disable a11y in WTR since it's no longer nedded with ATSPI.

        * WebKitTestRunner/gtk/main.cpp:
        (main):
        * WebKitTestRunner/wpe/main.cpp:
        (main):

2022-02-21  Brandon Stewart  <brandonstewart@apple.com>

        Use ArgumentParser for parsing args in generate-compile-commands
        https://bugs.webkit.org/show_bug.cgi?id=236995

        Reviewed by Alexey Proskuryakov.

        Use argument parser instead of sys.argv[1] for getting build dir.

        * Scripts/generate-compile-commands:

2022-02-21  Wenson Hsieh  <wenson_hsieh@apple.com>

        [iOS] Adjust some behaviors around the "Markup Image" action in the callout bar
        https://bugs.webkit.org/show_bug.cgi?id=236980

        Reviewed by Aditya Keerthi.

        Add an API test to verify that "Markup Image" appears as the first non-default callout bar item when a single
        image element is in the selection range. The test is comprised of three parts:

        1. Select just a single image, and expect the "Markup Image" item.
        2. Select all images in the document, and expect no "Markup Image" item.
        3. Select a single image and some surrounding text, and expect the "Markup Image" item.

        See WebKit/ChangeLog for more details.

        * TestWebKitAPI/Tests/WebKitCocoa/ImageAnalysisTests.mm:
        (TestWebKitAPI::createWebViewWithTextRecognitionEnhancements):
        (TestWebKitAPI::swizzledSetMenuItems):
        (TestWebKitAPI::TEST):
        * TestWebKitAPI/Tests/WebKitCocoa/multiple-images.html:

        Add some text before and after each image so that we can select a single image alongside some text, and exercise
        the changes in `WebPage::getPlatformEditorState` (see WebKit changes for more information).

2022-02-21  Jon Lee  <jonlee@apple.com>

        Add test name to the image diff template
        https://bugs.webkit.org/show_bug.cgi?id=237003

        Reviewed by Sam Weinig.

        * Scripts/webkitpy/layout_tests/controllers/test_result_writer.py:
        (TestResultWriter.write_image_diff_files):

== Rolled over to ChangeLog-2022-02-22 ==
