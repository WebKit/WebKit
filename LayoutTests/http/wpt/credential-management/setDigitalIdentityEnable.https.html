<!DOCTYPE html>
<html>
    <head>
        <title>
            Check that parts of the Digital Identity API are not exposed by
            setting
        </title>
    </head>
    <script>
        testRunner.dumpAsText();
        testRunner.waitUntilDone();

        if (window.navigator.credentials.requestIdentity !== undefined) {
            console.log("FAIL: requestIdentity() must not be exposed by default.");
        }

        if (window.DigitalIdentity !== undefined) {
            console.log(
                "FAIL: DigitalIdentity interface must not be exposed by default."
            );
        }

        window.internals.settings.setDigitalIdentityEnabled(true);

        async function checkIFrame() {
            const iframeWin = document.querySelector("iframe").contentWindow;

            if (!iframeWin.navigator.credentials.requestIdentity) {
                console.log(
                    "FAIL: navigator.credentials.requestIdentity() must be exposed. Was enabled by pref."
                );
            }

            const isInstanceOfDigitalIdentity =
                iframeWin.DigitalIdentity.prototype instanceof
                iframeWin.Credential;
            if (!isInstanceOfDigitalIdentity) {
                console.log(
                    "FAIL: DigitalIdentity's prototype interface must be an instance of Credential."
                );
            }
            console.log("Test finished");
            testRunner.notifyDone();
        }
    </script>
    <body>
        <iframe src="about:blank" onload="checkIFrame()"></iframe>
    </body>
</html>
