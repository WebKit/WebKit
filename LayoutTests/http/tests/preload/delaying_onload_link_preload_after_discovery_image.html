<!DOCTYPE html>
<script>
    if (window.internals)
        window.internals.settings.setLinkPreloadEnabled(true);
    if (window.testRunner) {
        testRunner.dumpAsText()
        testRunner.waitUntilDone();
    }
    var finishedImage = false;
</script>
<script src="/js-test-resources/js-test.js"></script>
<link rel=preload href="../resources/slow-image.php" as=image onload="finishedImage = true;">
<body>
<script>
    window.addEventListener("load", function() {
        shouldBeTrue("finishedImage");
        if (window.internals)
            window.internals.settings.setLinkPreloadEnabled(false);
        testRunner.notifyDone();
    });
    var img = new Image();
    img.src = "../resources/slow-image.php";
    document.body.appendChild(img);
</script>
</body>
