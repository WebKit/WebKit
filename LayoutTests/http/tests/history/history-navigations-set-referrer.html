<!DOCTYPE html>
<html>
<head>
<script>
if (window.testRunner) {
    testRunner.waitUntilDone();
    testRunner.dumpAsText();
}

function test() {
    history.replaceState("initialState", "", "");
    history.pushState("", "", "other.html");
    history.back();
}

onpopstate = function (evt) {
    if (evt.state == "initialState")
        location.href = "resources/check-referrer.html";
}
</script>
</head>
<body onload="test()">
<p>
Tests that when navigating back from a history entry that was created by
history.pushState(), the outgoing referrer is correctly updated.
</p>
<div>
FAIL: popstate event was never received
</div>
</body>
</html>

