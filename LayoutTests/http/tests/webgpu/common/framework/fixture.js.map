{"version":3,"file":"fixture.js","names":["assert","unreachable","SkipTestCase","Error","UnexpectedPassError","TestCaseRecorder","SubcaseBatchState","constructor","params","_params","init","postInit","finalize","Fixture","eventualExpectations","numOutstandingAsyncExpectations","objectsToCleanUp","MakeSharedState","sharedState","rec","_sharedState","length","p","shift","ex","threw","o","WEBGL_lose_context","getExtension","loseContext","destroy","close","trackForCleanup","push","tryTrackForCleanup","WebGLRenderingContext","WebGL2RenderingContext","debug","msg","skip","warn","fail","expectationFailed","immediateAsyncExpectation","fn","ret","eventualAsyncExpectation","promise","expectErrorValue","expectedError","niceStack","message","actualName","name","shouldResolve","m","shouldReject","expectedName","shouldThrow","expect","cond","expectOK","error","mode","handleError","stack","Array","isArray","e","eventualExpectOK"],"sources":["../../../src/common/framework/fixture.ts"],"sourcesContent":["import { TestCaseRecorder } from '../internal/logging/test_case_recorder.js';\nimport { JSONWithUndefined } from '../internal/params_utils.js';\nimport { assert, unreachable } from '../util/util.js';\n\nexport class SkipTestCase extends Error {}\nexport class UnexpectedPassError extends Error {}\n\nexport { TestCaseRecorder } from '../internal/logging/test_case_recorder.js';\n\n/** The fully-general type for params passed to a test function invocation. */\nexport type TestParams = {\n  readonly [k: string]: JSONWithUndefined;\n};\n\ntype DestroyableObject =\n  | { destroy(): void }\n  | { close(): void }\n  | { getExtension(extensionName: 'WEBGL_lose_context'): WEBGL_lose_context };\n\nexport class SubcaseBatchState {\n  private _params: TestParams;\n\n  constructor(params: TestParams) {\n    this._params = params;\n  }\n\n  /**\n   * Returns the case parameters for this test fixture shared state. Subcase params\n   * are not included.\n   */\n  get params(): TestParams {\n    return this._params;\n  }\n\n  /**\n   * Runs before the `.before()` function.\n   * @internal MAINTENANCE_TODO: Make this not visible to test code?\n   */\n  async init() {}\n  /**\n   * Runs between the `.before()` function and the subcases.\n   * @internal MAINTENANCE_TODO: Make this not visible to test code?\n   */\n  async postInit() {}\n  /**\n   * Runs after all subcases finish.\n   * @internal MAINTENANCE_TODO: Make this not visible to test code?\n   */\n  async finalize() {}\n}\n\n/**\n * A Fixture is a class used to instantiate each test sub/case at run time.\n * A new instance of the Fixture is created for every single test subcase\n * (i.e. every time the test function is run).\n */\nexport class Fixture<S extends SubcaseBatchState = SubcaseBatchState> {\n  private _params: unknown;\n  private _sharedState: S;\n  /**\n   * Interface for recording logs and test status.\n   *\n   * @internal\n   */\n  protected rec: TestCaseRecorder;\n  private eventualExpectations: Array<Promise<unknown>> = [];\n  private numOutstandingAsyncExpectations = 0;\n  private objectsToCleanUp: DestroyableObject[] = [];\n\n  public static MakeSharedState(params: TestParams): SubcaseBatchState {\n    return new SubcaseBatchState(params);\n  }\n\n  /** @internal */\n  constructor(sharedState: S, rec: TestCaseRecorder, params: TestParams) {\n    this._sharedState = sharedState;\n    this.rec = rec;\n    this._params = params;\n  }\n\n  /**\n   * Returns the (case+subcase) parameters for this test function invocation.\n   */\n  get params(): unknown {\n    return this._params;\n  }\n\n  /**\n   * Gets the test fixture's shared state. This object is shared between subcases\n   * within the same testcase.\n   */\n  get sharedState(): S {\n    return this._sharedState;\n  }\n\n  /**\n   * Override this to do additional pre-test-function work in a derived fixture.\n   * This has to be a member function instead of an async `createFixture` function, because\n   * we need to be able to ergonomically override it in subclasses.\n   *\n   * @internal MAINTENANCE_TODO: Make this not visible to test code?\n   */\n  async init(): Promise<void> {}\n\n  /**\n   * Override this to do additional post-test-function work in a derived fixture.\n   *\n   * Called even if init was unsuccessful.\n   *\n   * @internal MAINTENANCE_TODO: Make this not visible to test code?\n   */\n  async finalize(): Promise<void> {\n    assert(\n      this.numOutstandingAsyncExpectations === 0,\n      'there were outstanding immediateAsyncExpectations (e.g. expectUncapturedError) at the end of the test'\n    );\n\n    // Loop to exhaust the eventualExpectations in case they chain off each other.\n    while (this.eventualExpectations.length) {\n      const p = this.eventualExpectations.shift()!;\n      try {\n        await p;\n      } catch (ex) {\n        this.rec.threw(ex);\n      }\n    }\n\n    // And clean up any objects now that they're done being used.\n    for (const o of this.objectsToCleanUp) {\n      if ('getExtension' in o) {\n        const WEBGL_lose_context = o.getExtension('WEBGL_lose_context');\n        if (WEBGL_lose_context) WEBGL_lose_context.loseContext();\n      } else if ('destroy' in o) {\n        o.destroy();\n      } else {\n        o.close();\n      }\n    }\n  }\n\n  /**\n   * Tracks an object to be cleaned up after the test finishes.\n   *\n   * MAINTENANCE_TODO: Use this in more places. (Will be easier once .destroy() is allowed on\n   * invalid objects.)\n   */\n  trackForCleanup<T extends DestroyableObject>(o: T): T {\n    this.objectsToCleanUp.push(o);\n    return o;\n  }\n\n  /** Tracks an object, if it's destroyable, to be cleaned up after the test finishes. */\n  tryTrackForCleanup<T>(o: T): T {\n    if (typeof o === 'object' && o !== null) {\n      if (\n        'destroy' in o ||\n        'close' in o ||\n        o instanceof WebGLRenderingContext ||\n        o instanceof WebGL2RenderingContext\n      ) {\n        this.objectsToCleanUp.push((o as unknown) as DestroyableObject);\n      }\n    }\n    return o;\n  }\n\n  /** Log a debug message. */\n  debug(msg: string): void {\n    this.rec.debug(new Error(msg));\n  }\n\n  /** Throws an exception marking the subcase as skipped. */\n  skip(msg: string): never {\n    throw new SkipTestCase(msg);\n  }\n\n  /** Log a warning and increase the result status to \"Warn\". */\n  warn(msg?: string): void {\n    this.rec.warn(new Error(msg));\n  }\n\n  /** Log an error and increase the result status to \"ExpectFailed\". */\n  fail(msg?: string): void {\n    this.rec.expectationFailed(new Error(msg));\n  }\n\n  /**\n   * Wraps an async function. Tracks its status to fail if the test tries to report a test status\n   * before the async work has finished.\n   */\n  protected async immediateAsyncExpectation<T>(fn: () => Promise<T>): Promise<T> {\n    this.numOutstandingAsyncExpectations++;\n    const ret = await fn();\n    this.numOutstandingAsyncExpectations--;\n    return ret;\n  }\n\n  /**\n   * Wraps an async function, passing it an `Error` object recording the original stack trace.\n   * The async work will be implicitly waited upon before reporting a test status.\n   */\n  protected eventualAsyncExpectation<T>(fn: (niceStack: Error) => Promise<T>): void {\n    const promise = fn(new Error());\n    this.eventualExpectations.push(promise);\n  }\n\n  private expectErrorValue(expectedError: string | true, ex: unknown, niceStack: Error): void {\n    if (!(ex instanceof Error)) {\n      niceStack.message = `THREW non-error value, of type ${typeof ex}: ${ex}`;\n      this.rec.expectationFailed(niceStack);\n      return;\n    }\n    const actualName = ex.name;\n    if (expectedError !== true && actualName !== expectedError) {\n      niceStack.message = `THREW ${actualName}, instead of ${expectedError}: ${ex}`;\n      this.rec.expectationFailed(niceStack);\n    } else {\n      niceStack.message = `OK: threw ${actualName}: ${ex.message}`;\n      this.rec.debug(niceStack);\n    }\n  }\n\n  /** Expect that the provided promise resolves (fulfills). */\n  shouldResolve(p: Promise<unknown>, msg?: string): void {\n    this.eventualAsyncExpectation(async niceStack => {\n      const m = msg ? ': ' + msg : '';\n      try {\n        await p;\n        niceStack.message = 'resolved as expected' + m;\n      } catch (ex) {\n        niceStack.message = `REJECTED${m}`;\n        if (ex instanceof Error) {\n          niceStack.message += '\\n' + ex.message;\n        }\n        this.rec.expectationFailed(niceStack);\n      }\n    });\n  }\n\n  /** Expect that the provided promise rejects, with the provided exception name. */\n  shouldReject(expectedName: string, p: Promise<unknown>, msg?: string): void {\n    this.eventualAsyncExpectation(async niceStack => {\n      const m = msg ? ': ' + msg : '';\n      try {\n        await p;\n        niceStack.message = 'DID NOT REJECT' + m;\n        this.rec.expectationFailed(niceStack);\n      } catch (ex) {\n        niceStack.message = 'rejected as expected' + m;\n        this.expectErrorValue(expectedName, ex, niceStack);\n      }\n    });\n  }\n\n  /**\n   * Expect that the provided function throws.\n   * If an `expectedName` is provided, expect that the throw exception has that name.\n   */\n  shouldThrow(expectedError: string | boolean, fn: () => void, msg?: string): void {\n    const m = msg ? ': ' + msg : '';\n    try {\n      fn();\n      if (expectedError === false) {\n        this.rec.debug(new Error('did not throw, as expected' + m));\n      } else {\n        this.rec.expectationFailed(new Error('unexpectedly did not throw' + m));\n      }\n    } catch (ex) {\n      if (expectedError === false) {\n        this.rec.expectationFailed(new Error('threw unexpectedly' + m));\n      } else {\n        this.expectErrorValue(expectedError, ex, new Error(m));\n      }\n    }\n  }\n\n  /** Expect that a condition is true. */\n  expect(cond: boolean, msg?: string): boolean {\n    if (cond) {\n      const m = msg ? ': ' + msg : '';\n      this.rec.debug(new Error('expect OK' + m));\n    } else {\n      this.rec.expectationFailed(new Error(msg));\n    }\n    return cond;\n  }\n\n  /**\n   * If the argument is an `Error`, fail (or warn). If it's `undefined`, no-op.\n   * If the argument is an array, apply the above behavior on each of elements.\n   */\n  expectOK(\n    error: Error | undefined | (Error | undefined)[],\n    { mode = 'fail', niceStack }: { mode?: 'fail' | 'warn'; niceStack?: Error } = {}\n  ): void {\n    const handleError = (error: Error | undefined) => {\n      if (error instanceof Error) {\n        if (niceStack) {\n          error.stack = niceStack.stack;\n        }\n        if (mode === 'fail') {\n          this.rec.expectationFailed(error);\n        } else if (mode === 'warn') {\n          this.rec.warn(error);\n        } else {\n          unreachable();\n        }\n      }\n    };\n\n    if (Array.isArray(error)) {\n      for (const e of error) {\n        handleError(e);\n      }\n    } else {\n      handleError(error);\n    }\n  }\n\n  eventualExpectOK(\n    error: Promise<Error | undefined | (Error | undefined)[]>,\n    { mode = 'fail' }: { mode?: 'fail' | 'warn' } = {}\n  ) {\n    this.eventualAsyncExpectation(async niceStack => {\n      this.expectOK(await error, { mode, niceStack });\n    });\n  }\n}\n"],"mappings":"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"}