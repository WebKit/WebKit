{"version":3,"file":"setup-ts-in-node.js","names":["path","require","register","project","resolve","__dirname","compilerOptions","module","transpileOnly","Module","resolveFilename","_resolveFilename","request","parentModule","isMain","startsWith","filename","endsWith","Error","tsRequest","substring","length","call","ex","process","on"],"sources":["../../../src/common/tools/setup-ts-in-node.js"],"sourcesContent":["const path = require('path');\n\n// Automatically transpile .ts imports\nrequire('ts-node').register({\n  // Specify the project file so ts-node doesn't try to find it itself based on the CWD.\n  project: path.resolve(__dirname, '../../../tsconfig.json'),\n  compilerOptions: {\n    module: 'commonjs',\n  },\n  transpileOnly: true,\n});\nconst Module = require('module');\n\n// Redirect imports of .js files to .ts files\nconst resolveFilename = Module._resolveFilename;\nModule._resolveFilename = (request, parentModule, isMain) => {\n  do {\n    if (request.startsWith('.') && parentModule.filename.endsWith('.ts')) {\n      // Required for browser (because it needs the actual correct file path and\n      // can't do any kind of file resolution).\n      if (request.endsWith('/index.js')) {\n        throw new Error(\n          \"Avoid the name `index.js`; we don't have Node-style path resolution: \" + request\n        );\n      }\n\n      // Import of Node addon modules are valid and should pass through.\n      if (request.endsWith('.node')) {\n        break;\n      }\n\n      if (!request.endsWith('.js')) {\n        throw new Error('All relative imports must end in .js: ' + request);\n      }\n\n      try {\n        const tsRequest = request.substring(0, request.length - '.js'.length) + '.ts';\n        return resolveFilename.call(this, tsRequest, parentModule, isMain);\n      } catch (ex) {\n        // If the .ts file doesn't exist, try .js instead.\n        break;\n      }\n    }\n  } while (0);\n\n  return resolveFilename.call(this, request, parentModule, isMain);\n};\n\nprocess.on('unhandledRejection', ex => {\n  throw ex;\n});\n"],"mappings":";AAAA;AAAA,GAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC,CAAC,CAE7B;AACAA,OAAO,CAAC,SAAS,CAAC,CAACC,QAAQ,CAAC;EAC1B;EACAC,OAAO,EAAEH,IAAI,CAACI,OAAO,CAACC,SAAS,EAAE,wBAAwB,CAAC;EAC1DC,eAAe,EAAE;IACfC,MAAM,EAAE;EACV,CAAC;EACDC,aAAa,EAAE;AACjB,CAAC,CAAC;AACF,MAAMC,MAAM,GAAGR,OAAO,CAAC,QAAQ,CAAC;;AAEhC;AACA,MAAMS,eAAe,GAAGD,MAAM,CAACE,gBAAgB;AAC/CF,MAAM,CAACE,gBAAgB,GAAG,CAACC,OAAO,EAAEC,YAAY,EAAEC,MAAM,KAAK;EAC3D,GAAG;IACD,IAAIF,OAAO,CAACG,UAAU,CAAC,GAAG,CAAC,IAAIF,YAAY,CAACG,QAAQ,CAACC,QAAQ,CAAC,KAAK,CAAC,EAAE;MACpE;MACA;MACA,IAAIL,OAAO,CAACK,QAAQ,CAAC,WAAW,CAAC,EAAE;QACjC,MAAM,IAAIC,KAAK;QACb,uEAAuE,GAAGN,OAAO,CAClF;;MACH;;MAEA;MACA,IAAIA,OAAO,CAACK,QAAQ,CAAC,OAAO,CAAC,EAAE;QAC7B;MACF;;MAEA,IAAI,CAACL,OAAO,CAACK,QAAQ,CAAC,KAAK,CAAC,EAAE;QAC5B,MAAM,IAAIC,KAAK,CAAC,wCAAwC,GAAGN,OAAO,CAAC;MACrE;;MAEA,IAAI;QACF,MAAMO,SAAS,GAAGP,OAAO,CAACQ,SAAS,CAAC,CAAC,EAAER,OAAO,CAACS,MAAM,GAAG,KAAK,CAACA,MAAM,CAAC,GAAG,KAAK;QAC7E,OAAOX,eAAe,CAACY,IAAI,CAAC,IAAI,EAAEH,SAAS,EAAEN,YAAY,EAAEC,MAAM,CAAC;MACpE,CAAC,CAAC,OAAOS,EAAE,EAAE;QACX;QACA;MACF;IACF;EACF,CAAC,QAAQ,CAAC;;EAEV,OAAOb,eAAe,CAACY,IAAI,CAAC,IAAI,EAAEV,OAAO,EAAEC,YAAY,EAAEC,MAAM,CAAC;AAClE,CAAC;;AAEDU,OAAO,CAACC,EAAE,CAAC,oBAAoB,EAAE,CAAAF,EAAE,KAAI;EACrC,MAAMA,EAAE;AACV,CAAC,CAAC"}