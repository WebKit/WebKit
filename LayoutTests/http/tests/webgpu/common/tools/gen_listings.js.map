{"version":3,"file":"gen_listings.js","names":["fs","path","process","crawl","usage","rc","console","error","exit","argv","indexOf","validate","i","splice","length","myself","outDir","suiteDir","slice","listing","suite","basename","outFile","normalize","join","mkdirSync","recursive","writeFileSync","JSON","stringify","undefined","unlinkSync","ex"],"sources":["../../../src/common/tools/gen_listings.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport * as process from 'process';\n\nimport { crawl } from './crawl.js';\n\nfunction usage(rc: number): void {\n  console.error(`Usage: tools/gen_listings [options] [OUT_DIR] [SUITE_DIRS...]\n\nFor each suite in SUITE_DIRS, generate listings and write each listing.js\ninto OUT_DIR/{suite}/listing.js. Example:\n  tools/gen_listings out/ src/unittests/ src/webgpu/\n\nOptions:\n  --help          Print this message and exit.\n  --no-validate   Whether to validate test modules while crawling.\n`);\n  process.exit(rc);\n}\n\nconst argv = process.argv;\nif (argv.indexOf('--help') !== -1) {\n  usage(0);\n}\n\nlet validate = true;\n{\n  const i = argv.indexOf('--no-validate');\n  if (i !== -1) {\n    validate = false;\n    argv.splice(i, 1);\n  }\n}\n\nif (argv.length < 4) {\n  usage(0);\n}\n\nconst myself = 'src/common/tools/gen_listings.ts';\n\nconst outDir = argv[2];\n\nvoid (async () => {\n  for (const suiteDir of argv.slice(3)) {\n    const listing = await crawl(suiteDir, validate);\n\n    const suite = path.basename(suiteDir);\n    const outFile = path.normalize(path.join(outDir, `${suite}/listing.js`));\n    fs.mkdirSync(path.join(outDir, suite), { recursive: true });\n    fs.writeFileSync(\n      outFile,\n      `\\\n// AUTO-GENERATED - DO NOT EDIT. See ${myself}.\n\nexport const listing = ${JSON.stringify(listing, undefined, 2)};\n`\n    );\n    try {\n      fs.unlinkSync(outFile + '.map');\n    } catch (ex) {\n      // ignore if file didn't exist\n    }\n  }\n})();\n"],"mappings":";AAAA;AAAA,GAAA,OAAO,KAAKA,EAAE,MAAM,IAAI,CACxB,OAAO,KAAKC,IAAI,MAAM,MAAM,CAC5B,OAAO,KAAKC,OAAO,MAAM,SAAS;;AAElC,SAASC,KAAK,QAAQ,YAAY;;AAElC,SAASC,KAAK,CAACC,EAAU,EAAQ;EAC/BC,OAAO,CAACC,KAAK,CAAE;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC;EACAL,OAAO,CAACM,IAAI,CAACH,EAAE,CAAC;AAClB;;AAEA,MAAMI,IAAI,GAAGP,OAAO,CAACO,IAAI;AACzB,IAAIA,IAAI,CAACC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE;EACjCN,KAAK,CAAC,CAAC,CAAC;AACV;;AAEA,IAAIO,QAAQ,GAAG,IAAI;AACnB;EACE,MAAMC,CAAC,GAAGH,IAAI,CAACC,OAAO,CAAC,eAAe,CAAC;EACvC,IAAIE,CAAC,KAAK,CAAC,CAAC,EAAE;IACZD,QAAQ,GAAG,KAAK;IAChBF,IAAI,CAACI,MAAM,CAACD,CAAC,EAAE,CAAC,CAAC;EACnB;AACF;;AAEA,IAAIH,IAAI,CAACK,MAAM,GAAG,CAAC,EAAE;EACnBV,KAAK,CAAC,CAAC,CAAC;AACV;;AAEA,MAAMW,MAAM,GAAG,kCAAkC;;AAEjD,MAAMC,MAAM,GAAGP,IAAI,CAAC,CAAC,CAAC;;AAEtB,KAAK,CAAC,YAAY;EAChB,KAAK,MAAMQ,QAAQ,IAAIR,IAAI,CAACS,KAAK,CAAC,CAAC,CAAC,EAAE;IACpC,MAAMC,OAAO,GAAG,MAAMhB,KAAK,CAACc,QAAQ,EAAEN,QAAQ,CAAC;;IAE/C,MAAMS,KAAK,GAAGnB,IAAI,CAACoB,QAAQ,CAACJ,QAAQ,CAAC;IACrC,MAAMK,OAAO,GAAGrB,IAAI,CAACsB,SAAS,CAACtB,IAAI,CAACuB,IAAI,CAACR,MAAM,EAAG,GAAEI,KAAM,aAAY,CAAC,CAAC;IACxEpB,EAAE,CAACyB,SAAS,CAACxB,IAAI,CAACuB,IAAI,CAACR,MAAM,EAAEI,KAAK,CAAC,EAAE,EAAEM,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;IAC3D1B,EAAE,CAAC2B,aAAa;IACdL,OAAO;IACN;AACP,uCAAuCP,MAAO;AAC9C;AACA,yBAAyBa,IAAI,CAACC,SAAS,CAACV,OAAO,EAAEW,SAAS,EAAE,CAAC,CAAE;AAC/D,CAAC,CACI;;IACD,IAAI;MACF9B,EAAE,CAAC+B,UAAU,CAACT,OAAO,GAAG,MAAM,CAAC;IACjC,CAAC,CAAC,OAAOU,EAAE,EAAE;;MACX;IAAA,CAEJ;AACF,CAAC,GAAG"}