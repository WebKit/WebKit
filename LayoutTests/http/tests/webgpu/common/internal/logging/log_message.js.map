{"version":3,"file":"log_message.js","names":["extractImportantStackTrace","LogMessageWithStack","Error","stackHiddenMessage","undefined","constructor","name","ex","message","stack","extra","setStackHidden","toJSON","m","prettyPrintLog","log","replace"],"sources":["../../../../src/common/internal/logging/log_message.ts"],"sourcesContent":["import { ErrorWithExtra } from '../../util/util.js';\nimport { extractImportantStackTrace } from '../stack.js';\n\nexport class LogMessageWithStack extends Error {\n  readonly extra: unknown;\n\n  private stackHiddenMessage: string | undefined = undefined;\n\n  constructor(name: string, ex: Error | ErrorWithExtra) {\n    super(ex.message);\n\n    this.name = name;\n    this.stack = ex.stack;\n    if ('extra' in ex) {\n      this.extra = ex.extra;\n    }\n  }\n\n  /** Set a flag so the stack is not printed in toJSON(). */\n  setStackHidden(stackHiddenMessage: string) {\n    this.stackHiddenMessage ??= stackHiddenMessage;\n  }\n\n  toJSON(): string {\n    let m = this.name;\n    if (this.message) m += ': ' + this.message;\n    if (this.stack) {\n      if (this.stackHiddenMessage === undefined) {\n        m += '\\n' + extractImportantStackTrace(this);\n      } else if (this.stackHiddenMessage) {\n        m += `\\n  at (elided: ${this.stackHiddenMessage})`;\n      }\n    }\n    return m;\n  }\n}\n\n/**\n * Returns a string, nicely indented, for debug logs.\n * This is used in the cmdline and wpt runtimes. In WPT, it shows up in the `*-actual.txt` file.\n */\nexport function prettyPrintLog(log: LogMessageWithStack): string {\n  return '  - ' + log.toJSON().replace(/\\n/g, '\\n    ');\n}\n"],"mappings":";AAAA;AAAA,GACA,SAASA,0BAA0B,QAAQ,aAAa;AAExD,OAAO,MAAMC,mBAAmB,SAASC,KAAK,CAAC;;;EAGrCC,kBAAkB,GAAuBC,SAAS;;EAE1DC,WAAW,CAACC,IAAY,EAAEC,EAA0B,EAAE;IACpD,KAAK,CAACA,EAAE,CAACC,OAAO,CAAC;;IAEjB,IAAI,CAACF,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACG,KAAK,GAAGF,EAAE,CAACE,KAAK;IACrB,IAAI,OAAO,IAAIF,EAAE,EAAE;MACjB,IAAI,CAACG,KAAK,GAAGH,EAAE,CAACG,KAAK;IACvB;EACF;;EAEA;EACAC,cAAc,CAACR,kBAA0B,EAAE;IACzC,IAAI,CAACA,kBAAkB,KAAKA,kBAAkB;EAChD;;EAEAS,MAAM,GAAW;IACf,IAAIC,CAAC,GAAG,IAAI,CAACP,IAAI;IACjB,IAAI,IAAI,CAACE,OAAO,EAAEK,CAAC,IAAI,IAAI,GAAG,IAAI,CAACL,OAAO;IAC1C,IAAI,IAAI,CAACC,KAAK,EAAE;MACd,IAAI,IAAI,CAACN,kBAAkB,KAAKC,SAAS,EAAE;QACzCS,CAAC,IAAI,IAAI,GAAGb,0BAA0B,CAAC,IAAI,CAAC;MAC9C,CAAC,MAAM,IAAI,IAAI,CAACG,kBAAkB,EAAE;QAClCU,CAAC,IAAK,mBAAkB,IAAI,CAACV,kBAAmB,GAAE;MACpD;IACF;IACA,OAAOU,CAAC;EACV;AACF;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASC,cAAc,CAACC,GAAwB,EAAU;EAC/D,OAAO,MAAM,GAAGA,GAAG,CAACH,MAAM,EAAE,CAACI,OAAO,CAAC,KAAK,EAAE,QAAQ,CAAC;AACvD"}