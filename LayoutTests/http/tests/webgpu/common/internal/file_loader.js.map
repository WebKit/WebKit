{"version":3,"sources":["../../../src/common/internal/file_loader.ts"],"names":["assert","parseQuery","loadTreeForQuery","TestFileLoader","importSpecFile","suite","path","import","join","loadTree","query","subqueriesToExpand","map","s","q","level","loadCases","tree","iterateLeaves","DefaultTestFileLoader","listing"],"mappings":";AAAA;AACA,YAASA,MAAT,QAAuB,iBAAvB;AAEA,SAASC,UAAT,QAA2B,uBAA3B;;;AAGA,SAASC,gBAAT,QAAyD,WAAzD;;AAEA;AACA;AACA;;;;;;;;;;;AAWA;AACA,OAAO,MAAeC,cAAf,CAA8B;;;;AAInCC,EAAAA,cAAc,CAACC,KAAD,EAAgBC,IAAhB,EAAmD;AAC/D,WAAO,KAAKC,MAAL,CAAa,GAAEF,KAAM,IAAGC,IAAI,CAACE,IAAL,CAAU,GAAV,CAAe,UAAvC,CAAP;AACD;;AAEa,QAARC,QAAQ,CAACC,KAAD,EAAmBC,kBAA4B,GAAG,EAAlD,EAAyE;AACrF,WAAOT,gBAAgB;AACrB,QADqB;AAErBQ,IAAAA,KAFqB;AAGrBC,IAAAA,kBAAkB,CAACC,GAAnB,CAAuB,CAAAC,CAAC,KAAI;AAC1B,YAAMC,CAAC,GAAGb,UAAU,CAACY,CAAD,CAApB;AACAb,MAAAA,MAAM,CAACc,CAAC,CAACC,KAAF,IAAW,CAAZ,EAAe,MAAO,2DAA0DD,CAAE,EAAlF,CAAN;AACA,aAAOA,CAAP;AACD,KAJD,CAHqB,CAAvB;;AASD;;AAEc,QAATE,SAAS,CAACN,KAAD,EAA4D;AACzE,UAAMO,IAAI,GAAG,MAAM,KAAKR,QAAL,CAAcC,KAAd,CAAnB;AACA,WAAOO,IAAI,CAACC,aAAL,EAAP;AACD,GAvBkC;;;AA0BrC,OAAO,MAAMC,qBAAN,SAAoChB,cAApC,CAAmD;AAC3C,QAAPiB,OAAO,CAACf,KAAD,EAA2C;AACtD,WAAO,CAAE,MAAM,OAAQ,SAAQA,KAAM,aAAtB,CAAR,EAA6De,OAApE;AACD;;AAEDb,EAAAA,MAAM,CAACD,IAAD,EAAkC;AACtC,WAAO,OAAQ,SAAQA,IAAK,EAArB,CAAP;AACD,GAPuD","sourcesContent":["import { IterableTestGroup } from '../internal/test_group.js';\nimport { assert } from '../util/util.js';\n\nimport { parseQuery } from './query/parseQuery.js';\nimport { TestQuery } from './query/query.js';\nimport { TestSuiteListing } from './test_suite_listing.js';\nimport { loadTreeForQuery, TestTree, TestTreeLeaf } from './tree.js';\n\n// A listing file, e.g. either of:\n// - `src/webgpu/listing.ts` (which is dynamically computed, has a Promise<TestSuiteListing>)\n// - `out/webgpu/listing.js` (which is pre-baked, has a TestSuiteListing)\ninterface ListingFile {\n  listing: Promise<TestSuiteListing> | TestSuiteListing;\n}\n\n// A .spec.ts file, as imported.\nexport interface SpecFile {\n  readonly description: string;\n  readonly g: IterableTestGroup;\n}\n\n// Base class for DefaultTestFileLoader and FakeTestFileLoader.\nexport abstract class TestFileLoader {\n  abstract listing(suite: string): Promise<TestSuiteListing>;\n  protected abstract import(path: string): Promise<SpecFile>;\n\n  importSpecFile(suite: string, path: string[]): Promise<SpecFile> {\n    return this.import(`${suite}/${path.join('/')}.spec.js`);\n  }\n\n  async loadTree(query: TestQuery, subqueriesToExpand: string[] = []): Promise<TestTree> {\n    return loadTreeForQuery(\n      this,\n      query,\n      subqueriesToExpand.map(s => {\n        const q = parseQuery(s);\n        assert(q.level >= 2, () => `subqueriesToExpand entries should not be multi-file:\\n  ${q}`);\n        return q;\n      })\n    );\n  }\n\n  async loadCases(query: TestQuery): Promise<IterableIterator<TestTreeLeaf>> {\n    const tree = await this.loadTree(query);\n    return tree.iterateLeaves();\n  }\n}\n\nexport class DefaultTestFileLoader extends TestFileLoader {\n  async listing(suite: string): Promise<TestSuiteListing> {\n    return ((await import(`../../${suite}/listing.js`)) as ListingFile).listing;\n  }\n\n  import(path: string): Promise<SpecFile> {\n    return import(`../../${path}`);\n  }\n}\n"],"file":"file_loader.js"}