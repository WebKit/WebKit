{"version":3,"file":"stack.js","names":["extractImportantStackTrace","e","stack","redundantMessage","message","startsWith","substring","length","lines","split","i","line","indexOf","slice","join"],"sources":["../../../src/common/internal/stack.ts"],"sourcesContent":["// Returns the stack trace of an Error, but without the extra boilerplate at the bottom\n// (e.g. RunCaseSpecific, processTicksAndRejections, etc.), for logging.\nexport function extractImportantStackTrace(e: Error): string {\n  let stack = e.stack;\n  if (!stack) {\n    return '';\n  }\n  const redundantMessage = 'Error: ' + e.message + '\\n';\n  if (stack.startsWith(redundantMessage)) {\n    stack = stack.substring(redundantMessage.length);\n  }\n\n  const lines = stack.split('\\n');\n  for (let i = lines.length - 1; i >= 0; --i) {\n    const line = lines[i];\n    if (line.indexOf('.spec.') !== -1) {\n      return lines.slice(0, i + 1).join('\\n');\n    }\n  }\n  return stack;\n}\n\n// *** Examples ***\n//\n// Node fail()\n// > Error:\n// >    at CaseRecorder.fail (/Users/kainino/src/cts/src/common/framework/logger.ts:99:30)\n// >    at RunCaseSpecific.exports.g.test.t [as fn] (/Users/kainino/src/cts/src/unittests/logger.spec.ts:80:7)\n// x    at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:121:18)\n// x    at processTicksAndRejections (internal/process/task_queues.js:86:5)\n//\n// Node throw\n// > Error: hello\n// >     at RunCaseSpecific.g.test.t [as fn] (/Users/kainino/src/cts/src/unittests/test_group.spec.ts:51:11)\n// x     at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:121:18)\n// x     at processTicksAndRejections (internal/process/task_queues.js:86:5)\n//\n// Firefox fail()\n// > fail@http://localhost:8080/out/framework/logger.js:104:30\n// > expect@http://localhost:8080/out/framework/default_fixture.js:59:16\n// > @http://localhost:8080/out/unittests/util.spec.js:35:5\n// x run@http://localhost:8080/out/framework/test_group.js:119:18\n//\n// Firefox throw\n// > @http://localhost:8080/out/unittests/test_group.spec.js:48:11\n// x run@http://localhost:8080/out/framework/test_group.js:119:18\n//\n// Safari fail()\n// > fail@http://localhost:8080/out/framework/logger.js:104:39\n// > expect@http://localhost:8080/out/framework/default_fixture.js:59:20\n// > http://localhost:8080/out/unittests/util.spec.js:35:11\n// x http://localhost:8080/out/framework/test_group.js:119:20\n// x asyncFunctionResume@[native code]\n// x [native code]\n// x promiseReactionJob@[native code]\n//\n// Safari throw\n// > http://localhost:8080/out/unittests/test_group.spec.js:48:20\n// x http://localhost:8080/out/framework/test_group.js:119:20\n// x asyncFunctionResume@[native code]\n// x [native code]\n// x promiseReactionJob@[native code]\n//\n// Chrome fail()\n// x Error\n// x     at CaseRecorder.fail (http://localhost:8080/out/framework/logger.js:104:30)\n// x     at DefaultFixture.expect (http://localhost:8080/out/framework/default_fixture.js:59:16)\n// >     at RunCaseSpecific.fn (http://localhost:8080/out/unittests/util.spec.js:35:5)\n// x     at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\n// x     at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n// x     at async http://localhost:8080/out/runtime/standalone.js:102:7\n//\n// Chrome throw\n// x Error: hello\n// >     at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n// x     at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\"\n// x     at async Promise.all (index 0)\n// x     at async TestGroupTest.run (http://localhost:8080/out/unittests/test_group_test.js:6:5)\n// x     at async RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:53:15)\n// x     at async RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:7)\n// x     at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n// x     at async http://localhost:8080/out/runtime/standalone.js:102:7\n"],"mappings":";AAAA;AAAA,G,CAAA;AACA;AACA,OAAO,SAASA,0BAA0B,CAACC,CAAQ,EAAU,CAC3D,IAAIC,KAAK,GAAGD,CAAC,CAACC,KAAK,CACnB,IAAI,CAACA,KAAK,EAAE;IACV,OAAO,EAAE;EACX;EACA,MAAMC,gBAAgB,GAAG,SAAS,GAAGF,CAAC,CAACG,OAAO,GAAG,IAAI;EACrD,IAAIF,KAAK,CAACG,UAAU,CAACF,gBAAgB,CAAC,EAAE;IACtCD,KAAK,GAAGA,KAAK,CAACI,SAAS,CAACH,gBAAgB,CAACI,MAAM,CAAC;EAClD;;EAEA,MAAMC,KAAK,GAAGN,KAAK,CAACO,KAAK,CAAC,IAAI,CAAC;EAC/B,KAAK,IAAIC,CAAC,GAAGF,KAAK,CAACD,MAAM,GAAG,CAAC,EAAEG,CAAC,IAAI,CAAC,EAAE,EAAEA,CAAC,EAAE;IAC1C,MAAMC,IAAI,GAAGH,KAAK,CAACE,CAAC,CAAC;IACrB,IAAIC,IAAI,CAACC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE;MACjC,OAAOJ,KAAK,CAACK,KAAK,CAAC,CAAC,EAAEH,CAAC,GAAG,CAAC,CAAC,CAACI,IAAI,CAAC,IAAI,CAAC;IACzC;EACF;EACA,OAAOZ,KAAK;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}