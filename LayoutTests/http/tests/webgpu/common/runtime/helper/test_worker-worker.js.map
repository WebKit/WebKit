{"version":3,"file":"test_worker-worker.js","names":["setBaseResourcePath","DefaultTestFileLoader","Logger","parseQuery","assert","loader","self","onmessage","ev","query","data","expectations","debug","globalDebugMode","log","testcases","Array","from","loadCases","length","testcase","rec","result","record","toString","run","postMessage"],"sources":["../../../../src/common/runtime/helper/test_worker-worker.ts"],"sourcesContent":["import { setBaseResourcePath } from '../../framework/resources.js';\nimport { DefaultTestFileLoader } from '../../internal/file_loader.js';\nimport { Logger } from '../../internal/logging/logger.js';\nimport { parseQuery } from '../../internal/query/parseQuery.js';\nimport { TestQueryWithExpectation } from '../../internal/query/query.js';\nimport { assert } from '../../util/util.js';\n\n// Should be DedicatedWorkerGlobalScope, but importing lib \"webworker\" conflicts with lib \"dom\".\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\ndeclare const self: any;\n\nconst loader = new DefaultTestFileLoader();\n\nsetBaseResourcePath('../../../resources');\n\nself.onmessage = async (ev: MessageEvent) => {\n  const query: string = ev.data.query;\n  const expectations: TestQueryWithExpectation[] = ev.data.expectations;\n  const debug: boolean = ev.data.debug;\n\n  Logger.globalDebugMode = debug;\n  const log = new Logger();\n\n  const testcases = Array.from(await loader.loadCases(parseQuery(query)));\n  assert(testcases.length === 1, 'worker query resulted in != 1 cases');\n\n  const testcase = testcases[0];\n  const [rec, result] = log.record(testcase.query.toString());\n  await testcase.run(rec, expectations);\n\n  self.postMessage({ query, result });\n};\n"],"mappings":";AAAA;AAAA,GAAA,SAASA,mBAAmB,QAAQ,8BAA8B,CAClE,SAASC,qBAAqB,QAAQ,+BAA+B,CACrE,SAASC,MAAM,QAAQ,kCAAkC;AACzD,SAASC,UAAU,QAAQ,oCAAoC;;AAE/D,SAASC,MAAM,QAAQ,oBAAoB;;AAE3C;;;;AAIA,MAAMC,MAAM,GAAG,IAAIJ,qBAAqB,EAAE;;AAE1CD,mBAAmB,CAAC,oBAAoB,CAAC;;AAEzCM,IAAI,CAACC,SAAS,GAAG,OAAOC,EAAgB,KAAK;EAC3C,MAAMC,KAAa,GAAGD,EAAE,CAACE,IAAI,CAACD,KAAK;EACnC,MAAME,YAAwC,GAAGH,EAAE,CAACE,IAAI,CAACC,YAAY;EACrE,MAAMC,KAAc,GAAGJ,EAAE,CAACE,IAAI,CAACE,KAAK;;EAEpCV,MAAM,CAACW,eAAe,GAAGD,KAAK;EAC9B,MAAME,GAAG,GAAG,IAAIZ,MAAM,EAAE;;EAExB,MAAMa,SAAS,GAAGC,KAAK,CAACC,IAAI,CAAC,MAAMZ,MAAM,CAACa,SAAS,CAACf,UAAU,CAACM,KAAK,CAAC,CAAC,CAAC;EACvEL,MAAM,CAACW,SAAS,CAACI,MAAM,KAAK,CAAC,EAAE,qCAAqC,CAAC;;EAErE,MAAMC,QAAQ,GAAGL,SAAS,CAAC,CAAC,CAAC;EAC7B,MAAM,CAACM,GAAG,EAAEC,MAAM,CAAC,GAAGR,GAAG,CAACS,MAAM,CAACH,QAAQ,CAACX,KAAK,CAACe,QAAQ,EAAE,CAAC;EAC3D,MAAMJ,QAAQ,CAACK,GAAG,CAACJ,GAAG,EAAEV,YAAY,CAAC;;EAErCL,IAAI,CAACoB,WAAW,CAAC,EAAEjB,KAAK,EAAEa,MAAM,CAAC,CAAC,CAAC;AACrC,CAAC"}