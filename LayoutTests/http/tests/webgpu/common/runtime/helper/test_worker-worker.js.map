{"version":3,"sources":["../../../../src/common/runtime/helper/test_worker-worker.ts"],"names":["setBaseResourcePath","DefaultTestFileLoader","Logger","parseQuery","assert","loader","self","onmessage","ev","query","data","expectations","debug","globalDebugMode","log","testcases","Array","from","loadCases","length","testcase","rec","result","record","toString","run","postMessage"],"mappings":";AAAA;AACA,GADA,SAASA,mBAAT,QAAoC,8BAApC,CACA,SAASC,qBAAT,QAAsC,+BAAtC,CACA,SAASC,MAAT,QAAuB,kCAAvB;AACA,SAASC,UAAT,QAA2B,oCAA3B;;AAEA,SAASC,MAAT,QAAuB,oBAAvB;;AAEA;;;;AAIA,MAAMC,MAAM,GAAG,IAAIJ,qBAAJ,EAAf;;AAEAD,mBAAmB,CAAC,oBAAD,CAAnB;;AAEAM,IAAI,CAACC,SAAL,GAAiB,OAAOC,EAAP,KAA4B;AAC3C,QAAMC,KAAa,GAAGD,EAAE,CAACE,IAAH,CAAQD,KAA9B;AACA,QAAME,YAAwC,GAAGH,EAAE,CAACE,IAAH,CAAQC,YAAzD;AACA,QAAMC,KAAc,GAAGJ,EAAE,CAACE,IAAH,CAAQE,KAA/B;;AAEAV,EAAAA,MAAM,CAACW,eAAP,GAAyBD,KAAzB;AACA,QAAME,GAAG,GAAG,IAAIZ,MAAJ,EAAZ;;AAEA,QAAMa,SAAS,GAAGC,KAAK,CAACC,IAAN,CAAW,MAAMZ,MAAM,CAACa,SAAP,CAAiBf,UAAU,CAACM,KAAD,CAA3B,CAAjB,CAAlB;AACAL,EAAAA,MAAM,CAACW,SAAS,CAACI,MAAV,KAAqB,CAAtB,EAAyB,qCAAzB,CAAN;;AAEA,QAAMC,QAAQ,GAAGL,SAAS,CAAC,CAAD,CAA1B;AACA,QAAM,CAACM,GAAD,EAAMC,MAAN,IAAgBR,GAAG,CAACS,MAAJ,CAAWH,QAAQ,CAACX,KAAT,CAAee,QAAf,EAAX,CAAtB;AACA,QAAMJ,QAAQ,CAACK,GAAT,CAAaJ,GAAb,EAAkBV,YAAlB,CAAN;;AAEAL,EAAAA,IAAI,CAACoB,WAAL,CAAiB,EAAEjB,KAAF,EAASa,MAAT,EAAjB;AACD,CAhBD","sourcesContent":["import { setBaseResourcePath } from '../../framework/resources.js';\nimport { DefaultTestFileLoader } from '../../internal/file_loader.js';\nimport { Logger } from '../../internal/logging/logger.js';\nimport { parseQuery } from '../../internal/query/parseQuery.js';\nimport { TestQueryWithExpectation } from '../../internal/query/query.js';\nimport { assert } from '../../util/util.js';\n\n// Should be DedicatedWorkerGlobalScope, but importing lib \"webworker\" conflicts with lib \"dom\".\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\ndeclare const self: any;\n\nconst loader = new DefaultTestFileLoader();\n\nsetBaseResourcePath('../../../resources');\n\nself.onmessage = async (ev: MessageEvent) => {\n  const query: string = ev.data.query;\n  const expectations: TestQueryWithExpectation[] = ev.data.expectations;\n  const debug: boolean = ev.data.debug;\n\n  Logger.globalDebugMode = debug;\n  const log = new Logger();\n\n  const testcases = Array.from(await loader.loadCases(parseQuery(query)));\n  assert(testcases.length === 1, 'worker query resulted in != 1 cases');\n\n  const testcase = testcases[0];\n  const [rec, result] = log.record(testcase.query.toString());\n  await testcase.run(rec, expectations);\n\n  self.postMessage({ query, result });\n};\n"],"file":"test_worker-worker.js"}