<body>
<p>Test Worker constructor functionality. Should print a series of PASS messages, followed with DONE.</p>
<div id=result></div>
<script>
function log(message)
{
    document.getElementById("result").innerHTML += message + "<br>";
}

function runNextTest()
{
    testIndex++;
    // Loop until there are no more tests to run
    var testName = 'test' + testIndex;
    if (window[testName]) {
        window[testName]();
    } else {
        log("DONE");
        if (window.layoutTestController)
            layoutTestController.notifyDone();
    }
}

function test1()
{
    try {
        new Worker({toString:function(){throw "exception"}})
        log("FAIL: toString exception not propagated.");
    } catch (ex) {
        if (ex == "exception")
            log("PASS: toString exception propagated correctly.");
        else
            log("FAIL: unexpected exception (" + ex + ") received instead of one propagated from toString.");
    }
    runNextTest();
}

function test2()
{
    try {
        var foo = {toString:function(){new Worker(foo)}}
        new Worker(foo);
        log("FAIL: no exception when trying to create workers recursively");
    } catch (ex) {
        log("PASS: trying to create workers recursively resulted in an exception (" + ex + ")");
    }
    runNextTest();
}

function test3()
{
    try {
        new Worker();
        log("FAIL: invoking Worker constructor without arguments did not result in an exception");
    } catch (ex) {
        log("PASS: invoking Worker constructor without arguments resulted in an exception (" + ex + ")");
    }
    runNextTest();
}

function test4()
{
    try {
        var worker = new Worker("");
        worker.onerror = function() {
            log("PASS: onerror invoked for an empty script URL.");
            runNextTest();
        }
    } catch (ex) {
        log("FAIL: unexpected exception " + ex);
        runNextTest();
    }
}

function test5()
{
    try {
        var worker = new Worker("invalidurl://");
        worker.onerror = function() {
            log("PASS: onerror invoked for an invalid script URL.");
            runNextTest();
        }
    } catch (ex) {
        log("FAIL: unexpected exception " + ex);
        runNextTest();
    }
}

function test6()
{
    try {
        var worker = new Worker("does-not-exist.js");
        worker.onerror = function() {
            log("PASS: onerror invoked for a script that could not be loaded.");
            runNextTest();
        }
    } catch (ex) {
        log("FAIL: unexpected exception " + ex);
        runNextTest();
    }
}

function test7()
{
    try {
        var worker = new Worker("resources/worker-common.js");
        // Make sure attributes from both Worker and AbstractWorker are visible.
        if (!worker.postMessage)
            log("FAIL: worker.postMessage did not exist.");
        else if (!worker.addEventListener)
            log("FAIL: worker.addEventListener did not exist.");
        else
            log("PASS: Successfully created worker.");
    } catch (ex) {
        log("FAIL: unexpected exception (" + ex + ") thrown when creating worker");
    }
    runNextTest();
}

if (window.layoutTestController) {
    layoutTestController.dumpAsText();
    layoutTestController.waitUntilDone();
}

var testIndex = 0;
runNextTest();

</script>
</body>
