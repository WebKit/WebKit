<style>
     canvas {
         width: 300px;
         height: 300px;
     }
 </style>
 <body>
    <h3>This tests the filter is drawn to the detached canvas.</h3>
    <canvas id="canvas"></canvas>
    <script>
        function createPatternCanvas() {
            const patternCanvas = document.createElement('canvas');
            patternCanvas.width = 80;
            patternCanvas.height = 80;
            const patternCtx = patternCanvas.getContext('2d');
            patternCtx.fillStyle = '#A00';
            patternCtx.fillRect(0, 0, 40, 40);
            patternCtx.fillStyle = '#0A0';
            patternCtx.fillRect(40, 0, 40, 40);
            patternCtx.fillStyle = '#00A';
            patternCtx.fillRect(0, 40, 40, 40);
            patternCtx.fillStyle = "#AA0";
            patternCtx.fillRect(40, 40, 40, 40);
            return patternCanvas;
        }

        const detachedCanvas = document.createElement('canvas');
        detachedCanvas.width  = 300;
        detachedCanvas.height = 300;
        const detachedContext = detachedCanvas.getContext("2d");

        detachedContext.filter = 'drop-shadow(40px 40px 0 #666)';
        const pattern = createPatternCanvas();

        detachedContext.drawImage(pattern, 0, 0);
        detachedContext.drawImage(pattern, 80, 80);
        detachedContext.drawImage(pattern, 160, 160);

        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 300;
        canvas.height = 300;

        context.drawImage(detachedCanvas, 0, 0);
    </script>
</body>
