<html>
<body onload="main()">
<p>This test passes if WebKit does not crash in ASAN builds.</p>
<div id="result"></div>
<script>

if (window.testRunner) {
    testRunner.waitUntilDone();
    testRunner.dumpAsText();
}

function main() {
    const img_window = window.open(URL.createObjectURL(new Blob([new Uint8Array([0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a, 0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x00, 0x00, 0x00, 0x25, 0xdb, 0x56, 0xca, 0x00, 0x00, 0x00, 0x03, 0x50, 0x4c, 0x54, 0x45, 0x00, 0x00, 0x00, 0xa7, 0x7a, 0x3d, 0xda, 0x00, 0x00, 0x00, 0x01, 0x74, 0x52, 0x4e, 0x53, 0x00, 0x40, 0xe6, 0xd8, 0x66, 0x00, 0x00, 0x00, 0x0a, 0x49, 0x44, 0x41, 0x54, 0x08, 0xd7, 0x63, 0x60, 0x00, 0x00, 0x00, 0x02, 0x00, 0x01, 0xe2, 0x21, 0xbc, 0x33, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4e, 0x44, 0xae, 0x42, 0x60, 0x82])], {type: 'image/png'})));

    img_window.onload = () => {
        const div = document.createElement('div');
        div.appendChild(img_window.document.body);

        const img = div.querySelector('img');
        img.remove();

        div.firstChild.remove();
        img_window.location.reload();

        setTimeout(() => {
            if (window.GCController)
                GCController.collect();
            img.dispatchEvent(new MouseEvent('click'));
            result.textContent = 'PASS';
            if (window.testRunner)
                testRunner.notifyDone();
        }, 10);
    }
}

</script>
</body>
</html>
