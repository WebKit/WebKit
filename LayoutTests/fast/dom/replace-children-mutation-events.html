<!DOCTYPE html>
<html>
<body>
<script src="../../resources/js-test.js"></script>
<script>

description('This tests mutating DOM in mutation event listerns during replaceChilden.');
    
let oldParent = document.createElement('div');
let span = document.createElement('span');
oldParent.appendChild(span);

let parent = document.createElement('div');
parent.innerHTML = '<b>hello</b><i> world</i>';
let i = parent.querySelector('i');
span.addEventListener('DOMNodeRemoved', () => i.appendChild(span), {once: true});
shouldThrowErrorName('parent.replaceChildren(span)', 'NotFoundError');

const em = document.createElement('em');
em.textContent = "some";
oldParent.addEventListener('DOMNodeInserted', () => document.body.appendChild(em), {once: true});
shouldNotThrow('span.replaceChildren(oldParent, em, "text")');
shouldBe('span.childNodes.length', '1');
shouldBe('span.childNodes[0]', 'oldParent');
shouldBeEqualToString('span.textContent', '');

successfullyParsed = true;

</script>
</body>
</html>
