<html>
<head>
<script src="../../http/tests/inspector/inspector-test.js"></script>
<script src="../../http/tests/inspector/debugger-test.js"></script>
<script>
function test()
{
    // Always use indentation in scripts drop box
    WebInspector._isMac = false;
    WebInspector.showPanel("scripts");

    var persistentBreakpoints = [];
    var breakpointStorage = {
        get: function() { return persistentBreakpoints; },
        set: function(breakpoints) { persistentBreakpoints = breakpoints; }
    };

    var contentProvider = new WebInspector.StaticContentProvider(WebInspector.resourceTypes.Script, "", "text/javascript");

    function createMockWorkspace()
    {
        var workspace = new WebInspector.Workspace();
        var networkWorkspaceProvider = new WebInspector.SimpleWorkspaceProvider(workspace);
        workspace.addProject(WebInspector.projectNames.Network, networkWorkspaceProvider);

        workspace.debuggerWorkspaceProvider = new WebInspector.SimpleWorkspaceProvider(workspace);
        workspace.addProject(WebInspector.projectNames.Debugger, workspace.debuggerWorkspaceProvider);
        workspace.requestFileContent = function(uiSourceCode, callback)
        {
            InspectorTest.addResult("Source requested for " + uiSourceCode.url);
            callback("");
        };
        workspace.networkWorkspaceProvider = networkWorkspaceProvider;
        return workspace;
    }

    InspectorTest.runTestSuite([
        function testInitialLoad(next)
        {
            var workspace = createMockWorkspace();

            workspace.networkWorkspaceProvider.addFileForURL("foobar.js", contentProvider, false);

            var panel = new WebInspector.ScriptsPanel(workspace);
            panel.show();

            workspace.networkWorkspaceProvider.addFileForURL("foo.js", contentProvider, false);
            workspace.networkWorkspaceProvider.addFileForURL("bar.js", contentProvider, false);
            workspace.networkWorkspaceProvider.addFileForURL("baz.js", contentProvider, false);

            InspectorTest.dumpScriptsNavigator(panel._navigator);

            // Select "baz.js".
            panel._showFile(workspace.uiSourceCodeForURL("baz.js"));
            panel.detach();

            next();
        },

        function testReset(next)
        {
            var workspace = createMockWorkspace();
            var workspaceController = new WebInspector.WorkspaceController(workspace);
            var panel = new WebInspector.ScriptsPanel(workspace);
            panel.show();

            workspace.networkWorkspaceProvider.addFileForURL("foo.js", contentProvider, false);
            workspace.networkWorkspaceProvider.addFileForURL("bar.js", contentProvider, false);
            workspace.networkWorkspaceProvider.addFileForURL("baz.js", contentProvider, false);

            InspectorTest.dumpScriptsNavigator(panel._navigator);

            workspace.networkWorkspaceProvider.reset();
            workspace.networkWorkspaceProvider.addFileForURL("bar.js", contentProvider, false);
            InspectorTest.dumpScriptsNavigator(panel._navigator);

            panel.detach();
            next();
        },

        function testDebuggerUISourceCodeAddedAndRemoved(next)
        {
            var workspace = createMockWorkspace();
            var panel = new WebInspector.ScriptsPanel(workspace);
            panel.show();

            workspace.networkWorkspaceProvider.addFileForURL("foo.js", contentProvider, false);
            workspace.debuggerWorkspaceProvider.addFile("debugger:compiled.js", "compiled.js", contentProvider);

            InspectorTest.dumpScriptsNavigator(panel._navigator);

            // Plug compiler source mapping.
            workspace.networkWorkspaceProvider.addFileForURL("source.js", contentProvider, false);

            InspectorTest.dumpScriptsNavigator(panel._navigator);
            next();
        }
    ]);
};
</script>
</head>
<body onload="runTest()">
<p>Tests that scripts panel UI elements work as intended.</p>
</body>
</html>
