<!DOCTYPE HTML><!-- webkit-test-runner [ runSingly=true AccessibilityThreadTextApisEnabled=true ] -->
<!-- New test. Keep after accessibilityThreadTextApisEnabled is enabled by default. -->
<html>
<head>
<script src="../../resources/accessibility-helper.js"></script>
<script src="../../resources/js-test.js"></script>
</head>
<body>

<div id="content">
<p>
    One two
    <p>
        three
        <p></p>
        four
    </p>
    <p></p>
    <p></p>
    <p></p>
    five
</p>
</div>

<script>
var output = "This tests that we are getting the correct string for document range with nested paragraphs.\n\n";

// FIXME: Fails because:
//  1. We miss a newline between "One two" and "three", and between "three" and "four" due to shouldEmitExtraNewlineForNode
//     logic in TextIterator that we don't emulate.
//  2. We are missing a newline between "four" and "five", generated by TextIterator::representNodeOffsetZero() ->
//     shouldEmitNewlineBeforeNode -> shouldRepresentNodeOffsetZero == true for some node between the two pieces of text

if (window.accessibilityController) {
    var webArea = accessibilityController.rootElement.childAtIndex(0);
    var startMarker = webArea.startTextMarker;
    var endMarker = webArea.endTextMarker;
    var range = webArea.textMarkerRangeForMarkers(startMarker, endMarker);

    output += webArea.stringForTextMarkerRange(range);
    document.getElementById("content").style.visibility = "hidden";
    debug(output);
}
</script>
</body>
</html>

