/*! (c) Andrea Giammarchi @webreflection ISC */
!function(){var t=function(t,e){var n=function(t){for(var e=0,n=t.length;e<n;e++)i(t[e])},i=function(t){var e=t.target,n=t.attributeName,i=t.oldValue;e.attributeChangedCallback(n,i,e.getAttribute(n))};return function(r,s){var a=r.constructor.observedAttributes;return a&&t(s).then((function(){new e(n).observe(r,{attributes:!0,attributeOldValue:!0,attributeFilter:a});for(var t=0,s=a.length;t<s;t++)r.hasAttribute(a[t])&&i({target:r,attributeName:a[t],oldValue:null})})),r}};function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,n){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,n){if(t){if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){c=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(c)throw a}}}}
/*! (c) Andrea Giammarchi - ISC */var i=!0,r=!1,s="querySelectorAll",a="querySelectorAll",o=self,c=o.document,l=o.Element,h=o.MutationObserver,u=o.Set,d=o.WeakMap,p=function(t){return a in t},f=[].filter,A=function(t){var e=new d,o=function(n,i){var r;if(i)for(var s,a=function(t){return t.matches||t.webkitMatchesSelector||t.msMatchesSelector}(n),o=0,c=g.length;o<c;o++)a.call(n,s=g[o])&&(e.has(n)||e.set(n,new u),(r=e.get(n)).has(s)||(r.add(s),t.handle(n,i,s)));else e.has(n)&&(r=e.get(n),e.delete(n),r.forEach((function(e){t.handle(n,i,e)})))},A=function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0,i=t.length;n<i;n++)o(t[n],e)},g=t.query,m=t.root||c,b=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:MutationObserver,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:["*"],c=function e(r,a,o,c,l,h){var u,d=n(r);try{for(d.s();!(u=d.n()).done;){var p=u.value;(h||s in p)&&(l?o.has(p)||(o.add(p),c.delete(p),t(p,l)):c.has(p)||(c.add(p),o.delete(p),t(p,l)),h||e(p[s](a),a,o,c,l,i))}}catch(t){d.e(t)}finally{d.f()}},l=new a((function(t){if(o.length){var e,s=o.join(","),a=new Set,l=new Set,h=n(t);try{for(h.s();!(e=h.n()).done;){var u=e.value,d=u.addedNodes,p=u.removedNodes;c(p,s,a,l,r,r),c(d,s,a,l,i,r)}}catch(t){h.e(t)}finally{h.f()}}})),h=l.observe;return(l.observe=function(t){return h.call(l,t,{subtree:i,childList:i})})(e),l}(o,m,h,g),v=l.prototype.attachShadow;return v&&(l.prototype.attachShadow=function(t){var e=v.call(this,t);return b.observe(e),e}),g.length&&A(m[a](g)),{drop:function(t){for(var n=0,i=t.length;n<i;n++)e.delete(t[n])},flush:function(){for(var t=b.takeRecords(),e=0,n=t.length;e<n;e++)A(f.call(t[e].removedNodes,p),!1),A(f.call(t[e].addedNodes,p),!0)},observer:b,parse:A}},g=self,m=g.document,b=g.Map,v=g.MutationObserver,y=g.Object,x=g.Set,_=g.WeakMap,E=g.Element,w=g.HTMLElement,C=g.Node,S=g.Error,M=g.TypeError,I=g.Reflect,T=y.defineProperty,B=y.keys,R=y.getOwnPropertyNames,P=y.setPrototypeOf,D=!self.customElements,L=function(t){for(var e=B(t),n=[],i=new x,r=e.length,s=0;s<r;s++){n[s]=t[e[s]];try{delete t[e[s]]}catch(t){i.add(s)}}return function(){for(var s=0;s<r;s++)i.has(s)||(t[e[s]]=n[s])}};if(D){var U=function(){var t=this.constructor;if(!N.has(t))throw new M("Illegal constructor");var e=N.get(t);if(z)return V(z,e);var n=F.call(m,e);return V(P(n,t.prototype),e)},F=m.createElement,N=new b,k=new b,O=new b,Q=new b,G=[],H=A({query:G,handle:function(t,e,n){var i=O.get(n);if(e&&!i.isPrototypeOf(t)){var r=L(t);z=P(t,i);try{new i.constructor}finally{z=null,r()}}var s="".concat(e?"":"dis","connectedCallback");s in i&&t[s]()}}).parse,z=null,j=function(t){if(!k.has(t)){var e,n=new Promise((function(t){e=t}));k.set(t,{$:n,_:e})}return k.get(t).$},V=t(j,v);self.customElements={define:function(t,e){if(Q.has(t))throw new S('the name "'.concat(t,'" has already been used with this registry'));N.set(e,t),O.set(t,e.prototype),Q.set(t,e),G.push(t),j(t).then((function(){H(m.querySelectorAll(t))})),k.get(t)._(e)},get:function(t){return Q.get(t)},whenDefined:j},T(U.prototype=w.prototype,"constructor",{value:U}),self.HTMLElement=U,m.createElement=function(t,e){var n=e&&e.is,i=n?Q.get(n):Q.get(t);return i?new i:F.call(m,t)},"isConnected"in C.prototype||T(C.prototype,"isConnected",{configurable:!0,get:function(){return!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}else if(D=!self.customElements.get("extends-br"))try{var W=function t(){return self.Reflect.construct(HTMLBRElement,[],t)};W.prototype=HTMLLIElement.prototype;var q="extends-br";self.customElements.define("extends-br",W,{extends:"br"}),D=m.createElement("br",{is:q}).outerHTML.indexOf(q)<0;var X=self.customElements,Y=X.get,J=X.whenDefined;self.customElements.whenDefined=function(t){var e=this;return J.call(this,t).then((function(n){return n||Y.call(e,t)}))}}catch(t){}if(D){var K=function(t){var e=st.get(t);ft(e.querySelectorAll(this),t.isConnected)},Z=self.customElements,$=m.createElement,tt=Z.define,et=Z.get,nt=Z.upgrade,it=I||{construct:function(t){return t.call(this)}},rt=it.construct,st=new _,at=new x,ot=new b,ct=new b,lt=new b,ht=new b,ut=[],dt=[],pt=function(t){return ht.get(t)||et.call(Z,t)},ft=A({query:dt,handle:function(t,e,n){var i=lt.get(n);if(e&&!i.isPrototypeOf(t)){var r=L(t);vt=P(t,i);try{new i.constructor}finally{vt=null,r()}}var s="".concat(e?"":"dis","connectedCallback");s in i&&t[s]()}}).parse,At=A({query:ut,handle:function(t,e){st.has(t)&&(e?at.add(t):at.delete(t),dt.length&&K.call(dt,t))}}).parse,gt=E.prototype.attachShadow;gt&&(E.prototype.attachShadow=function(t){var e=gt.call(this,t);return st.set(this,e),e});var mt=function(t){if(!ct.has(t)){var e,n=new Promise((function(t){e=t}));ct.set(t,{$:n,_:e})}return ct.get(t).$},bt=t(mt,v),vt=null;R(self).filter((function(t){return/^HTML.*Element$/.test(t)})).forEach((function(t){var e=self[t];function n(){var t=this.constructor;if(!ot.has(t))throw new M("Illegal constructor");var n=ot.get(t),i=n.is,r=n.tag;if(i){if(vt)return bt(vt,i);var s=$.call(m,r);return s.setAttribute("is",i),bt(P(s,t.prototype),i)}return rt.call(this,e,[],t)}T(n.prototype=e.prototype,"constructor",{value:n}),T(self,t,{value:n})})),m.createElement=function(t,e){var n=e&&e.is;if(n){var i=ht.get(n);if(i&&ot.get(i).tag===t)return new i}var r=$.call(m,t);return n&&r.setAttribute("is",n),r},Z.get=pt,Z.whenDefined=mt,Z.upgrade=function(t){var e=t.getAttribute("is");if(e){var n=ht.get(e);if(n)return void bt(P(t,n.prototype),e)}nt.call(Z,t)},Z.define=function(t,e,n){if(pt(t))throw new S("'".concat(t,"' has already been defined as a custom element"));var i,r=n&&n.extends;ot.set(e,r?{is:t,tag:r}:{is:"",tag:t}),r?(i="".concat(r,'[is="').concat(t,'"]'),lt.set(i,e.prototype),ht.set(t,e),dt.push(i)):(tt.apply(Z,arguments),ut.push(i=t)),mt(t).then((function(){r?(ft(m.querySelectorAll(i)),at.forEach(K,[i])):At(m.querySelectorAll(i))})),ct.get(t)._(e)}}}();
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const t="163",e=0,n=1,i=2,r=0,s=1,a=2,o=3,c=1,l=2,h=3,u=0,d=1,p=2,f=100,A=0,g=1,m=2,b=0,v=1,y=2,x=3,_=4,E=5,w=6,C=7,S="attached",M=301,I=302,T=303,B=304,R=306,P=1e3,D=1001,L=1002,U=1003,F=1005,N=1006,k=1007,O=1008,Q=1009,G=1013,H=1014,z=1015,j=1016,V=1020,W=1023,q=1026,X=1027,Y=1028,J=1030,K=33776,Z=33777,$=33778,tt=33779,et=35840,nt=35842,it=36196,rt=37492,st=37496,at=37808,ot=37812,ct=36492,lt=2300,ht=2301,ut=2302,dt=2400,pt=2401,ft=2402,At=2500,gt=3201,mt="",bt="srgb",vt="srgb-linear",yt="display-p3",xt="display-p3-linear",_t="linear",Et="srgb",wt="rec709",Ct="p3",St=7680,Mt=35044,It="300 es",Tt=2e3,Bt=2001;class Rt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const Pt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Dt=1234567;const Lt=Math.PI/180,Ut=180/Math.PI;function Ft(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Pt[255&t]+Pt[t>>8&255]+Pt[t>>16&255]+Pt[t>>24&255]+"-"+Pt[255&e]+Pt[e>>8&255]+"-"+Pt[e>>16&15|64]+Pt[e>>24&255]+"-"+Pt[63&n|128]+Pt[n>>8&255]+"-"+Pt[n>>16&255]+Pt[n>>24&255]+Pt[255&i]+Pt[i>>8&255]+Pt[i>>16&255]+Pt[i>>24&255]).toLowerCase()}function Nt(t,e,n){return Math.max(e,Math.min(n,t))}function kt(t,e){return(t%e+e)%e}function Ot(t,e,n){return(1-n)*t+n*e}function Qt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Gt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Ht={DEG2RAD:Lt,RAD2DEG:Ut,generateUUID:Ft,clamp:Nt,euclideanModulo:kt,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Ot,damp:function(t,e,n,i){return Ot(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(kt(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(Dt=t);let e=Dt+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Lt},radToDeg:function(t){return t*Ut},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),c=a(n/2),l=s((e+i)/2),h=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),f=a((i-e)/2);switch(r){case"XYX":t.set(o*h,c*u,c*d,o*l);break;case"YZY":t.set(c*d,o*h,c*u,o*l);break;case"ZXZ":t.set(c*u,c*d,o*h,o*l);break;case"XZX":t.set(o*h,c*f,c*p,o*l);break;case"YXY":t.set(c*p,o*h,c*f,o*l);break;case"ZYZ":t.set(c*f,c*p,o*h,o*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Gt,denormalize:Qt};class zt{constructor(t=0,e=0){zt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Nt(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class jt{constructor(t,e,n,i,r,s,a,o,c){jt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,c)}set(t,e,n,i,r,s,a,o,c){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=e,l[4]=r,l[5]=o,l[6]=n,l[7]=s,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],c=n[1],l=n[4],h=n[7],u=n[2],d=n[5],p=n[8],f=i[0],A=i[3],g=i[6],m=i[1],b=i[4],v=i[7],y=i[2],x=i[5],_=i[8];return r[0]=s*f+a*m+o*y,r[3]=s*A+a*b+o*x,r[6]=s*g+a*v+o*_,r[1]=c*f+l*m+h*y,r[4]=c*A+l*b+h*x,r[7]=c*g+l*v+h*_,r[2]=u*f+d*m+p*y,r[5]=u*A+d*b+p*x,r[8]=u*g+d*v+p*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],c=t[7],l=t[8];return e*s*l-e*a*c-n*r*l+n*a*o+i*r*c-i*s*o}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],c=t[7],l=t[8],h=l*s-a*c,u=a*o-l*r,d=c*r-s*o,p=e*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(i*c-l*n)*f,t[2]=(a*n-i*s)*f,t[3]=u*f,t[4]=(l*e-i*o)*f,t[5]=(i*r-a*e)*f,t[6]=d*f,t[7]=(n*o-c*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,a){const o=Math.cos(r),c=Math.sin(r);return this.set(n*o,n*c,-n*(o*s+c*a)+s+t,-i*c,i*o,-i*(-c*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Vt.makeScale(t,e)),this}rotate(t){return this.premultiply(Vt.makeRotation(-t)),this}translate(t,e){return this.premultiply(Vt.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Vt=new jt;function Wt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function qt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Xt(){const t=qt("canvas");return t.style.display="block",t}const Yt={};function Jt(t){t in Yt||(Yt[t]=!0,console.warn(t))}const Kt=(new jt).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Zt=(new jt).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),$t={[vt]:{transfer:_t,primaries:wt,toReference:t=>t,fromReference:t=>t},[bt]:{transfer:Et,primaries:wt,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[xt]:{transfer:_t,primaries:Ct,toReference:t=>t.applyMatrix3(Zt),fromReference:t=>t.applyMatrix3(Kt)},[yt]:{transfer:Et,primaries:Ct,toReference:t=>t.convertSRGBToLinear().applyMatrix3(Zt),fromReference:t=>t.applyMatrix3(Kt).convertLinearToSRGB()}},te=new Set([vt,xt]),ee={enabled:!0,_workingColorSpace:vt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!te.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;const i=$t[e].toReference;return(0,$t[n].fromReference)(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return $t[t].primaries},getTransfer:function(t){return t===mt?_t:$t[t].transfer}};function ne(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ie(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let re;class se{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===re&&(re=qt("canvas")),re.width=t.width,re.height=t.height;const n=re.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=re}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=qt("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*ne(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*ne(e[t]/255)):e[t]=ne(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let ae=0;class oe{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ae++}),this.uuid=Ft(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(ce(i[e].image)):t.push(ce(i[e]))}else t=ce(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function ce(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?se.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let le=0;class he extends Rt{constructor(t=he.DEFAULT_IMAGE,e=he.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,a=1023,o=1009,c=he.DEFAULT_ANISOTROPY,l=mt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:le++}),this.uuid=Ft(),this.name="",this.source=new oe(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=o,this.offset=new zt(0,0),this.repeat=new zt(1,1),this.center=new zt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new jt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case P:t.x=t.x-Math.floor(t.x);break;case D:t.x=t.x<0?0:1;break;case L:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case P:t.y=t.y-Math.floor(t.y);break;case D:t.y=t.y<0?0:1;break;case L:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}he.DEFAULT_IMAGE=null,he.DEFAULT_MAPPING=300,he.DEFAULT_ANISOTROPY=1;class ue{constructor(t=0,e=0,n=0,i=1){ue.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,a=.1,o=t.elements,c=o[0],l=o[4],h=o[8],u=o[1],d=o[5],p=o[9],f=o[2],A=o[6],g=o[10];if(Math.abs(l-u)<s&&Math.abs(h-f)<s&&Math.abs(p-A)<s){if(Math.abs(l+u)<a&&Math.abs(h+f)<a&&Math.abs(p+A)<a&&Math.abs(c+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(c+1)/2,o=(d+1)/2,m=(g+1)/2,b=(l+u)/4,v=(h+f)/4,y=(p+A)/4;return t>o&&t>m?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=b/n,r=v/n):o>m?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=b/i,r=y/i):m<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(m),n=v/r,i=y/r),this.set(n,i,r,e),this}let m=Math.sqrt((A-p)*(A-p)+(h-f)*(h-f)+(u-l)*(u-l));return Math.abs(m)<.001&&(m=1),this.x=(A-p)/m,this.y=(h-f)/m,this.z=(u-l)/m,this.w=Math.acos((c+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class de extends Rt{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new ue(0,0,t,e),this.scissorTest=!1,this.viewport=new ue(0,0,t,e);const i={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:N,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},n);const r=new he(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let t=0;t<s;t++)this.textures[t]=r.clone(),this.textures[t].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new oe(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class pe extends de{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class fe extends he{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=U,this.minFilter=U,this.wrapR=D,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ae extends he{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=U,this.minFilter=U,this.wrapR=D,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ge{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,a){let o=n[i+0],c=n[i+1],l=n[i+2],h=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=c,t[e+2]=l,void(t[e+3]=h);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||o!==u||c!==d||l!==p){let t=1-a;const e=o*u+c*d+l*p+h*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*t+u*r,c=c*t+d*r,l=l*t+p*r,h=h*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+c*c+l*l+h*h);o*=t,c*=t,l*=t,h*=t}}t[e]=o,t[e+1]=c,t[e+2]=l,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,i,r,s){const a=n[i],o=n[i+1],c=n[i+2],l=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+l*h+o*d-c*u,t[e+1]=o*p+l*u+c*h-a*d,t[e+2]=c*p+l*d+a*u-o*h,t[e+3]=l*p-a*h-o*u-c*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,i=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,c=a(n/2),l=a(i/2),h=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*l*h+c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h-u*d*p;break;case"YXZ":this._x=u*l*h+c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h+u*d*p;break;case"ZXY":this._x=u*l*h-c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h-u*d*p;break;case"ZYX":this._x=u*l*h-c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h+u*d*p;break;case"YZX":this._x=u*l*h+c*d*p,this._y=c*d*h+u*l*p,this._z=c*l*p-u*d*h,this._w=c*l*h-u*d*p;break;case"XZY":this._x=u*l*h-c*d*p,this._y=c*d*h-u*l*p,this._z=c*l*p+u*d*h,this._w=c*l*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],c=e[2],l=e[6],h=e[10],u=n+a+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-o)*t,this._y=(r-c)*t,this._z=(s-i)*t}else if(n>a&&n>h){const t=2*Math.sqrt(1+n-a-h);this._w=(l-o)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+c)/t}else if(a>h){const t=2*Math.sqrt(1+a-n-h);this._w=(r-c)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(o+l)/t}else{const t=2*Math.sqrt(1+h-n-a);this._w=(s-i)/t,this._x=(r+c)/t,this._y=(o+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Nt(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,a=e._x,o=e._y,c=e._z,l=e._w;return this._x=n*l+s*a+i*c-r*o,this._y=i*l+s*o+r*a-n*c,this._z=r*l+s*c+n*o-i*a,this._w=s*l-n*a-i*o-r*c,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const c=Math.sqrt(o),l=Math.atan2(c,a),h=Math.sin((1-e)*l)/c,u=Math.sin(e*l)/c;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class me{constructor(t=0,e=0,n=0){me.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ve.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ve.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,c=2*(s*i-a*n),l=2*(a*e-r*i),h=2*(r*n-s*e);return this.x=e+o*c+s*h-a*l,this.y=n+o*l+a*c-r*h,this.z=i+o*h+r*l-s*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return be.copy(this).projectOnVector(t),this.sub(be)}reflect(t){return this.sub(be.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Nt(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const be=new me,ve=new ge;class ye{constructor(t=new me(1/0,1/0,1/0),e=new me(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(_e.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(_e.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=_e.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,n=i.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,_e):_e.fromBufferAttribute(i,e),_e.applyMatrix4(t.matrixWorld),this.expandByPoint(_e);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Ee.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Ee.copy(n.boundingBox)),Ee.applyMatrix4(t.matrixWorld),this.union(Ee)}const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_e),_e.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Be),Re.subVectors(this.max,Be),we.subVectors(t.a,Be),Ce.subVectors(t.b,Be),Se.subVectors(t.c,Be),Me.subVectors(Ce,we),Ie.subVectors(Se,Ce),Te.subVectors(we,Se);let e=[0,-Me.z,Me.y,0,-Ie.z,Ie.y,0,-Te.z,Te.y,Me.z,0,-Me.x,Ie.z,0,-Ie.x,Te.z,0,-Te.x,-Me.y,Me.x,0,-Ie.y,Ie.x,0,-Te.y,Te.x,0];return!!Le(e,we,Ce,Se,Re)&&(e=[1,0,0,0,1,0,0,0,1],!!Le(e,we,Ce,Se,Re)&&(Pe.crossVectors(Me,Ie),e=[Pe.x,Pe.y,Pe.z],Le(e,we,Ce,Se,Re)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_e).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(_e).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(xe[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),xe[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),xe[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),xe[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),xe[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),xe[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),xe[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),xe[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(xe)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const xe=[new me,new me,new me,new me,new me,new me,new me,new me],_e=new me,Ee=new ye,we=new me,Ce=new me,Se=new me,Me=new me,Ie=new me,Te=new me,Be=new me,Re=new me,Pe=new me,De=new me;function Le(t,e,n,i,r){for(let s=0,a=t.length-3;s<=a;s+=3){De.fromArray(t,s);const a=r.x*Math.abs(De.x)+r.y*Math.abs(De.y)+r.z*Math.abs(De.z),o=e.dot(De),c=n.dot(De),l=i.dot(De);if(Math.max(-Math.max(o,c,l),Math.min(o,c,l))>a)return!1}return!0}const Ue=new ye,Fe=new me,Ne=new me;class ke{constructor(t=new me,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Ue.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Fe.subVectors(t,this.center);const e=Fe.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(Fe,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Ne.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Fe.copy(t.center).add(Ne)),this.expandByPoint(Fe.copy(t.center).sub(Ne))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Oe=new me,Qe=new me,Ge=new me,He=new me,ze=new me,je=new me,Ve=new me;class We{constructor(t=new me,e=new me(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Oe)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Oe.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Oe.copy(this.origin).addScaledVector(this.direction,e),Oe.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){Qe.copy(t).add(e).multiplyScalar(.5),Ge.copy(e).sub(t).normalize(),He.copy(this.origin).sub(Qe);const r=.5*t.distanceTo(e),s=-this.direction.dot(Ge),a=He.dot(this.direction),o=-He.dot(Ge),c=He.lengthSq(),l=Math.abs(1-s*s);let h,u,d,p;if(l>0)if(h=s*o-a,u=s*a-o,p=r*l,h>=0)if(u>=-p)if(u<=p){const t=1/l;h*=t,u*=t,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+c}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+c;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+c;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+c):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+c):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+c);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(Qe).addScaledVector(Ge,u),d}intersectSphere(t,e){Oe.subVectors(t.center,this.origin);const n=Oe.dot(this.direction),i=Oe.dot(Oe)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,a,o;const c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(n=(t.min.x-u.x)*c,i=(t.max.x-u.x)*c):(n=(t.max.x-u.x)*c,i=(t.min.x-u.x)*c),l>=0?(r=(t.min.y-u.y)*l,s=(t.max.y-u.y)*l):(r=(t.max.y-u.y)*l,s=(t.min.y-u.y)*l),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,Oe)}intersectTriangle(t,e,n,i,r){ze.subVectors(e,t),je.subVectors(n,t),Ve.crossVectors(ze,je);let s,a=this.direction.dot(Ve);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}He.subVectors(this.origin,t);const o=s*this.direction.dot(je.crossVectors(He,je));if(o<0)return null;const c=s*this.direction.dot(ze.cross(He));if(c<0)return null;if(o+c>a)return null;const l=-s*He.dot(Ve);return l<0?null:this.at(l/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class qe{constructor(t,e,n,i,r,s,a,o,c,l,h,u,d,p,f,A){qe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,c,l,h,u,d,p,f,A)}set(t,e,n,i,r,s,a,o,c,l,h,u,d,p,f,A){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=c,g[6]=l,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new qe).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Xe.setFromMatrixColumn(t,0).length(),r=1/Xe.setFromMatrixColumn(t,1).length(),s=1/Xe.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),c=Math.sin(i),l=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*l,n=s*h,i=a*l,r=a*h;e[0]=o*l,e[4]=-o*h,e[8]=c,e[1]=n+i*c,e[5]=t-r*c,e[9]=-a*o,e[2]=r-t*c,e[6]=i+n*c,e[10]=s*o}else if("YXZ"===t.order){const t=o*l,n=o*h,i=c*l,r=c*h;e[0]=t+r*a,e[4]=i*a-n,e[8]=s*c,e[1]=s*h,e[5]=s*l,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*l,n=o*h,i=c*l,r=c*h;e[0]=t-r*a,e[4]=-s*h,e[8]=i+n*a,e[1]=n+i*a,e[5]=s*l,e[9]=r-t*a,e[2]=-s*c,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*l,n=s*h,i=a*l,r=a*h;e[0]=o*l,e[4]=i*c-n,e[8]=t*c+r,e[1]=o*h,e[5]=r*c+t,e[9]=n*c-i,e[2]=-c,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,n=s*c,i=a*o,r=a*c;e[0]=o*l,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=s*l,e[9]=-a*l,e[2]=-c*l,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===t.order){const t=s*o,n=s*c,i=a*o,r=a*c;e[0]=o*l,e[4]=-h,e[8]=c*l,e[1]=t*h+r,e[5]=s*l,e[9]=n*h-i,e[2]=i*h-n,e[6]=a*l,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Je,t,Ke)}lookAt(t,e,n){const i=this.elements;return tn.subVectors(t,e),0===tn.lengthSq()&&(tn.z=1),tn.normalize(),Ze.crossVectors(n,tn),0===Ze.lengthSq()&&(1===Math.abs(n.z)?tn.x+=1e-4:tn.z+=1e-4,tn.normalize(),Ze.crossVectors(n,tn)),Ze.normalize(),$e.crossVectors(tn,Ze),i[0]=Ze.x,i[4]=$e.x,i[8]=tn.x,i[1]=Ze.y,i[5]=$e.y,i[9]=tn.y,i[2]=Ze.z,i[6]=$e.z,i[10]=tn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[4],o=n[8],c=n[12],l=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],A=n[10],g=n[14],m=n[3],b=n[7],v=n[11],y=n[15],x=i[0],_=i[4],E=i[8],w=i[12],C=i[1],S=i[5],M=i[9],I=i[13],T=i[2],B=i[6],R=i[10],P=i[14],D=i[3],L=i[7],U=i[11],F=i[15];return r[0]=s*x+a*C+o*T+c*D,r[4]=s*_+a*S+o*B+c*L,r[8]=s*E+a*M+o*R+c*U,r[12]=s*w+a*I+o*P+c*F,r[1]=l*x+h*C+u*T+d*D,r[5]=l*_+h*S+u*B+d*L,r[9]=l*E+h*M+u*R+d*U,r[13]=l*w+h*I+u*P+d*F,r[2]=p*x+f*C+A*T+g*D,r[6]=p*_+f*S+A*B+g*L,r[10]=p*E+f*M+A*R+g*U,r[14]=p*w+f*I+A*P+g*F,r[3]=m*x+b*C+v*T+y*D,r[7]=m*_+b*S+v*B+y*L,r[11]=m*E+b*M+v*R+y*U,r[15]=m*w+b*I+v*P+y*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],c=t[13],l=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*o*h-i*c*h-r*a*u+n*c*u+i*a*d-n*o*d)+t[7]*(+e*o*d-e*c*u+r*s*u-i*s*d+i*c*l-r*o*l)+t[11]*(+e*c*h-e*a*d-r*s*h+n*s*d+r*a*l-n*c*l)+t[15]*(-i*a*l-e*o*h+e*a*u+i*s*h-n*s*u+n*o*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],c=t[7],l=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],A=t[14],g=t[15],m=h*A*c-f*u*c+f*o*d-a*A*d-h*o*g+a*u*g,b=p*u*c-l*A*c-p*o*d+s*A*d+l*o*g-s*u*g,v=l*f*c-p*h*c+p*a*d-s*f*d-l*a*g+s*h*g,y=p*h*o-l*f*o-p*a*u+s*f*u+l*a*A-s*h*A,x=e*m+n*b+i*v+r*y;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/x;return t[0]=m*_,t[1]=(f*u*r-h*A*r-f*i*d+n*A*d+h*i*g-n*u*g)*_,t[2]=(a*A*r-f*o*r+f*i*c-n*A*c-a*i*g+n*o*g)*_,t[3]=(h*o*r-a*u*r-h*i*c+n*u*c+a*i*d-n*o*d)*_,t[4]=b*_,t[5]=(l*A*r-p*u*r+p*i*d-e*A*d-l*i*g+e*u*g)*_,t[6]=(p*o*r-s*A*r-p*i*c+e*A*c+s*i*g-e*o*g)*_,t[7]=(s*u*r-l*o*r+l*i*c-e*u*c-s*i*d+e*o*d)*_,t[8]=v*_,t[9]=(p*h*r-l*f*r-p*n*d+e*f*d+l*n*g-e*h*g)*_,t[10]=(s*f*r-p*a*r+p*n*c-e*f*c-s*n*g+e*a*g)*_,t[11]=(l*a*r-s*h*r-l*n*c+e*h*c+s*n*d-e*a*d)*_,t[12]=y*_,t[13]=(l*f*i-p*h*i+p*n*u-e*f*u-l*n*A+e*h*A)*_,t[14]=(p*a*i-s*f*i-p*n*o+e*f*o+s*n*A-e*a*A)*_,t[15]=(s*h*i-l*a*i+l*n*o-e*h*o-s*n*u+e*a*u)*_,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,c=r*s,l=r*a;return this.set(c*s+n,c*a-i*o,c*o+i*a,0,c*a+i*o,l*a+n,l*o-i*s,0,c*o-i*a,l*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,c=r+r,l=s+s,h=a+a,u=r*c,d=r*l,p=r*h,f=s*l,A=s*h,g=a*h,m=o*c,b=o*l,v=o*h,y=n.x,x=n.y,_=n.z;return i[0]=(1-(f+g))*y,i[1]=(d+v)*y,i[2]=(p-b)*y,i[3]=0,i[4]=(d-v)*x,i[5]=(1-(u+g))*x,i[6]=(A+m)*x,i[7]=0,i[8]=(p+b)*_,i[9]=(A-m)*_,i[10]=(1-(u+f))*_,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Xe.set(i[0],i[1],i[2]).length();const s=Xe.set(i[4],i[5],i[6]).length(),a=Xe.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Ye.copy(this);const o=1/r,c=1/s,l=1/a;return Ye.elements[0]*=o,Ye.elements[1]*=o,Ye.elements[2]*=o,Ye.elements[4]*=c,Ye.elements[5]*=c,Ye.elements[6]*=c,Ye.elements[8]*=l,Ye.elements[9]*=l,Ye.elements[10]*=l,e.setFromRotationMatrix(Ye),n.x=r,n.y=s,n.z=a,this}makePerspective(t,e,n,i,r,s,a=2e3){const o=this.elements,c=2*r/(e-t),l=2*r/(n-i),h=(e+t)/(e-t),u=(n+i)/(n-i);let d,p;if(a===Tt)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==Bt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=c,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s,a=2e3){const o=this.elements,c=1/(e-t),l=1/(n-i),h=1/(s-r),u=(e+t)*c,d=(n+i)*l;let p,f;if(a===Tt)p=(s+r)*h,f=-2*h;else{if(a!==Bt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*h,f=-1*h}return o[0]=2*c,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Xe=new me,Ye=new qe,Je=new me(0,0,0),Ke=new me(1,1,1),Ze=new me,$e=new me,tn=new me,en=new qe,nn=new ge;class rn{constructor(t=0,e=0,n=0,i=rn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],a=i[8],o=i[1],c=i[5],l=i[9],h=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(Nt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Nt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,c)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Nt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Nt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(Nt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Nt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return en.makeRotationFromQuaternion(t),this.setFromRotationMatrix(en,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return nn.setFromEuler(this),this.setFromQuaternion(nn,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}rn.DEFAULT_ORDER="XYZ";class sn{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let an=0;const on=new me,cn=new ge,ln=new qe,hn=new me,un=new me,dn=new me,pn=new ge,fn=new me(1,0,0),An=new me(0,1,0),gn=new me(0,0,1),mn={type:"added"},bn={type:"removed"},vn={type:"childadded",child:null},yn={type:"childremoved",child:null};class xn extends Rt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:an++}),this.uuid=Ft(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=xn.DEFAULT_UP.clone();const t=new me,e=new rn,n=new ge,i=new me(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new qe},normalMatrix:{value:new jt}}),this.matrix=new qe,this.matrixWorld=new qe,this.matrixAutoUpdate=xn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new sn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return cn.setFromAxisAngle(t,e),this.quaternion.multiply(cn),this}rotateOnWorldAxis(t,e){return cn.setFromAxisAngle(t,e),this.quaternion.premultiply(cn),this}rotateX(t){return this.rotateOnAxis(fn,t)}rotateY(t){return this.rotateOnAxis(An,t)}rotateZ(t){return this.rotateOnAxis(gn,t)}translateOnAxis(t,e){return on.copy(t).applyQuaternion(this.quaternion),this.position.add(on.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(fn,t)}translateY(t){return this.translateOnAxis(An,t)}translateZ(t){return this.translateOnAxis(gn,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ln.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?hn.copy(t):hn.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),un.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ln.lookAt(un,hn,this.up):ln.lookAt(hn,un,this.up),this.quaternion.setFromRotationMatrix(ln),i&&(ln.extractRotation(i.matrixWorld),cn.setFromRotationMatrix(ln),this.quaternion.premultiply(cn.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(mn),vn.child=t,this.dispatchEvent(vn),vn.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(bn),yn.child=t,this.dispatchEvent(yn),yn.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),ln.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ln.multiply(t.parent.matrixWorld)),t.applyMatrix4(ln),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(mn),vn.child=t,this.dispatchEvent(vn),vn.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(un,t,dn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(un,pn,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){const i=e[n];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),c=s(t.skeletons),l=s(t.animations),h=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l),h.length>0&&(n.nodes=h)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}xn.DEFAULT_UP=new me(0,1,0),xn.DEFAULT_MATRIX_AUTO_UPDATE=!0,xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _n=new me,En=new me,wn=new me,Cn=new me,Sn=new me,Mn=new me,In=new me,Tn=new me,Bn=new me,Rn=new me;class Pn{constructor(t=new me,e=new me,n=new me){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),_n.subVectors(t,e),i.cross(_n);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){_n.subVectors(i,e),En.subVectors(n,e),wn.subVectors(t,e);const s=_n.dot(_n),a=_n.dot(En),o=_n.dot(wn),c=En.dot(En),l=En.dot(wn),h=s*c-a*a;if(0===h)return r.set(0,0,0),null;const u=1/h,d=(c*o-a*l)*u,p=(s*l-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return null!==this.getBarycoord(t,e,n,i,Cn)&&(Cn.x>=0&&Cn.y>=0&&Cn.x+Cn.y<=1)}static getInterpolation(t,e,n,i,r,s,a,o){return null===this.getBarycoord(t,e,n,i,Cn)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Cn.x),o.addScaledVector(s,Cn.y),o.addScaledVector(a,Cn.z),o)}static isFrontFacing(t,e,n,i){return _n.subVectors(n,e),En.subVectors(t,e),_n.cross(En).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _n.subVectors(this.c,this.b),En.subVectors(this.a,this.b),.5*_n.cross(En).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Pn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Pn.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,r){return Pn.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return Pn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Pn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,a;Sn.subVectors(i,n),Mn.subVectors(r,n),Tn.subVectors(t,n);const o=Sn.dot(Tn),c=Mn.dot(Tn);if(o<=0&&c<=0)return e.copy(n);Bn.subVectors(t,i);const l=Sn.dot(Bn),h=Mn.dot(Bn);if(l>=0&&h<=l)return e.copy(i);const u=o*h-l*c;if(u<=0&&o>=0&&l<=0)return s=o/(o-l),e.copy(n).addScaledVector(Sn,s);Rn.subVectors(t,r);const d=Sn.dot(Rn),p=Mn.dot(Rn);if(p>=0&&d<=p)return e.copy(r);const f=d*c-o*p;if(f<=0&&c>=0&&p<=0)return a=c/(c-p),e.copy(n).addScaledVector(Mn,a);const A=l*p-d*h;if(A<=0&&h-l>=0&&d-p>=0)return In.subVectors(r,i),a=(h-l)/(h-l+(d-p)),e.copy(i).addScaledVector(In,a);const g=1/(A+f+u);return s=f*g,a=u*g,e.copy(n).addScaledVector(Sn,s).addScaledVector(Mn,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Dn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ln={h:0,s:0,l:0},Un={h:0,s:0,l:0};function Fn(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class Nn{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=bt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ee.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=ee.workingColorSpace){return this.r=t,this.g=e,this.b=n,ee.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=ee.workingColorSpace){if(t=kt(t,1),e=Nt(e,0,1),n=Nt(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Fn(r,i,t+1/3),this.g=Fn(r,i,t),this.b=Fn(r,i,t-1/3)}return ee.toWorkingColorSpace(this,i),this}setStyle(t,e=bt){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===r)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=bt){const n=Dn[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ne(t.r),this.g=ne(t.g),this.b=ne(t.b),this}copyLinearToSRGB(t){return this.r=ie(t.r),this.g=ie(t.g),this.b=ie(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=bt){return ee.fromWorkingColorSpace(kn.copy(this),t),65536*Math.round(Nt(255*kn.r,0,255))+256*Math.round(Nt(255*kn.g,0,255))+Math.round(Nt(255*kn.b,0,255))}getHexString(t=bt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ee.workingColorSpace){ee.fromWorkingColorSpace(kn.copy(this),e);const n=kn.r,i=kn.g,r=kn.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,c;const l=(a+s)/2;if(a===s)o=0,c=0;else{const t=s-a;switch(c=l<=.5?t/(s+a):t/(2-s-a),s){case n:o=(i-r)/t+(i<r?6:0);break;case i:o=(r-n)/t+2;break;case r:o=(n-i)/t+4}o/=6}return t.h=o,t.s=c,t.l=l,t}getRGB(t,e=ee.workingColorSpace){return ee.fromWorkingColorSpace(kn.copy(this),e),t.r=kn.r,t.g=kn.g,t.b=kn.b,t}getStyle(t=bt){ee.fromWorkingColorSpace(kn.copy(this),t);const e=kn.r,n=kn.g,i=kn.b;return t!==bt?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(t,e,n){return this.getHSL(Ln),this.setHSL(Ln.h+t,Ln.s+e,Ln.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Ln),t.getHSL(Un);const n=Ot(Ln.h,Un.h,e),i=Ot(Ln.s,Un.s,e),r=Ot(Ln.l,Un.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const kn=new Nn;Nn.NAMES=Dn;let On=0;class Qn extends Rt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:On++}),this.uuid=Ft(),this.name="",this.type="Material",this.blending=1,this.side=u,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=f,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Nn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=St,this.stencilZFail=St,this.stencilZPass=St,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==u&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==f&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==St&&(n.stencilFail=this.stencilFail),this.stencilZFail!==St&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==St&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class Gn extends Qn{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Nn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new rn,this.combine=A,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Hn=zn();function zn(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(i[t]=0,i[256|t]=32768,r[t]=24,r[256|t]=24):e<-14?(i[t]=1024>>-e-14,i[256|t]=1024>>-e-14|32768,r[t]=-e-1,r[256|t]=-e-1):e<=15?(i[t]=e+15<<10,i[256|t]=e+15<<10|32768,r[t]=13,r[256|t]=13):e<128?(i[t]=31744,i[256|t]=64512,r[t]=24,r[256|t]=24):(i[t]=31744,i[256|t]=64512,r[t]=13,r[256|t]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;0==(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,s[t]=e|n}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)a[t]=t<<23;a[31]=1199570944,a[32]=2147483648;for(let t=33;t<63;++t)a[t]=2147483648+(t-32<<23);a[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(o[t]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}const jn={toHalfFloat:function(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Nt(t,-65504,65504),Hn.floatView[0]=t;const e=Hn.uint32View[0],n=e>>23&511;return Hn.baseTable[n]+((8388607&e)>>Hn.shiftTable[n])},fromHalfFloat:function(t){const e=t>>10;return Hn.uint32View[0]=Hn.mantissaTable[Hn.offsetTable[e]+(1023&t)]+Hn.exponentTable[e],Hn.floatView[0]}},Vn=new me,Wn=new zt;class qn{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=Mt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=z,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return Jt("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Wn.fromBufferAttribute(this,e),Wn.applyMatrix3(t),this.setXY(e,Wn.x,Wn.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Vn.fromBufferAttribute(this,e),Vn.applyMatrix3(t),this.setXYZ(e,Vn.x,Vn.y,Vn.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Vn.fromBufferAttribute(this,e),Vn.applyMatrix4(t),this.setXYZ(e,Vn.x,Vn.y,Vn.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Vn.fromBufferAttribute(this,e),Vn.applyNormalMatrix(t),this.setXYZ(e,Vn.x,Vn.y,Vn.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Vn.fromBufferAttribute(this,e),Vn.transformDirection(t),this.setXYZ(e,Vn.x,Vn.y,Vn.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Qt(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Gt(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Qt(e,this.array)),e}setX(t,e){return this.normalized&&(e=Gt(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Qt(e,this.array)),e}setY(t,e){return this.normalized&&(e=Gt(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Qt(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Gt(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Qt(e,this.array)),e}setW(t,e){return this.normalized&&(e=Gt(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Gt(e,this.array),n=Gt(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Gt(e,this.array),n=Gt(n,this.array),i=Gt(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Gt(e,this.array),n=Gt(n,this.array),i=Gt(i,this.array),r=Gt(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Mt&&(t.usage=this.usage),t}}class Xn extends qn{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Yn extends qn{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Jn extends qn{constructor(t,e,n){super(new Float32Array(t),e,n)}}let Kn=0;const Zn=new qe,$n=new xn,ti=new me,ei=new ye,ni=new ye,ii=new me;class ri extends Rt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Kn++}),this.uuid=Ft(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Wt(t)?Yn:Xn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new jt).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Zn.makeRotationFromQuaternion(t),this.applyMatrix4(Zn),this}rotateX(t){return Zn.makeRotationX(t),this.applyMatrix4(Zn),this}rotateY(t){return Zn.makeRotationY(t),this.applyMatrix4(Zn),this}rotateZ(t){return Zn.makeRotationZ(t),this.applyMatrix4(Zn),this}translate(t,e,n){return Zn.makeTranslation(t,e,n),this.applyMatrix4(Zn),this}scale(t,e,n){return Zn.makeScale(t,e,n),this.applyMatrix4(Zn),this}lookAt(t){return $n.lookAt(t),$n.updateMatrix(),this.applyMatrix4($n.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ti).negate(),this.translate(ti.x,ti.y,ti.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Jn(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ye);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new me(-1/0,-1/0,-1/0),new me(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];ei.setFromBufferAttribute(n),this.morphTargetsRelative?(ii.addVectors(this.boundingBox.min,ei.min),this.boundingBox.expandByPoint(ii),ii.addVectors(this.boundingBox.max,ei.max),this.boundingBox.expandByPoint(ii)):(this.boundingBox.expandByPoint(ei.min),this.boundingBox.expandByPoint(ei.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ke);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new me,1/0);if(t){const n=this.boundingSphere.center;if(ei.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];ni.setFromBufferAttribute(n),this.morphTargetsRelative?(ii.addVectors(ei.min,ni.min),ei.expandByPoint(ii),ii.addVectors(ei.max,ni.max),ei.expandByPoint(ii)):(ei.expandByPoint(ni.min),ei.expandByPoint(ni.max))}ei.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)ii.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(ii));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)ii.fromBufferAttribute(s,e),a&&(ti.fromBufferAttribute(t,e),ii.add(ti)),i=Math.max(i,n.distanceToSquared(ii))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,i=e.normal,r=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new qn(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let t=0;t<n.count;t++)a[t]=new me,o[t]=new me;const c=new me,l=new me,h=new me,u=new zt,d=new zt,p=new zt,f=new me,A=new me;function g(t,e,i){c.fromBufferAttribute(n,t),l.fromBufferAttribute(n,e),h.fromBufferAttribute(n,i),u.fromBufferAttribute(r,t),d.fromBufferAttribute(r,e),p.fromBufferAttribute(r,i),l.sub(c),h.sub(c),d.sub(u),p.sub(u);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(l).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(s),A.copy(h).multiplyScalar(d.x).addScaledVector(l,-p.x).multiplyScalar(s),a[t].add(f),a[e].add(f),a[i].add(f),o[t].add(A),o[e].add(A),o[i].add(A))}let m=this.groups;0===m.length&&(m=[{start:0,count:t.count}]);for(let e=0,n=m.length;e<n;++e){const n=m[e],i=n.start;for(let e=i,r=i+n.count;e<r;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const b=new me,v=new me,y=new me,x=new me;function _(t){y.fromBufferAttribute(i,t),x.copy(y);const e=a[t];b.copy(e),b.sub(y.multiplyScalar(y.dot(e))).normalize(),v.crossVectors(x,e);const n=v.dot(o[t])<0?-1:1;s.setXYZW(t,b.x,b.y,b.z,n)}for(let e=0,n=m.length;e<n;++e){const n=m[e],i=n.start;for(let e=i,r=i+n.count;e<r;e+=3)_(t.getX(e+0)),_(t.getX(e+1)),_(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new qn(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new me,r=new me,s=new me,a=new me,o=new me,c=new me,l=new me,h=new me;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),l.subVectors(s,r),h.subVectors(i,r),l.cross(h),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),c.fromBufferAttribute(n,f),a.add(l),o.add(l),c.add(l),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let t=0,a=e.count;t<a;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),l.subVectors(s,r),h.subVectors(i,r),l.cross(h),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)ii.fromBufferAttribute(t,e),ii.normalize(),t.setXYZ(e,ii.x,ii.y,ii.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let a=0,o=0;for(let r=0,c=e.length;r<c;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[o++]=n[a++]}return new qn(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ri,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let e=0,i=a.length;e<i;e++){const i=t(a[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const si=new qe,ai=new We,oi=new ke,ci=new me,li=new me,hi=new me,ui=new me,di=new me,pi=new me,fi=new zt,Ai=new zt,gi=new zt,mi=new me,bi=new me,vi=new me,yi=new me,xi=new me;class _i extends xn{constructor(t=new ri,e=new Gn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(r&&a){pi.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(di.fromBufferAttribute(o,t),s?pi.addScaledVector(di,i):pi.addScaledVector(di.sub(e),i))}e.add(pi)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),oi.copy(n.boundingSphere),oi.applyMatrix4(r),ai.copy(t.ray).recast(t.near),!1===oi.containsPoint(ai.origin)){if(null===ai.intersectSphere(oi,ci))return;if(ai.origin.distanceToSquared(ci)>(t.far-t.near)**2)return}si.copy(r).invert(),ai.copy(t.ray).applyMatrix4(si),null!==n.boundingBox&&!1===ai.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,ai)}}_computeIntersections(t,e,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,c=r.attributes.uv,l=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let r=0,o=u.length;r<o;r++){const o=u[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3){i=Ei(this,p,t,n,c,l,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3){i=Ei(this,s,t,n,c,l,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}else if(void 0!==o)if(Array.isArray(s))for(let r=0,a=u.length;r<a;r++){const a=u[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3){i=Ei(this,p,t,n,c,l,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3){i=Ei(this,s,t,n,c,l,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}}}function Ei(t,e,n,i,r,s,a,o,c,l){t.getVertexPosition(o,li),t.getVertexPosition(c,hi),t.getVertexPosition(l,ui);const h=function(t,e,n,i,r,s,a,o){let c;if(c=e.side===d?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,e.side===u,o),null===c)return null;xi.copy(o),xi.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(xi);return l<n.near||l>n.far?null:{distance:l,point:xi.clone(),object:t}}(t,e,n,i,li,hi,ui,yi);if(h){r&&(fi.fromBufferAttribute(r,o),Ai.fromBufferAttribute(r,c),gi.fromBufferAttribute(r,l),h.uv=Pn.getInterpolation(yi,li,hi,ui,fi,Ai,gi,new zt)),s&&(fi.fromBufferAttribute(s,o),Ai.fromBufferAttribute(s,c),gi.fromBufferAttribute(s,l),h.uv1=Pn.getInterpolation(yi,li,hi,ui,fi,Ai,gi,new zt)),a&&(mi.fromBufferAttribute(a,o),bi.fromBufferAttribute(a,c),vi.fromBufferAttribute(a,l),h.normal=Pn.getInterpolation(yi,li,hi,ui,mi,bi,vi,new me),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const t={a:o,b:c,c:l,normal:new me,materialIndex:0};Pn.getNormal(li,hi,ui,t.normal),h.face=t}return h}class wi extends ri{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],c=[],l=[],h=[];let u=0,d=0;function p(t,e,n,i,r,s,p,f,A,g,m){const b=s/A,v=p/g,y=s/2,x=p/2,_=f/2,E=A+1,w=g+1;let C=0,S=0;const M=new me;for(let s=0;s<w;s++){const a=s*v-x;for(let o=0;o<E;o++){const u=o*b-y;M[t]=u*i,M[e]=a*r,M[n]=_,c.push(M.x,M.y,M.z),M[t]=0,M[e]=0,M[n]=f>0?1:-1,l.push(M.x,M.y,M.z),h.push(o/A),h.push(1-s/g),C+=1}}for(let t=0;t<g;t++)for(let e=0;e<A;e++){const n=u+e+E*t,i=u+e+E*(t+1),r=u+(e+1)+E*(t+1),s=u+(e+1)+E*t;o.push(n,i,s),o.push(i,r,s),S+=6}a.addGroup(d,S,m),d+=S,u+=C}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new Jn(c,3)),this.setAttribute("normal",new Jn(l,3)),this.setAttribute("uv",new Jn(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wi(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ci(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Si(t){const e={};for(let n=0;n<t.length;n++){const i=Ci(t[n]);for(const t in i)e[t]=i[t]}return e}function Mi(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:ee.workingColorSpace}const Ii={clone:Ci,merge:Si};class Ti extends Qn{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ci(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class Bi extends xn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new qe,this.projectionMatrix=new qe,this.projectionMatrixInverse=new qe,this.coordinateSystem=Tt}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Ri=new me,Pi=new zt,Di=new zt;class Li extends Bi{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Ut*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Lt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Ut*Math.atan(Math.tan(.5*Lt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Ri.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Ri.x,Ri.y).multiplyScalar(-t/Ri.z),Ri.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Ri.x,Ri.y).multiplyScalar(-t/Ri.z)}getViewSize(t,e){return this.getViewBounds(t,Pi,Di),e.subVectors(Di,Pi)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Lt*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/a,i*=s.width/t,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Ui=-90;class Fi extends xn{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Li(Ui,1,t,e);i.layers=this.layers,this.add(i);const r=new Li(Ui,1,t,e);r.layers=this.layers,this.add(r);const s=new Li(Ui,1,t,e);s.layers=this.layers,this.add(s);const a=new Li(Ui,1,t,e);a.layers=this.layers,this.add(a);const o=new Li(Ui,1,t,e);o.layers=this.layers,this.add(o);const c=new Li(Ui,1,t,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,s,a,o]=e;for(const t of e)this.remove(t);if(t===Tt)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(t!==Bt)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,c,l]=this.children,h=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,s),t.setRenderTarget(n,2,i),t.render(e,a),t.setRenderTarget(n,3,i),t.render(e,o),t.setRenderTarget(n,4,i),t.render(e,c),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,i),t.render(e,l),t.setRenderTarget(h,u,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Ni extends he{constructor(t,e,n,i,r,s,a,o,c,l){super(t=void 0!==t?t:[],e=void 0!==e?e:M,n,i,r,s,a,o,c,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class ki extends pe{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new Ni(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:N}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new wi(5,5,5),r=new Ti({name:"CubemapFromEquirect",uniforms:Ci(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:d,blending:0});r.uniforms.tEquirect.value=e;const s=new _i(i,r),a=e.minFilter;e.minFilter===O&&(e.minFilter=N);return new Fi(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}const Oi=new me,Qi=new me,Gi=new jt;class Hi{constructor(t=new me(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Oi.subVectors(n,e).cross(Qi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(Oi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Gi.getNormalMatrix(t),i=this.coplanarPoint(Oi).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const zi=new ke,ji=new me;class Vi{constructor(t=new Hi,e=new Hi,n=new Hi,i=new Hi,r=new Hi,s=new Hi){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,i=t.elements,r=i[0],s=i[1],a=i[2],o=i[3],c=i[4],l=i[5],h=i[6],u=i[7],d=i[8],p=i[9],f=i[10],A=i[11],g=i[12],m=i[13],b=i[14],v=i[15];if(n[0].setComponents(o-r,u-c,A-d,v-g).normalize(),n[1].setComponents(o+r,u+c,A+d,v+g).normalize(),n[2].setComponents(o+s,u+l,A+p,v+m).normalize(),n[3].setComponents(o-s,u-l,A-p,v-m).normalize(),n[4].setComponents(o-a,u-h,A-f,v-b).normalize(),e===Tt)n[5].setComponents(o+a,u+h,A+f,v+b).normalize();else{if(e!==Bt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(a,h,f,b).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),zi.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),zi.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(zi)}intersectsSprite(t){return zi.center.set(0,0,0),zi.radius=.7071067811865476,zi.applyMatrix4(t.matrixWorld),this.intersectsSphere(zi)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(ji.x=i.normal.x>0?t.max.x:t.min.x,ji.y=i.normal.y>0?t.max.y:t.min.y,ji.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(ji)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Wi(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function qi(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=e.get(n);i&&(t.deleteBuffer(i.buffer),e.delete(n))},update:function(n,i){if(n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}n.isInterleavedBufferAttribute&&(n=n.data);const r=e.get(n);if(void 0===r)e.set(n,function(e,n){const i=e.array,r=e.usage,s=i.byteLength,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,i,r),e.onUploadCallback(),i instanceof Float32Array)o=t.FLOAT;else if(i instanceof Uint16Array)o=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=t.SHORT;else if(i instanceof Uint32Array)o=t.UNSIGNED_INT;else if(i instanceof Int32Array)o=t.INT;else if(i instanceof Int8Array)o=t.BYTE;else if(i instanceof Uint8Array)o=t.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=t.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,size:s}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,i){const r=n.array,s=n._updateRange,a=n.updateRanges;if(t.bindBuffer(i,e),-1===s.count&&0===a.length&&t.bufferSubData(i,0,r),0!==a.length){for(let e=0,n=a.length;e<n;e++){const n=a[e];t.bufferSubData(i,n.start*r.BYTES_PER_ELEMENT,r,n.start,n.count)}n.clearUpdateRanges()}-1!==s.count&&(t.bufferSubData(i,s.offset*r.BYTES_PER_ELEMENT,r,s.offset,s.count),s.count=-1),n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}class Xi extends ri{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,a=Math.floor(n),o=Math.floor(i),c=a+1,l=o+1,h=t/a,u=e/o,d=[],p=[],f=[],A=[];for(let t=0;t<l;t++){const e=t*u-s;for(let n=0;n<c;n++){const i=n*h-r;p.push(i,-e,0),f.push(0,0,1),A.push(n/a),A.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const n=e+c*t,i=e+c*(t+1),r=e+1+c*(t+1),s=e+1+c*t;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Jn(p,3)),this.setAttribute("normal",new Jn(f,3)),this.setAttribute("uv",new Jn(A,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Xi(t.width,t.height,t.widthSegments,t.heightSegments)}}const Yi={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[MORPHTARGETS_COUNT];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t#endif\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\t#ifndef USE_INSTANCING_MORPH\n\t\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\t#endif\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tfloat startCompression = 0.8 - 0.04;\n\tfloat desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min(color.r, min(color.g, color.b));\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max(color.r, max(color.g, color.b));\n\tif (peak < startCompression) return color;\n\tfloat d = 1. - startCompression;\n\tfloat newPeak = 1. - d * d / (peak + d - startCompression);\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);\n\treturn mix(color, newPeak * vec3(1, 1, 1), g);\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Ji={common:{diffuse:{value:new Nn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new jt},alphaMap:{value:null},alphaMapTransform:{value:new jt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new jt}},envmap:{envMap:{value:null},envMapRotation:{value:new jt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new jt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new jt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new jt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new jt},normalScale:{value:new zt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new jt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new jt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new jt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new jt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Nn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Nn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new jt},alphaTest:{value:0},uvTransform:{value:new jt}},sprite:{diffuse:{value:new Nn(16777215)},opacity:{value:1},center:{value:new zt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new jt},alphaMap:{value:null},alphaMapTransform:{value:new jt},alphaTest:{value:0}}},Ki={basic:{uniforms:Si([Ji.common,Ji.specularmap,Ji.envmap,Ji.aomap,Ji.lightmap,Ji.fog]),vertexShader:Yi.meshbasic_vert,fragmentShader:Yi.meshbasic_frag},lambert:{uniforms:Si([Ji.common,Ji.specularmap,Ji.envmap,Ji.aomap,Ji.lightmap,Ji.emissivemap,Ji.bumpmap,Ji.normalmap,Ji.displacementmap,Ji.fog,Ji.lights,{emissive:{value:new Nn(0)}}]),vertexShader:Yi.meshlambert_vert,fragmentShader:Yi.meshlambert_frag},phong:{uniforms:Si([Ji.common,Ji.specularmap,Ji.envmap,Ji.aomap,Ji.lightmap,Ji.emissivemap,Ji.bumpmap,Ji.normalmap,Ji.displacementmap,Ji.fog,Ji.lights,{emissive:{value:new Nn(0)},specular:{value:new Nn(1118481)},shininess:{value:30}}]),vertexShader:Yi.meshphong_vert,fragmentShader:Yi.meshphong_frag},standard:{uniforms:Si([Ji.common,Ji.envmap,Ji.aomap,Ji.lightmap,Ji.emissivemap,Ji.bumpmap,Ji.normalmap,Ji.displacementmap,Ji.roughnessmap,Ji.metalnessmap,Ji.fog,Ji.lights,{emissive:{value:new Nn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Yi.meshphysical_vert,fragmentShader:Yi.meshphysical_frag},toon:{uniforms:Si([Ji.common,Ji.aomap,Ji.lightmap,Ji.emissivemap,Ji.bumpmap,Ji.normalmap,Ji.displacementmap,Ji.gradientmap,Ji.fog,Ji.lights,{emissive:{value:new Nn(0)}}]),vertexShader:Yi.meshtoon_vert,fragmentShader:Yi.meshtoon_frag},matcap:{uniforms:Si([Ji.common,Ji.bumpmap,Ji.normalmap,Ji.displacementmap,Ji.fog,{matcap:{value:null}}]),vertexShader:Yi.meshmatcap_vert,fragmentShader:Yi.meshmatcap_frag},points:{uniforms:Si([Ji.points,Ji.fog]),vertexShader:Yi.points_vert,fragmentShader:Yi.points_frag},dashed:{uniforms:Si([Ji.common,Ji.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Yi.linedashed_vert,fragmentShader:Yi.linedashed_frag},depth:{uniforms:Si([Ji.common,Ji.displacementmap]),vertexShader:Yi.depth_vert,fragmentShader:Yi.depth_frag},normal:{uniforms:Si([Ji.common,Ji.bumpmap,Ji.normalmap,Ji.displacementmap,{opacity:{value:1}}]),vertexShader:Yi.meshnormal_vert,fragmentShader:Yi.meshnormal_frag},sprite:{uniforms:Si([Ji.sprite,Ji.fog]),vertexShader:Yi.sprite_vert,fragmentShader:Yi.sprite_frag},background:{uniforms:{uvTransform:{value:new jt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Yi.background_vert,fragmentShader:Yi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new jt}},vertexShader:Yi.backgroundCube_vert,fragmentShader:Yi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Yi.cube_vert,fragmentShader:Yi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Yi.equirect_vert,fragmentShader:Yi.equirect_frag},distanceRGBA:{uniforms:Si([Ji.common,Ji.displacementmap,{referencePosition:{value:new me},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Yi.distanceRGBA_vert,fragmentShader:Yi.distanceRGBA_frag},shadow:{uniforms:Si([Ji.lights,Ji.fog,{color:{value:new Nn(0)},opacity:{value:1}}]),vertexShader:Yi.shadow_vert,fragmentShader:Yi.shadow_frag}};Ki.physical={uniforms:Si([Ki.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new jt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new jt},clearcoatNormalScale:{value:new zt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new jt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new jt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new jt},sheen:{value:0},sheenColor:{value:new Nn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new jt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new jt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new jt},transmissionSamplerSize:{value:new zt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new jt},attenuationDistance:{value:0},attenuationColor:{value:new Nn(0)},specularColor:{value:new Nn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new jt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new jt},anisotropyVector:{value:new zt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new jt}}]),vertexShader:Yi.meshphysical_vert,fragmentShader:Yi.meshphysical_frag};const Zi={r:0,b:0,g:0},$i=new rn,tr=new qe;function er(t,e,n,i,r,s,a){const o=new Nn(0);let c,l,h=!0===s?0:1,p=null,f=0,A=null;function g(e,n){e.getRGB(Zi,Mi(t)),i.buffers.color.setClear(Zi.r,Zi.g,Zi.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),h=e,g(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,g(o,h)},render:function(s,m){let b=!1,v=!0===m.isScene?m.background:null;if(v&&v.isTexture){v=(m.backgroundBlurriness>0?n:e).get(v)}null===v?g(o,h):v&&v.isColor&&(g(v,1),b=!0);const y=t.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,a),(t.autoClear||b)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.mapping===R)?(void 0===l&&(l=new _i(new wi(1,1,1),new Ti({name:"BackgroundCubeMaterial",uniforms:Ci(Ki.backgroundCube.uniforms),vertexShader:Ki.backgroundCube.vertexShader,fragmentShader:Ki.backgroundCube.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),$i.copy(m.backgroundRotation),$i.x*=-1,$i.y*=-1,$i.z*=-1,v.isCubeTexture&&!1===v.isRenderTargetTexture&&($i.y*=-1,$i.z*=-1),l.material.uniforms.envMap.value=v,l.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4(tr.makeRotationFromEuler($i)),l.material.toneMapped=ee.getTransfer(v.colorSpace)!==Et,p===v&&f===v.version&&A===t.toneMapping||(l.material.needsUpdate=!0,p=v,f=v.version,A=t.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null)):v&&v.isTexture&&(void 0===c&&(c=new _i(new Xi(2,2),new Ti({name:"BackgroundMaterial",uniforms:Ci(Ki.background.uniforms),vertexShader:Ki.background.vertexShader,fragmentShader:Ki.background.fragmentShader,side:u,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=v,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=ee.getTransfer(v.colorSpace)!==Et,!0===v.matrixAutoUpdate&&v.updateMatrix(),c.material.uniforms.uvTransform.value.copy(v.matrix),p===v&&f===v.version&&A===t.toneMapping||(c.material.needsUpdate=!0,p=v,f=v.version,A=t.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null))}}}function nr(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=l(null);let s=r,a=!1;function o(e){return t.bindVertexArray(e)}function c(e){return t.deleteVertexArray(e)}function l(t){const e=[],i=[],r=[];for(let t=0;t<n;t++)e[t]=0,i[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:r,object:t,attributes:{},index:null}}function h(){const t=s.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function u(t){d(t,0)}function d(e,n){const i=s.newAttributes,r=s.enabledAttributes,a=s.attributeDivisors;i[e]=1,0===r[e]&&(t.enableVertexAttribArray(e),r[e]=1),a[e]!==n&&(t.vertexAttribDivisor(e,n),a[e]=n)}function p(){const e=s.newAttributes,n=s.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function f(e,n,i,r,s,a,o){!0===o?t.vertexAttribIPointer(e,n,i,s,a):t.vertexAttribPointer(e,n,i,r,s,a)}function A(){g(),a=!0,s!==r&&(s=r,o(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,c,A,g){let m=!1;const b=function(e,n,r){const s=!0===r.wireframe;let a=i[e.id];void 0===a&&(a={},i[e.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let c=o[s];void 0===c&&(c=l(t.createVertexArray()),o[s]=c);return c}(A,c,r);s!==b&&(s=b,o(s.object)),m=function(t,e,n,i){const r=s.attributes,a=e.attributes;let o=0;const c=n.getAttributes();for(const e in c){if(c[e].location>=0){const n=r[e];let i=a[e];if(void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;o++}}return s.attributesNum!==o||s.index!==i}(n,A,c,g),m&&function(t,e,n,i){const r={},a=e.attributes;let o=0;const c=n.getAttributes();for(const e in c){if(c[e].location>=0){let n=a[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[e]=i,o++}}s.attributes=r,s.attributesNum=o,s.index=i}(n,A,c,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(m||a)&&(a=!1,function(n,i,r,s){h();const a=s.attributes,o=r.getAttributes(),c=i.defaultAttributeValues;for(const i in o){const r=o[i];if(r.location>=0){let o=a[i];if(void 0===o&&("instanceMatrix"===i&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===i&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){const i=o.normalized,a=o.itemSize,c=e.get(o);if(void 0===c)continue;const l=c.buffer,h=c.type,p=c.bytesPerElement,A=h===t.INT||h===t.UNSIGNED_INT||o.gpuType===G;if(o.isInterleavedBufferAttribute){const e=o.data,c=e.stride,g=o.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)d(r.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<r.locationSize;t++)u(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,l);for(let t=0;t<r.locationSize;t++)f(r.location+t,a/r.locationSize,h,i,c*p,(g+a/r.locationSize*t)*p,A)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)d(r.location+t,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<r.locationSize;t++)u(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,l);for(let t=0;t<r.locationSize;t++)f(r.location+t,a/r.locationSize,h,i,a*p,a/r.locationSize*t*p,A)}}else if(void 0!==c){const e=c[i];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(r.location,e);break;case 3:t.vertexAttrib3fv(r.location,e);break;case 4:t.vertexAttrib4fv(r.location,e);break;default:t.vertexAttrib1fv(r.location,e)}}}}p()}(n,r,c,A),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:A,resetDefaultState:g,dispose:function(){A();for(const t in i){const e=i[t];for(const t in e){const n=e[t];for(const t in n)c(n[t].object),delete n[t];delete e[t]}delete i[t]}},releaseStatesOfGeometry:function(t){if(void 0===i[t.id])return;const e=i[t.id];for(const t in e){const n=e[t];for(const t in n)c(n[t].object),delete n[t];delete e[t]}delete i[t.id]},releaseStatesOfProgram:function(t){for(const e in i){const n=i[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)c(r[t].object),delete r[t];delete n[t.id]}},initAttributes:h,enableAttribute:u,disableUnusedAttributes:p}}function ir(t,e,n){let i;this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=function(e,r,s){0!==s&&(t.drawArraysInstanced(i,e,r,s),n.update(r,i,s))},this.renderMultiDraw=function(t,r,s){if(0===s)return;const a=e.get("WEBGL_multi_draw");if(null===a)for(let e=0;e<s;e++)this.render(t[e],r[e]);else{a.multiDrawArraysWEBGL(i,t,0,r,0,s);let e=0;for(let t=0;t<s;t++)e+=r[t];n.update(e,i,1)}}}function rr(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp";const a=r(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const o=!0===n.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),l=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:o,maxTextures:c,maxVertexTextures:l,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:l>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function sr(t){const e=this;let n=null,i=0,r=!1,s=!1;const a=new Hi,o=new jt,c={value:null,needsUpdate:!1};function l(t,n,i,r){const s=null!==t?t.length:0;let l=null;if(0!==s){if(l=c.value,!0!==r||null===l){const e=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(l,n),l[n+3]=a.constant}c.value=l,c.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n},this.beginShadows=function(){s=!0,l(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){n=l(t,e,0)},this.setState=function(a,o,h){const u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=t.get(a);if(!r||null===u||0===u.length||s&&!p)s?l(null):function(){c.value!==n&&(c.value=n,c.needsUpdate=i>0);e.numPlanes=i,e.numIntersection=0}();else{const t=s?0:i,e=4*t;let r=f.clippingState||null;c.value=r,r=l(u,o,e,h);for(let t=0;t!==e;++t)r[t]=n[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function ar(t){let e=new WeakMap;function n(t,e){return e===T?t.mapping=M:e===B&&(t.mapping=I),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===T||s===B){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new ki(s.height);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}class or extends Bi{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,a=i+e,o=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const cr=[.125,.215,.35,.446,.526,.582],lr=20,hr=new or,ur=new Nn;let dr=null,pr=0,fr=0,Ar=!1;const gr=(1+Math.sqrt(5))/2,mr=1/gr,br=[new me(1,1,1),new me(-1,1,1),new me(1,1,-1),new me(-1,1,-1),new me(0,gr,mr),new me(0,gr,-mr),new me(mr,0,gr),new me(-mr,0,gr),new me(gr,mr,0),new me(-gr,mr,0)];class vr{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){dr=this._renderer.getRenderTarget(),pr=this._renderer.getActiveCubeFace(),fr=this._renderer.getActiveMipmapLevel(),Ar=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Er(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=_r(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(dr,pr,fr),this._renderer.xr.enabled=Ar,t.scissorTest=!1,xr(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===M||t.mapping===I?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),dr=this._renderer.getRenderTarget(),pr=this._renderer.getActiveCubeFace(),fr=this._renderer.getActiveMipmapLevel(),Ar=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:N,minFilter:N,generateMipmaps:!1,type:j,format:W,colorSpace:vt,depthBuffer:!1},i=yr(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=yr(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+cr.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);n.push(s);let o=1/s;a>t-4?o=cr[a-t+4-1]:0===a&&(o=0),i.push(o);const c=1/(s-2),l=-c,h=1+c,u=[l,l,h,l,h,h,l,l,h,h,l,h],d=6,p=6,f=3,A=2,g=1,m=new Float32Array(f*p*d),b=new Float32Array(A*p*d),v=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];m.set(i,f*p*t),b.set(u,A*p*t);const r=[t,t,t,t,t,t];v.set(r,g*p*t)}const y=new ri;y.setAttribute("position",new qn(m,f)),y.setAttribute("uv",new qn(b,A)),y.setAttribute("faceIndex",new qn(v,g)),e.push(y),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(lr),r=new me(0,1,0),s=new Ti({name:"SphericalGaussianBlur",defines:{n:lr,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:wr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(i,t,e)}return i}_compileMaterial(t){const e=new _i(this._lodPlanes[0],t);this._renderer.compile(e,hr)}_sceneToCubeUV(t,e,n,i){const r=new Li(90,1,e,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,c=o.autoClear,l=o.toneMapping;o.getClearColor(ur),o.toneMapping=b,o.autoClear=!1;const h=new Gn({name:"PMREM.Background",side:d,depthWrite:!1,depthTest:!1}),u=new _i(new wi,h);let p=!1;const f=t.background;f?f.isColor&&(h.color.copy(f),t.background=null,p=!0):(h.color.copy(ur),p=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1===n?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e]));const c=this._cubeSize;xr(i,n*c,e>2?c:0,c,c),o.setRenderTarget(i),p&&o.render(u,r),o.render(t,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=l,o.autoClear=c,t.background=f}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===M||t.mapping===I;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Er()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=_r());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new _i(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const a=this._cubeSize;xr(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(s,hr)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=br[(e-1)%br.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,a){const o=this._renderer,c=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new _i(this._lodPlanes[i],c),h=c.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):lr;f>lr&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const A=[];let g=0;for(let t=0;t<lr;++t){const e=t/p,n=Math.exp(-e*e/2);A.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<A.length;t++)A[t]=A[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=A,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:m}=this;h.dTheta.value=d,h.mipInt.value=m-n;const b=this._sizeLods[i];xr(e,3*b*(i>m-4?i-m+4:0),4*(this._cubeSize-b),3*b,2*b),o.setRenderTarget(e),o.render(l,hr)}}function yr(t,e,n){const i=new pe(t,e,n);return i.texture.mapping=R,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function xr(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function _r(){return new Ti({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:wr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Er(){return new Ti({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:wr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function wr(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Cr(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===T||s===B,o=s===M||s===I;if(a||o){let s=e.get(r);const c=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==c)return null===n&&(n=new vr(t)),s=a?n.fromEquirectangular(r,s):n.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),s.texture;if(void 0!==s)return s.texture;{const c=r.image;return a&&c&&c.height>0||o&&c&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(c)?(null===n&&(n=new vr(t)),s=a?n.fromEquirectangular(r):n.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),r.addEventListener("dispose",i),s.texture):null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Sr(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Mr(t,e,n,i){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);for(const t in o.morphAttributes){const n=o.morphAttributes[t];for(let t=0,i=n.length;t<i;t++)e.remove(n[t])}o.removeEventListener("dispose",a),delete r[o.id];const c=s.get(o);c&&(e.remove(c),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(t){const n=[],i=t.index,r=t.attributes.position;let a=0;if(null!==i){const t=i.array;a=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const t=r.array;a=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}}const o=new(Wt(n)?Yn:Xn)(n,1);o.version=a;const c=s.get(t);c&&e.remove(c),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,n.memory.geometries++),e},update:function(n){const i=n.attributes;for(const n in i)e.update(i[n],t.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)e.update(i[n],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&o(t)}else o(t);return s.get(t)}}}function Ir(t,e,n){let i,r,s;this.setMode=function(t){i=t},this.setIndex=function(t){r=t.type,s=t.bytesPerElement},this.render=function(e,a){t.drawElements(i,a,r,e*s),n.update(a,i,1)},this.renderInstances=function(e,a,o){0!==o&&(t.drawElementsInstanced(i,a,r,e*s,o),n.update(a,i,o))},this.renderMultiDraw=function(t,a,o){if(0===o)return;const c=e.get("WEBGL_multi_draw");if(null===c)for(let e=0;e<o;e++)this.render(t[e]/s,a[e]);else{c.multiDrawElementsWEBGL(i,a,0,r,t,0,o);let e=0;for(let t=0;t<o;t++)e+=a[t];n.update(e,i,1)}}}function Tr(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Br(t,e,n){const i=new WeakMap,r=new ue;return{update:function(s,a,o){const c=s.morphTargetInfluences,l=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=void 0!==l?l.length:0;let u=i.get(a);if(void 0===u||u.count!==h){void 0!==u&&u.texture.dispose();const t=void 0!==a.morphAttributes.position,n=void 0!==a.morphAttributes.normal,s=void 0!==a.morphAttributes.color,o=a.morphAttributes.position||[],c=a.morphAttributes.normal||[],l=a.morphAttributes.color||[];let d=0;!0===t&&(d=1),!0===n&&(d=2),!0===s&&(d=3);let p=a.attributes.position.count*d,f=1;p>e.maxTextureSize&&(f=Math.ceil(p/e.maxTextureSize),p=e.maxTextureSize);const A=new Float32Array(p*f*4*h),g=new fe(A,p,f,h);g.type=z,g.needsUpdate=!0;const m=4*d;for(let e=0;e<h;e++){const i=o[e],a=c[e],h=l[e],u=p*f*4*e;for(let e=0;e<i.count;e++){const o=e*m;!0===t&&(r.fromBufferAttribute(i,e),A[u+o+0]=r.x,A[u+o+1]=r.y,A[u+o+2]=r.z,A[u+o+3]=0),!0===n&&(r.fromBufferAttribute(a,e),A[u+o+4]=r.x,A[u+o+5]=r.y,A[u+o+6]=r.z,A[u+o+7]=0),!0===s&&(r.fromBufferAttribute(h,e),A[u+o+8]=r.x,A[u+o+9]=r.y,A[u+o+10]=r.z,A[u+o+11]=4===h.itemSize?r.w:1)}}u={count:h,texture:g,size:new zt(p,f)},i.set(a,u),a.addEventListener("dispose",(function t(){g.dispose(),i.delete(a),a.removeEventListener("dispose",t)}))}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(t,"morphTexture",s.morphTexture,n);else{let e=0;for(let t=0;t<c.length;t++)e+=c[t];const n=a.morphTargetsRelative?1:1-e;o.getUniforms().setValue(t,"morphTargetBaseInfluence",n),o.getUniforms().setValue(t,"morphTargetInfluences",c)}o.getUniforms().setValue(t,"morphTargetsTexture",u.texture,n),o.getUniforms().setValue(t,"morphTargetsTextureSize",u.size)}}}function Rr(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(a){const o=i.render.frame,c=a.geometry,l=e.get(a,c);if(r.get(l)!==o&&(e.update(l),r.set(l,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,t.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const t=a.skeleton;r.get(t)!==o&&(t.update(),r.set(t,o))}return l},dispose:function(){r=new WeakMap}}}class Pr extends he{constructor(t,e,n,i,r,s,a,o,c,l){if((l=void 0!==l?l:q)!==q&&l!==X)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===q&&(n=H),void 0===n&&l===X&&(n=V),super(null,i,r,s,a,o,l,n,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:U,this.minFilter=void 0!==o?o:U,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const Dr=new he,Lr=new Pr(1,1);Lr.compareFunction=515;const Ur=new fe,Fr=new Ae,Nr=new Ni,kr=[],Or=[],Qr=new Float32Array(16),Gr=new Float32Array(9),Hr=new Float32Array(4);function zr(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=kr[r];if(void 0===s&&(s=new Float32Array(r),kr[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function jr(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Vr(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Wr(t,e){let n=Or[e];void 0===n&&(n=new Int32Array(e),Or[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function qr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Xr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(jr(n,e))return;t.uniform2fv(this.addr,e),Vr(n,e)}}function Yr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(jr(n,e))return;t.uniform3fv(this.addr,e),Vr(n,e)}}function Jr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(jr(n,e))return;t.uniform4fv(this.addr,e),Vr(n,e)}}function Kr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(jr(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Vr(n,e)}else{if(jr(n,i))return;Hr.set(i),t.uniformMatrix2fv(this.addr,!1,Hr),Vr(n,i)}}function Zr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(jr(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Vr(n,e)}else{if(jr(n,i))return;Gr.set(i),t.uniformMatrix3fv(this.addr,!1,Gr),Vr(n,i)}}function $r(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(jr(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Vr(n,e)}else{if(jr(n,i))return;Qr.set(i),t.uniformMatrix4fv(this.addr,!1,Qr),Vr(n,i)}}function ts(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function es(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(jr(n,e))return;t.uniform2iv(this.addr,e),Vr(n,e)}}function ns(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(jr(n,e))return;t.uniform3iv(this.addr,e),Vr(n,e)}}function is(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(jr(n,e))return;t.uniform4iv(this.addr,e),Vr(n,e)}}function rs(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ss(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(jr(n,e))return;t.uniform2uiv(this.addr,e),Vr(n,e)}}function as(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(jr(n,e))return;t.uniform3uiv(this.addr,e),Vr(n,e)}}function os(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(jr(n,e))return;t.uniform4uiv(this.addr,e),Vr(n,e)}}function cs(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);const s=this.type===t.SAMPLER_2D_SHADOW?Lr:Dr;n.setTexture2D(e||s,r)}function ls(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Fr,r)}function hs(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||Nr,r)}function us(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||Ur,r)}function ds(t,e){t.uniform1fv(this.addr,e)}function ps(t,e){const n=zr(e,this.size,2);t.uniform2fv(this.addr,n)}function fs(t,e){const n=zr(e,this.size,3);t.uniform3fv(this.addr,n)}function As(t,e){const n=zr(e,this.size,4);t.uniform4fv(this.addr,n)}function gs(t,e){const n=zr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function ms(t,e){const n=zr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function bs(t,e){const n=zr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function vs(t,e){t.uniform1iv(this.addr,e)}function ys(t,e){t.uniform2iv(this.addr,e)}function xs(t,e){t.uniform3iv(this.addr,e)}function _s(t,e){t.uniform4iv(this.addr,e)}function Es(t,e){t.uniform1uiv(this.addr,e)}function ws(t,e){t.uniform2uiv(this.addr,e)}function Cs(t,e){t.uniform3uiv(this.addr,e)}function Ss(t,e){t.uniform4uiv(this.addr,e)}function Ms(t,e,n){const i=this.cache,r=e.length,s=Wr(n,r);jr(i,s)||(t.uniform1iv(this.addr,s),Vr(i,s));for(let t=0;t!==r;++t)n.setTexture2D(e[t]||Dr,s[t])}function Is(t,e,n){const i=this.cache,r=e.length,s=Wr(n,r);jr(i,s)||(t.uniform1iv(this.addr,s),Vr(i,s));for(let t=0;t!==r;++t)n.setTexture3D(e[t]||Fr,s[t])}function Ts(t,e,n){const i=this.cache,r=e.length,s=Wr(n,r);jr(i,s)||(t.uniform1iv(this.addr,s),Vr(i,s));for(let t=0;t!==r;++t)n.setTextureCube(e[t]||Nr,s[t])}function Bs(t,e,n){const i=this.cache,r=e.length,s=Wr(n,r);jr(i,s)||(t.uniform1iv(this.addr,s),Vr(i,s));for(let t=0;t!==r;++t)n.setTexture2DArray(e[t]||Ur,s[t])}class Rs{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return qr;case 35664:return Xr;case 35665:return Yr;case 35666:return Jr;case 35674:return Kr;case 35675:return Zr;case 35676:return $r;case 5124:case 35670:return ts;case 35667:case 35671:return es;case 35668:case 35672:return ns;case 35669:case 35673:return is;case 5125:return rs;case 36294:return ss;case 36295:return as;case 36296:return os;case 35678:case 36198:case 36298:case 36306:case 35682:return cs;case 35679:case 36299:case 36307:return ls;case 35680:case 36300:case 36308:case 36293:return hs;case 36289:case 36303:case 36311:case 36292:return us}}(e.type)}}class Ps{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return ds;case 35664:return ps;case 35665:return fs;case 35666:return As;case 35674:return gs;case 35675:return ms;case 35676:return bs;case 5124:case 35670:return vs;case 35667:case 35671:return ys;case 35668:case 35672:return xs;case 35669:case 35673:return _s;case 5125:return Es;case 36294:return ws;case 36295:return Cs;case 36296:return Ss;case 35678:case 36198:case 36298:case 36306:case 35682:return Ms;case 35679:case 36299:case 36307:return Is;case 35680:case 36300:case 36308:case 36293:return Ts;case 36289:case 36303:case 36311:case 36292:return Bs}}(e.type)}}class Ds{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}}}const Ls=/(\w+)(\])?(\[|\.)?/g;function Us(t,e){t.seq.push(e),t.map[e.id]=e}function Fs(t,e,n){const i=t.name,r=i.length;for(Ls.lastIndex=0;;){const s=Ls.exec(i),a=Ls.lastIndex;let o=s[1];const c="]"===s[2],l=s[3];if(c&&(o|=0),void 0===l||"["===l&&a+2===r){Us(n,void 0===l?new Rs(o,t,e):new Ps(o,t,e));break}{let t=n.map[o];void 0===t&&(t=new Ds(o),Us(n,t)),n=t}}}class Ns{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);Fs(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function ks(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}const Os=37297;let Qs=0;function Gs(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=r;t<s;t++){const r=t+1;i.push(`${r===e?">":" "} ${r}: ${n[t]}`)}return i.join("\n")}(t.getShaderSource(e),i)}return r}function Hs(t,e){const n=function(t){const e=ee.getPrimaries(ee.workingColorSpace),n=ee.getPrimaries(t);let i;switch(e===n?i="":e===Ct&&n===wt?i="LinearDisplayP3ToLinearSRGB":e===wt&&n===Ct&&(i="LinearSRGBToLinearDisplayP3"),t){case vt:case xt:return[i,"LinearTransferOETF"];case bt:case yt:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[i,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function zs(t,e){let n;switch(e){case v:n="Linear";break;case y:n="Reinhard";break;case x:n="OptimizedCineon";break;case _:n="ACESFilmic";break;case w:n="AgX";break;case C:n="Neutral";break;case E:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function js(t){return""!==t}function Vs(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ws(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const qs=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xs(t){return t.replace(qs,Js)}const Ys=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Js(t,e){let n=Yi[e];if(void 0===n){const t=Ys.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=Yi[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return Xs(n)}const Ks=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Zs(t){return t.replace(Ks,$s)}function $s(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function ta(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ea(t,e,n,i){const r=t.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const u=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===c?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===l?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===h&&(e="SHADOWMAP_TYPE_VSM"),e}(n),d=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case M:case I:e="ENVMAP_TYPE_CUBE";break;case R:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),p=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===I&&(e="ENVMAP_MODE_REFRACTION");return e}(n),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case A:e="ENVMAP_BLENDING_MULTIPLY";break;case g:e="ENVMAP_BLENDING_MIX";break;case m:e="ENVMAP_BLENDING_ADD"}return e}(n),v=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),y=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(js).join("\n")}(n),x=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),_=r.createProgram();let E,w,C=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(E=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,x].filter(js).join("\n"),E.length>0&&(E+="\n"),w=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,x].filter(js).join("\n"),w.length>0&&(w+="\n")):(E=[ta(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,x,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(js).join("\n"),w=[ta(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,x,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==b?"#define TONE_MAPPING":"",n.toneMapping!==b?Yi.tonemapping_pars_fragment:"",n.toneMapping!==b?zs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Yi.colorspace_pars_fragment,Hs("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(js).join("\n")),a=Xs(a),a=Vs(a,n),a=Ws(a,n),o=Xs(o),o=Vs(o,n),o=Ws(o,n),a=Zs(a),o=Zs(o),!0!==n.isRawShaderMaterial&&(C="#version 300 es\n",E=[y,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+E,w=["#define varying in",n.glslVersion===It?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===It?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+w);const S=C+E+a,T=C+w+o,B=ks(r,r.VERTEX_SHADER,S),P=ks(r,r.FRAGMENT_SHADER,T);function D(e){if(t.debug.checkShaderErrors){const n=r.getProgramInfoLog(_).trim(),i=r.getShaderInfoLog(B).trim(),s=r.getShaderInfoLog(P).trim();let a=!0,o=!0;if(!1===r.getProgramParameter(_,r.LINK_STATUS))if(a=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(r,_,B,P);else{const t=Gs(r,B,"vertex"),i=Gs(r,P,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+n+"\n"+t+"\n"+i)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==s||(o=!1);o&&(e.diagnostics={runnable:a,programLog:n,vertexShader:{log:i,prefix:E},fragmentShader:{log:s,prefix:w}})}r.deleteShader(B),r.deleteShader(P),L=new Ns(r,_),U=function(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let a=1;i.type===t.FLOAT_MAT2&&(a=2),i.type===t.FLOAT_MAT3&&(a=3),i.type===t.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:a}}return n}(r,_)}let L,U;r.attachShader(_,B),r.attachShader(_,P),void 0!==n.index0AttributeName?r.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_),this.getUniforms=function(){return void 0===L&&D(this),L},this.getAttributes=function(){return void 0===U&&D(this),U};let F=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===F&&(F=r.getProgramParameter(_,Os)),F},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Qs++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=B,this.fragmentShader=P,this}let na=0;class ia{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new ra(t),e.set(t,n)),n}}class ra{constructor(t){this.id=na++,this.code=t,this.usedTimes=0}}function sa(t,e,n,i,r,s,a){const o=new sn,c=new ia,l=new Set,h=[],u=r.logarithmicDepthBuffer,f=r.vertexTextures;let A=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return l.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(s,o,h,v,y){const x=v.fog,_=y.geometry,E=s.isMeshStandardMaterial?v.environment:null,w=(s.isMeshStandardMaterial?n:e).get(s.envMap||E),C=w&&w.mapping===R?w.image.height:null,S=g[s.type];null!==s.precision&&(A=r.getMaxPrecision(s.precision),A!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",A,"instead."));const M=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,I=void 0!==M?M.length:0;let T,B,P,D,L=0;if(void 0!==_.morphAttributes.position&&(L=1),void 0!==_.morphAttributes.normal&&(L=2),void 0!==_.morphAttributes.color&&(L=3),S){const t=Ki[S];T=t.vertexShader,B=t.fragmentShader}else T=s.vertexShader,B=s.fragmentShader,c.update(s),P=c.getVertexShaderID(s),D=c.getFragmentShaderID(s);const U=t.getRenderTarget(),F=!0===y.isInstancedMesh,N=!0===y.isBatchedMesh,k=!!s.map,O=!!s.matcap,Q=!!w,G=!!s.aoMap,H=!!s.lightMap,z=!!s.bumpMap,j=!!s.normalMap,V=!!s.displacementMap,W=!!s.emissiveMap,q=!!s.metalnessMap,X=!!s.roughnessMap,Y=s.anisotropy>0,J=s.clearcoat>0,K=s.iridescence>0,Z=s.sheen>0,$=s.transmission>0,tt=Y&&!!s.anisotropyMap,et=J&&!!s.clearcoatMap,nt=J&&!!s.clearcoatNormalMap,it=J&&!!s.clearcoatRoughnessMap,rt=K&&!!s.iridescenceMap,st=K&&!!s.iridescenceThicknessMap,at=Z&&!!s.sheenColorMap,ot=Z&&!!s.sheenRoughnessMap,ct=!!s.specularMap,lt=!!s.specularColorMap,ht=!!s.specularIntensityMap,ut=$&&!!s.transmissionMap,dt=$&&!!s.thicknessMap,pt=!!s.gradientMap,ft=!!s.alphaMap,At=s.alphaTest>0,gt=!!s.alphaHash,mt=!!s.extensions;let bt=b;s.toneMapped&&(null!==U&&!0!==U.isXRRenderTarget||(bt=t.toneMapping));const yt={shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:T,fragmentShader:B,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:D,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:A,batching:N,instancing:F,instancingColor:F&&null!==y.instanceColor,instancingMorph:F&&null!==y.morphTexture,supportsVertexTextures:f,outputColorSpace:null===U?t.outputColorSpace:!0===U.isXRRenderTarget?U.texture.colorSpace:vt,alphaToCoverage:!!s.alphaToCoverage,map:k,matcap:O,envMap:Q,envMapMode:Q&&w.mapping,envMapCubeUVHeight:C,aoMap:G,lightMap:H,bumpMap:z,normalMap:j,displacementMap:f&&V,emissiveMap:W,normalMapObjectSpace:j&&1===s.normalMapType,normalMapTangentSpace:j&&0===s.normalMapType,metalnessMap:q,roughnessMap:X,anisotropy:Y,anisotropyMap:tt,clearcoat:J,clearcoatMap:et,clearcoatNormalMap:nt,clearcoatRoughnessMap:it,iridescence:K,iridescenceMap:rt,iridescenceThicknessMap:st,sheen:Z,sheenColorMap:at,sheenRoughnessMap:ot,specularMap:ct,specularColorMap:lt,specularIntensityMap:ht,transmission:$,transmissionMap:ut,thicknessMap:dt,gradientMap:pt,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:ft,alphaTest:At,alphaHash:gt,combine:s.combine,mapUv:k&&m(s.map.channel),aoMapUv:G&&m(s.aoMap.channel),lightMapUv:H&&m(s.lightMap.channel),bumpMapUv:z&&m(s.bumpMap.channel),normalMapUv:j&&m(s.normalMap.channel),displacementMapUv:V&&m(s.displacementMap.channel),emissiveMapUv:W&&m(s.emissiveMap.channel),metalnessMapUv:q&&m(s.metalnessMap.channel),roughnessMapUv:X&&m(s.roughnessMap.channel),anisotropyMapUv:tt&&m(s.anisotropyMap.channel),clearcoatMapUv:et&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:nt&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:it&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:rt&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:st&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:at&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:ot&&m(s.sheenRoughnessMap.channel),specularMapUv:ct&&m(s.specularMap.channel),specularColorMapUv:lt&&m(s.specularColorMap.channel),specularIntensityMapUv:ht&&m(s.specularIntensityMap.channel),transmissionMapUv:ut&&m(s.transmissionMap.channel),thicknessMapUv:dt&&m(s.thicknessMap.channel),alphaMapUv:ft&&m(s.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(j||Y),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!_.attributes.uv&&(k||ft),fog:!!x,useFog:!0===s.fog,fogExp2:!!x&&x.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:I,morphTextureStride:L,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:bt,useLegacyLights:t._useLegacyLights,decodeVideoTexture:k&&!0===s.map.isVideoTexture&&ee.getTransfer(s.map.colorSpace)===Et,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===p,flipSided:s.side===d,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:mt&&!0===s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:mt&&!0===s.extensions.multiDraw&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return yt.vertexUv1s=l.has(1),yt.vertexUv2s=l.has(2),yt.vertexUv3s=l.has(3),l.clear(),yt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){o.disableAll(),e.supportsVertexTextures&&o.enable(0);e.instancing&&o.enable(1);e.instancingColor&&o.enable(2);e.instancingMorph&&o.enable(3);e.matcap&&o.enable(4);e.envMap&&o.enable(5);e.normalMapObjectSpace&&o.enable(6);e.normalMapTangentSpace&&o.enable(7);e.clearcoat&&o.enable(8);e.iridescence&&o.enable(9);e.alphaTest&&o.enable(10);e.vertexColors&&o.enable(11);e.vertexAlphas&&o.enable(12);e.vertexUv1s&&o.enable(13);e.vertexUv2s&&o.enable(14);e.vertexUv3s&&o.enable(15);e.vertexTangents&&o.enable(16);e.anisotropy&&o.enable(17);e.alphaHash&&o.enable(18);e.batching&&o.enable(19);t.push(o.mask),o.disableAll(),e.fog&&o.enable(0);e.useFog&&o.enable(1);e.flatShading&&o.enable(2);e.logarithmicDepthBuffer&&o.enable(3);e.skinning&&o.enable(4);e.morphTargets&&o.enable(5);e.morphNormals&&o.enable(6);e.morphColors&&o.enable(7);e.premultipliedAlpha&&o.enable(8);e.shadowMapEnabled&&o.enable(9);e.useLegacyLights&&o.enable(10);e.doubleSided&&o.enable(11);e.flipSided&&o.enable(12);e.useDepthPacking&&o.enable(13);e.dithering&&o.enable(14);e.transmission&&o.enable(15);e.sheen&&o.enable(16);e.opaque&&o.enable(17);e.pointsUvs&&o.enable(18);e.decodeVideoTexture&&o.enable(19);e.alphaToCoverage&&o.enable(20);t.push(o.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=g[t.type];let n;if(e){const t=Ki[e];n=Ii.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new ea(t,n,e,s),h.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:h,dispose:function(){c.dispose()}}}function aa(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function oa(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ca(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function la(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let c=t[e];return void 0===c?(c={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},t[e]=c):(c.id=n.id,c.object=n,c.geometry=i,c.material=r,c.groupOrder=s,c.renderOrder=n.renderOrder,c.z=a,c.group=o),e++,c}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,a,o,c,l){const h=s(t,e,a,o,c,l);a.transmission>0?i.push(h):!0===a.transparent?r.push(h):n.push(h)},unshift:function(t,e,a,o,c,l){const h=s(t,e,a,o,c,l);a.transmission>0?i.unshift(h):!0===a.transparent?r.unshift(h):n.unshift(h)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||oa),i.length>1&&i.sort(e||ca),r.length>1&&r.sort(e||ca)}}}function ha(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new la,t.set(e,[r])):n>=i.length?(r=new la,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function ua(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new me,color:new Nn};break;case"SpotLight":n={position:new me,direction:new me,color:new Nn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new me,color:new Nn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new me,skyColor:new Nn,groundColor:new Nn};break;case"RectAreaLight":n={color:new Nn,position:new me,halfWidth:new me,halfHeight:new me}}return t[e.id]=n,n}}}let da=0;function pa(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function fa(t){const e=new ua,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)i.probe.push(new me);const r=new me,s=new qe,a=new qe;return{setup:function(r,s){let a=0,o=0,c=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,h=0,u=0,d=0,p=0,f=0,A=0,g=0,m=0,b=0,v=0;r.sort(pa);const y=!0===s?Math.PI:1;for(let t=0,s=r.length;t<s;t++){const s=r[t],x=s.color,_=s.intensity,E=s.distance,w=s.shadow&&s.shadow.map?s.shadow.map.texture:null;if(s.isAmbientLight)a+=x.r*_*y,o+=x.g*_*y,c+=x.b*_*y;else if(s.isLightProbe){for(let t=0;t<9;t++)i.probe[t].addScaledVector(s.sh.coefficients[t],_);v++}else if(s.isDirectionalLight){const t=e.get(s);if(t.color.copy(s.color).multiplyScalar(s.intensity*y),s.castShadow){const t=s.shadow,e=n.get(s);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,i.directionalShadow[l]=e,i.directionalShadowMap[l]=w,i.directionalShadowMatrix[l]=s.shadow.matrix,f++}i.directional[l]=t,l++}else if(s.isSpotLight){const t=e.get(s);t.position.setFromMatrixPosition(s.matrixWorld),t.color.copy(x).multiplyScalar(_*y),t.distance=E,t.coneCos=Math.cos(s.angle),t.penumbraCos=Math.cos(s.angle*(1-s.penumbra)),t.decay=s.decay,i.spot[u]=t;const r=s.shadow;if(s.map&&(i.spotLightMap[m]=s.map,m++,r.updateMatrices(s),s.castShadow&&b++),i.spotLightMatrix[u]=r.matrix,s.castShadow){const t=n.get(s);t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,i.spotShadow[u]=t,i.spotShadowMap[u]=w,g++}u++}else if(s.isRectAreaLight){const t=e.get(s);t.color.copy(x).multiplyScalar(_),t.halfWidth.set(.5*s.width,0,0),t.halfHeight.set(0,.5*s.height,0),i.rectArea[d]=t,d++}else if(s.isPointLight){const t=e.get(s);if(t.color.copy(s.color).multiplyScalar(s.intensity*y),t.distance=s.distance,t.decay=s.decay,s.castShadow){const t=s.shadow,e=n.get(s);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,i.pointShadow[h]=e,i.pointShadowMap[h]=w,i.pointShadowMatrix[h]=s.shadow.matrix,A++}i.point[h]=t,h++}else if(s.isHemisphereLight){const t=e.get(s);t.skyColor.copy(s.color).multiplyScalar(_*y),t.groundColor.copy(s.groundColor).multiplyScalar(_*y),i.hemi[p]=t,p++}}d>0&&(!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=Ji.LTC_FLOAT_1,i.rectAreaLTC2=Ji.LTC_FLOAT_2):(i.rectAreaLTC1=Ji.LTC_HALF_1,i.rectAreaLTC2=Ji.LTC_HALF_2)),i.ambient[0]=a,i.ambient[1]=o,i.ambient[2]=c;const x=i.hash;x.directionalLength===l&&x.pointLength===h&&x.spotLength===u&&x.rectAreaLength===d&&x.hemiLength===p&&x.numDirectionalShadows===f&&x.numPointShadows===A&&x.numSpotShadows===g&&x.numSpotMaps===m&&x.numLightProbes===v||(i.directional.length=l,i.spot.length=u,i.rectArea.length=d,i.point.length=h,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=A,i.pointShadowMap.length=A,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=A,i.spotLightMatrix.length=g+m-b,i.spotLightMap.length=m,i.numSpotLightShadowsWithMaps=b,i.numLightProbes=v,x.directionalLength=l,x.pointLength=h,x.spotLength=u,x.rectAreaLength=d,x.hemiLength=p,x.numDirectionalShadows=f,x.numPointShadows=A,x.numSpotShadows=g,x.numSpotMaps=m,x.numLightProbes=v,i.version=da++)},setupView:function(t,e){let n=0,o=0,c=0,l=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),n++}else if(d.isSpotLight){const t=i.spot[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),c++}else if(d.isRectAreaLight){const t=i.rectArea[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),s.copy(d.matrixWorld),s.premultiply(u),a.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),l++}else if(d.isPointLight){const t=i.point[o];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o++}else if(d.isHemisphereLight){const t=i.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:i}}function Aa(t){const e=new fa(t),n=[],i=[];return{init:function(){n.length=0,i.length=0},state:{lightsArray:n,shadowsArray:i,lights:e,transmissionRenderTarget:null},setupLights:function(t){e.setup(n,t)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){i.push(t)}}}function ga(t){let e=new WeakMap;return{get:function(n,i=0){const r=e.get(n);let s;return void 0===r?(s=new Aa(t),e.set(n,[s])):i>=r.length?(s=new Aa(t),r.push(s)):s=r[i],s},dispose:function(){e=new WeakMap}}}class ma extends Qn{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class ba extends Qn{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function va(t,e,n){let i=new Vi;const r=new zt,s=new zt,a=new ue,o=new ma({depthPacking:gt}),l=new ba,f={},A=n.maxTextureSize,g={[u]:d,[d]:u,[p]:p},m=new Ti({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new zt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),b=m.clone();b.defines.HORIZONTAL_PASS=1;const v=new ri;v.setAttribute("position",new qn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new _i(v,m),x=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=c;let _=this.type;function E(n,i){const s=e.update(y);m.defines.VSM_SAMPLES!==n.blurSamples&&(m.defines.VSM_SAMPLES=n.blurSamples,b.defines.VSM_SAMPLES=n.blurSamples,m.needsUpdate=!0,b.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new pe(r.x,r.y)),m.uniforms.shadow_pass.value=n.map.texture,m.uniforms.resolution.value=n.mapSize,m.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,s,m,y,null),b.uniforms.shadow_pass.value=n.mapPass.texture,b.uniforms.resolution.value=n.mapSize,b.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,s,b,y,null)}function w(e,n,i,r){let s=null;const a=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===i.isPointLight?l:o,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=s.uuid,e=n.uuid;let i=f[t];void 0===i&&(i={},f[t]=i);let r=i[e];void 0===r&&(r=s.clone(),i[e]=r,n.addEventListener("dispose",S)),s=r}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=r===h?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:g[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial){t.properties.get(s).light=i}return s}function C(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===h)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),c=n.material;if(Array.isArray(c)){const e=i.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],u=c[h.materialIndex];if(u&&u.visible){const e=w(n,u,a,o);n.onBeforeShadow(t,n,r,s,i,e,h),t.renderBufferDirect(s,null,i,e,n,h),n.onAfterShadow(t,n,r,s,i,e,h)}}}else if(c.visible){const e=w(n,c,a,o);n.onBeforeShadow(t,n,r,s,i,e,null),t.renderBufferDirect(s,null,i,e,n,null),n.onAfterShadow(t,n,r,s,i,e,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)C(c[t],r,s,a,o)}function S(t){t.target.removeEventListener("dispose",S);for(const e in f){const n=f[e],i=t.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(e,n,o){if(!1===x.enabled)return;if(!1===x.autoUpdate&&!1===x.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),l=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=_!==h&&this.type===h,f=_===h&&this.type!==h;for(let c=0,l=e.length;c<l;c++){const l=e[c],u=l.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const g=u.getFrameExtents();if(r.multiply(g),s.copy(u.mapSize),(r.x>A||r.y>A)&&(r.x>A&&(s.x=Math.floor(A/g.x),r.x=s.x*g.x,u.mapSize.x=s.x),r.y>A&&(s.y=Math.floor(A/g.y),r.y=s.y*g.y,u.mapSize.y=s.y)),null===u.map||!0===p||!0===f){const t=this.type!==h?{minFilter:U,magFilter:U}:{};null!==u.map&&u.map.dispose(),u.map=new pe(r.x,r.y,t),u.map.texture.name=l.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(a),u.updateMatrices(l,t),i=u.getFrustum(),C(n,o,u.camera,l,this.type)}!0!==u.isPointLightShadow&&this.type===h&&E(u,o),u.needsUpdate=!1}_=this.type,x.needsUpdate=!1,t.setRenderTarget(c,l,u)}}function ya(t){const e=new function(){let e=!1;const n=new ue;let i=null;const r=new ue(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,a,o){!0===o&&(e*=a,i*=a,s*=a),n.set(e,i,s,a),!1===r.equals(n)&&(t.clearColor(e,i,s,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},n=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(e){e?H(t.DEPTH_TEST):z(t.DEPTH_TEST)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},i=new function(){let e=!1,n=null,i=null,r=null,s=null,a=null,o=null,c=null,l=null;return{setTest:function(n){e||(n?H(t.STENCIL_TEST):z(t.STENCIL_TEST))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&s===a||(t.stencilFunc(e,n,a),i=e,r=n,s=a)},setOp:function(e,n,i){a===e&&o===n&&c===i||(t.stencilOp(e,n,i),a=e,o=n,c=i)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,a=null,o=null,c=null,l=null}}},r=new WeakMap,s=new WeakMap;let a={},o={},c=new WeakMap,l=[],h=null,u=!1,A=null,g=null,m=null,b=null,v=null,y=null,x=null,_=new Nn(0,0,0),E=0,w=!1,C=null,S=null,M=null,I=null,T=null;const B=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,P=0;const D=t.getParameter(t.VERSION);-1!==D.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(D)[1]),R=P>=1):-1!==D.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),R=P>=2);let L=null,U={};const F=t.getParameter(t.SCISSOR_BOX),N=t.getParameter(t.VIEWPORT),k=(new ue).fromArray(F),O=(new ue).fromArray(N);function Q(e,n,i,r){const s=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let a=0;a<i;a++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,s):t.texImage2D(n+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,s);return a}const G={};function H(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function z(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}G[t.TEXTURE_2D]=Q(t.TEXTURE_2D,t.TEXTURE_2D,1),G[t.TEXTURE_CUBE_MAP]=Q(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),G[t.TEXTURE_2D_ARRAY]=Q(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),G[t.TEXTURE_3D]=Q(t.TEXTURE_3D,t.TEXTURE_3D,1,1),e.setClear(0,0,0,1),n.setClear(1),i.setClear(0),H(t.DEPTH_TEST),n.setFunc(3),q(!1),X(1),H(t.CULL_FACE),W(0);const j={[f]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};j[103]=t.MIN,j[104]=t.MAX;const V={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA,211:t.CONSTANT_COLOR,212:t.ONE_MINUS_CONSTANT_COLOR,213:t.CONSTANT_ALPHA,214:t.ONE_MINUS_CONSTANT_ALPHA};function W(e,n,i,r,s,a,o,c,l,h){if(0!==e){if(!1===u&&(H(t.BLEND),u=!0),5===e)s=s||n,a=a||i,o=o||r,n===g&&s===v||(t.blendEquationSeparate(j[n],j[s]),g=n,v=s),i===m&&r===b&&a===y&&o===x||(t.blendFuncSeparate(V[i],V[r],V[a],V[o]),m=i,b=r,y=a,x=o),!1!==c.equals(_)&&l===E||(t.blendColor(c.r,c.g,c.b,l),_.copy(c),E=l),A=e,w=!1;else if(e!==A||h!==w){if(g===f&&v===f||(t.blendEquation(t.FUNC_ADD),g=f,v=f),h)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,b=null,y=null,x=null,_.set(0,0,0),E=0,A=e,w=h}}else!0===u&&(z(t.BLEND),u=!1)}function q(e){C!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),C=e)}function X(e){0!==e?(H(t.CULL_FACE),e!==S&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):z(t.CULL_FACE),S=e}function Y(e,n,i){e?(H(t.POLYGON_OFFSET_FILL),I===n&&T===i||(t.polygonOffset(n,i),I=n,T=i)):z(t.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:n,stencil:i},enable:H,disable:z,bindFramebuffer:function(e,n){return o[e]!==n&&(t.bindFramebuffer(e,n),o[e]=n,e===t.DRAW_FRAMEBUFFER&&(o[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(o[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let i=l,r=!1;if(e){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const s=e.textures;if(i.length!==s.length||i[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=s.length;e<n;e++)i[e]=t.COLOR_ATTACHMENT0+e;i.length=s.length,r=!0}}else i[0]!==t.BACK&&(i[0]=t.BACK,r=!0);r&&t.drawBuffers(i)},useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:W,setMaterial:function(r,s){r.side===p?z(t.CULL_FACE):H(t.CULL_FACE);let a=r.side===d;s&&(a=!a),q(a),1===r.blending&&!1===r.transparent?W(0):W(r.blending,r.blendEquation,r.blendSrc,r.blendDst,r.blendEquationAlpha,r.blendSrcAlpha,r.blendDstAlpha,r.blendColor,r.blendAlpha,r.premultipliedAlpha),n.setFunc(r.depthFunc),n.setTest(r.depthTest),n.setMask(r.depthWrite),e.setMask(r.colorWrite);const o=r.stencilWrite;i.setTest(o),o&&(i.setMask(r.stencilWriteMask),i.setFunc(r.stencilFunc,r.stencilRef,r.stencilFuncMask),i.setOp(r.stencilFail,r.stencilZFail,r.stencilZPass)),Y(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),!0===r.alphaToCoverage?H(t.SAMPLE_ALPHA_TO_COVERAGE):z(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:q,setCullFace:X,setLineWidth:function(e){e!==M&&(R&&t.lineWidth(e),M=e)},setPolygonOffset:Y,setScissorTest:function(e){e?H(t.SCISSOR_TEST):z(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+B-1),L!==e&&(t.activeTexture(e),L=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===L?t.TEXTURE0+B-1:L);let r=U[i];void 0===r&&(r={type:void 0,texture:void 0},U[i]=r),r.type===e&&r.texture===n||(L!==i&&(t.activeTexture(i),L=i),t.bindTexture(e,n||G[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=U[L];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,n){let i=s.get(n);void 0===i&&(i=new WeakMap,s.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=s.get(n).get(e);r.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),r.set(n,i))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===k.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),k.copy(e))},viewport:function(e){!1===O.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),O.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},L=null,U={},o={},c=new WeakMap,l=[],h=null,u=!1,A=null,g=null,m=null,b=null,v=null,y=null,x=null,_=new Nn(0,0,0),E=0,w=!1,C=null,S=null,M=null,I=null,T=null,k.set(0,0,t.canvas.width,t.canvas.height),O.set(0,0,t.canvas.width,t.canvas.height),e.reset(),n.reset(),i.reset()}}}function xa(t,e,n,i,r,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),l=new zt,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return p?new OffscreenCanvas(t,e):qt("canvas")}function A(t,e,n){let i=1;const r=Z(t);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(i*r.width),s=Math.floor(i*r.height);void 0===u&&(u=f(n,s));const a=e?f(n,s):u;a.width=n,a.height=s;return a.getContext("2d").drawImage(t,0,0,n,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),t}return t}function g(t){return t.generateMipmaps&&t.minFilter!==U&&t.minFilter!==N}function m(e){t.generateMipmap(e)}function b(n,i,r,s,a=!1){if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;if(i===t.RED&&(r===t.FLOAT&&(o=t.R32F),r===t.HALF_FLOAT&&(o=t.R16F),r===t.UNSIGNED_BYTE&&(o=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(o=t.R8UI),r===t.UNSIGNED_SHORT&&(o=t.R16UI),r===t.UNSIGNED_INT&&(o=t.R32UI),r===t.BYTE&&(o=t.R8I),r===t.SHORT&&(o=t.R16I),r===t.INT&&(o=t.R32I)),i===t.RG&&(r===t.FLOAT&&(o=t.RG32F),r===t.HALF_FLOAT&&(o=t.RG16F),r===t.UNSIGNED_BYTE&&(o=t.RG8)),i===t.RG_INTEGER&&(r===t.UNSIGNED_BYTE&&(o=t.RG8UI),r===t.UNSIGNED_SHORT&&(o=t.RG16UI),r===t.UNSIGNED_INT&&(o=t.RG32UI),r===t.BYTE&&(o=t.RG8I),r===t.SHORT&&(o=t.RG16I),r===t.INT&&(o=t.RG32I)),i===t.RGB&&r===t.UNSIGNED_INT_5_9_9_9_REV&&(o=t.RGB9_E5),i===t.RGBA){const e=a?_t:ee.getTransfer(s);r===t.FLOAT&&(o=t.RGBA32F),r===t.HALF_FLOAT&&(o=t.RGBA16F),r===t.UNSIGNED_BYTE&&(o=e===Et?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(o=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(o=t.RGB5_A1)}return o!==t.R16F&&o!==t.R32F&&o!==t.RG16F&&o!==t.RG32F&&o!==t.RGBA16F&&o!==t.RGBA32F||e.get("EXT_color_buffer_float"),o}function v(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==U&&t.minFilter!==N?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function y(t){const e=t.target;e.removeEventListener("dispose",y),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=d.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&_(t),0===Object.keys(r).length&&d.delete(n)}i.remove(t)}(e),e.isVideoTexture&&h.delete(e)}function x(e){const n=e.target;n.removeEventListener("dispose",x),function(e){const n=i.get(e);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(n.__webglFramebuffer[e]))for(let i=0;i<n.__webglFramebuffer[e].length;i++)t.deleteFramebuffer(n.__webglFramebuffer[e][i]);else t.deleteFramebuffer(n.__webglFramebuffer[e]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=e.textures;for(let e=0,n=r.length;e<n;e++){const n=i.get(r[e]);n.__webglTexture&&(t.deleteTexture(n.__webglTexture),a.memory.textures--),i.remove(r[e])}i.remove(e)}(n)}function _(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete d.get(r)[n.__cacheKey],a.memory.textures--}let E=0;function w(e,r){const s=i.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;h.get(t)!==e&&(h.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void B(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+r)}const C={[P]:t.REPEAT,[D]:t.CLAMP_TO_EDGE,[L]:t.MIRRORED_REPEAT},S={[U]:t.NEAREST,1004:t.NEAREST_MIPMAP_NEAREST,[F]:t.NEAREST_MIPMAP_LINEAR,[N]:t.LINEAR,[k]:t.LINEAR_MIPMAP_NEAREST,[O]:t.LINEAR_MIPMAP_LINEAR},M={512:t.NEVER,519:t.ALWAYS,513:t.LESS,515:t.LEQUAL,514:t.EQUAL,518:t.GEQUAL,516:t.GREATER,517:t.NOTEQUAL};function I(n,s){if(s.type!==z||!1!==e.has("OES_texture_float_linear")||s.magFilter!==N&&s.magFilter!==k&&s.magFilter!==F&&s.magFilter!==O&&s.minFilter!==N&&s.minFilter!==k&&s.minFilter!==F&&s.minFilter!==O||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(n,t.TEXTURE_WRAP_S,C[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,C[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,C[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,S[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,S[s.minFilter]),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,M[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(s.magFilter===U)return;if(s.minFilter!==F&&s.minFilter!==O)return;if(s.type===z&&!1===e.has("OES_texture_float_linear"))return;if(s.anisotropy>1||i.get(s).__currentAnisotropy){const a=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy}}}function T(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",y));const r=n.source;let s=d.get(r);void 0===s&&(s={},d.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&_(n)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return i}function B(e,a,o){let c=t.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(c=t.TEXTURE_2D_ARRAY),a.isData3DTexture&&(c=t.TEXTURE_3D);const l=T(e,a),h=a.source;n.bindTexture(c,e.__webglTexture,t.TEXTURE0+o);const u=i.get(h);if(h.version!==u.__version||!0===l){n.activeTexture(t.TEXTURE0+o);const e=ee.getPrimaries(ee.workingColorSpace),i=a.colorSpace===mt?null:ee.getPrimaries(a.colorSpace),d=a.colorSpace===mt||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=A(a.image,!1,r.maxTextureSize);p=K(a,p);const f=s.convert(a.format,a.colorSpace),y=s.convert(a.type);let x,_=b(a.internalFormat,f,y,a.colorSpace,a.isVideoTexture);I(c,a);const E=a.mipmaps,w=!0!==a.isVideoTexture&&_!==it,C=void 0===u.__version||!0===l,S=h.dataReady,M=v(a,p);if(a.isDepthTexture)_=t.DEPTH_COMPONENT16,a.type===z?_=t.DEPTH_COMPONENT32F:a.type===H?_=t.DEPTH_COMPONENT24:a.type===V&&(_=t.DEPTH24_STENCIL8),C&&(w?n.texStorage2D(t.TEXTURE_2D,1,_,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,_,p.width,p.height,0,f,y,null));else if(a.isDataTexture)if(E.length>0){w&&C&&n.texStorage2D(t.TEXTURE_2D,M,_,E[0].width,E[0].height);for(let e=0,i=E.length;e<i;e++)x=E[e],w?S&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,x.width,x.height,f,y,x.data):n.texImage2D(t.TEXTURE_2D,e,_,x.width,x.height,0,f,y,x.data);a.generateMipmaps=!1}else w?(C&&n.texStorage2D(t.TEXTURE_2D,M,_,p.width,p.height),S&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,p.width,p.height,f,y,p.data)):n.texImage2D(t.TEXTURE_2D,0,_,p.width,p.height,0,f,y,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){w&&C&&n.texStorage3D(t.TEXTURE_2D_ARRAY,M,_,E[0].width,E[0].height,p.depth);for(let e=0,i=E.length;e<i;e++)x=E[e],a.format!==W?null!==f?w?S&&n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,x.width,x.height,p.depth,f,x.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,_,x.width,x.height,p.depth,0,x.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?S&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,x.width,x.height,p.depth,f,y,x.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,_,x.width,x.height,p.depth,0,f,y,x.data)}else{w&&C&&n.texStorage2D(t.TEXTURE_2D,M,_,E[0].width,E[0].height);for(let e=0,i=E.length;e<i;e++)x=E[e],a.format!==W?null!==f?w?S&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,x.width,x.height,f,x.data):n.compressedTexImage2D(t.TEXTURE_2D,e,_,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?S&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,x.width,x.height,f,y,x.data):n.texImage2D(t.TEXTURE_2D,e,_,x.width,x.height,0,f,y,x.data)}else if(a.isDataArrayTexture)w?(C&&n.texStorage3D(t.TEXTURE_2D_ARRAY,M,_,p.width,p.height,p.depth),S&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,_,p.width,p.height,p.depth,0,f,y,p.data);else if(a.isData3DTexture)w?(C&&n.texStorage3D(t.TEXTURE_3D,M,_,p.width,p.height,p.depth),S&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)):n.texImage3D(t.TEXTURE_3D,0,_,p.width,p.height,p.depth,0,f,y,p.data);else if(a.isFramebufferTexture){if(C)if(w)n.texStorage2D(t.TEXTURE_2D,M,_,p.width,p.height);else{let e=p.width,i=p.height;for(let r=0;r<M;r++)n.texImage2D(t.TEXTURE_2D,r,_,e,i,0,f,y,null),e>>=1,i>>=1}}else if(E.length>0){if(w&&C){const e=Z(E[0]);n.texStorage2D(t.TEXTURE_2D,M,_,e.width,e.height)}for(let e=0,i=E.length;e<i;e++)x=E[e],w?S&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,f,y,x):n.texImage2D(t.TEXTURE_2D,e,_,f,y,x);a.generateMipmaps=!1}else if(w){if(C){const e=Z(p);n.texStorage2D(t.TEXTURE_2D,M,_,e.width,e.height)}S&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,f,y,p)}else n.texImage2D(t.TEXTURE_2D,0,_,f,y,p);g(a)&&m(c),u.__version=h.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}function R(e,r,a,c,l,h){const u=s.convert(a.format,a.colorSpace),d=s.convert(a.type),p=b(a.internalFormat,u,d,a.colorSpace);if(!i.get(r).__hasExternalTextures){const e=Math.max(1,r.width>>h),i=Math.max(1,r.height>>h);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?n.texImage3D(l,h,p,e,i,r.depth,0,u,d,null):n.texImage2D(l,h,p,e,i,0,u,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),J(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,c,l,i.get(a).__webglTexture,0,Y(r)):(l===t.TEXTURE_2D||l>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,c,l,i.get(a).__webglTexture,h),n.bindFramebuffer(t.FRAMEBUFFER,null)}function G(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer){let r=t.DEPTH_COMPONENT24;if(i||J(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===z?r=t.DEPTH_COMPONENT32F:e.type===H&&(r=t.DEPTH_COMPONENT24));const i=Y(n);J(n)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,i,r,n.width,n.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,i,r,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,r,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=Y(n);i&&!1===J(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,n.width,n.height):J(n)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=n.textures;for(let r=0;r<e.length;r++){const a=e[r],c=s.convert(a.format,a.colorSpace),l=s.convert(a.type),h=b(a.internalFormat,c,l,a.colorSpace),u=Y(n);i&&!1===J(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,h,n.width,n.height):J(n)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,h,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,h,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function j(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),w(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,a=Y(r);if(r.depthTexture.format===q)J(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==X)throw new Error("Unknown depthTexture format");J(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),G(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),G(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function Y(t){return Math.min(r.maxSamples,t.samples)}function J(t){const n=i.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function K(t,e){const n=t.colorSpace,i=t.format,r=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==vt&&n!==mt&&(ee.getTransfer(n)===Et?i===W&&r===Q||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),e}function Z(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(l.width=t.naturalWidth||t.width,l.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(l.width=t.displayWidth,l.height=t.displayHeight):(l.width=t.width,l.height=t.height),l}this.allocateTextureUnit=function(){const t=E;return t>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+r.maxTextures),E+=1,t},this.resetTextureUnits=function(){E=0},this.setTexture2D=w,this.setTexture2DArray=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?B(s,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?B(s,e,r):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,a){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,a,o){if(6!==a.image.length)return;const c=T(e,a),l=a.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+o);const h=i.get(l);if(l.version!==h.__version||!0===c){n.activeTexture(t.TEXTURE0+o);const e=ee.getPrimaries(ee.workingColorSpace),i=a.colorSpace===mt?null:ee.getPrimaries(a.colorSpace),u=a.colorSpace===mt||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);const d=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?a.image[t].image:a.image[t]:A(a.image[t],!0,r.maxCubemapSize),f[t]=K(a,f[t]);const y=f[0],x=s.convert(a.format,a.colorSpace),_=s.convert(a.type),E=b(a.internalFormat,x,_,a.colorSpace),w=!0!==a.isVideoTexture,C=void 0===h.__version||!0===c,S=l.dataReady;let M,T=v(a,y);if(I(t.TEXTURE_CUBE_MAP,a),d){w&&C&&n.texStorage2D(t.TEXTURE_CUBE_MAP,T,E,y.width,y.height);for(let e=0;e<6;e++){M=f[e].mipmaps;for(let i=0;i<M.length;i++){const r=M[i];a.format!==W?null!==x?w?S&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,x,r.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,E,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):w?S&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,x,_,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,E,r.width,r.height,0,x,_,r.data)}}}else{if(M=a.mipmaps,w&&C){M.length>0&&T++;const e=Z(f[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,T,E,e.width,e.height)}for(let e=0;e<6;e++)if(p){w?S&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,x,_,f[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,E,f[e].width,f[e].height,0,x,_,f[e].data);for(let i=0;i<M.length;i++){const r=M[i].image[e].image;w?S&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,r.width,r.height,x,_,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,E,r.width,r.height,0,x,_,r.data)}}else{w?S&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,x,_,f[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,E,x,_,f[e]);for(let i=0;i<M.length;i++){const r=M[i];w?S&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,x,_,r.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,E,x,_,r.image[e])}}}g(a)&&m(t.TEXTURE_CUBE_MAP),h.__version=l.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}(o,e,a):n.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture,t.TEXTURE0+a)},this.rebindTextures=function(e,n,r){const s=i.get(e);void 0!==n&&R(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&j(e)},this.setupRenderTarget=function(e){const r=e.texture,o=i.get(e),c=i.get(r);e.addEventListener("dispose",x);const l=e.textures,h=!0===e.isWebGLCubeRenderTarget,u=l.length>1;if(u||(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=r.version,a.memory.textures++),h){o.__webglFramebuffer=[];for(let e=0;e<6;e++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[e]=[];for(let n=0;n<r.mipmaps.length;n++)o.__webglFramebuffer[e][n]=t.createFramebuffer()}else o.__webglFramebuffer[e]=t.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let e=0;e<r.mipmaps.length;e++)o.__webglFramebuffer[e]=t.createFramebuffer()}else o.__webglFramebuffer=t.createFramebuffer();if(u)for(let e=0,n=l.length;e<n;e++){const n=i.get(l[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),a.memory.textures++)}if(e.samples>0&&!1===J(e)){o.__webglMultisampledFramebuffer=t.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<l.length;n++){const i=l[n];o.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const r=s.convert(i.format,i.colorSpace),a=s.convert(i.type),c=b(i.internalFormat,r,a,i.colorSpace,!0===e.isXRRenderTarget),h=Y(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,c,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,o.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(o.__webglDepthRenderbuffer=t.createRenderbuffer(),G(o.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(h){n.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),I(t.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)R(o.__webglFramebuffer[n][i],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else R(o.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&m(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(u){for(let r=0,s=l.length;r<s;r++){const s=l[r],a=i.get(s);n.bindTexture(t.TEXTURE_2D,a.__webglTexture),I(t.TEXTURE_2D,s),R(o.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,0),g(s)&&m(t.TEXTURE_2D)}n.unbindTexture()}else{let i=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(i=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(i,c.__webglTexture),I(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)R(o.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,i,n);else R(o.__webglFramebuffer,e,r,t.COLOR_ATTACHMENT0,i,0);g(r)&&m(i),n.unbindTexture()}e.depthBuffer&&j(e)},this.updateRenderTargetMipmap=function(e){const r=e.textures;for(let s=0,a=r.length;s<a;s++){const a=r[s];if(g(a)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=i.get(a).__webglTexture;n.bindTexture(r,s),m(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0&&!1===J(e)){const r=e.textures,s=e.width,a=e.height;let o=t.COLOR_BUFFER_BIT;const l=[],h=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=i.get(e),d=r.length>1;if(d)for(let e=0;e<r.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&l.push(h);const p=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===p&&(e.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&!0!==u.__isTransmissionRenderTarget&&(o|=t.STENCIL_BUFFER_BIT)),d&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===p&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[h]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[h])),d){const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,a,0,0,s,a,o,t.NEAREST),c&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),d)for(let e=0;e<r.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,u.__webglColorRenderbuffer[e]);const s=i.get(r[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=j,this.setupFrameBufferTexture=R,this.useMultisampledRTT=J}function _a(t,e){return{convert:function(n,i=mt){let r;const s=ee.getTransfer(i);if(n===Q)return t.UNSIGNED_BYTE;if(1017===n)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return t.UNSIGNED_SHORT_5_5_5_1;if(35902===n)return t.UNSIGNED_INT_5_9_9_9_REV;if(1010===n)return t.BYTE;if(1011===n)return t.SHORT;if(1012===n)return t.UNSIGNED_SHORT;if(n===G)return t.INT;if(n===H)return t.UNSIGNED_INT;if(n===z)return t.FLOAT;if(n===j)return t.HALF_FLOAT;if(1021===n)return t.ALPHA;if(1022===n)return t.RGB;if(n===W)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(n===q)return t.DEPTH_COMPONENT;if(n===X)return t.DEPTH_STENCIL;if(n===Y)return t.RED;if(1029===n)return t.RED_INTEGER;if(n===J)return t.RG;if(1031===n)return t.RG_INTEGER;if(1033===n)return t.RGBA_INTEGER;if(n===K||n===Z||n===$||n===tt)if(s===Et){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===K)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Z)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===$)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===tt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===K)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Z)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===$)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===tt)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===et||35841===n||n===nt||35843===n){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===et)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===nt)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===it)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===rt||n===st){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===rt)return s===Et?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===st)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===at||37809===n||37810===n||37811===n||n===ot||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===at)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===ot)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return s===Et?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===ct||36494===n||36495===n){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(n===ct)return s===Et?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(r=e.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===ct)return r.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===V?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class Ea extends Li{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class wa extends xn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ca={type:"move"};class Sa{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new wa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new wa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new me,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new me),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new wa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new me,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new me),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(c&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n),r=this._getHandJoint(c,i);null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=t.radius),r.visible=null!==t}const i=c.joints["index-finger-tip"],r=c.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,l=.005;c.inputState.pinching&&a>o+l?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&a<=o-l&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Ca)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==c&&(c.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new wa;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class Ma{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(null===this.texture){const i=new he;t.properties.get(i).__webglTexture=e.texture,e.depthNear==n.depthNear&&e.depthFar==n.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}render(t,e){if(null!==this.texture){if(null===this.mesh){const t=e.cameras[0].viewport,n=new Ti({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new _i(new Xi(20,20),n)}t.render(this.mesh,e)}}reset(){this.texture=null,this.mesh=null}}class Ia extends Rt{constructor(t,e){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,c=null,l=null,h=null,u=null,d=null,p=null;const f=new Ma,A=e.getContextAttributes();let g=null,m=null;const b=[],v=[],y=new zt;let x=null;const _=new Li;_.layers.enable(1),_.viewport=new ue;const E=new Li;E.layers.enable(2),E.viewport=new ue;const w=[_,E],C=new Ea;C.layers.enable(1),C.layers.enable(2);let S=null,M=null;function I(t){const e=v.indexOf(t.inputSource);if(-1===e)return;const n=b[e];void 0!==n&&(n.update(t.inputSource,t.frame,c||s),n.dispatchEvent({type:t.type,data:t.inputSource}))}function T(){i.removeEventListener("select",I),i.removeEventListener("selectstart",I),i.removeEventListener("selectend",I),i.removeEventListener("squeeze",I),i.removeEventListener("squeezestart",I),i.removeEventListener("squeezeend",I),i.removeEventListener("end",T),i.removeEventListener("inputsourceschange",B);for(let t=0;t<b.length;t++){const e=v[t];null!==e&&(v[t]=null,b[t].disconnect(e))}S=null,M=null,f.reset(),t.setRenderTarget(g),d=null,u=null,h=null,i=null,m=null,U.stop(),n.isPresenting=!1,t.setPixelRatio(x),t.setSize(y.width,y.height,!1),n.dispatchEvent({type:"sessionend"})}function B(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=v.indexOf(n);i>=0&&(v[i]=null,b[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=v.indexOf(n);if(-1===i){for(let t=0;t<b.length;t++){if(t>=v.length){v.push(n),i=t;break}if(null===v[t]){v[t]=n,i=t;break}}if(-1===i)break}const r=b[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=b[t];return void 0===e&&(e=new Sa,b[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=b[t];return void 0===e&&(e=new Sa,b[t]=e),e.getGripSpace()},this.getHand=function(t){let e=b[t];return void 0===e&&(e=new Sa,b[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||s},this.setReferenceSpace=function(t){c=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(l){if(i=l,null!==i){if(g=t.getRenderTarget(),i.addEventListener("select",I),i.addEventListener("selectstart",I),i.addEventListener("selectend",I),i.addEventListener("squeeze",I),i.addEventListener("squeezestart",I),i.addEventListener("squeezeend",I),i.addEventListener("end",T),i.addEventListener("inputsourceschange",B),!0!==A.xrCompatible&&await e.makeXRCompatible(),x=t.getPixelRatio(),t.getSize(y),void 0===i.renderState.layers){const n={antialias:A.antialias,alpha:!0,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),m=new pe(d.framebufferWidth,d.framebufferHeight,{format:W,type:Q,colorSpace:t.outputColorSpace,stencilBuffer:A.stencil})}else{let n=null,s=null,a=null;A.depth&&(a=A.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=A.stencil?X:q,s=A.stencil?V:H);const o={colorFormat:e.RGBA8,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(i,e),u=h.createProjectionLayer(o),i.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),m=new pe(u.textureWidth,u.textureHeight,{format:W,type:Q,depthTexture:new Pr(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:A.stencil,colorSpace:t.outputColorSpace,samples:A.antialias?4:0});t.properties.get(m).__ignoreDepthValues=u.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(o),c=null,s=await i.requestReferenceSpace(a),U.setContext(i),U.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const R=new me,P=new me;function D(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;null!==f.texture&&(t.near=f.depthNear,t.far=f.depthFar),C.near=E.near=_.near=t.near,C.far=E.far=_.far=t.far,S===C.near&&M===C.far||(i.updateRenderState({depthNear:C.near,depthFar:C.far}),S=C.near,M=C.far,_.near=S,_.far=M,E.near=S,E.far=M,_.updateProjectionMatrix(),E.updateProjectionMatrix(),t.updateProjectionMatrix());const e=t.parent,n=C.cameras;D(C,e);for(let t=0;t<n.length;t++)D(n[t],e);2===n.length?function(t,e,n){R.setFromMatrixPosition(e.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const i=R.distanceTo(P),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),c=(r[9]+1)/r[5],l=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,f=i/(-h+u),A=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(A),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+f,m=o+f,b=d-A,v=p+(i-A),y=c*o/m*g,x=l*o/m*g;t.projectionMatrix.makePerspective(b,v,y,x,g,m),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(C,_,E):C.projectionMatrix.copy(_.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Ut*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,C,e)},this.getCamera=function(){return C},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(t){o=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==f.texture};let L=null;const U=new Wi;U.setAnimationLoop((function(e,r){if(l=r.getViewerPose(c||s),p=r,null!==l){const e=l.views;null!==d&&(t.setRenderTargetFramebuffer(m,d.framebuffer),t.setRenderTarget(m));let n=!1;e.length!==C.cameras.length&&(C.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==d)s=d.getViewport(r);else{const e=h.getViewSubImage(u,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(m,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}let a=w[i];void 0===a&&(a=new Li,a.layers.enable(i),a.viewport=new ue,w[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&(C.matrix.copy(a.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),!0===n&&C.cameras.push(a)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")){const n=h.getDepthInformation(e[0]);n&&n.isValid&&n.texture&&f.init(t,n,i.renderState)}}for(let t=0;t<b.length;t++){const e=v[t],n=b[t];null!==e&&void 0!==n&&n.update(e,r,c||s)}f.render(t,C),L&&L(e,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(t){L=t},this.dispose=function(){}}}const Ta=new rn,Ba=new qe;function Ra(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,r.side===d&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),r.side===d&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const s=e.get(r),a=s.envMap,o=s.envMapRotation;if(a&&(i.envMap.value=a,Ta.copy(o),Ta.x*=-1,Ta.y*=-1,Ta.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(Ta.y*=-1,Ta.z*=-1),i.envMapRotation.value.setFromMatrix4(Ba.makeRotationFromEuler(Ta)),i.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*e,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,Mi(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===d&&t.clearcoatNormalScale.value.negate()));e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,o)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){const i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,s,a):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Pa(t,e,n,i){let r={},s={},a=[];const o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(t,e,n,i){const r=t.value,s=e+"_"+n;if(void 0===i[s])return i[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const t=i[s];if("number"==typeof r||"boolean"==typeof r){if(t!==r)return i[s]=r,!0}else if(!1===t.equals(r))return t.copy(r),!0}return!1}function l(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function h(e){const n=e.target;n.removeEventListener("dispose",h);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,u){let d=r[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const i=16;for(let t=0,r=e.length;t<r;t++){const r=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=r.length;t<e;t++){const e=r[t],s=Array.isArray(e.value)?e.value:[e.value];for(let t=0,r=s.length;t<r;t++){const r=l(s[t]),a=n%i;0!==a&&i-a<r.boundary&&(n+=i-a),e.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,n+=r.storage}}}const r=n%i;r>0&&(n+=i-r);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<o;t++)if(-1===a.indexOf(t))return a.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",h));const p=u.program;i.updateUBOMapping(n,p);const f=e.render.frame;s[n.id]!==f&&(!function(e){const n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let e=0,n=i.length;e<n;e++){const n=Array.isArray(i[e])?i[e]:[i[e]];for(let i=0,r=n.length;i<r;i++){const r=n[i];if(!0===c(r,e,i,s)){const e=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let s=0;s<n.length;s++){const a=n[s],o=l(a);"number"==typeof a||"boolean"==typeof a?(r.__data[0]=a,t.bufferSubData(t.UNIFORM_BUFFER,e+i,r.__data)):a.isMatrix3?(r.__data[0]=a.elements[0],r.__data[1]=a.elements[1],r.__data[2]=a.elements[2],r.__data[3]=0,r.__data[4]=a.elements[3],r.__data[5]=a.elements[4],r.__data[6]=a.elements[5],r.__data[7]=0,r.__data[8]=a.elements[6],r.__data[9]=a.elements[7],r.__data[10]=a.elements[8],r.__data[11]=0):(a.toArray(r.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,r.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);a=[],r={},s={}}}}class Da{constructor(e={}){const{canvas:n=Xt(),context:i=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:f=!1}=e;let A;if(this.isWebGLRenderer=!0,null!==i){if("undefined"!=typeof WebGLRenderingContext&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");A=i.getContextAttributes().alpha}else A=a;const g=new Uint32Array(4),m=new Int32Array(4);let v=null,y=null;const x=[],_=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=bt,this._useLegacyLights=!1,this.toneMapping=b,this.toneMappingExposure=1;const E=this;let w=!1,C=0,S=0,M=null,I=-1,T=null;const B=new ue,R=new ue;let P=null;const D=new Nn(0);let L=0,U=n.width,F=n.height,N=1,k=null,G=null;const q=new ue(0,0,U,F),X=new ue(0,0,U,F);let Y=!1;const J=new Vi;let K=!1,Z=!1;const $=new qe,tt=new zt,et=new me,nt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function it(){return null===M?N:1}let rt,st,at,ot,ct,lt,ht,ut,dt,pt,ft,At,gt,mt,yt,xt,_t,Et,wt,Ct,St,Mt,It,Tt,Bt=i;function Rt(t,e){const i=n.getContext(t,e);return null!==i?i:null}try{const e={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:f};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${t}`),n.addEventListener("webglcontextlost",Lt,!1),n.addEventListener("webglcontextrestored",Ut,!1),n.addEventListener("webglcontextcreationerror",Ft,!1),null===Bt){const t="webgl2";if(Bt=Rt(t,e),null===Bt)throw Rt(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Pt(){rt=new Sr(Bt),rt.init(),st=new rr(Bt,rt,e),Mt=new _a(Bt,rt),at=new ya(Bt),ot=new Tr(Bt),ct=new aa,lt=new xa(Bt,rt,at,ct,st,Mt,ot),ht=new ar(E),ut=new Cr(E),dt=new qi(Bt),It=new nr(Bt,dt),pt=new Mr(Bt,dt,ot,It),ft=new Rr(Bt,pt,dt,ot),wt=new Br(Bt,st,lt),xt=new sr(ct),At=new sa(E,ht,ut,rt,st,It,xt),gt=new Ra(E,ct),mt=new ha,yt=new ga(rt),Et=new er(E,ht,ut,at,ft,A,c),_t=new va(E,ft,st),Tt=new Pa(Bt,ot,st,at),Ct=new ir(Bt,rt,ot),St=new Ir(Bt,rt,ot),ot.programs=At.programs,E.capabilities=st,E.extensions=rt,E.properties=ct,E.renderLists=mt,E.shadowMap=_t,E.state=at,E.info=ot}Pt();const Dt=new Ia(E,Bt);function Lt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function Ut(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const t=ot.autoReset,e=_t.enabled,n=_t.autoUpdate,i=_t.needsUpdate,r=_t.type;Pt(),ot.autoReset=t,_t.enabled=e,_t.autoUpdate=n,_t.needsUpdate=i,_t.type=r}function Ft(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Nt(t){const e=t.target;e.removeEventListener("dispose",Nt),function(t){(function(t){const e=ct.get(t).programs;void 0!==e&&(e.forEach((function(t){At.releaseProgram(t)})),t.isShaderMaterial&&At.releaseShaderCache(t))})(t),ct.remove(t)}(e)}function kt(t,e,n){!0===t.transparent&&t.side===p&&!1===t.forceSinglePass?(t.side=d,t.needsUpdate=!0,Yt(t,e,n),t.side=u,t.needsUpdate=!0,Yt(t,e,n),t.side=p):Yt(t,e,n)}this.xr=Dt,this.getContext=function(){return Bt},this.getContextAttributes=function(){return Bt.getContextAttributes()},this.forceContextLoss=function(){const t=rt.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=rt.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(t){void 0!==t&&(N=t,this.setSize(U,F,!1))},this.getSize=function(t){return t.set(U,F)},this.setSize=function(t,e,i=!0){Dt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(U=t,F=e,n.width=Math.floor(t*N),n.height=Math.floor(e*N),!0===i&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(U*N,F*N).floor()},this.setDrawingBufferSize=function(t,e,i){U=t,F=e,N=i,n.width=Math.floor(t*i),n.height=Math.floor(e*i),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(B)},this.getViewport=function(t){return t.copy(q)},this.setViewport=function(t,e,n,i){t.isVector4?q.set(t.x,t.y,t.z,t.w):q.set(t,e,n,i),at.viewport(B.copy(q).multiplyScalar(N).round())},this.getScissor=function(t){return t.copy(X)},this.setScissor=function(t,e,n,i){t.isVector4?X.set(t.x,t.y,t.z,t.w):X.set(t,e,n,i),at.scissor(R.copy(X).multiplyScalar(N).round())},this.getScissorTest=function(){return Y},this.setScissorTest=function(t){at.setScissorTest(Y=t)},this.setOpaqueSort=function(t){k=t},this.setTransparentSort=function(t){G=t},this.getClearColor=function(t){return t.copy(Et.getClearColor())},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;if(t){let t=!1;if(null!==M){const e=M.texture.format;t=1033===e||1031===e||1029===e}if(t){const t=M.texture.type,e=t===Q||t===H||1012===t||t===V||1017===t||1018===t,n=Et.getClearColor(),i=Et.getClearAlpha(),r=n.r,s=n.g,a=n.b;e?(g[0]=r,g[1]=s,g[2]=a,g[3]=i,Bt.clearBufferuiv(Bt.COLOR,0,g)):(m[0]=r,m[1]=s,m[2]=a,m[3]=i,Bt.clearBufferiv(Bt.COLOR,0,m))}else i|=Bt.COLOR_BUFFER_BIT}e&&(i|=Bt.DEPTH_BUFFER_BIT),n&&(i|=Bt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Bt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Lt,!1),n.removeEventListener("webglcontextrestored",Ut,!1),n.removeEventListener("webglcontextcreationerror",Ft,!1),mt.dispose(),yt.dispose(),ct.dispose(),ht.dispose(),ut.dispose(),ft.dispose(),It.dispose(),Tt.dispose(),At.dispose(),Dt.dispose(),Dt.removeEventListener("sessionstart",Qt),Dt.removeEventListener("sessionend",Gt),Ht.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=nt);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,n,i,r){!0!==e.isScene&&(e=nt);lt.resetTextureUnits();const s=e.fog,a=i.isMeshStandardMaterial?e.environment:null,o=null===M?E.outputColorSpace:!0===M.isXRRenderTarget?M.texture.colorSpace:vt,c=(i.isMeshStandardMaterial?ut:ht).get(i.envMap||a),l=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=b;i.toneMapped&&(null!==M&&!0!==M.isXRRenderTarget||(f=E.toneMapping));const A=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==A?A.length:0,m=ct.get(i),v=y.state.lights;if(!0===K&&(!0===Z||t!==T)){const e=t===T&&i.id===I;xt.setState(i,t,e)}let x=!1;i.version===m.__version?m.needsLights&&m.lightsStateVersion!==v.state.version||m.outputColorSpace!==o||r.isBatchedMesh&&!1===m.batching?x=!0:r.isBatchedMesh||!0!==m.batching?r.isInstancedMesh&&!1===m.instancing?x=!0:r.isInstancedMesh||!0!==m.instancing?r.isSkinnedMesh&&!1===m.skinning?x=!0:r.isSkinnedMesh||!0!==m.skinning?r.isInstancedMesh&&!0===m.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===m.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===m.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===m.instancingMorph&&null!==r.morphTexture||m.envMap!==c||!0===i.fog&&m.fog!==s?x=!0:void 0===m.numClippingPlanes||m.numClippingPlanes===xt.numPlanes&&m.numIntersection===xt.numIntersection?(m.vertexAlphas!==l||m.vertexTangents!==h||m.morphTargets!==u||m.morphNormals!==d||m.morphColors!==p||m.toneMapping!==f||m.morphTargetsCount!==g)&&(x=!0):x=!0:x=!0:x=!0:x=!0:(x=!0,m.__version=i.version);let _=m.currentProgram;!0===x&&(_=Yt(i,e,r));let w=!1,C=!1,S=!1;const B=_.getUniforms(),R=m.uniforms;at.useProgram(_.program)&&(w=!0,C=!0,S=!0);i.id!==I&&(I=i.id,C=!0);if(w||T!==t){B.setValue(Bt,"projectionMatrix",t.projectionMatrix),B.setValue(Bt,"viewMatrix",t.matrixWorldInverse);const e=B.map.cameraPosition;void 0!==e&&e.setValue(Bt,et.setFromMatrixPosition(t.matrixWorld)),st.logarithmicDepthBuffer&&B.setValue(Bt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&B.setValue(Bt,"isOrthographic",!0===t.isOrthographicCamera),T!==t&&(T=t,C=!0,S=!0)}if(r.isSkinnedMesh){B.setOptional(Bt,r,"bindMatrix"),B.setOptional(Bt,r,"bindMatrixInverse");const t=r.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),B.setValue(Bt,"boneTexture",t.boneTexture,lt))}r.isBatchedMesh&&(B.setOptional(Bt,r,"batchingTexture"),B.setValue(Bt,"batchingTexture",r._matricesTexture,lt));const P=n.morphAttributes;void 0===P.position&&void 0===P.normal&&void 0===P.color||wt.update(r,n,_);(C||m.receiveShadow!==r.receiveShadow)&&(m.receiveShadow=r.receiveShadow,B.setValue(Bt,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(R.envMap.value=c,R.flipEnvMap.value=c.isCubeTexture&&!1===c.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==e.environment&&(R.envMapIntensity.value=e.environmentIntensity);C&&(B.setValue(Bt,"toneMappingExposure",E.toneMappingExposure),m.needsLights&&(L=S,(D=R).ambientLightColor.needsUpdate=L,D.lightProbe.needsUpdate=L,D.directionalLights.needsUpdate=L,D.directionalLightShadows.needsUpdate=L,D.pointLights.needsUpdate=L,D.pointLightShadows.needsUpdate=L,D.spotLights.needsUpdate=L,D.spotLightShadows.needsUpdate=L,D.rectAreaLights.needsUpdate=L,D.hemisphereLights.needsUpdate=L),s&&!0===i.fog&&gt.refreshFogUniforms(R,s),gt.refreshMaterialUniforms(R,i,N,F,y.state.transmissionRenderTarget),Ns.upload(Bt,Jt(m),R,lt));var D,L;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Ns.upload(Bt,Jt(m),R,lt),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&B.setValue(Bt,"center",r.center);if(B.setValue(Bt,"modelViewMatrix",r.modelViewMatrix),B.setValue(Bt,"normalMatrix",r.normalMatrix),B.setValue(Bt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];Tt.update(n,_),Tt.bind(n,_)}}return _}(t,e,n,i,r);at.setMaterial(i,a);let c=n.index,l=1;if(!0===i.wireframe){if(c=pt.getWireframeAttribute(n),void 0===c)return;l=2}const h=n.drawRange,u=n.attributes.position;let d=h.start*l,p=(h.start+h.count)*l;null!==s&&(d=Math.max(d,s.start*l),p=Math.min(p,(s.start+s.count)*l)),null!==c?(d=Math.max(d,0),p=Math.min(p,c.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const f=p-d;if(f<0||f===1/0)return;let A;It.setup(r,i,o,n,c);let g=Ct;if(null!==c&&(A=dt.get(c),g=St,g.setIndex(A)),r.isMesh)!0===i.wireframe?(at.setLineWidth(i.wireframeLinewidth*it()),g.setMode(Bt.LINES)):g.setMode(Bt.TRIANGLES);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),at.setLineWidth(t*it()),r.isLineSegments?g.setMode(Bt.LINES):r.isLineLoop?g.setMode(Bt.LINE_LOOP):g.setMode(Bt.LINE_STRIP)}else r.isPoints?g.setMode(Bt.POINTS):r.isSprite&&g.setMode(Bt.TRIANGLES);if(r.isBatchedMesh)g.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else if(r.isInstancedMesh)g.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);g.renderInstances(d,f,e)}else g.render(d,f)},this.compile=function(t,e,n=null){null===n&&(n=t),y=yt.get(n),y.init(),_.push(y),n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(y.pushLight(t),t.castShadow&&y.pushShadow(t))})),t!==n&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(y.pushLight(t),t.castShadow&&y.pushShadow(t))})),y.setupLights(E._useLegacyLights);const i=new Set;return t.traverse((function(t){const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const s=e[r];kt(s,n,t),i.add(s)}else kt(e,n,t),i.add(e)})),_.pop(),y=null,i},this.compileAsync=function(t,e,n=null){const i=this.compile(t,e,n);return new Promise((e=>{function n(){i.forEach((function(t){ct.get(t).currentProgram.isReady()&&i.delete(t)})),0!==i.size?setTimeout(n,10):e(t)}null!==rt.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ot=null;function Qt(){Ht.stop()}function Gt(){Ht.start()}const Ht=new Wi;function jt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)y.pushLight(t),t.castShadow&&y.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||J.intersectsSprite(t)){i&&et.setFromMatrixPosition(t.matrixWorld).applyMatrix4($);const e=ft.update(t),r=t.material;r.visible&&v.push(t,e,r,n,et.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||J.intersectsObject(t))){const e=ft.update(t),r=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),et.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),et.copy(e.boundingSphere.center)),et.applyMatrix4(t.matrixWorld).applyMatrix4($)),Array.isArray(r)){const i=e.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&v.push(t,e,o,n,et.z,a)}}else r.visible&&v.push(t,e,r,n,et.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)jt(r[t],e,n,i)}function Vt(t,e,n,i){const r=t.opaque,a=t.transmissive,o=t.transparent;y.setupLightsView(n),!0===K&&xt.setGlobalState(E.clippingPlanes,n),a.length>0&&function(t,e,n,i){const r=!0===n.isScene?n.overrideMaterial:null;if(null!==r)return;if(null===y.state.transmissionRenderTarget){y.state.transmissionRenderTarget=new pe(1,1,{generateMipmaps:!0,type:rt.has("EXT_color_buffer_half_float")||rt.has("EXT_color_buffer_float")?j:Q,minFilter:O,samples:4,stencilBuffer:s});ct.get(y.state.transmissionRenderTarget).__isTransmissionRenderTarget=!0}const a=y.state.transmissionRenderTarget;E.getDrawingBufferSize(tt),a.setSize(tt.x,tt.y);const o=E.getRenderTarget();E.setRenderTarget(a),E.getClearColor(D),L=E.getClearAlpha(),L<1&&E.setClearColor(16777215,.5);E.clear();const c=E.toneMapping;E.toneMapping=b,Wt(t,n,i),lt.updateMultisampleRenderTarget(a),lt.updateRenderTargetMipmap(a);let l=!1;for(let t=0,r=e.length;t<r;t++){const r=e[t],s=r.object,a=r.geometry,o=r.material,c=r.group;if(o.side===p&&s.layers.test(i.layers)){const t=o.side;o.side=d,o.needsUpdate=!0,qt(s,n,i,a,o,c),o.side=t,o.needsUpdate=!0,l=!0}}!0===l&&(lt.updateMultisampleRenderTarget(a),lt.updateRenderTargetMipmap(a));E.setRenderTarget(o),E.setClearColor(D,L),E.toneMapping=c}(r,a,e,n),i&&at.viewport(B.copy(i)),r.length>0&&Wt(r,e,n),a.length>0&&Wt(a,e,n),o.length>0&&Wt(o,e,n),at.buffers.depth.setTest(!0),at.buffers.depth.setMask(!0),at.buffers.color.setMask(!0),at.setPolygonOffset(!1)}function Wt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,c=null===i?s.material:i,l=s.group;a.layers.test(n.layers)&&qt(a,e,n,o,c,l)}}function qt(t,e,n,i,r,s){t.onBeforeRender(E,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(E,e,n,i,t,s),!0===r.transparent&&r.side===p&&!1===r.forceSinglePass?(r.side=d,r.needsUpdate=!0,E.renderBufferDirect(n,e,i,r,t,s),r.side=u,r.needsUpdate=!0,E.renderBufferDirect(n,e,i,r,t,s),r.side=p):E.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(E,e,n,i,r,s)}function Yt(t,e,n){!0!==e.isScene&&(e=nt);const i=ct.get(t),r=y.state.lights,s=y.state.shadowsArray,a=r.state.version,o=At.getParameters(t,r.state,s,e,n),c=At.getProgramCacheKey(o);let l=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?ut:ht).get(t.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===l&&(t.addEventListener("dispose",Nt),l=new Map,i.programs=l);let h=l.get(c);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return Kt(t,o),h}else o.uniforms=At.getUniforms(t),t.onBuild(n,o,E),t.onBeforeCompile(o,E),h=At.acquireProgram(o,c),l.set(c,h),i.uniforms=o.uniforms;const u=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=xt.uniform),Kt(t,o),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=h,i.uniformsList=null,h}function Jt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=Ns.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Kt(t,e){const n=ct.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Ht.setAnimationLoop((function(t){Ot&&Ot(t)})),"undefined"!=typeof self&&Ht.setContext(self),this.setAnimationLoop=function(t){Ot=t,Dt.setAnimationLoop(t),null===t?Ht.stop():Ht.start()},Dt.addEventListener("sessionstart",Qt),Dt.addEventListener("sessionend",Gt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===w)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Dt.enabled&&!0===Dt.isPresenting&&(!0===Dt.cameraAutoUpdate&&Dt.updateCamera(e),e=Dt.getCamera()),!0===t.isScene&&t.onBeforeRender(E,t,e,M),y=yt.get(t,_.length),y.init(),_.push(y),$.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),J.setFromProjectionMatrix($),Z=this.localClippingEnabled,K=xt.init(this.clippingPlanes,Z),v=mt.get(t,x.length),v.init(),x.push(v),jt(t,e,0,E.sortObjects),v.finish(),!0===E.sortObjects&&v.sort(k,G),this.info.render.frame++,!0===K&&xt.beginShadows();const n=y.state.shadowsArray;if(_t.render(n,t,e),!0===K&&xt.endShadows(),!0===this.info.autoReset&&this.info.reset(),!1!==Dt.enabled&&!1!==Dt.isPresenting&&!1!==Dt.hasDepthSensing()||Et.render(v,t),y.setupLights(E._useLegacyLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Vt(v,t,i,i.viewport)}}else Vt(v,t,e);null!==M&&(lt.updateMultisampleRenderTarget(M),lt.updateRenderTargetMipmap(M)),!0===t.isScene&&t.onAfterRender(E,t,e),It.resetDefaultState(),I=-1,T=null,_.pop(),y=_.length>0?_[_.length-1]:null,x.pop(),v=x.length>0?x[x.length-1]:null},this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(t,e,n){ct.get(t.texture).__webglTexture=e,ct.get(t.depthTexture).__webglTexture=n;const i=ct.get(t);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===rt.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const n=ct.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){M=t,C=e,S=n;let i=!0,r=null,s=!1,a=!1;if(t){const o=ct.get(t);void 0!==o.__useDefaultFramebuffer?(at.bindFramebuffer(Bt.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?lt.setupRenderTarget(t):o.__hasExternalTextures&&lt.rebindTextures(t,ct.get(t.texture).__webglTexture,ct.get(t.depthTexture).__webglTexture);const c=t.texture;(c.isData3DTexture||c.isDataArrayTexture||c.isCompressedArrayTexture)&&(a=!0);const l=ct.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(l[e])?l[e][n]:l[e],s=!0):r=t.samples>0&&!1===lt.useMultisampledRTT(t)?ct.get(t).__webglMultisampledFramebuffer:Array.isArray(l)?l[n]:l,B.copy(t.viewport),R.copy(t.scissor),P=t.scissorTest}else B.copy(q).multiplyScalar(N).floor(),R.copy(X).multiplyScalar(N).floor(),P=Y;if(at.bindFramebuffer(Bt.FRAMEBUFFER,r)&&i&&at.drawBuffers(t,r),at.viewport(B),at.scissor(R),at.setScissorTest(P),s){const i=ct.get(t.texture);Bt.framebufferTexture2D(Bt.FRAMEBUFFER,Bt.COLOR_ATTACHMENT0,Bt.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.__webglTexture,n)}else if(a){const i=ct.get(t.texture),r=e||0;Bt.framebufferTextureLayer(Bt.FRAMEBUFFER,Bt.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}I=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=ct.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){at.bindFramebuffer(Bt.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,c=a.type;if(o!==W&&Mt.convert(o)!==Bt.getParameter(Bt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=c===j&&(rt.has("EXT_color_buffer_half_float")||rt.has("EXT_color_buffer_float"));if(c!==Q&&Mt.convert(c)!==Bt.getParameter(Bt.IMPLEMENTATION_COLOR_READ_TYPE)&&c!==z&&!l)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&Bt.readPixels(e,n,i,r,Mt.convert(o),Mt.convert(c),s)}finally{const t=null!==M?ct.get(M).__webglFramebuffer:null;at.bindFramebuffer(Bt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);lt.setTexture2D(e,0),Bt.copyTexSubImage2D(Bt.TEXTURE_2D,n,0,0,t.x,t.y,r,s),at.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,a=Mt.convert(n.format),o=Mt.convert(n.type);lt.setTexture2D(n,0),Bt.pixelStorei(Bt.UNPACK_FLIP_Y_WEBGL,n.flipY),Bt.pixelStorei(Bt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Bt.pixelStorei(Bt.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?Bt.texSubImage2D(Bt.TEXTURE_2D,i,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?Bt.compressedTexSubImage2D(Bt.TEXTURE_2D,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):Bt.texSubImage2D(Bt.TEXTURE_2D,i,t.x,t.y,a,o,e.image),0===i&&n.generateMipmaps&&Bt.generateMipmap(Bt.TEXTURE_2D),at.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){const s=Math.round(t.max.x-t.min.x),a=Math.round(t.max.y-t.min.y),o=t.max.z-t.min.z+1,c=Mt.convert(i.format),l=Mt.convert(i.type);let h;if(i.isData3DTexture)lt.setTexture3D(i,0),h=Bt.TEXTURE_3D;else{if(!i.isDataArrayTexture&&!i.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");lt.setTexture2DArray(i,0),h=Bt.TEXTURE_2D_ARRAY}Bt.pixelStorei(Bt.UNPACK_FLIP_Y_WEBGL,i.flipY),Bt.pixelStorei(Bt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Bt.pixelStorei(Bt.UNPACK_ALIGNMENT,i.unpackAlignment);const u=Bt.getParameter(Bt.UNPACK_ROW_LENGTH),d=Bt.getParameter(Bt.UNPACK_IMAGE_HEIGHT),p=Bt.getParameter(Bt.UNPACK_SKIP_PIXELS),f=Bt.getParameter(Bt.UNPACK_SKIP_ROWS),A=Bt.getParameter(Bt.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[r]:n.image;Bt.pixelStorei(Bt.UNPACK_ROW_LENGTH,g.width),Bt.pixelStorei(Bt.UNPACK_IMAGE_HEIGHT,g.height),Bt.pixelStorei(Bt.UNPACK_SKIP_PIXELS,t.min.x),Bt.pixelStorei(Bt.UNPACK_SKIP_ROWS,t.min.y),Bt.pixelStorei(Bt.UNPACK_SKIP_IMAGES,t.min.z),n.isDataTexture||n.isData3DTexture?Bt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,c,l,g.data):i.isCompressedArrayTexture?Bt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,a,o,c,g.data):Bt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,c,l,g),Bt.pixelStorei(Bt.UNPACK_ROW_LENGTH,u),Bt.pixelStorei(Bt.UNPACK_IMAGE_HEIGHT,d),Bt.pixelStorei(Bt.UNPACK_SKIP_PIXELS,p),Bt.pixelStorei(Bt.UNPACK_SKIP_ROWS,f),Bt.pixelStorei(Bt.UNPACK_SKIP_IMAGES,A),0===r&&i.generateMipmaps&&Bt.generateMipmap(h),at.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?lt.setTextureCube(t,0):t.isData3DTexture?lt.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?lt.setTexture2DArray(t,0):lt.setTexture2D(t,0),at.unbindTexture()},this.resetState=function(){C=0,S=0,M=null,at.reset(),It.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Tt}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===yt?"display-p3":"srgb",e.unpackColorSpace=ee.workingColorSpace===xt?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}class La{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Nn(t),this.density=e}clone(){return new La(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Ua extends xn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new rn,this.environmentIntensity=1,this.environmentRotation=new rn,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class Fa{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Mt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Ft()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return Jt("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ft()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ft()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Na=new me;class ka{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Na.fromBufferAttribute(this,e),Na.applyMatrix4(t),this.setXYZ(e,Na.x,Na.y,Na.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Na.fromBufferAttribute(this,e),Na.applyNormalMatrix(t),this.setXYZ(e,Na.x,Na.y,Na.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Na.fromBufferAttribute(this,e),Na.transformDirection(t),this.setXYZ(e,Na.x,Na.y,Na.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Qt(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Gt(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=Gt(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Gt(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Gt(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Gt(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Qt(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Qt(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Qt(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Qt(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Gt(e,this.array),n=Gt(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Gt(e,this.array),n=Gt(n,this.array),i=Gt(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Gt(e,this.array),n=Gt(n,this.array),i=Gt(i,this.array),r=Gt(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new qn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ka(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Oa=new me,Qa=new ue,Ga=new ue,Ha=new me,za=new qe,ja=new me,Va=new ke,Wa=new qe,qa=new We;class Xa extends _i{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=S,this.bindMatrix=new qe,this.bindMatrixInverse=new qe,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new ye),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,ja),this.boundingBox.expandByPoint(ja)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new ke),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,ja),this.boundingSphere.expandByPoint(ja)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Va.copy(this.boundingSphere),Va.applyMatrix4(i),!1!==t.ray.intersectsSphere(Va)&&(Wa.copy(i).invert(),qa.copy(t.ray).applyMatrix4(Wa),null!==this.boundingBox&&!1===qa.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,qa)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new ue,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===S?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,i=this.geometry;Qa.fromBufferAttribute(i.attributes.skinIndex,t),Ga.fromBufferAttribute(i.attributes.skinWeight,t),Oa.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const i=Ga.getComponent(t);if(0!==i){const r=Qa.getComponent(t);za.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(Ha.copy(Oa).applyMatrix4(za),i)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Ya extends xn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ja extends he{constructor(t=null,e=1,n=1,i,r,s,a,o,c=1003,l=1003,h,u){super(null,s,a,o,c,l,i,r,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ka=new qe,Za=new qe;class $a{constructor(t=[],e=[]){this.uuid=Ft(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new qe)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new qe;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:Za;Ka.multiplyMatrices(r,e[i]),Ka.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new $a(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Ja(e,t,t,W,z);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Ya),this.bones.push(r),this.boneInverses.push((new qe).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class to extends qn{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const eo=new qe,no=new qe,io=[],ro=new ye,so=new qe,ao=new _i,oo=new ke;class co extends _i{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new to(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<n;t++)this.setMatrixAt(t,so)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new ye),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,eo),ro.copy(t.boundingBox).applyMatrix4(eo),this.boundingBox.union(ro)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new ke),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,eo),oo.copy(t.boundingSphere).applyMatrix4(eo),this.boundingSphere.union(oo)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const n=e.morphTargetInfluences,i=this.morphTexture.source.data.data,r=t*(n.length+1)+1;for(let t=0;t<n.length;t++)n[t]=i[r+t]}raycast(t,e){const n=this.matrixWorld,i=this.count;if(ao.geometry=this.geometry,ao.material=this.material,void 0!==ao.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),oo.copy(this.boundingSphere),oo.applyMatrix4(n),!1!==t.ray.intersectsSphere(oo)))for(let r=0;r<i;r++){this.getMatrixAt(r,eo),no.multiplyMatrices(n,eo),ao.matrixWorld=no,ao.raycast(t,io);for(let t=0,n=io.length;t<n;t++){const n=io[t];n.instanceId=r,n.object=this,e.push(n)}io.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new to(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const n=e.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new Ja(new Float32Array(i*this.count),i,this.count,Y,z));const r=this.morphTexture.source.data.data;let s=0;for(let t=0;t<n.length;t++)s+=n[t];const a=this.geometry.morphTargetsRelative?1:1-s,o=i*t;r[o]=a,r.set(n,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function lo(t,e){return t.z-e.z}function ho(t,e){return e.z-t.z}class uo{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e){const n=this.pool,i=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const r=n[this.index];i.push(r),this.index++,r.start=t.start,r.count=t.count,r.z=e}reset(){this.list.length=0,this.index=0}}const po="batchId",fo=new qe,Ao=new qe,go=new qe,mo=new qe,bo=new Vi,vo=new ye,yo=new ke,xo=new me,_o=new uo,Eo=new _i,wo=[];function Co(t,e,n=0){const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let s=0;s<r;s++)for(let r=0;r<i;r++)e.setComponent(s+n,r,t.getComponent(s,r))}else e.array.set(t.array,n*i);e.needsUpdate=!0}class So extends _i{get maxGeometryCount(){return this._maxGeometryCount}constructor(t,e,n=2*e,i){super(new ri,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=t,this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let t=Math.sqrt(4*this._maxGeometryCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),n=new Ja(e,t,t,W,z);this._matricesTexture=n}_initializeGeometry(t){const e=this.geometry,n=this._maxVertexCount,i=this._maxGeometryCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in t.attributes){const r=t.getAttribute(i),{array:s,itemSize:a,normalized:o}=r,c=new s.constructor(n*a),l=new qn(c,a,o);e.setAttribute(i,l)}if(null!==t.getIndex()){const t=n>65536?new Uint32Array(r):new Uint16Array(r);e.setIndex(new qn(t,1))}const s=i>65536?new Uint32Array(n):new Uint16Array(n);e.setAttribute(po,new qn(s,1)),this._geometryInitialized=!0}}_validateGeometry(t){if(t.getAttribute(po))throw new Error(`BatchedMesh: Geometry cannot use attribute "${po}"`);const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in e.attributes){if(n===po)continue;if(!t.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=t.getAttribute(n),r=e.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ye);const t=this._geometryCount,e=this.boundingBox,n=this._active;e.makeEmpty();for(let i=0;i<t;i++)!1!==n[i]&&(this.getMatrixAt(i,fo),this.getBoundingBoxAt(i,vo).applyMatrix4(fo),e.union(vo))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ke);const t=this._geometryCount,e=this.boundingSphere,n=this._active;e.makeEmpty();for(let i=0;i<t;i++)!1!==n[i]&&(this.getMatrixAt(i,fo),this.getBoundingSphereAt(i,yo).applyMatrix4(fo),e.union(yo))}addGeometry(t,e=-1,n=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const s=this._reservedRanges,a=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(r=s[s.length-1]),i.vertexCount=-1===e?t.getAttribute("position").count:e,i.vertexStart=null===r?0:r.vertexStart+r.vertexCount;const c=t.getIndex(),l=null!==c;if(l&&(i.indexCount=-1===n?c.count:n,i.indexStart=null===r?0:r.indexStart+r.indexCount),-1!==i.indexStart&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,u=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data;h.push(!0),u.push(!0);const f=this._geometryCount;this._geometryCount++,go.toArray(p,16*f),d.needsUpdate=!0,s.push(i),a.push({start:l?i.indexStart:i.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new ye,sphereInitialized:!1,sphere:new ke});const A=this.geometry.getAttribute(po);for(let t=0;t<i.vertexCount;t++)A.setX(i.vertexStart+t,f);return A.needsUpdate=!0,this.setGeometryAt(f,t),f}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),s=e.getIndex(),a=this._reservedRanges[t];if(i&&s.count>a.indexCount||e.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const o=a.vertexStart,c=a.vertexCount;for(const t in n.attributes){if(t===po)continue;const i=e.getAttribute(t),r=n.getAttribute(t);Co(i,r,o);const s=i.itemSize;for(let t=i.count,e=c;t<e;t++){const e=o+t;for(let t=0;t<s;t++)r.setComponent(e,t,0)}r.needsUpdate=!0,r.addUpdateRange(o*s,c*s)}if(i){const t=a.indexStart;for(let e=0;e<s.count;e++)r.setX(t+e,o+s.getX(e));for(let e=s.count,n=a.indexCount;e<n;e++)r.setX(t+e,o);r.needsUpdate=!0,r.addUpdateRange(t,a.indexCount)}const l=this._bounds[t];null!==e.boundingBox?(l.box.copy(e.boundingBox),l.boxInitialized=!0):l.boxInitialized=!1,null!==e.boundingSphere?(l.sphere.copy(e.boundingSphere),l.sphereInitialized=!0):l.sphereInitialized=!1;const h=this._drawRanges[t],u=e.getAttribute("position");return h.count=i?s.count:u.count,this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._active;return t>=e.length||!1===e[t]||(e[t]=!1,this._visibilityChanged=!0),this}getBoundingBoxAt(t,e){if(!1===this._active[t])return null;const n=this._bounds[t],i=n.box,r=this.geometry;if(!1===n.boxInitialized){i.makeEmpty();const e=r.index,s=r.attributes.position,a=this._drawRanges[t];for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),i.expandByPoint(xo.fromBufferAttribute(s,n))}n.boxInitialized=!0}return e.copy(i),e}getBoundingSphereAt(t,e){if(!1===this._active[t])return null;const n=this._bounds[t],i=n.sphere,r=this.geometry;if(!1===n.sphereInitialized){i.makeEmpty(),this.getBoundingBoxAt(t,vo),vo.getCenter(i.center);const e=r.index,s=r.attributes.position,a=this._drawRanges[t];let o=0;for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),xo.fromBufferAttribute(s,n),o=Math.max(o,i.center.distanceToSquared(xo))}i.radius=Math.sqrt(o),n.sphereInitialized=!0}return e.copy(i),e}setMatrixAt(t,e){const n=this._active,i=this._matricesTexture,r=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]||(e.toArray(r,16*t),i.needsUpdate=!0),this}getMatrixAt(t,e){const n=this._active,i=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]?null:e.fromArray(i,16*t)}setVisibleAt(t,e){const n=this._visibility,i=this._active;return t>=this._geometryCount||!1===i[t]||n[t]===e||(n[t]=e,this._visibilityChanged=!0),this}getVisibleAt(t){const e=this._visibility,n=this._active;return!(t>=this._geometryCount||!1===n[t])&&e[t]}raycast(t,e){const n=this._visibility,i=this._active,r=this._drawRanges,s=this._geometryCount,a=this.matrixWorld,o=this.geometry;Eo.material=this.material,Eo.geometry.index=o.index,Eo.geometry.attributes=o.attributes,null===Eo.geometry.boundingBox&&(Eo.geometry.boundingBox=new ye),null===Eo.geometry.boundingSphere&&(Eo.geometry.boundingSphere=new ke);for(let o=0;o<s;o++){if(!n[o]||!i[o])continue;const s=r[o];Eo.geometry.setDrawRange(s.start,s.count),this.getMatrixAt(o,Eo.matrixWorld).premultiply(a),this.getBoundingBoxAt(o,Eo.geometry.boundingBox),this.getBoundingSphereAt(o,Eo.geometry.boundingSphere),Eo.raycast(t,wo);for(let t=0,n=wo.length;t<n;t++){const n=wo[t];n.object=this,n.batchId=o,e.push(n)}wo.length=0}Eo.material=null,Eo.geometry.index=null,Eo.geometry.attributes={},Eo.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map((t=>({...t}))),this._reservedRanges=t._reservedRanges.map((t=>({...t}))),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map((t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()}))),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(t,e,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=i.getIndex(),a=null===s?1:s.array.BYTES_PER_ELEMENT,o=this._active,c=this._visibility,l=this._multiDrawStarts,h=this._multiDrawCounts,u=this._drawRanges,d=this.perObjectFrustumCulled;d&&(mo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),bo.setFromProjectionMatrix(mo,t.coordinateSystem));let p=0;if(this.sortObjects){Ao.copy(this.matrixWorld).invert(),xo.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Ao);for(let t=0,e=c.length;t<e;t++)if(c[t]&&o[t]){this.getMatrixAt(t,fo),this.getBoundingSphereAt(t,yo).applyMatrix4(fo);let e=!1;if(d&&(e=!bo.intersectsSphere(yo)),!e){const e=xo.distanceTo(yo.center);_o.push(u[t],e)}}const t=_o.list,e=this.customSort;null===e?t.sort(r.transparent?ho:lo):e.call(this,t,n);for(let e=0,n=t.length;e<n;e++){const n=t[e];l[p]=n.start*a,h[p]=n.count,p++}_o.reset()}else for(let t=0,e=c.length;t<e;t++)if(c[t]&&o[t]){let e=!1;if(d&&(this.getMatrixAt(t,fo),this.getBoundingSphereAt(t,yo).applyMatrix4(fo),e=!bo.intersectsSphere(yo)),!e){const e=u[t];l[p]=e.start*a,h[p]=e.count,p++}}this._multiDrawCount=p,this._visibilityChanged=!1}onBeforeShadow(t,e,n,i,r,s){this.onBeforeRender(t,null,i,r,s)}}class Mo extends Qn{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Nn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Io=new me,To=new me,Bo=new qe,Ro=new We,Po=new ke;class Do extends xn{constructor(t=new ri,e=new Mo){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Io.fromBufferAttribute(e,t-1),To.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Io.distanceTo(To);t.setAttribute("lineDistance",new Jn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Po.copy(n.boundingSphere),Po.applyMatrix4(i),Po.radius+=r,!1===t.ray.intersectsSphere(Po))return;Bo.copy(i).invert(),Ro.copy(t.ray).applyMatrix4(Bo);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,c=new me,l=new me,h=new me,u=new me,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p){for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){const i=p.getX(n),r=p.getX(n+1);c.fromBufferAttribute(f,i),l.fromBufferAttribute(f,r);if(Ro.distanceSqToSegment(c,l,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(u);s<t.near||s>t.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count)-1;n<i;n+=d){c.fromBufferAttribute(f,n),l.fromBufferAttribute(f,n+1);if(Ro.distanceSqToSegment(c,l,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const Lo=new me,Uo=new me;class Fo extends Do{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Lo.fromBufferAttribute(e,t),Uo.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Lo.distanceTo(Uo);t.setAttribute("lineDistance",new Jn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class No extends Do{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class ko extends Qn{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Nn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Oo=new qe,Qo=new We,Go=new ke,Ho=new me;class zo extends xn{constructor(t=new ri,e=new ko){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Go.copy(n.boundingSphere),Go.applyMatrix4(i),Go.radius+=r,!1===t.ray.intersectsSphere(Go))return;Oo.copy(i).invert(),Qo.copy(t.ray).applyMatrix4(Oo);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,c=n.index,l=n.attributes.position;if(null!==c){for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++){const r=c.getX(n);Ho.fromBufferAttribute(l,r),jo(Ho,r,o,i,t,e,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++)Ho.fromBufferAttribute(l,n),jo(Ho,n,o,i,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function jo(t,e,n,i,r,s,a){const o=Qo.distanceSqToPoint(t);if(o<n){const n=new me;Qo.closestPointToPoint(t,n),n.applyMatrix4(i);const c=r.ray.origin.distanceTo(n);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:n,index:e,face:null,object:a})}}class Vo extends he{constructor(t,e,n,i,r,s,a,o,c){super(t,e,n,i,r,s,a,o,c),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:N,this.magFilter=void 0!==r?r:N,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Wo extends he{constructor(t,e,n,i,r,s,a,o,c,l,h,u){super(null,s,a,o,c,l,i,r,h,u),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class qo extends Wo{constructor(t,e,n,i,r,s){super(t,e,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=D}}class Xo extends Wo{constructor(t,e,n){super(void 0,t[0].width,t[0].height,e,n,M),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class Yo extends he{constructor(t,e,n,i,r,s,a,o,c){super(t,e,n,i,r,s,a,o,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Jo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let a,o=0,c=r-1;for(;o<=c;)if(i=Math.floor(o+(c-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){c=i;break}c=i-1}if(i=c,n[i]===s)return i/(r-1);const l=n[i];return(i+(s-l)/(n[i+1]-l))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=e||(s.isVector2?new zt:new me);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new me,i=[],r=[],s=[],a=new me,o=new qe;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new me)}r[0]=new me,s[0]=new me;let c=Number.MAX_VALUE;const l=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);l<=c&&(c=l,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),u<=c&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(i[e-1],i[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(Nt(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(Nt(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Ko extends Jo{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e=new zt){const n=e,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,i=c-this.aY;o=n*t-i*e+this.aX,c=n*e+i*t+this.aY}return n.set(o,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Zo extends Ko{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function $o(){let t=0,e=0,n=0,i=0;function r(r,s,a,o){t=r,e=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,a,o){let c=(e-t)/s-(n-t)/(s+a)+(n-e)/a,l=(n-e)/a-(i-e)/(a+o)+(i-n)/o;c*=a,l*=a,r(e,n,c,l)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}const tc=new me,ec=new $o,nc=new $o,ic=new $o;class rc extends Jo{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new me){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let a,o,c=Math.floor(s),l=s-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/r)+1)*r:0===l&&c===r-1&&(c=r-2,l=1),this.closed||c>0?a=i[(c-1)%r]:(tc.subVectors(i[0],i[1]).add(i[0]),a=tc);const h=i[c%r],u=i[(c+1)%r];if(this.closed||c+2<r?o=i[(c+2)%r]:(tc.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=tc),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(o),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),ec.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,e,n,i),nc.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,e,n,i),ic.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,e,n,i)}else"catmullrom"===this.curveType&&(ec.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),nc.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),ic.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return n.set(ec.calc(l),nc.calc(l),ic.calc(l)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new me).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function sc(t,e,n,i,r){const s=.5*(i-e),a=.5*(r-n),o=t*t;return(2*n-2*i+s+a)*(t*o)+(-3*n+3*i-2*s-a)*o+s*t+n}function ac(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function oc(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}class cc extends Jo{constructor(t=new zt,e=new zt,n=new zt,i=new zt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new zt){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(oc(t,i.x,r.x,s.x,a.x),oc(t,i.y,r.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class lc extends Jo{constructor(t=new me,e=new me,n=new me,i=new me){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new me){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(oc(t,i.x,r.x,s.x,a.x),oc(t,i.y,r.y,s.y,a.y),oc(t,i.z,r.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class hc extends Jo{constructor(t=new zt,e=new zt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new zt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new zt){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class uc extends Jo{constructor(t=new me,e=new me){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new me){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new me){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class dc extends Jo{constructor(t=new zt,e=new zt,n=new zt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new zt){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(ac(t,i.x,r.x,s.x),ac(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class pc extends Jo{constructor(t=new me,e=new me,n=new me){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new me){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(ac(t,i.x,r.x,s.x),ac(t,i.y,r.y,s.y),ac(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class fc extends Jo{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new zt){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],c=i[s],l=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(sc(a,o.x,c.x,l.x,h.x),sc(a,o.y,c.y,l.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new zt).fromArray(n))}return this}}var Ac=Object.freeze({__proto__:null,ArcCurve:Zo,CatmullRomCurve3:rc,CubicBezierCurve:cc,CubicBezierCurve3:lc,EllipseCurve:Ko,LineCurve:hc,LineCurve3:uc,QuadraticBezierCurve:dc,QuadraticBezierCurve3:pc,SplineCurve:fc});class gc extends Jo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ac[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const i=o[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Ac[n.type]).fromJSON(n))}return this}}class mc extends gc{constructor(t){super(),this.type="Path",this.currentPoint=new zt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new hc(this.currentPoint.clone(),new zt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new dc(this.currentPoint.clone(),new zt(t,e),new zt(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const a=new cc(this.currentPoint.clone(),new zt(t,e),new zt(n,i),new zt(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new fc(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,a,o){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,n,i,r,s,a,o),this}absellipse(t,e,n,i,r,s,a,o){const c=new Ko(t,e,n,i,r,s,a,o);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class bc extends ri{constructor(t=1,e=32,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],s=[],a=[],o=[],c=new me,l=new zt;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=n+r/e*i;c.x=t*Math.cos(u),c.y=t*Math.sin(u),s.push(c.x,c.y,c.z),a.push(0,0,1),l.x=(s[h]/t+1)/2,l.y=(s[h+1]/t+1)/2,o.push(l.x,l.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Jn(s,3)),this.setAttribute("normal",new Jn(a,3)),this.setAttribute("uv",new Jn(o,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new bc(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class vc extends ri{constructor(t=1,e=1,n=1,i=32,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const c=this;i=Math.floor(i),r=Math.floor(r);const l=[],h=[],u=[],d=[];let p=0;const f=[],A=n/2;let g=0;function m(n){const r=p,s=new zt,f=new me;let m=0;const b=!0===n?t:e,v=!0===n?1:-1;for(let t=1;t<=i;t++)h.push(0,A*v,0),u.push(0,v,0),d.push(.5,.5),p++;const y=p;for(let t=0;t<=i;t++){const e=t/i*o+a,n=Math.cos(e),r=Math.sin(e);f.x=b*r,f.y=A*v,f.z=b*n,h.push(f.x,f.y,f.z),u.push(0,v,0),s.x=.5*n+.5,s.y=.5*r*v+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=y+t;!0===n?l.push(i,i+1,e):l.push(i+1,i,e),m+=3}c.addGroup(g,m,!0===n?1:2),g+=m}!function(){const s=new me,m=new me;let b=0;const v=(e-t)/n;for(let c=0;c<=r;c++){const l=[],g=c/r,b=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*o+a,c=Math.sin(r),f=Math.cos(r);m.x=b*c,m.y=-g*n+A,m.z=b*f,h.push(m.x,m.y,m.z),s.set(c,v,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),l.push(p++)}f.push(l)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];l.push(n,i,s),l.push(i,r,s),b+=6}c.addGroup(g,b,0),g+=b}(),!1===s&&(t>0&&m(!0),e>0&&m(!1)),this.setIndex(l),this.setAttribute("position",new Jn(h,3)),this.setAttribute("normal",new Jn(u,3)),this.setAttribute("uv",new Jn(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vc(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class yc extends vc{constructor(t=1,e=1,n=32,i=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new yc(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class xc extends mc{constructor(t){super(t),this.uuid=Ft(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new mc).fromJSON(n))}return this}}const _c=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=Ec(t,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,c,l,h,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,a,o,c,l;for(s=0,a=e.length;s<a;s++)o=e[s]*i,c=s<a-1?e[s+1]*i:t.length,l=Ec(t,o,c,i,!1),l===l.next&&(l.steiner=!0),r.push(Lc(l));for(r.sort(Bc),s=0;s<r.length;s++)n=Rc(r[s],n);return n}(t,e,s,n)),t.length>80*n){o=l=t[0],c=h=t[1];for(let e=n;e<r;e+=n)u=t[e],d=t[e+1],u<o&&(o=u),d<c&&(c=d),u>l&&(l=u),d>h&&(h=d);p=Math.max(l-o,h-c),p=0!==p?32767/p:0}return Cc(s,a,n,o,c,p,0),a};function Ec(t,e,n,i,r){let s,a;if(r===function(t,e,n,i){let r=0;for(let s=e,a=n-i;s<n;s+=i)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)a=jc(s,t[s],t[s+1],a);else for(s=n-i;s>=e;s-=i)a=jc(s,t[s],t[s+1],a);return a&&kc(a,a.next)&&(Vc(a),a=a.next),a}function wc(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!kc(i,i.next)&&0!==Nc(i.prev,i,i.next))i=i.next;else{if(Vc(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function Cc(t,e,n,i,r,s,a){if(!t)return;!a&&s&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=Dc(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,a,o,c,l=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,i=n,o=0,e=0;e<l&&(o++,i=i.nextZ,i);e++);for(c=l;o>0||c>0&&i;)0!==o&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,c--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,l*=2}while(a>1)}(r)}(t,i,r,s);let o,c,l=t;for(;t.prev!==t.next;)if(o=t.prev,c=t.next,s?Mc(t,i,r,s):Sc(t))e.push(o.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),Vc(t),t=c.next,l=c.next;else if((t=c)===l){a?1===a?Cc(t=Ic(wc(t),e,n),e,n,i,r,s,2):2===a&&Tc(t,e,n,i,r,s):Cc(wc(t),e,n,i,r,s,1);break}}function Sc(t){const e=t.prev,n=t,i=t.next;if(Nc(e,n,i)>=0)return!1;const r=e.x,s=n.x,a=i.x,o=e.y,c=n.y,l=i.y,h=r<s?r<a?r:a:s<a?s:a,u=o<c?o<l?o:l:c<l?c:l,d=r>s?r>a?r:a:s>a?s:a,p=o>c?o>l?o:l:c>l?c:l;let f=i.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Uc(r,o,s,c,a,l,f.x,f.y)&&Nc(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Mc(t,e,n,i){const r=t.prev,s=t,a=t.next;if(Nc(r,s,a)>=0)return!1;const o=r.x,c=s.x,l=a.x,h=r.y,u=s.y,d=a.y,p=o<c?o<l?o:l:c<l?c:l,f=h<u?h<d?h:d:u<d?u:d,A=o>c?o>l?o:l:c>l?c:l,g=h>u?h>d?h:d:u>d?u:d,m=Dc(p,f,e,n,i),b=Dc(A,g,e,n,i);let v=t.prevZ,y=t.nextZ;for(;v&&v.z>=m&&y&&y.z<=b;){if(v.x>=p&&v.x<=A&&v.y>=f&&v.y<=g&&v!==r&&v!==a&&Uc(o,h,c,u,l,d,v.x,v.y)&&Nc(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,y.x>=p&&y.x<=A&&y.y>=f&&y.y<=g&&y!==r&&y!==a&&Uc(o,h,c,u,l,d,y.x,y.y)&&Nc(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;v&&v.z>=m;){if(v.x>=p&&v.x<=A&&v.y>=f&&v.y<=g&&v!==r&&v!==a&&Uc(o,h,c,u,l,d,v.x,v.y)&&Nc(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=b;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=g&&y!==r&&y!==a&&Uc(o,h,c,u,l,d,y.x,y.y)&&Nc(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function Ic(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!kc(r,s)&&Oc(r,i,i.next,s)&&Hc(r,s)&&Hc(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),Vc(i),Vc(i.next),i=t=s),i=i.next}while(i!==t);return wc(i)}function Tc(t,e,n,i,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Fc(a,t)){let o=zc(a,t);return a=wc(a,a.next),o=wc(o,o.next),Cc(a,e,n,i,r,s,0),void Cc(o,e,n,i,r,s,0)}t=t.next}a=a.next}while(a!==t)}function Bc(t,e){return t.x-e.x}function Rc(t,e){const n=function(t,e){let n,i=e,r=-1/0;const s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const t=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>r&&(r=t,n=i.x<i.next.x?i:i.next,t===s))return n}i=i.next}while(i!==e);if(!n)return null;const o=n,c=n.x,l=n.y;let h,u=1/0;i=n;do{s>=i.x&&i.x>=c&&s!==i.x&&Uc(a<l?s:r,a,c,l,a<l?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Hc(i,t)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Pc(n,i)))&&(n=i,u=h)),i=i.next}while(i!==o);return n}(t,e);if(!n)return e;const i=zc(n,t);return wc(i,i.next),wc(n,n.next)}function Pc(t,e){return Nc(t.prev,t,e.prev)<0&&Nc(e.next,t,t.next)<0}function Dc(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Lc(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Uc(t,e,n,i,r,s,a,o){return(r-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(n-a)*(e-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Fc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Oc(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Hc(t,e)&&Hc(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Nc(t.prev,t,e.prev)||Nc(t,e.prev,e))||kc(t,e)&&Nc(t.prev,t,t.next)>0&&Nc(e.prev,e,e.next)>0)}function Nc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function kc(t,e){return t.x===e.x&&t.y===e.y}function Oc(t,e,n,i){const r=Gc(Nc(t,e,n)),s=Gc(Nc(t,e,i)),a=Gc(Nc(n,i,t)),o=Gc(Nc(n,i,e));return r!==s&&a!==o||(!(0!==r||!Qc(t,n,e))||(!(0!==s||!Qc(t,i,e))||(!(0!==a||!Qc(n,t,i))||!(0!==o||!Qc(n,e,i)))))}function Qc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Gc(t){return t>0?1:t<0?-1:0}function Hc(t,e){return Nc(t.prev,t,t.next)<0?Nc(t,e,t.next)>=0&&Nc(t,t.prev,e)>=0:Nc(t,e,t.prev)<0||Nc(t,t.next,e)<0}function zc(t,e){const n=new Wc(t.i,t.x,t.y),i=new Wc(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function jc(t,e,n,i){const r=new Wc(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Vc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Wc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class qc{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return qc.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];Xc(t),Yc(n,t);let s=t.length;e.forEach(Xc);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,Yc(n,e[t]);const a=_c(n,i);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function Xc(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Yc(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class Jc extends ri{constructor(t=.5,e=1,n=32,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],o=[],c=[],l=[];let h=t;const u=(e-t)/(i=Math.max(1,i)),d=new me,p=new zt;for(let t=0;t<=i;t++){for(let t=0;t<=n;t++){const i=r+t/n*s;d.x=h*Math.cos(i),d.y=h*Math.sin(i),o.push(d.x,d.y,d.z),c.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,l.push(p.x,p.y)}h+=u}for(let t=0;t<i;t++){const e=t*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,s=i+n+1,o=i+n+2,c=i+1;a.push(r,s,c),a.push(s,o,c)}}this.setIndex(a),this.setAttribute("position",new Jn(o,3)),this.setAttribute("normal",new Jn(c,3)),this.setAttribute("uv",new Jn(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Jc(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Kc extends ri{constructor(t=new xc([new zt(0,.5),new zt(-.5,-.5),new zt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))c(t);else for(let e=0;e<t.length;e++)c(t[e]),this.addGroup(a,o,e),a+=o,o=0;function c(t){const a=i.length/3,c=t.extractPoints(e);let l=c.shape;const h=c.holes;!1===qc.isClockWise(l)&&(l=l.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===qc.isClockWise(e)&&(h[t]=e.reverse())}const u=qc.triangulateShape(l,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+a,r=e[1]+a,s=e[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new Jn(i,3)),this.setAttribute("normal",new Jn(r,3)),this.setAttribute("uv",new Jn(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new Kc(n,t.curveSegments)}}class Zc extends ri{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let c=0;const l=[],h=new me,u=new me,d=[],p=[],f=[],A=[];for(let d=0;d<=n;d++){const g=[],m=d/n;let b=0;0===d&&0===s?b=.5/e:d===n&&o===Math.PI&&(b=-.5/e);for(let n=0;n<=e;n++){const o=n/e;h.x=-t*Math.cos(i+o*r)*Math.sin(s+m*a),h.y=t*Math.cos(s+m*a),h.z=t*Math.sin(i+o*r)*Math.sin(s+m*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),A.push(o+b,1-m),g.push(c++)}l.push(g)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=l[t][i+1],r=l[t][i],a=l[t+1][i],c=l[t+1][i+1];(0!==t||s>0)&&d.push(e,r,c),(t!==n-1||o<Math.PI)&&d.push(r,a,c)}this.setIndex(d),this.setAttribute("position",new Jn(p,3)),this.setAttribute("normal",new Jn(f,3)),this.setAttribute("uv",new Jn(A,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Zc(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class $c extends ri{constructor(t=1,e=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],c=[],l=new me,h=new me,u=new me;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),a.push(h.x,h.y,h.z),l.x=t*Math.cos(p),l.y=t*Math.sin(p),u.subVectors(h,l).normalize(),o.push(u.x,u.y,u.z),c.push(d/i),c.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,a=(i+1)*(t-1)+e,o=(i+1)*t+e;s.push(n,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new Jn(a,3)),this.setAttribute("normal",new Jn(o,3)),this.setAttribute("uv",new Jn(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new $c(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class tl extends ri{constructor(t=new pc(new me(-1,-1,0),new me(-1,1,0),new me(1,1,0)),e=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new me,o=new me,c=new zt;let l=new me;const h=[],u=[],d=[],p=[];function f(r){l=t.getPointAt(r/e,l);const c=s.normals[r],d=s.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*c.x+r*d.x,o.y=s*c.y+r*d.y,o.z=s*c.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=l.x+n*o.x,a.y=l.y+n*o.y,a.z=l.z+n*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)c.x=t/e,c.y=n/i,d.push(c.x,c.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,a=(i+1)*(t-1)+e;p.push(n,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Jn(h,3)),this.setAttribute("normal",new Jn(u,3)),this.setAttribute("uv",new Jn(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new tl((new Ac[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class el extends Qn{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Nn(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class nl extends Qn{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Nn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new rn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class il extends nl{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new zt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Nt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Nn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Nn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Nn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class rl extends Qn{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Nn(16777215),this.specular=new Nn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new rn,this.combine=A,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class sl extends Qn{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Nn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class al extends Qn{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Nn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new rn,this.combine=A,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class ol extends Mo{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function cl(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function ll(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n}function hl(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[a++]=t[i+n]}return r}function ul(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(e.push(s.time),n.push.apply(n,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(e.push(s.time),a.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(e.push(s.time),n.push(a)),s=t[r++]}while(void 0!==s)}class dl{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const a=e[1];t<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class pl extends dl{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:dt,endingEnd:dt}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case pt:r=t,a=2*e-n;break;case ft:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case pt:s=t,o=2*n-e;break;case ft:s=1,o=n+i[1]-i[0];break;default:s=t-1,o=e}const c=.5*(n-e),l=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(o-n),this._offsetPrev=r*l,this._offsetNext=s*l}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,c=o-a,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,A=f*p,g=-u*A+2*u*f-u*p,m=(1+u)*A+(-1.5-2*u)*f+(-.5+u)*p+1,b=(-1-d)*A+(1.5+d)*f+.5*p,v=d*A-d*f;for(let t=0;t!==a;++t)r[t]=g*s[l+t]+m*s[c+t]+b*s[o+t]+v*s[h+t];return r}}class fl extends dl{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,c=o-a,l=(n-e)/(i-e),h=1-l;for(let t=0;t!==a;++t)r[t]=s[c+t]*h+s[o+t]*l;return r}}class Al extends dl{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class gl{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=cl(e,this.TimeBufferType),this.values=cl(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:cl(t.times,Array),values:cl(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Al(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new fl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new pl(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case lt:e=this.InterpolantFactoryMethodDiscrete;break;case ht:e=this.InterpolantFactoryMethodLinear;break;case ut:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return lt;case this.InterpolantFactoryMethodLinear:return ht;case this.InterpolantFactoryMethodSmooth:return ut}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&(a=i,ArrayBuffer.isView(a)&&!(a instanceof DataView)))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}var a;return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===ut,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(i)r=!0;else{const t=a*n,i=t-n,s=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[i+a]||n!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const i=a*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,a=0;a!==n;++a)e[i+a]=e[t+a];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}gl.prototype.TimeBufferType=Float32Array,gl.prototype.ValueBufferType=Float32Array,gl.prototype.DefaultInterpolation=ht;class ml extends gl{}ml.prototype.ValueTypeName="bool",ml.prototype.ValueBufferType=Array,ml.prototype.DefaultInterpolation=lt,ml.prototype.InterpolantFactoryMethodLinear=void 0,ml.prototype.InterpolantFactoryMethodSmooth=void 0;class bl extends gl{}bl.prototype.ValueTypeName="color";class vl extends gl{}vl.prototype.ValueTypeName="number";class yl extends dl{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-e)/(i-e);let c=t*a;for(let t=c+a;c!==t;c+=4)ge.slerpFlat(r,0,s,c-a,s,c,o);return r}}class xl extends gl{InterpolantFactoryMethodLinear(t){return new yl(this.times,this.values,this.getValueSize(),t)}}xl.prototype.ValueTypeName="quaternion",xl.prototype.DefaultInterpolation=ht,xl.prototype.InterpolantFactoryMethodSmooth=void 0;class _l extends gl{}_l.prototype.ValueTypeName="string",_l.prototype.ValueBufferType=Array,_l.prototype.DefaultInterpolation=lt,_l.prototype.InterpolantFactoryMethodLinear=void 0,_l.prototype.InterpolantFactoryMethodSmooth=void 0;class El extends gl{}El.prototype.ValueTypeName="vector";class wl{constructor(t="",e=-1,n=[],i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Ft(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(Cl(n[t]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(gl.toJSON(n[t]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const c=ll(a);a=hl(a,1,c),o=hl(o,1,c),i||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new vl(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(r);if(s&&s.length>1){const t=s[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const s=[];for(const t in i)s.push(this.CreateFromMorphTargetSequence(t,i[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],a=[];ul(n,s,a,i),0!==s.length&&r.push(new t(e,s,a))}},i=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const c=t.hierarchy||[];for(let t=0;t<c.length;t++){const r=c[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new vl(".morphTargetInfluence["+n+"]",t,s))}o=t.length*s}else{const s=".bones["+e[t].name+"]";n(El,s+".position",r,"pos",i),n(xl,s+".quaternion",r,"rot",i),n(El,s+".scale",r,"scl",i)}}if(0===i.length)return null;return new this(r,o,i,a)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Cl(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return vl;case"vector":case"vector2":case"vector3":case"vector4":return El;case"color":return bl;case"quaternion":return xl;case"bool":case"boolean":return ml;case"string":return _l}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];ul(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Sl={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Ml{constructor(t,e,n){const i=this;let r,s=!1,a=0,o=0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===s&&void 0!==i.onStart&&i.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=c.length;e<n;e+=2){const n=c[e],i=c[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const Il=new Ml;class Tl{constructor(t){this.manager=void 0!==t?t:Il,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Tl.DEFAULT_MATERIAL_NAME="__DEFAULT";const Bl={};class Rl extends Error{constructor(t,e){super(t),this.response=e}}class Pl extends Tl{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Sl.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==Bl[t])return void Bl[t].push({onLoad:e,onProgress:n,onError:i});Bl[t]=[],Bl[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=Bl[t],i=e.body.getReader(),r=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),s=r?parseInt(r):0,a=0!==s;let o=0;const c=new ReadableStream({start(t){!function e(){i.read().then((({done:i,value:r})=>{if(i)t.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}}))}()}});return new Response(c)}throw new Rl(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then((t=>i.decode(t)))}}})).then((e=>{Sl.add(t,e);const n=Bl[t];delete Bl[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const n=Bl[t];if(void 0===n)throw this.manager.itemError(t),e;delete Bl[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Dl extends Tl{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Sl.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=qt("img");function o(){l(),Sl.add(t,this),e&&e(this),r.manager.itemEnd(t)}function c(e){l(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function l(){a.removeEventListener("load",o,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",c,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class Ll extends Tl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Ja,a=new Pl(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,(function(t){let n;try{n=r.parse(t)}catch(t){if(void 0===i)return void console.error(t);i(t)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:D,s.wrapT=void 0!==n.wrapT?n.wrapT:D,s.magFilter=void 0!==n.magFilter?n.magFilter:N,s.minFilter=void 0!==n.minFilter?n.minFilter:N,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(s.colorSpace=n.colorSpace),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=O),1===n.mipmapCount&&(s.minFilter=N),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n)}),n,i),s}}class Ul extends Tl{constructor(t){super(t)}load(t,e,n,i){const r=new he,s=new Dl(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}class Fl extends xn{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Nn(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}const Nl=new qe,kl=new me,Ol=new me;class Ql{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new zt(512,512),this.map=null,this.mapPass=null,this.matrix=new qe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Vi,this._frameExtents=new zt(1,1),this._viewportCount=1,this._viewports=[new ue(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;kl.setFromMatrixPosition(t.matrixWorld),e.position.copy(kl),Ol.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Ol),e.updateMatrixWorld(),Nl.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Nl),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Nl)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Gl extends Ql{constructor(){super(new Li(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*Ut*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Hl extends Fl{constructor(t,e,n=0,i=Math.PI/3,r=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(xn.DEFAULT_UP),this.updateMatrix(),this.target=new xn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new Gl}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const zl=new qe,jl=new me,Vl=new me;class Wl extends Ql{constructor(){super(new Li(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new zt(4,2),this._viewportCount=6,this._viewports=[new ue(2,1,1,1),new ue(0,1,1,1),new ue(3,1,1,1),new ue(1,1,1,1),new ue(3,0,1,1),new ue(1,0,1,1)],this._cubeDirections=[new me(1,0,0),new me(-1,0,0),new me(0,0,1),new me(0,0,-1),new me(0,1,0),new me(0,-1,0)],this._cubeUps=[new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,0,1),new me(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),jl.setFromMatrixPosition(t.matrixWorld),n.position.copy(jl),Vl.copy(n.position),Vl.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Vl),n.updateMatrixWorld(),i.makeTranslation(-jl.x,-jl.y,-jl.z),zl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zl)}}class ql extends Fl{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Wl}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Xl extends Ql{constructor(){super(new or(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Yl extends Fl{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(xn.DEFAULT_UP),this.updateMatrix(),this.target=new xn,this.shadow=new Xl}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Jl extends Fl{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Kl{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Zl extends ri{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class $l extends Tl{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Sl.get(t);if(void 0!==s)return r.manager.itemStart(t),s.then?void s.then((n=>{e&&e(n),r.manager.itemEnd(t)})).catch((t=>{i&&i(t)})):(setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const o=fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){return Sl.add(t,n),e&&e(n),r.manager.itemEnd(t),n})).catch((function(e){i&&i(e),Sl.remove(t),r.manager.itemError(t),r.manager.itemEnd(t)}));Sl.add(t,o),r.manager.itemStart(t)}}let th;class eh{static getContext(){return void 0===th&&(th=new(window.AudioContext||window.webkitAudioContext)),th}static setContext(t){th=t}}class nh{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ih(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=ih();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function ih(){return("undefined"==typeof performance?Date:performance).now()}const rh=new me,sh=new ge,ah=new me,oh=new me;class ch extends xn{constructor(){super(),this.type="AudioListener",this.context=eh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new nh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(rh,sh,ah),oh.set(0,0,-1).applyQuaternion(sh),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(rh.x,t),e.positionY.linearRampToValueAtTime(rh.y,t),e.positionZ.linearRampToValueAtTime(rh.z,t),e.forwardX.linearRampToValueAtTime(oh.x,t),e.forwardY.linearRampToValueAtTime(oh.y,t),e.forwardZ.linearRampToValueAtTime(oh.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(rh.x,rh.y,rh.z),e.setOrientation(oh.x,oh.y,oh.z,n.x,n.y,n.z)}}class lh extends xn{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const hh=new me,uh=new ge,dh=new me,ph=new me;class fh extends lh{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(hh,uh,dh),ph.set(0,0,1).applyQuaternion(uh);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(hh.x,t),e.positionY.linearRampToValueAtTime(hh.y,t),e.positionZ.linearRampToValueAtTime(hh.z,t),e.orientationX.linearRampToValueAtTime(ph.x,t),e.orientationY.linearRampToValueAtTime(ph.y,t),e.orientationZ.linearRampToValueAtTime(ph.z,t)}else e.setPosition(hh.x,hh.y,hh.z),e.setOrientation(ph.x,ph.y,ph.z)}}class Ah{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){a.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]}_slerp(t,e,n,i){ge.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;ge.multiplyQuaternionsFlat(t,s,t,e,t,n),ge.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[n+a]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const gh="\\[\\]\\.:\\/",mh=new RegExp("["+gh+"]","g"),bh="[^"+gh+"]",vh="[^"+gh.replace("\\.","")+"]",yh=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",bh)+/(WCOD+)?/.source.replace("WCOD",vh)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bh)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bh)+"$"),xh=["material","materials","bones","map"];class _h{constructor(t,e,n){this.path=e,this.parsedPath=n||_h.parseTrackName(e),this.node=_h.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new _h.Composite(t,e,n):new _h(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(mh,"")}static parseTrackName(t){const e=yh.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==xh.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=_h.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}_h.Composite=class{constructor(t,e,n){const i=n||_h.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},_h.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},_h.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},_h.prototype.GetterByBindingType=[_h.prototype._getValue_direct,_h.prototype._getValue_array,_h.prototype._getValue_arrayElement,_h.prototype._getValue_toArray],_h.prototype.SetterByBindingTypeAndVersioning=[[_h.prototype._setValue_direct,_h.prototype._setValue_direct_setNeedsUpdate,_h.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[_h.prototype._setValue_array,_h.prototype._setValue_array_setNeedsUpdate,_h.prototype._setValue_array_setMatrixWorldNeedsUpdate],[_h.prototype._setValue_arrayElement,_h.prototype._setValue_arrayElement_setNeedsUpdate,_h.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[_h.prototype._setValue_fromArray,_h.prototype._setValue_fromArray_setNeedsUpdate,_h.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Eh{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:dt,endingEnd:dt};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,c=a.sampleValues;return o[0]=r,o[1]=r+n,c[0]=t/s,c[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;i<0||0===n?e=0:(this._startTime=null,e=n*i)}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(a);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r?i:s&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=pt,i.endingEnd=pt):(i.endingStart=t?this.zeroSlopeAtStart?pt:dt:ft,i.endingEnd=e?this.zeroSlopeAtEnd?pt:dt:ft)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=n,this}}const wh=new Float32Array(1);class Ch extends Rt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,a=t._interpolants,o=n.uuid,c=this._bindingsByRootAndName;let l=c[o];void 0===l&&(l={},c[o]=l);for(let t=0;t!==r;++t){const r=i[t],c=r.name;let h=l[c];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,c));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;h=new Ah(_h.create(n,c,i),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,c),s[t]=h}a[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,c=o[o.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,o[l]=c,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=e[e.length-1],c=t._cacheIndex;o._cacheIndex=c,e[c]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new fl(new Float32Array(2),new Float32Array(2),1,wh),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?wl.findByName(i,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let c=null;if(void 0===n&&(n=null!==s?s.blendMode:At),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;c=o.knownActions[0],null===s&&(s=c._clip)}if(null===s)return null;const l=new Eh(this,s,e,n);return this._bindAction(l,c),this._addInactiveAction(l,a,r),l}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?wl.findByName(n,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==n;++a){e[a]._update(i,t,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}const Sh=new qe;class Mh{constructor(t,e,n=0,i=1/0){this.ray=new We(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new sn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Sh.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Sh),this}intersectObject(t,e=!0,n=[]){return Th(t,this,n,e),n.sort(Ih),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)Th(t[i],this,n,e);return n.sort(Ih),n}}function Ih(t,e){return t.distance-e.distance}function Th(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)Th(i[t],e,n,!0)}}class Bh{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Nt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const Rh=new me,Ph=new me;class Dh{constructor(t=new me,e=new me){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Rh.subVectors(t,this.start),Ph.subVectors(this.end,this.start);const n=Ph.dot(Ph);let i=Ph.dot(Rh)/n;return e&&(i=Nt(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Lh=new me;class Uh extends xn{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new ri,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const r=t/n*Math.PI*2,s=e/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new Jn(i,3));const r=new Mo({fog:!1,toneMapped:!1});this.cone=new Fo(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Lh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Lh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}class Fh extends Fo{constructor(t=10,e=10,n=4473924,i=8947848){n=new Nn(n),i=new Nn(i);const r=e/2,s=t/e,a=t/2,o=[],c=[];for(let t=0,l=0,h=-a;t<=e;t++,h+=s){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const e=t===r?n:i;e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3}const l=new ri;l.setAttribute("position",new Jn(o,3)),l.setAttribute("color",new Jn(c,3));super(l,new Mo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Nh extends Fo{constructor(t=10,e=16,n=8,i=64,r=4473924,s=8947848){r=new Nn(r),s=new Nn(s);const a=[],o=[];if(e>1)for(let n=0;n<e;n++){const i=n/e*(2*Math.PI),c=Math.sin(i)*t,l=Math.cos(i)*t;a.push(0,0,0),a.push(c,0,l);const h=1&n?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let e=0;e<n;e++){const c=1&e?r:s,l=t-t/n*e;for(let t=0;t<i;t++){let e=t/i*(2*Math.PI),n=Math.sin(e)*l,r=Math.cos(e)*l;a.push(n,0,r),o.push(c.r,c.g,c.b),e=(t+1)/i*(2*Math.PI),n=Math.sin(e)*l,r=Math.cos(e)*l,a.push(n,0,r),o.push(c.r,c.g,c.b)}}const c=new ri;c.setAttribute("position",new Jn(a,3)),c.setAttribute("color",new Jn(o,3));super(c,new Mo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const kh=new me,Oh=new Bi;class Qh extends Fo{constructor(t){const e=new ri,n=new Mo({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(t,e){o(t),o(e)}function o(t){i.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new Jn(i,3)),e.setAttribute("color",new Jn(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const c=new Nn(16755200),l=new Nn(16711680),h=new Nn(43775),u=new Nn(16777215),d=new Nn(3355443);this.setColors(c,l,h,u,d)}setColors(t,e,n,i,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;Oh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Gh("c",e,t,Oh,0,0,-1),Gh("t",e,t,Oh,0,0,1),Gh("n1",e,t,Oh,-1,-1,-1),Gh("n2",e,t,Oh,1,-1,-1),Gh("n3",e,t,Oh,-1,1,-1),Gh("n4",e,t,Oh,1,1,-1),Gh("f1",e,t,Oh,-1,-1,1),Gh("f2",e,t,Oh,1,-1,1),Gh("f3",e,t,Oh,-1,1,1),Gh("f4",e,t,Oh,1,1,1),Gh("u1",e,t,Oh,.7,1.1,-1),Gh("u2",e,t,Oh,-.7,1.1,-1),Gh("u3",e,t,Oh,0,2,-1),Gh("cf1",e,t,Oh,-1,0,1),Gh("cf2",e,t,Oh,1,0,1),Gh("cf3",e,t,Oh,0,-1,1),Gh("cf4",e,t,Oh,0,1,1),Gh("cn1",e,t,Oh,-1,0,-1),Gh("cn2",e,t,Oh,1,0,-1),Gh("cn3",e,t,Oh,0,-1,-1),Gh("cn4",e,t,Oh,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Gh(t,e,n,i,r,s,a){kh.set(r,s,a).unproject(i);const o=e[t];if(void 0!==o){const t=n.getAttribute("position");for(let e=0,n=o.length;e<n;e++)t.setXYZ(o[e],kh.x,kh.y,kh.z)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t);var Hh=Object.freeze({__proto__:null,Box3:ye,BufferAttribute:qn,BufferGeometry:ri,Euler:rn,Group:wa,InstancedBufferAttribute:to,InstancedBufferGeometry:Zl,InstancedMesh:co,Line:Do,LineBasicMaterial:Mo,Matrix3:jt,Matrix4:qe,Mesh:_i,MeshBasicMaterial:Gn,MeshDepthMaterial:ma,MeshPhongMaterial:rl,MeshStandardMaterial:nl,Object3D:xn,OrthographicCamera:or,Quaternion:ge,Sphere:ke,Vector2:zt,Vector3:me,WebGLRenderTarget:pe,WebGLRenderer:Da});const zh=new me;function jh(t,e,n,i,r,s){const a=2*Math.PI*r/4,o=Math.max(s-2*r,0),c=Math.PI/4;zh.copy(e),zh[i]=0,zh.normalize();const l=.5*a/(a+o),h=1-zh.angleTo(t)/c;if(1===Math.sign(zh[n]))return h*l;return o/(a+o)+l+l*(1-h)}class Vh extends wi{constructor(t=1,e=1,n=1,i=2,r=.1){if(i=2*i+1,r=Math.min(t/2,e/2,n/2,r),super(1,1,1,i,i,i),1===i)return;const s=this.toNonIndexed();this.index=null,this.attributes.position=s.attributes.position,this.attributes.normal=s.attributes.normal,this.attributes.uv=s.attributes.uv;const a=new me,o=new me,c=new me(t,e,n).divideScalar(2).subScalar(r),l=this.attributes.position.array,h=this.attributes.normal.array,u=this.attributes.uv.array,d=l.length/6,p=new me,f=.5/i;for(let i=0,s=0;i<l.length;i+=3,s+=2){a.fromArray(l,i),o.copy(a),o.x-=Math.sign(o.x)*f,o.y-=Math.sign(o.y)*f,o.z-=Math.sign(o.z)*f,o.normalize(),l[i+0]=c.x*Math.sign(a.x)+o.x*r,l[i+1]=c.y*Math.sign(a.y)+o.y*r,l[i+2]=c.z*Math.sign(a.z)+o.z*r,h[i+0]=o.x,h[i+1]=o.y,h[i+2]=o.z;switch(Math.floor(i/d)){case 0:p.set(1,0,0),u[s+0]=jh(p,o,"z","y",r,n),u[s+1]=1-jh(p,o,"y","z",r,e);break;case 1:p.set(-1,0,0),u[s+0]=1-jh(p,o,"z","y",r,n),u[s+1]=1-jh(p,o,"y","z",r,e);break;case 2:p.set(0,1,0),u[s+0]=1-jh(p,o,"x","z",r,t),u[s+1]=jh(p,o,"z","x",r,n);break;case 3:p.set(0,-1,0),u[s+0]=1-jh(p,o,"x","z",r,t),u[s+1]=1-jh(p,o,"z","x",r,n);break;case 4:p.set(0,0,1),u[s+0]=1-jh(p,o,"x","y",r,t),u[s+1]=1-jh(p,o,"y","x",r,e);break;case 5:p.set(0,0,-1),u[s+0]=jh(p,o,"x","y",r,t),u[s+1]=1-jh(p,o,"y","x",r,e)}}}}class Wh extends _i{constructor(t,e,n,i=128){if(e<=0||n<=0||i<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const r=new Zc(n,2*i,i);r.scale(1,1,-1);const s=r.getAttribute("position"),a=new me;for(let t=0;t<s.count;++t)if(a.fromBufferAttribute(s,t),a.y<0){const n=3*-e/2,i=a.y<n?-e/a.y:1-a.y*a.y/(3*n*n);a.multiplyScalar(i),a.toArray(s.array,3*t)}s.needsUpdate=!0,super(r,new Gn({map:t,depthWrite:!1}))}}var qh=Object.freeze({__proto__:null,ACESFilmicToneMapping:4,AddEquation:100,AddOperation:2,AdditiveAnimationBlendMode:2501,AdditiveBlending:2,AgXToneMapping:6,AlphaFormat:1021,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AttachedBindMode:"attached",BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,ByteType:1010,CineonToneMapping:3,ClampToEdgeWrapping:1001,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeReflectionMapping:301,CubeRefractionMapping:302,CubeUVReflectionMapping:306,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,CustomBlending:5,CustomToneMapping:5,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DepthFormat:1026,DepthStencilFormat:1027,DetachedBindMode:"detached",DisplayP3ColorSpace:"display-p3",DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,FloatType:1015,FrontSide:0,GLSL1:"100",GLSL3:"300 es",GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,HalfFloatType:1016,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,IntType:1013,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,InvertStencilOp:5386,KeepStencilOp:7680,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,LinearDisplayP3ColorSpace:"display-p3-linear",LinearFilter:1006,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:1008,LinearMipmapNearestFilter:1007,LinearSRGBColorSpace:"srgb-linear",LinearToneMapping:1,LinearTransfer:"linear",LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},MaxEquation:104,MinEquation:103,MirroredRepeatWrapping:1002,MixOperation:1,MultiplyBlending:4,MultiplyOperation:0,NearestFilter:1003,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:1005,NearestMipmapNearestFilter:1004,NeutralToneMapping:7,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:"",NoToneMapping:0,NormalAnimationBlendMode:2500,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,ObjectSpaceNormalMap:1,OneFactor:201,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:205,OneMinusSrcColorFactor:203,P3Primaries:"p3",PCFShadowMap:1,PCFSoftShadowMap:2,RED_GREEN_RGTC2_Format:36285,RED_RGTC1_Format:36283,REVISION:"163",RGBADepthPacking:3201,RGBAFormat:1023,RGBAIntegerFormat:1033,RGBA_ASTC_10x10_Format:37819,RGBA_ASTC_10x5_Format:37816,RGBA_ASTC_10x6_Format:37817,RGBA_ASTC_10x8_Format:37818,RGBA_ASTC_12x10_Format:37820,RGBA_ASTC_12x12_Format:37821,RGBA_ASTC_4x4_Format:37808,RGBA_ASTC_5x4_Format:37809,RGBA_ASTC_5x5_Format:37810,RGBA_ASTC_6x5_Format:37811,RGBA_ASTC_6x6_Format:37812,RGBA_ASTC_8x5_Format:37813,RGBA_ASTC_8x6_Format:37814,RGBA_ASTC_8x8_Format:37815,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_2BPPV1_Format:35843,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT1_Format:33777,RGBA_S3TC_DXT3_Format:33778,RGBA_S3TC_DXT5_Format:33779,RGBFormat:1022,RGB_BPTC_SIGNED_Format:36494,RGB_BPTC_UNSIGNED_Format:36495,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_2BPPV1_Format:35841,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776,RGFormat:1030,RGIntegerFormat:1031,Rec709Primaries:"rec709",RedFormat:1028,RedIntegerFormat:1029,ReinhardToneMapping:2,RepeatWrapping:1e3,ReplaceStencilOp:7681,ReverseSubtractEquation:102,SIGNED_RED_GREEN_RGTC2_Format:36286,SIGNED_RED_RGTC1_Format:36284,SRGBColorSpace:"srgb",SRGBTransfer:"srgb",ShortType:1011,SrcAlphaFactor:204,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:35044,StaticReadUsage:35045,StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,SubtractEquation:101,SubtractiveBlending:3,TOUCH:{ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},TangentSpaceNormalMap:0,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,UVMapping:300,UnsignedByteType:1009,UnsignedInt248Type:1020,UnsignedInt5999Type:35902,UnsignedIntType:1014,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedShortType:1012,VSMShadowMap:3,WebGLCoordinateSystem:2e3,WebGPUCoordinateSystem:2001,WrapAroundEnding:2402,ZeroCurvatureEnding:2400,ZeroFactor:200,ZeroSlopeEnding:2401,ZeroStencilOp:0});function Xh(t,e,n){return(e.dot(t)-e.dot(n))/e.length()}function Yh(t){try{return new URL(t,window.location.href).pathname.split("/").pop()}catch(t){return""}}class Jh extends CustomEvent{constructor(...t){super(...t)}}function Kh(t,e){for(const n of t)if(n===e)return!0}function Zh(t){return`<${t.tagName.toLowerCase()+(t.className?"."+t.className.split(" ").join("."):"")+(t.id?"#"+t.id:"")}>`}const $h=new Set,tu=t=>{$h.has(t)||($h.add(t),console.warn(t))};function eu(t){return 1-(1-t)**3}function nu(t,e,n){return(1-n)*t+n*e}const iu=(t={})=>new Map(Object.entries(Object.assign({mixins:[]},t))),ru=(t,...e)=>String.raw({raw:t},...e);class su{#t=new WeakMap;#e=new Set;#n=new FinalizationRegistry(su.#i);static#i({set:t,ref:e}){t.delete(e)}constructor(t=[]){for(const[e,n]of t)this.set(e,n)}set(t,e){this.#t.has(t)&&this.delete(t);const n=new WeakRef(t);this.#t.set(t,{value:e,ref:n}),this.#e.add(n),this.#n.register(t,{set:this.#e,ref:n},n)}has(t){const e=this.#t.get(t);return!(!e||void 0===e.value)}get(t){const e=this.#t.get(t);return e&&e.value}getKeysFromValue(t){return[...this].filter((([,e])=>e===t)).map((([t])=>t))}delete(t){const e=this.#t.get(t);return!!e&&(this.#t.delete(t),this.#e.delete(e.ref),this.#n.unregister(e.ref),!0)}*[Symbol.iterator](){for(const t of this.#e){const e=t.deref();if(!e)continue;const{value:n}=this.#t.get(e);yield[e,n]}}entries(){return this[Symbol.iterator]()}*keys(){for(const[t,e]of this)yield t}*values(){for(const[t,e]of this)yield e}}const au=new DOMParser;function ou(t,e){const n=e.split(/,(?=[^\]]*(?:\[|$))/);let i=!1;for(const e of n){if(e.includes("::part")){const n=e.match(/([^\s]*)::part\((.*)\)/);n&&(i=i||t.getRootNode()?.host?.matches(n[1]||"*")&&t.matches(`[part~="${n[2].trim()}"]`))}else i=i||t.matches(e);if(i)break}return i}function cu(t,e){const n=[];var i=function(t,e,n=[]){const i=e.split(/,(?=[^\]]*(?:\[|$))/),r=[];for(const e of i)if(e.includes("::part")){const i=e.match(/([^\s]*)::part\((.*)\)/);if(i)for(const e of t.querySelectorAll(i[1]||"*"))n.push(e),r.push(...hu(e,i[2].trim()))}else r.push(...t.querySelectorAll(e));return r}(t,e,n),r=new MutationObserver((function(t){t.forEach((function(t){if(Array.prototype.forEach.call(t.addedNodes,(function(t){t.nodeType===Node.ELEMENT_NODE&&ou(t,e)&&i.push(t)})),Array.prototype.forEach.call(t.removedNodes,(function(t){const e=i.indexOf(t);-1!==e&&i.splice(e,1)})),"attributes"===t.type){const n=t.target,r=ou(n,e),s=i.indexOf(n);r&&-1===s&&i.push(n),r||-1===s||i.splice(s,1)}}))}));for(const t of n)customElements.upgrade(t),t.shadowRoot&&r.observe(t.shadowRoot,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","part","id"]});return r.observe(t,{childList:!0,subtree:!0}),i.dispose=function(){r.disconnect()},i.__query=e,i}const lu=new Map;function hu(t,e,n=[]){if(!t.shadowRoot)return n;const i=e.split(/\s+/),r=i.map((t=>`[part~="${t}"]`)).join(""),s=i.map((t=>`[exportparts~="${t}"]`)).join("");n.push(...t.shadowRoot.querySelectorAll(r));const a=t.shadowRoot.querySelectorAll(s);if(a)for(const t of a)hu(t,e,n);return n}function uu(t,e){var n=Array.prototype.slice.call(t.querySelectorAll(e)),i=new MutationObserver((function(t){t.forEach((function(t){[].forEach.call(t.addedNodes,(function(t){t.nodeType===Node.ELEMENT_NODE&&t.matches(e)&&n.push(t)})),[].forEach.call(t.removedNodes,(function(t){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}))}));return i.observe(t,{childList:!0,subtree:!0}),n.dispose=function(){i.disconnect()},n}const du=(t,e,n)=>Math.min(Math.max(t,e),n);function pu(t,e,n){const i=t.deref();if(!i){const t=n.deref();t&&(console.log(`${e} on ${Zh(Zh(this))} references a cleaned up element.`),t.attributeChangedCallback(e,t.attributes.getNamedItem(e)||"",null))}return i}const fu=new WeakMap;function Au(t,e,n){if(fu.has(t))return fu.get(t);const i=Zh(t),r=new WeakRef(t),s=new Proxy({el:r,get original(){return r.deref()?.object}},{get(t,s){const a=pu(r,e,n);if(!a)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);if(!a.object)throw Error("Element.object is undefined");return Reflect.get(a.object,s)},set(t,s,a){const o=pu(r,e,n);if(!o)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);if(!o.object)throw Error("Element.object is undefined");return Reflect.set(o.object,s,a)},defineProperty(t,s,a){const o=pu(r,e,n);if(!o)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);if(!o.object)throw Error("Element.object is undefined");return Reflect.defineProperty(o.object,s,a)},deleteProperty(t,s){const a=pu(r,e,n);if(!a)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);if(!a.object)throw Error("Element.object is undefined");return Reflect.deleteProperty(a.object,s)},has(t,s){const a=pu(r,e,n);if(!a)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);if(!a.object)throw Error("Element.object is undefined");return Reflect.deleteProperty(a.object,s)},isExtensible(){const t=pu(r,e,n);if(!t)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);return Reflect.isExtensible(t.object)},getPrototypeOf(){const t=pu(r,e,n);if(!t)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);return Reflect.getPrototypeOf(t.object)},setPrototypeOf(t,s){const a=pu(r,e,n);if(!a)throw Error(`Element ${i} used as ${e} has been garbage collected, make sure you unassign it first.`);return Reflect.setPrototypeOf(a.object,s)}});return fu.set(t,s),s}const gu={Texture:he,Material:Qn,BufferGeometry:ri,Object:Object,Object3D:xn,Camera:Bi,Mesh:_i,Scene:Ua,WebGLRenderer:Da,InstancedMesh:co},mu=/\s+/,bu=new WeakMap,vu=t=>class extends t{static name="SchemaTypeParsing";stringToValue(t,e){bu.has(this)||bu.set(this,{});const n=bu.get(this);if(void 0===e)throw Error("parse attribute error given value is undefined");const i=this.constructor.getSchemaEntry(t),r=i.type||typeof i.default,s=i.as||t;if("string"==typeof e&&(e=e.trim()),i.map){const t=i.map[e];e=void 0===t?e:t}let a=e;if("string"==typeof a&&"string"!==r)if("Class"===r)a=document.getElementsByClassName(e);else if("Element"===r){let n=null;try{n=this.getRootNode().querySelector(e)||document.querySelector(e)}catch(t){}n&&(a=n,n.isShortHandElement&&n.onAssign(t,new WeakRef(this)),this.objectAssigned(t,n))}else if("Elements"===r){let n=null;try{n=cu(document,e)}catch(t){}if(n){a=n;for(const e of n)e.isShortHandElement&&e.onAssign(t,new WeakRef(this)),this.objectAssigned(t,e)}}else if("angle"===r){const t=window.parseFloat(a);isNaN(t)||(a=t*Math.PI/180)}else{if(0===e.indexOf("THREE.")){const t=e.substring(6);a=qh[t]}else if("Color"===r){const t=n[s]=n[s]||new Nn;t.set(e),a=t}else if("boolean"===r)a="false"!==e.toLowerCase();else if("number"===r)a=parseFloat(e);else if("percentage"===r)a=.01*parseFloat(e);else if("boolean[]"===r)a=""===e?[]:e.split(mu).map((t=>"false"!==t.toLowerCase()));else if("number[]"===r)a=""===e?[]:e.split(mu).map((t=>parseFloat(t)));else if("string[]"===r)a=""===e?[]:e.split(mu);else if("Map<string,number>"===r){a=new Map;for(const t of e.split(",")){const e=t.trim().split(mu);e.length>=2&&a.set(e[0],parseFloat(e[1]))}}else if("Vector2"===r){const t=n[s]=n[s]||new zt,i=e.split(mu);2===i.length&&t.fromArray(i.map((t=>parseFloat(t)))),a=t}else if("Vector3"===r){const t=n[s]=n[s]||new me,i=e.split(mu);3===i.length&&t.fromArray(i.map((t=>parseFloat(t)))),a=t}else if("Quaternion"===r){const t=n[s]=n[s]||new ge,i=e.split(mu);4===i.length&&t.fromArray(i.map((t=>parseFloat(t)))),a=t}else if("Euler"===r){const t=n[s]=n[s]||new rn,i=e.split(mu);3===i.length&&t.fromArray(i.map((t=>parseFloat(t)*Ht.DEG2RAD))),a=t}else{let n=!1,i=r,s="querySelector",o=!1;"[]"===r.slice(-2)&&(n=!0,i=r.slice(0,-2),s="querySelectorAll"),"[]?"===r.slice(-3)&&(n=!0,i=r.slice(0,-3),s="querySelectorAll",o=!0),a=async function(){let c=a,l=null,h=!1;if(!e.includes("/")&&"#"!==e&&"."!==e&&!e.includes("-gradient(")&&!e.includes("path(")){const t=e.split("::"),i=this.getRootNode();let r;try{i&&(r=i[s](t[0])),(!r||n&&0===r.length)&&(r=document[s](t[0]))}catch(t){console.warn(t)}if(!n&&r&&window.customElements.upgrade(r),n)for(const t of r)window.customElements.upgrade(t);if(1===t.length)l=n?Array.from(r):r;else if(!n&&r&&r.isShortHandElement){await r.object;const e=t[1].match(/(part)\((.+)\)/);if(e&&"part"===e[1]&&e[2]){l=hu(r,e[2])[0]||null}}else if(n&&r.length){l=[];for(const e of r){if(!e.isShortHandElement)continue;await e.object;const n=t[1].match(/(part)\((.+)\)/);if(n&&"part"===n[1]&&n[2]){const t=hu(e,n[2]);l=l.push(...t)}}}else l=null;h=!0}if(!n&&l){const n=l;if("url"===r)n.src&&(c=n),c=e;else{const e=await n.object;if(!gu[r])throw Error(`Unrecognised type in parser "${r}"`);if(e instanceof gu[r]){const e=new WeakRef(this);c=n.object?n.constructor.canProxy?Au(n,t,e):n.object:n,n.isShortHandElement&&n.onAssign(t,e),this.objectAssigned(t,n)}else console.warn(`${t} was expecting a ${r} but instead received:`,e)}}else if(h&&n&&l.length){c=[];const e=i;for(const n of l){const i=await n.object;if(!gu[e])throw Error(`Unrecognised type in parser ${e}`);if(i instanceof gu[e]){const e=new WeakRef(this);c.push(n.object?n.constructor.canProxy?Au(n,t,e):n.object:n),n.isShortHandElement&&n.onAssign(t,e),this.objectAssigned(t,n)}else console.warn(`${t} was expecting a ${e} but instead received:`,i)}o&&1===c.length&&(c=c[0])}else h&&console.warn("No element matches selector: "+e);return"string"==typeof c&&"string"!==r&&"url"!==r&&(c=void 0),c}.bind(this)()}}return"string"==typeof a&&"string"!==r&&"url"!==r&&(a=void 0),a}},yu="Documentation stripped from the minified library.";class xu extends EventTarget{renderer;async setRenderer(t){this.renderer=t,(await t.deref().object).xr.setFoveation(this.#r)}session=null;constructor({domOverlay:t,referenceSpaceType:e="local-floor",optionalFeatures:n=[],requiredFeatures:i=[]}){super(),this.optionalFeatures=n,this.requiredFeatures=i,this.referenceSpaceType=e,this.requiredFeatures.push(e),this.domOverlay=t}#r=1;set foveation(t){if(this.#r=t,!this.renderer)return;this.renderer.deref().object.xr.setFoveation(t)}get foveation(){if(!this.renderer)return this.#r;return this.renderer.deref().object.xr.getFoveation()}addOptionalFeature(t){this.optionalFeatures.push(t)}addRequiredFeature(t){this.requiredFeatures.push(t)}async enterVR(){return this.#s("immersive-vr")}async enterAR(){return this.#s("immersive-ar")}async enterInlineXR(){return this.#s("inline")}async#s(t){if(!navigator.xr)throw"WebXR is not avaialble in this browser.";if(this.session)throw Error("Already in session");const e=await navigator.xr.requestSession(t,this);e.addEventListener("end",function t(n){e.removeEventListener("end",t),this.dispatchEvent(new Jh(n.type,{detail:n})),this.session=null}.bind(this));const n=this.renderer.deref().object.xr;n.setReferenceSpaceType(this.referenceSpaceType),await n.setSession(e),this.baseReferenceSpace=await e.requestReferenceSpace(this.referenceSpaceType),n.setReferenceSpace(this.baseReferenceSpace),this.el.setSession(e);const i={optional:this.optionalFeatures,required:this.requiredFeatures,enabled:e.enabledFeatures};this.dispatchEvent(new Jh("sessionstart",{detail:{type:t,session:e,features:i}})),console.log("session started",i)}endXRSession(){this.session&&this.session.end(),this.session=null,this.el.session=null,this.baseReferenceSpace=null}}Object.assign(gu,{SHWebXRSessionConfig:xu});let _u=yu;const Eu=document.createElement("template");Eu.innerHTML=ru`
  <style>
    :host {
      display: none;
    }
  </style>

  <slot></slot>
`;const wu="XRSession",Cu=xu;var Su=Object.freeze({__proto__:null,SHWebXRSessionConfig:xu,mixin:t=>class extends t{static shortHandSchema=new Map([["dom-overlay",{as:"domOverlay",type:"Element"}],["reference-space",{as:"referenceSpaceType",type:"string[]",example:"local-floor",notes:"other useful values might be: local and bounded-floor, see https://developer.mozilla.org/en-US/docs/Web/API/XRReferenceSpace"}],["optional-features",{as:"optionalFeatures",type:"string[]",example:"hand-tracking"}],["required-features",{as:"requiredFeatures",type:"string[]"}],["foveation",{default:1}]]);static shortHandEventDescriptions={sessionstart:"Fired a WebXR session starts.",end:"Fired when a session ends."};static name=wu;static template=Eu;static documentation=_u;#a;constructor(){super(),this.detectXR()}async connectedCallback(){this.getRootNode().addEventListener("click",(t=>{"enter-vr"===t.target.dataset.action&&this.enterVR(),"enter-ar"===t.target.dataset.action&&this.enterAR(),"enter-inline"===t.target.dataset.action&&this.enterInlineXR(),"end-xr"===t.target.dataset.action&&this.endXR()})),await super.connectedCallback()}async enterVR(){const t=await this.object;await t.enterVR(),this.classList.add("in-vr")}async enterAR(){const t=await this.object;await t.enterAR(),this.classList.add("in-ar")}async enterInlineXR(){const t=await this.object;await t.enterInlineXR(),this.classList.add("in-inline-xr")}async endXR(){(await this.object).endXRSession(),this.classList.remove("in-vr"),this.classList.remove("in-ar"),this.classList.remove("in-inline-xr")}setSession(t){this.session=t,this.object.session=t,t.addEventListener("end",(()=>{this.object.session=null,this.endXR(this),this.emit("end")}),{once:!0});for(const e of["select","selectstart","selectend","squeeze","squeezeend","squeezestart","inputsourceschange"])t.addEventListener(e,(t=>{const e=new CustomEvent(t.type,{detail:t});this.object.dispatchEvent(e),this.dispatchEvent(e),this.#a.deref().dispatchEvent(e)}));super.setSession&&super.setSession(t),this.emit("sessionstart",{session:t})}async onAssign(t,e){super.onAssign(t,e),this.#a=e,(await this.object).setRenderer(e)}async detectXR(){navigator.xr&&(await navigator.xr.isSessionSupported("immersive-vr")&&this.classList.add("vr-supported"),await navigator.xr.isSessionSupported("immersive-ar")&&this.classList.add("ar-supported"),await navigator.xr.isSessionSupported("inline")&&this.classList.add("inline-xr-supported"))}async allAttributesChangedCallback(){await super.allAttributesChangedCallback(),this.object.addEventListener("end",this.endXR.bind(this))}},name:wu,type:Cu});function Mu(){var t=Object.create(null);function e(i,r){var s=i.id,a=i.name,o=i.dependencies;void 0===o&&(o=[]);var c=i.init;void 0===c&&(c=function(){});var l=i.getTransferables;if(void 0===l&&(l=null),!t[s])try{o=o.map((function(n){return n&&n.isWorkerModule&&(e(n,(function(t){if(t instanceof Error)throw t})),n=t[n.id].value),n})),c=n("<"+a+">.init",c),l&&(l=n("<"+a+">.getTransferables",l));var h=null;"function"==typeof c?h=c.apply(void 0,o):console.error("worker module init function failed to rehydrate"),t[s]={id:s,value:h,getTransferables:l},r(h)}catch(t){t&&t.noLog||console.error(t),r(t)}}function n(t,e){var n=void 0;self.troikaDefine=function(t){return n=t};var i=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+e+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(t){console.error(t)}return URL.revokeObjectURL(i),delete self.troikaDefine,n}self.addEventListener("message",(function(n){var i=n.data,r=i.messageId,s=i.action,a=i.data;try{"registerModule"===s&&e(a,(function(t){t instanceof Error?postMessage({messageId:r,success:!1,error:t.message}):postMessage({messageId:r,success:!0,result:{isCallable:"function"==typeof t}})})),"callModule"===s&&function(e,n){var i,r=e.id,s=e.args;t[r]&&"function"==typeof t[r].value||n(new Error("Worker module "+r+": not found or its 'init' did not return a function"));try{var a=(i=t[r]).value.apply(i,s);a&&"function"==typeof a.then?a.then(o,(function(t){return n(t instanceof Error?t:new Error(""+t))})):o(a)}catch(t){n(t)}function o(e){try{var i=t[r].getTransferables&&t[r].getTransferables(e);i&&Array.isArray(i)&&i.length||(i=void 0),n(e,i)}catch(t){console.error(t),n(t)}}}(a,(function(t,e){t instanceof Error?postMessage({messageId:r,success:!1,error:t.message}):postMessage({messageId:r,success:!0,result:t},e||void 0)}))}catch(t){postMessage({messageId:r,success:!1,error:t.stack})}}))}var Iu=function(){var t=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),t=!0}catch(t){"undefined"!=typeof process&&"test"===process.env.NODE_ENV||console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return Iu=function(){return t},t},Tu=0,Bu=0,Ru=!1,Pu=Object.create(null),Du=Object.create(null),Lu=Object.create(null);function Uu(t){if(!(t&&"function"==typeof t.init||Ru))throw new Error("requires `options.init` function");var e=t.dependencies,n=t.init,i=t.getTransferables,r=t.workerId;if(!Iu())return function(t){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then((function(e){if("function"==typeof e)return e.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return e._getInitResult=function(){var n=t.dependencies,i=t.init;n=Array.isArray(n)?n.map((function(t){return t&&t._getInitResult?t._getInitResult():t})):[];var r=Promise.all(n).then((function(t){return i.apply(null,t)}));return e._getInitResult=function(){return r},r},e}(t);null==r&&(r="#default");var s="workerModule"+ ++Tu,a=t.name||s,o=null;function c(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(!o){o=Nu(r,"registerModule",c.workerModuleData);var n=function(){o=null,Du[r].delete(n)};(Du[r]||(Du[r]=new Set)).add(n)}return o.then((function(e){if(e.isCallable)return Nu(r,"callModule",{id:s,args:t});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return e=e&&e.map((function(t){return"function"!=typeof t||t.workerModuleData||(Ru=!0,t=Uu({workerId:r,name:"<"+a+"> function dependency: "+t.name,init:"function(){return (\n"+Fu(t)+"\n)}"}),Ru=!1),t&&t.workerModuleData&&(t=t.workerModuleData),t})),c.workerModuleData={isWorkerModule:!0,id:s,name:a,dependencies:e,init:Fu(n),getTransferables:i&&Fu(i)},c}function Fu(t){var e=t.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function Nu(t,e,n){return new Promise((function(i,r){var s=++Bu;Lu[s]=function(t){t.success?i(t.result):r(new Error("Error in worker "+e+" call: "+t.error))},function(t){var e=Pu[t];if(!e){var n=Fu(Mu);(e=Pu[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(t){var e=t.data,n=e.messageId,i=Lu[n];if(!i)throw new Error("WorkerModule response with empty or unknown messageId");delete Lu[n],i(e)}}return e}(t).postMessage({messageId:s,action:e,data:n})}))}function ku(){var t=function(t){function e(t,e,n,i,r,s,a,o){var c=1-a;o.x=c*c*t+2*c*a*n+a*a*r,o.y=c*c*e+2*c*a*i+a*a*s}function n(t,e,n,i,r,s,a,o,c,l){var h=1-c;l.x=h*h*h*t+3*h*h*c*n+3*h*c*c*r+c*c*c*a,l.y=h*h*h*e+3*h*h*c*i+3*h*c*c*s+c*c*c*o}function i(t,e){for(var n,i,r,s,a,o=/([MLQCZ])([^MLQCZ]*)/g;n=o.exec(t);){var c=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(t){return parseFloat(t)}));switch(n[1]){case"M":s=i=c[0],a=r=c[1];break;case"L":c[0]===s&&c[1]===a||e("L",s,a,s=c[0],a=c[1]);break;case"Q":e("Q",s,a,s=c[2],a=c[3],c[0],c[1]);break;case"C":e("C",s,a,s=c[4],a=c[5],c[0],c[1],c[2],c[3]);break;case"Z":s===i&&a===r||e("L",s,a,i,r)}}}function r(t,r,s){void 0===s&&(s=16);var a={x:0,y:0};i(t,(function(t,i,o,c,l,h,u,d,p){switch(t){case"L":r(i,o,c,l);break;case"Q":for(var f=i,A=o,g=1;g<s;g++)e(i,o,h,u,c,l,g/(s-1),a),r(f,A,a.x,a.y),f=a.x,A=a.y;break;case"C":for(var m=i,b=o,v=1;v<s;v++)n(i,o,h,u,d,p,c,l,v/(s-1),a),r(m,b,a.x,a.y),m=a.x,b=a.y}}))}var s="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",o=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(t,e){var n=t.getContext?t.getContext("webgl",c):t,i=o.get(n);if(!i){var r="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,s={},a={},l={},h=-1,u=[];function d(t){var e=s[t];if(!e&&!(e=s[t]=n.getExtension(t)))throw new Error(t+" not supported");return e}function p(t,e){var i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}function f(){s={},a={},l={},h=-1,u.length=0}n.canvas.addEventListener("webglcontextlost",(function(t){f(),t.preventDefault()}),!1),o.set(n,i={gl:n,isWebGL2:r,getExtension:d,withProgram:function(t,e,i,s){if(!a[t]){var o={},c={},l=n.createProgram();n.attachShader(l,p(e,n.VERTEX_SHADER)),n.attachShader(l,p(i,n.FRAGMENT_SHADER)),n.linkProgram(l),a[t]={program:l,transaction:function(t){n.useProgram(l),t({setUniform:function(t,e){for(var i=[],r=arguments.length-2;r-- >0;)i[r]=arguments[r+2];var s=c[e]||(c[e]=n.getUniformLocation(l,e));n["uniform"+t].apply(n,[s].concat(i))},setAttribute:function(t,e,i,s,a){var c=o[t];c||(c=o[t]={buf:n.createBuffer(),loc:n.getAttribLocation(l,t),data:null}),n.bindBuffer(n.ARRAY_BUFFER,c.buf),n.vertexAttribPointer(c.loc,e,n.FLOAT,!1,0,0),n.enableVertexAttribArray(c.loc),r?n.vertexAttribDivisor(c.loc,s):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c.loc,s),a!==c.data&&(n.bufferData(n.ARRAY_BUFFER,a,i),c.data=a)}})}}}a[t].transaction(s)},withTexture:function(t,e){h++;try{n.activeTexture(n.TEXTURE0+h);var i=l[t];i||(i=l[t]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,i),e(i,h)}finally{h--}},withTextureFramebuffer:function(t,e,i){var r=n.createFramebuffer();u.push(r),n.bindFramebuffer(n.FRAMEBUFFER,r),n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);try{i(r)}finally{n.deleteFramebuffer(r),n.bindFramebuffer(n.FRAMEBUFFER,u[--u.length-1]||null)}},handleContextLoss:f})}e(i)}function h(t,e,n,i,r,o,c,h){void 0===c&&(c=15),void 0===h&&(h=null),l(t,(function(t){var l=t.gl,u=t.withProgram;(0,t.withTexture)("copy",(function(t,d){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,r,o,0,l.RGBA,l.UNSIGNED_BYTE,e),u("copy",s,a,(function(t){var e=t.setUniform;(0,t.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),e("1i","image",d),l.bindFramebuffer(l.FRAMEBUFFER,h||null),l.disable(l.BLEND),l.colorMask(8&c,4&c,2&c,1&c),l.viewport(n,i,r,o),l.scissor(n,i,r,o),l.drawArrays(l.TRIANGLES,0,3)}))}))}))}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:h,resizeWebGLCanvasWithoutClearing:function(t,e,n){var i=t.width,r=t.height;l(t,(function(s){var a=s.gl,o=new Uint8Array(i*r*4);a.readPixels(0,0,i,r,a.RGBA,a.UNSIGNED_BYTE,o),t.width=e,t.height=n,h(a,o,0,0,i,r)}))}});function d(t,e,n,i,s,a){void 0===a&&(a=1);var o=new Uint8Array(t*e),c=i[2]-i[0],l=i[3]-i[1],h=[];r(n,(function(t,e,n,i){h.push({x1:t,y1:e,x2:n,y2:i,minX:Math.min(t,n),minY:Math.min(e,i),maxX:Math.max(t,n),maxY:Math.max(e,i)})})),h.sort((function(t,e){return t.maxX-e.maxX}));for(var u=0;u<t;u++)for(var d=0;d<e;d++){var p=g(i[0]+c*(u+.5)/t,i[1]+l*(d+.5)/e),f=Math.pow(1-Math.abs(p)/s,a)/2;p<0&&(f=1-f),f=Math.max(0,Math.min(255,Math.round(255*f))),o[d*t+u]=f}return o;function g(t,e){for(var n=1/0,i=1/0,r=h.length;r--;){var s=h[r];if(s.maxX+i<=t)break;if(t+i>s.minX&&e-i<s.maxY&&e+i>s.minY){var a=A(t,e,s.x1,s.y1,s.x2,s.y2);a<n&&(n=a,i=Math.sqrt(n))}}return function(t,e){for(var n=0,i=h.length;i--;){var r=h[i];if(r.maxX<=t)break;r.y1>e!=r.y2>e&&t<(r.x2-r.x1)*(e-r.y1)/(r.y2-r.y1)+r.x1&&(n+=r.y1<r.y2?1:-1)}return 0!==n}(t,e)&&(i=-i),i}}function p(t,e,n,i,r,s,a,o,c,l){void 0===s&&(s=1),void 0===o&&(o=0),void 0===c&&(c=0),void 0===l&&(l=0),f(t,e,n,i,r,s,a,null,o,c,l)}function f(t,e,n,i,r,s,a,o,c,l,u){void 0===s&&(s=1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0);for(var p=d(t,e,n,i,r,s),f=new Uint8Array(4*p.length),A=0;A<p.length;A++)f[4*A+u]=p[A];h(a,f,c,l,t,e,1<<3-u,o)}function A(t,e,n,i,r,s){var a=r-n,o=s-i,c=a*a+o*o,l=c?Math.max(0,Math.min(1,((t-n)*a+(e-i)*o)/c)):0,h=t-(n+l*a),u=e-(i+l*o);return h*h+u*u}var g=Object.freeze({__proto__:null,generate:d,generateIntoCanvas:p,generateIntoFramebuffer:f}),m="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",v="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",y=new Float32Array([0,0,2,0,0,2]),x=null,_=!1,E={},w=new WeakMap;function C(t){if(!_&&!T(t))throw new Error("WebGL generation not supported")}function S(t,e,n,i,r,s,a){if(void 0===s&&(s=1),void 0===a&&(a=null),!a&&!(a=x)){var o="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!o)throw new Error("OffscreenCanvas or DOM canvas not supported");a=x=o.getContext("webgl",{depth:!1})}C(a);var c=new Uint8Array(t*e*4);l(a,(function(a){var o=a.gl,l=a.withTexture,h=a.withTextureFramebuffer;l("readable",(function(a,l){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,e,0,o.RGBA,o.UNSIGNED_BYTE,null),h(a,l,(function(a){I(t,e,n,i,r,s,o,a,0,0,0),o.readPixels(0,0,t,e,o.RGBA,o.UNSIGNED_BYTE,c)}))}))}));for(var h=new Uint8Array(t*e),u=0,d=0;u<c.length;u+=4)h[d++]=c[u];return h}function M(t,e,n,i,r,s,a,o,c,l){void 0===s&&(s=1),void 0===o&&(o=0),void 0===c&&(c=0),void 0===l&&(l=0),I(t,e,n,i,r,s,a,null,o,c,l)}function I(t,e,n,i,a,o,c,h,u,d,p){void 0===o&&(o=1),void 0===u&&(u=0),void 0===d&&(d=0),void 0===p&&(p=0),C(c);var f=[];r(n,(function(t,e,n,i){f.push(t,e,n,i)})),f=new Float32Array(f),l(c,(function(n){var r=n.gl,c=n.isWebGL2,l=n.getExtension,A=n.withProgram,g=n.withTexture,x=n.withTextureFramebuffer,_=n.handleContextLoss;if(g("rawDistances",(function(n,g){t===n._lastWidth&&e===n._lastHeight||r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n._lastWidth=t,n._lastHeight=e,0,r.RGBA,r.UNSIGNED_BYTE,null),A("main",m,b,(function(s){var h=s.setAttribute,u=s.setUniform,d=!c&&l("ANGLE_instanced_arrays"),p=!c&&l("EXT_blend_minmax");h("aUV",2,r.STATIC_DRAW,0,y),h("aLineSegment",4,r.DYNAMIC_DRAW,1,f),u.apply(void 0,["4f","uGlyphBounds"].concat(i)),u("1f","uMaxDistance",a),u("1f","uExponent",o),x(n,g,(function(n){r.enable(r.BLEND),r.colorMask(!0,!0,!0,!0),r.viewport(0,0,t,e),r.scissor(0,0,t,e),r.blendFunc(r.ONE,r.ONE),r.blendEquationSeparate(r.FUNC_ADD,c?r.MAX:p.MAX_EXT),r.clear(r.COLOR_BUFFER_BIT),c?r.drawArraysInstanced(r.TRIANGLES,0,3,f.length/4):d.drawArraysInstancedANGLE(r.TRIANGLES,0,3,f.length/4)}))})),A("post",s,v,(function(n){n.setAttribute("aUV",2,r.STATIC_DRAW,0,y),n.setUniform("1i","tex",g),r.bindFramebuffer(r.FRAMEBUFFER,h),r.disable(r.BLEND),r.colorMask(0===p,1===p,2===p,3===p),r.viewport(u,d,t,e),r.scissor(u,d,t,e),r.drawArrays(r.TRIANGLES,0,3)}))})),r.isContextLost())throw _(),new Error("webgl context lost")}))}function T(t){var e=t&&t!==x?t.canvas||t:E,n=w.get(e);if(void 0===n){_=!0;var i=null;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],s=S(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,t);n=s&&r.length===s.length&&s.every((function(t,e){return t===r[e]})),n||(i="bad trial run results",console.info(r,s))}catch(t){n=!1,i=t.message}i&&console.warn("WebGL SDF generation not supported:",i),_=!1,w.set(e,n)}return n}var B=Object.freeze({__proto__:null,generate:S,generateIntoCanvas:M,generateIntoFramebuffer:I,isSupported:T});return t.forEachPathCommand=i,t.generate=function(t,e,n,i,r,s){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===s&&(s=1);try{return S.apply(B,arguments)}catch(t){return console.info("WebGL SDF generation failed, falling back to JS",t),d.apply(g,arguments)}},t.generateIntoCanvas=function(t,e,n,i,r,s,a,o,c,l){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===s&&(s=1),void 0===o&&(o=0),void 0===c&&(c=0),void 0===l&&(l=0);try{return M.apply(B,arguments)}catch(t){return console.info("WebGL SDF generation failed, falling back to JS",t),p.apply(g,arguments)}},t.javascript=g,t.pathToLineSegments=r,t.webgl=B,t.webglUtils=u,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return t}const Ou=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Qu(t){return t.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(t,e){let n=Yi[e];return n?Qu(n):t}))}const Gu=[];for(let t=0;t<256;t++)Gu[t]=(t<16?"0":"")+t.toString(16);const Hu=Object.assign||function(){let t=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let n=arguments[e];if(n)for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},zu=Date.now(),ju=new WeakMap,Vu=new Map;let Wu=1e10;function qu(t,e){const n=function(t){const e=JSON.stringify(t,Yu);let n=Ku.get(e);null==n&&Ku.set(e,n=++Ju);return n}
/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/(e);let i=ju.get(t);if(i||ju.set(t,i=Object.create(null)),i[n])return new i[n];const r=`_onBeforeCompile${n}`,s=function(i,s){t.onBeforeCompile.call(this,i,s);const a=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let o=Vu[a];if(!o){const t=function(t,{vertexShader:e,fragmentShader:n},i,r){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:c,fragmentDefs:l,fragmentMainIntro:h,fragmentMainOutro:u,fragmentColorTransform:d,customRewriter:p,timeUniform:f}=i;s=s||"",a=a||"",o=o||"",l=l||"",h=h||"",u=u||"",(c||p)&&(e=Qu(e));(d||p)&&(n=Qu(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(p){let t=p({vertexShader:e,fragmentShader:n});e=t.vertexShader,n=t.fragmentShader}if(d){let t=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(e=>(t.push(e),""))),u=`${d}\n${t.join("\n")}\n${u}`}if(f){const t=`\nuniform float ${f};\n`;s=t+s,l=t+l}c&&(s=`${s}\nvoid troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${c}\n}\n`,a=`\ntroika_position_${r} = vec3(position);\ntroika_normal_${r} = vec3(normal);\ntroika_uv_${r} = vec2(uv);\ntroikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});\n${a}\n`,e=(e=`vec3 troika_position_${r};\nvec3 troika_normal_${r};\nvec2 troika_uv_${r};\n${e}\n`).replace(/\b(position|normal|uv)\b/g,((t,e,n,i)=>/\battribute\s+vec[23]\s+$/.test(i.substr(0,n))?e:`troika_${e}_${r}`)),t.map&&t.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${r}`)));return e=Xu(e,r,s,a,o),n=Xu(n,r,l,h,u),{vertexShader:e,fragmentShader:n}}(this,i,e,n);o=Vu[a]=t}i.vertexShader=o.vertexShader,i.fragmentShader=o.fragmentShader,Hu(i.uniforms,this.uniforms),e.timeUniform&&(i.uniforms[e.timeUniform]={get value(){return Date.now()-zu}}),this[r]&&this[r](i)},a=function(){return o(e.chained?t:t.clone())},o=function(i){const r=Object.create(i,c);return Object.defineProperty(r,"baseMaterial",{value:t}),Object.defineProperty(r,"id",{value:Wu++}),r.uuid=function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Gu[255&t]+Gu[t>>8&255]+Gu[t>>16&255]+Gu[t>>24&255]+"-"+Gu[255&e]+Gu[e>>8&255]+"-"+Gu[e>>16&15|64]+Gu[e>>24&255]+"-"+Gu[63&n|128]+Gu[n>>8&255]+"-"+Gu[n>>16&255]+Gu[n>>24&255]+Gu[255&i]+Gu[i>>8&255]+Gu[i>>16&255]+Gu[i>>24&255]).toUpperCase()}(),r.uniforms=Hu({},i.uniforms,e.uniforms),r.defines=Hu({},i.defines,e.defines),r.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",r.extensions=Hu({},i.extensions,e.extensions),r._listeners=void 0,r},c={constructor:{value:a},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>s,set(t){this[r]=t}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(Hu(this.extensions,e.extensions),Hu(this.defines,e.defines),Hu(this.uniforms,Ii.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const e=new t.constructor;return o(e).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=qu(t.isDerivedMaterial?t.getDepthMaterial():new ma({depthPacking:gt}),e),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=qu(t.isDerivedMaterial?t.getDistanceMaterial():new ba,e),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:e,_distanceMaterial:n}=this;e&&e.dispose(),n&&n.dispose(),t.dispose.call(this)}}};return i[n]=a,new a}function Xu(t,e,n,i,r){return(i||r||n)&&(t=t.replace(Ou,`\n${n}\nvoid troikaOrigMain${e}() {`),t+=`\nvoid main() {\n  ${i}\n  troikaOrigMain${e}();\n  ${r}\n}`),t}function Yu(t,e){return"uniforms"===t?void 0:"function"==typeof e?e.toString():e}let Ju=0;const Ku=new Map;const Zu=Uu({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(t){var e={parse:function(t){var n=e._bin,i=new Uint8Array(t);if("ttcf"==n.readASCII(i,0,4)){var r=4;n.readUshort(i,r),r+=2,n.readUshort(i,r),r+=2;var s=n.readUint(i,r);r+=4;for(var a=[],o=0;o<s;o++){var c=n.readUint(i,r);r+=4,a.push(e._readFont(i,c))}return a}return[e._readFont(i,0)]},_readFont:function(t,n){var i=e._bin,r=n;i.readFixed(t,n),n+=4;var s=i.readUshort(t,n);n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],o={_data:t,_offset:r},c={},l=0;l<s;l++){var h=i.readASCII(t,n,4);n+=4,i.readUint(t,n),n+=4;var u=i.readUint(t,n);n+=4;var d=i.readUint(t,n);n+=4,c[h]={offset:u,length:d}}for(l=0;l<a.length;l++){var p=a[l];c[p]&&(o[p.trim()]=e[p.trim()].parse(t,c[p].offset,c[p].length,o))}return o},_tabOffset:function(t,n,i){for(var r=e._bin,s=r.readUshort(t,i+4),a=i+12,o=0;o<s;o++){var c=r.readASCII(t,a,4);a+=4,r.readUint(t,a),a+=4;var l=r.readUint(t,a);if(a+=4,r.readUint(t,a),a+=4,c==n)return l}return 0}};e._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,n){return e._bin.readShort(t,n)/16384},readInt:function(t,n){return e._bin._view(t).getInt32(n)},readInt8:function(t,n){return e._bin._view(t).getInt8(n)},readShort:function(t,n){return e._bin._view(t).getInt16(n)},readUshort:function(t,n){return e._bin._view(t).getUint16(n)},readUshorts:function(t,n,i){for(var r=[],s=0;s<i;s++)r.push(e._bin.readUshort(t,n+2*s));return r},readUint:function(t,n){return e._bin._view(t).getUint32(n)},readUint64:function(t,n){return 4294967296*e._bin.readUint(t,n)+e._bin.readUint(t,n+4)},readASCII:function(t,e,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(t[e+r]);return i},readUnicode:function(t,e,n){for(var i="",r=0;r<n;r++){var s=t[e++]<<8|t[e++];i+=String.fromCharCode(s)}return i},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,n,i){var r=e._bin._tdec;return r&&0==n&&i==t.length?r.decode(t):e._bin.readASCII(t,n,i)},readBytes:function(t,e,n){for(var i=[],r=0;r<n;r++)i.push(t[e+r]);return i},readASCIIArray:function(t,e,n){for(var i=[],r=0;r<n;r++)i.push(String.fromCharCode(t[e+r]));return i},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},e._lctf={},e._lctf.parse=function(t,n,i,r,s){var a=e._bin,o={},c=n;a.readFixed(t,n),n+=4;var l=a.readUshort(t,n);n+=2;var h=a.readUshort(t,n);n+=2;var u=a.readUshort(t,n);return n+=2,o.scriptList=e._lctf.readScriptList(t,c+l),o.featureList=e._lctf.readFeatureList(t,c+h),o.lookupList=e._lctf.readLookupList(t,c+u,s),o},e._lctf.readLookupList=function(t,n,i){var r=e._bin,s=n,a=[],o=r.readUshort(t,n);n+=2;for(var c=0;c<o;c++){var l=r.readUshort(t,n);n+=2;var h=e._lctf.readLookupTable(t,s+l,i);a.push(h)}return a},e._lctf.readLookupTable=function(t,n,i){var r=e._bin,s=n,a={tabs:[]};a.ltype=r.readUshort(t,n),n+=2,a.flag=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2;for(var c=a.ltype,l=0;l<o;l++){var h=r.readUshort(t,n);n+=2;var u=i(t,c,s+h,a);a.tabs.push(u)}return a},e._lctf.numOfOnes=function(t){for(var e=0,n=0;n<32;n++)0!=(t>>>n&1)&&e++;return e},e._lctf.readClassDef=function(t,n){var i=e._bin,r=[],s=i.readUshort(t,n);if(n+=2,1==s){var a=i.readUshort(t,n);n+=2;var o=i.readUshort(t,n);n+=2;for(var c=0;c<o;c++)r.push(a+c),r.push(a+c),r.push(i.readUshort(t,n)),n+=2}if(2==s){var l=i.readUshort(t,n);for(n+=2,c=0;c<l;c++)r.push(i.readUshort(t,n)),n+=2,r.push(i.readUshort(t,n)),n+=2,r.push(i.readUshort(t,n)),n+=2}return r},e._lctf.getInterval=function(t,e){for(var n=0;n<t.length;n+=3){var i=t[n],r=t[n+1];if(t[n+2],i<=e&&e<=r)return n}return-1},e._lctf.readCoverage=function(t,n){var i=e._bin,r={};r.fmt=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);return n+=2,1==r.fmt&&(r.tab=i.readUshorts(t,n,s)),2==r.fmt&&(r.tab=i.readUshorts(t,n,3*s)),r},e._lctf.coverageIndex=function(t,n){var i=t.tab;if(1==t.fmt)return i.indexOf(n);if(2==t.fmt){var r=e._lctf.getInterval(i,n);if(-1!=r)return i[r+2]+(n-i[r])}return-1},e._lctf.readFeatureList=function(t,n){var i=e._bin,r=n,s=[],a=i.readUshort(t,n);n+=2;for(var o=0;o<a;o++){var c=i.readASCII(t,n,4);n+=4;var l=i.readUshort(t,n);n+=2;var h=e._lctf.readFeatureTable(t,r+l);h.tag=c.trim(),s.push(h)}return s},e._lctf.readFeatureTable=function(t,n){var i=e._bin,r=n,s={},a=i.readUshort(t,n);n+=2,a>0&&(s.featureParams=r+a);var o=i.readUshort(t,n);n+=2,s.tab=[];for(var c=0;c<o;c++)s.tab.push(i.readUshort(t,n+2*c));return s},e._lctf.readScriptList=function(t,n){var i=e._bin,r=n,s={},a=i.readUshort(t,n);n+=2;for(var o=0;o<a;o++){var c=i.readASCII(t,n,4);n+=4;var l=i.readUshort(t,n);n+=2,s[c.trim()]=e._lctf.readScriptTable(t,r+l)}return s},e._lctf.readScriptTable=function(t,n){var i=e._bin,r=n,s={},a=i.readUshort(t,n);n+=2,a>0&&(s.default=e._lctf.readLangSysTable(t,r+a));var o=i.readUshort(t,n);n+=2;for(var c=0;c<o;c++){var l=i.readASCII(t,n,4);n+=4;var h=i.readUshort(t,n);n+=2,s[l.trim()]=e._lctf.readLangSysTable(t,r+h)}return s},e._lctf.readLangSysTable=function(t,n){var i=e._bin,r={};i.readUshort(t,n),n+=2,r.reqFeature=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);return n+=2,r.features=i.readUshorts(t,n,s),r},e.CFF={},e.CFF.parse=function(t,n,i){var r=e._bin;(t=new Uint8Array(t.buffer,n,i))[n=0],t[++n],t[++n],t[++n],n++;var s=[];n=e.CFF.readIndex(t,n,s);for(var a=[],o=0;o<s.length-1;o++)a.push(r.readASCII(t,n+s[o],s[o+1]-s[o]));n+=s[s.length-1];var c=[];n=e.CFF.readIndex(t,n,c);var l=[];for(o=0;o<c.length-1;o++)l.push(e.CFF.readDict(t,n+c[o],n+c[o+1]));n+=c[c.length-1];var h=l[0],u=[];n=e.CFF.readIndex(t,n,u);var d=[];for(o=0;o<u.length-1;o++)d.push(r.readASCII(t,n+u[o],u[o+1]-u[o]));if(n+=u[u.length-1],e.CFF.readSubrs(t,n,h),h.CharStrings){n=h.CharStrings,u=[],n=e.CFF.readIndex(t,n,u);var p=[];for(o=0;o<u.length-1;o++)p.push(r.readBytes(t,n+u[o],u[o+1]-u[o]));h.CharStrings=p}if(h.ROS){n=h.FDArray;var f=[];for(n=e.CFF.readIndex(t,n,f),h.FDArray=[],o=0;o<f.length-1;o++){var A=e.CFF.readDict(t,n+f[o],n+f[o+1]);e.CFF._readFDict(t,A,d),h.FDArray.push(A)}n+=f[f.length-1],n=h.FDSelect,h.FDSelect=[];var g=t[n];if(n++,3!=g)throw g;var m=r.readUshort(t,n);for(n+=2,o=0;o<m+1;o++)h.FDSelect.push(r.readUshort(t,n),t[n+2]),n+=3}return h.Encoding&&(h.Encoding=e.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=e.CFF.readCharset(t,h.charset,h.CharStrings.length)),e.CFF._readFDict(t,h,d),h},e.CFF._readFDict=function(t,n,i){var r;for(var s in n.Private&&(r=n.Private[1],n.Private=e.CFF.readDict(t,r,r+n.Private[0]),n.Private.Subrs&&e.CFF.readSubrs(t,r+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(s)&&(n[s]=i[n[s]-426+35])},e.CFF.readSubrs=function(t,n,i){var r=e._bin,s=[];n=e.CFF.readIndex(t,n,s);var a,o=s.length;a=o<1240?107:o<33900?1131:32768,i.Bias=a,i.Subrs=[];for(var c=0;c<s.length-1;c++)i.Subrs.push(r.readBytes(t,n+s[c],s[c+1]-s[c]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(t,e){for(var n=0;n<t.charset.length;n++)if(t.charset[n]==e)return n;return-1},e.CFF.glyphBySE=function(t,n){return n<0||n>255?-1:e.CFF.glyphByUnicode(t,e.CFF.tableSE[n])},e.CFF.readEncoding=function(t,n,i){e._bin;var r=[".notdef"],s=t[n];if(n++,0!=s)throw"error: unknown encoding format: "+s;var a=t[n];n++;for(var o=0;o<a;o++)r.push(t[n+o]);return r},e.CFF.readCharset=function(t,n,i){var r=e._bin,s=[".notdef"],a=t[n];if(n++,0==a)for(var o=0;o<i;o++){var c=r.readUshort(t,n);n+=2,s.push(c)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;s.length<i;){c=r.readUshort(t,n),n+=2;var l=0;for(1==a?(l=t[n],n++):(l=r.readUshort(t,n),n+=2),o=0;o<=l;o++)s.push(c),c++}}return s},e.CFF.readIndex=function(t,n,i){var r=e._bin,s=r.readUshort(t,n)+1,a=t[n+=2];if(n++,1==a)for(var o=0;o<s;o++)i.push(t[n+o]);else if(2==a)for(o=0;o<s;o++)i.push(r.readUshort(t,n+2*o));else if(3==a)for(o=0;o<s;o++)i.push(16777215&r.readUint(t,n+3*o-1));else if(1!=s)throw"unsupported offset size: "+a+", count: "+s;return(n+=s*a)-1},e.CFF.getCharString=function(t,n,i){var r=e._bin,s=t[n],a=t[n+1];t[n+2],t[n+3],t[n+4];var o=1,c=null,l=null;s<=20&&(c=s,o=1),12==s&&(c=100*s+a,o=2),21<=s&&s<=27&&(c=s,o=1),28==s&&(l=r.readShort(t,n+1),o=3),29<=s&&s<=31&&(c=s,o=1),32<=s&&s<=246&&(l=s-139,o=1),247<=s&&s<=250&&(l=256*(s-247)+a+108,o=2),251<=s&&s<=254&&(l=256*-(s-251)-a-108,o=2),255==s&&(l=r.readInt(t,n+1)/65535,o=5),i.val=null!=l?l:"o"+c,i.size=o},e.CFF.readCharString=function(t,n,i){for(var r=n+i,s=e._bin,a=[];n<r;){var o=t[n],c=t[n+1];t[n+2],t[n+3],t[n+4];var l=1,h=null,u=null;o<=20&&(h=o,l=1),12==o&&(h=100*o+c,l=2),19!=o&&20!=o||(h=o,l=2),21<=o&&o<=27&&(h=o,l=1),28==o&&(u=s.readShort(t,n+1),l=3),29<=o&&o<=31&&(h=o,l=1),32<=o&&o<=246&&(u=o-139,l=1),247<=o&&o<=250&&(u=256*(o-247)+c+108,l=2),251<=o&&o<=254&&(u=256*-(o-251)-c-108,l=2),255==o&&(u=s.readInt(t,n+1)/65535,l=5),a.push(null!=u?u:"o"+h),n+=l}return a},e.CFF.readDict=function(t,n,i){for(var r=e._bin,s={},a=[];n<i;){var o=t[n],c=t[n+1];t[n+2],t[n+3],t[n+4];var l=1,h=null,u=null;if(28==o&&(u=r.readShort(t,n+1),l=3),29==o&&(u=r.readInt(t,n+1),l=5),32<=o&&o<=246&&(u=o-139,l=1),247<=o&&o<=250&&(u=256*(o-247)+c+108,l=2),251<=o&&o<=254&&(u=256*-(o-251)-c-108,l=2),255==o)throw u=r.readInt(t,n+1)/65535,l=5,"unknown number";if(30==o){var d=[];for(l=1;;){var p=t[n+l];l++;var f=p>>4,A=15&p;if(15!=f&&d.push(f),15!=A&&d.push(A),15==A)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],b=0;b<d.length;b++)g+=m[d[b]];u=parseFloat(g)}o<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][o],l=1,12==o&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][c],l=2)),null!=h?(s[h]=1==a.length?a[0]:a,a=[]):a.push(u),n+=l}return s},e.cmap={},e.cmap.parse=function(t,n,i){t=new Uint8Array(t.buffer,n,i),n=0;var r=e._bin,s={};r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);n+=2;var o=[];s.tables=[];for(var c=0;c<a;c++){var l=r.readUshort(t,n);n+=2;var h=r.readUshort(t,n);n+=2;var u=r.readUint(t,n);n+=4;var d="p"+l+"e"+h,p=o.indexOf(u);if(-1==p){var f;p=s.tables.length,o.push(u);var A=r.readUshort(t,u);0==A?f=e.cmap.parse0(t,u):4==A?f=e.cmap.parse4(t,u):6==A?f=e.cmap.parse6(t,u):12==A?f=e.cmap.parse12(t,u):console.debug("unknown format: "+A,l,h,u),s.tables.push(f)}if(null!=s[d])throw"multiple tables for one platform+encoding";s[d]=p}return s},e.cmap.parse0=function(t,n){var i=e._bin,r={};r.format=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);n+=2,i.readUshort(t,n),n+=2,r.map=[];for(var a=0;a<s-6;a++)r.map.push(t[n+a]);return r},e.cmap.parse4=function(t,n){var i=e._bin,r=n,s={};s.format=i.readUshort(t,n),n+=2;var a=i.readUshort(t,n);n+=2,i.readUshort(t,n),n+=2;var o=i.readUshort(t,n);n+=2;var c=o/2;s.searchRange=i.readUshort(t,n),n+=2,s.entrySelector=i.readUshort(t,n),n+=2,s.rangeShift=i.readUshort(t,n),n+=2,s.endCount=i.readUshorts(t,n,c),n+=2*c,n+=2,s.startCount=i.readUshorts(t,n,c),n+=2*c,s.idDelta=[];for(var l=0;l<c;l++)s.idDelta.push(i.readShort(t,n)),n+=2;for(s.idRangeOffset=i.readUshorts(t,n,c),n+=2*c,s.glyphIdArray=[];n<r+a;)s.glyphIdArray.push(i.readUshort(t,n)),n+=2;return s},e.cmap.parse6=function(t,n){var i=e._bin,r={};r.format=i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2,r.firstCode=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);n+=2,r.glyphIdArray=[];for(var a=0;a<s;a++)r.glyphIdArray.push(i.readUshort(t,n)),n+=2;return r},e.cmap.parse12=function(t,n){var i=e._bin,r={};r.format=i.readUshort(t,n),n+=2,n+=2,i.readUint(t,n),n+=4,i.readUint(t,n),n+=4;var s=i.readUint(t,n);n+=4,r.groups=[];for(var a=0;a<s;a++){var o=n+12*a,c=i.readUint(t,o+0),l=i.readUint(t,o+4),h=i.readUint(t,o+8);r.groups.push([c,l,h])}return r},e.glyf={},e.glyf.parse=function(t,e,n,i){for(var r=[],s=0;s<i.maxp.numGlyphs;s++)r.push(null);return r},e.glyf._parseGlyf=function(t,n){var i=e._bin,r=t._data,s=e._tabOffset(r,"glyf",t._offset)+t.loca[n];if(t.loca[n]==t.loca[n+1])return null;var a={};if(a.noc=i.readShort(r,s),s+=2,a.xMin=i.readShort(r,s),s+=2,a.yMin=i.readShort(r,s),s+=2,a.xMax=i.readShort(r,s),s+=2,a.yMax=i.readShort(r,s),s+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var o=0;o<a.noc;o++)a.endPts.push(i.readUshort(r,s)),s+=2;var c=i.readUshort(r,s);if(s+=2,r.length-s<c)return null;a.instructions=i.readBytes(r,s,c),s+=c;var l=a.endPts[a.noc-1]+1;for(a.flags=[],o=0;o<l;o++){var h=r[s];if(s++,a.flags.push(h),0!=(8&h)){var u=r[s];s++;for(var d=0;d<u;d++)a.flags.push(h),o++}}for(a.xs=[],o=0;o<l;o++){var p=0!=(2&a.flags[o]),f=0!=(16&a.flags[o]);p?(a.xs.push(f?r[s]:-r[s]),s++):f?a.xs.push(0):(a.xs.push(i.readShort(r,s)),s+=2)}for(a.ys=[],o=0;o<l;o++)p=0!=(4&a.flags[o]),f=0!=(32&a.flags[o]),p?(a.ys.push(f?r[s]:-r[s]),s++):f?a.ys.push(0):(a.ys.push(i.readShort(r,s)),s+=2);var A=0,g=0;for(o=0;o<l;o++)A+=a.xs[o],g+=a.ys[o],a.xs[o]=A,a.ys[o]=g}else{var m;a.parts=[];do{m=i.readUshort(r,s),s+=2;var b={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(b),b.glyphIndex=i.readUshort(r,s),s+=2,1&m){var v=i.readShort(r,s);s+=2;var y=i.readShort(r,s);s+=2}else v=i.readInt8(r,s),s++,y=i.readInt8(r,s),s++;2&m?(b.m.tx=v,b.m.ty=y):(b.p1=v,b.p2=y),8&m?(b.m.a=b.m.d=i.readF2dot14(r,s),s+=2):64&m?(b.m.a=i.readF2dot14(r,s),s+=2,b.m.d=i.readF2dot14(r,s),s+=2):128&m&&(b.m.a=i.readF2dot14(r,s),s+=2,b.m.b=i.readF2dot14(r,s),s+=2,b.m.c=i.readF2dot14(r,s),s+=2,b.m.d=i.readF2dot14(r,s),s+=2)}while(32&m);if(256&m){var x=i.readUshort(r,s);for(s+=2,a.instr=[],o=0;o<x;o++)a.instr.push(r[s]),s++}}return a},e.GDEF={},e.GDEF.parse=function(t,n,i,r){var s=n;n+=4;var a=e._bin.readUshort(t,n);return{glyphClassDef:0===a?null:e._lctf.readClassDef(t,s+a)}},e.GPOS={},e.GPOS.parse=function(t,n,i,r){return e._lctf.parse(t,n,i,r,e.GPOS.subt)},e.GPOS.subt=function(t,n,i,r){var s=e._bin,a=i,o={};if(o.fmt=s.readUshort(t,i),i+=2,1==n||2==n||3==n||7==n||8==n&&o.fmt<=2){var c=s.readUshort(t,i);i+=2,o.coverage=e._lctf.readCoverage(t,c+a)}if(1==n&&1==o.fmt){var l=s.readUshort(t,i);i+=2,0!=l&&(o.pos=e.GPOS.readValueRecord(t,i,l))}else if(2==n&&o.fmt>=1&&o.fmt<=2){l=s.readUshort(t,i),i+=2;var h=s.readUshort(t,i);i+=2;var u=e._lctf.numOfOnes(l),d=e._lctf.numOfOnes(h);if(1==o.fmt){o.pairsets=[];var p=s.readUshort(t,i);i+=2;for(var f=0;f<p;f++){var A=a+s.readUshort(t,i);i+=2;var g=s.readUshort(t,A);A+=2;for(var m=[],b=0;b<g;b++){var v=s.readUshort(t,A);A+=2,0!=l&&(C=e.GPOS.readValueRecord(t,A,l),A+=2*u),0!=h&&(S=e.GPOS.readValueRecord(t,A,h),A+=2*d),m.push({gid2:v,val1:C,val2:S})}o.pairsets.push(m)}}if(2==o.fmt){var y=s.readUshort(t,i);i+=2;var x=s.readUshort(t,i);i+=2;var _=s.readUshort(t,i);i+=2;var E=s.readUshort(t,i);for(i+=2,o.classDef1=e._lctf.readClassDef(t,a+y),o.classDef2=e._lctf.readClassDef(t,a+x),o.matrix=[],f=0;f<_;f++){var w=[];for(b=0;b<E;b++){var C=null,S=null;0!=l&&(C=e.GPOS.readValueRecord(t,i,l),i+=2*u),0!=h&&(S=e.GPOS.readValueRecord(t,i,h),i+=2*d),w.push({val1:C,val2:S})}o.matrix.push(w)}}}else if(4==n&&1==o.fmt)o.markCoverage=e._lctf.readCoverage(t,s.readUshort(t,i)+a),o.baseCoverage=e._lctf.readCoverage(t,s.readUshort(t,i+2)+a),o.markClassCount=s.readUshort(t,i+4),o.markArray=e.GPOS.readMarkArray(t,s.readUshort(t,i+6)+a),o.baseArray=e.GPOS.readBaseArray(t,s.readUshort(t,i+8)+a,o.markClassCount);else if(6==n&&1==o.fmt)o.mark1Coverage=e._lctf.readCoverage(t,s.readUshort(t,i)+a),o.mark2Coverage=e._lctf.readCoverage(t,s.readUshort(t,i+2)+a),o.markClassCount=s.readUshort(t,i+4),o.mark1Array=e.GPOS.readMarkArray(t,s.readUshort(t,i+6)+a),o.mark2Array=e.GPOS.readBaseArray(t,s.readUshort(t,i+8)+a,o.markClassCount);else{if(9==n&&1==o.fmt){var M=s.readUshort(t,i);i+=2;var I=s.readUint(t,i);if(i+=4,9==r.ltype)r.ltype=M;else if(r.ltype!=M)throw"invalid extension substitution";return e.GPOS.subt(t,r.ltype,a+I)}console.debug("unsupported GPOS table LookupType",n,"format",o.fmt)}return o},e.GPOS.readValueRecord=function(t,n,i){var r=e._bin,s=[];return s.push(1&i?r.readShort(t,n):0),n+=1&i?2:0,s.push(2&i?r.readShort(t,n):0),n+=2&i?2:0,s.push(4&i?r.readShort(t,n):0),n+=4&i?2:0,s.push(8&i?r.readShort(t,n):0),n+=8&i?2:0,s},e.GPOS.readBaseArray=function(t,n,i){var r=e._bin,s=[],a=n,o=r.readUshort(t,n);n+=2;for(var c=0;c<o;c++){for(var l=[],h=0;h<i;h++)l.push(e.GPOS.readAnchorRecord(t,a+r.readUshort(t,n))),n+=2;s.push(l)}return s},e.GPOS.readMarkArray=function(t,n){var i=e._bin,r=[],s=n,a=i.readUshort(t,n);n+=2;for(var o=0;o<a;o++){var c=e.GPOS.readAnchorRecord(t,i.readUshort(t,n+2)+s);c.markClass=i.readUshort(t,n),r.push(c),n+=4}return r},e.GPOS.readAnchorRecord=function(t,n){var i=e._bin,r={};return r.fmt=i.readUshort(t,n),r.x=i.readShort(t,n+2),r.y=i.readShort(t,n+4),r},e.GSUB={},e.GSUB.parse=function(t,n,i,r){return e._lctf.parse(t,n,i,r,e.GSUB.subt)},e.GSUB.subt=function(t,n,i,r){var s=e._bin,a=i,o={};if(o.fmt=s.readUshort(t,i),i+=2,1!=n&&2!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||2==n||4==n||5==n&&o.fmt<=2||6==n&&o.fmt<=2){var c=s.readUshort(t,i);i+=2,o.coverage=e._lctf.readCoverage(t,a+c)}if(1==n&&o.fmt>=1&&o.fmt<=2){if(1==o.fmt)o.delta=s.readShort(t,i),i+=2;else if(2==o.fmt){var l=s.readUshort(t,i);i+=2,o.newg=s.readUshorts(t,i,l),i+=2*o.newg.length}}else if(2==n&&1==o.fmt){l=s.readUshort(t,i),i+=2,o.seqs=[];for(var h=0;h<l;h++){var u=s.readUshort(t,i)+a;i+=2;var d=s.readUshort(t,u);o.seqs.push(s.readUshorts(t,u+2,d))}}else if(4==n)for(o.vals=[],l=s.readUshort(t,i),i+=2,h=0;h<l;h++){var p=s.readUshort(t,i);i+=2,o.vals.push(e.GSUB.readLigatureSet(t,a+p))}else if(5==n&&2==o.fmt){if(2==o.fmt){var f=s.readUshort(t,i);i+=2,o.cDef=e._lctf.readClassDef(t,a+f),o.scset=[];var A=s.readUshort(t,i);for(i+=2,h=0;h<A;h++){var g=s.readUshort(t,i);i+=2,o.scset.push(0==g?null:e.GSUB.readSubClassSet(t,a+g))}}}else if(6==n&&3==o.fmt){if(3==o.fmt){for(h=0;h<3;h++){l=s.readUshort(t,i),i+=2;for(var m=[],b=0;b<l;b++)m.push(e._lctf.readCoverage(t,a+s.readUshort(t,i+2*b)));i+=2*l,0==h&&(o.backCvg=m),1==h&&(o.inptCvg=m),2==h&&(o.ahedCvg=m)}l=s.readUshort(t,i),i+=2,o.lookupRec=e.GSUB.readSubstLookupRecords(t,i,l)}}else{if(7==n&&1==o.fmt){var v=s.readUshort(t,i);i+=2;var y=s.readUint(t,i);if(i+=4,9==r.ltype)r.ltype=v;else if(r.ltype!=v)throw"invalid extension substitution";return e.GSUB.subt(t,r.ltype,a+y)}console.debug("unsupported GSUB table LookupType",n,"format",o.fmt)}return o},e.GSUB.readSubClassSet=function(t,n){var i=e._bin.readUshort,r=n,s=[],a=i(t,n);n+=2;for(var o=0;o<a;o++){var c=i(t,n);n+=2,s.push(e.GSUB.readSubClassRule(t,r+c))}return s},e.GSUB.readSubClassRule=function(t,n){var i=e._bin.readUshort,r={},s=i(t,n),a=i(t,n+=2);n+=2,r.input=[];for(var o=0;o<s-1;o++)r.input.push(i(t,n)),n+=2;return r.substLookupRecords=e.GSUB.readSubstLookupRecords(t,n,a),r},e.GSUB.readSubstLookupRecords=function(t,n,i){for(var r=e._bin.readUshort,s=[],a=0;a<i;a++)s.push(r(t,n),r(t,n+2)),n+=4;return s},e.GSUB.readChainSubClassSet=function(t,n){var i=e._bin,r=n,s=[],a=i.readUshort(t,n);n+=2;for(var o=0;o<a;o++){var c=i.readUshort(t,n);n+=2,s.push(e.GSUB.readChainSubClassRule(t,r+c))}return s},e.GSUB.readChainSubClassRule=function(t,n){for(var i=e._bin,r={},s=["backtrack","input","lookahead"],a=0;a<s.length;a++){var o=i.readUshort(t,n);n+=2,1==a&&o--,r[s[a]]=i.readUshorts(t,n,o),n+=2*r[s[a]].length}return o=i.readUshort(t,n),n+=2,r.subst=i.readUshorts(t,n,2*o),n+=2*r.subst.length,r},e.GSUB.readLigatureSet=function(t,n){var i=e._bin,r=n,s=[],a=i.readUshort(t,n);n+=2;for(var o=0;o<a;o++){var c=i.readUshort(t,n);n+=2,s.push(e.GSUB.readLigature(t,r+c))}return s},e.GSUB.readLigature=function(t,n){var i=e._bin,r={chain:[]};r.nglyph=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);n+=2;for(var a=0;a<s-1;a++)r.chain.push(i.readUshort(t,n)),n+=2;return r},e.head={},e.head.parse=function(t,n,i){var r=e._bin,s={};return r.readFixed(t,n),n+=4,s.fontRevision=r.readFixed(t,n),n+=4,r.readUint(t,n),n+=4,r.readUint(t,n),n+=4,s.flags=r.readUshort(t,n),n+=2,s.unitsPerEm=r.readUshort(t,n),n+=2,s.created=r.readUint64(t,n),n+=8,s.modified=r.readUint64(t,n),n+=8,s.xMin=r.readShort(t,n),n+=2,s.yMin=r.readShort(t,n),n+=2,s.xMax=r.readShort(t,n),n+=2,s.yMax=r.readShort(t,n),n+=2,s.macStyle=r.readUshort(t,n),n+=2,s.lowestRecPPEM=r.readUshort(t,n),n+=2,s.fontDirectionHint=r.readShort(t,n),n+=2,s.indexToLocFormat=r.readShort(t,n),n+=2,s.glyphDataFormat=r.readShort(t,n),n+=2,s},e.hhea={},e.hhea.parse=function(t,n,i){var r=e._bin,s={};return r.readFixed(t,n),n+=4,s.ascender=r.readShort(t,n),n+=2,s.descender=r.readShort(t,n),n+=2,s.lineGap=r.readShort(t,n),n+=2,s.advanceWidthMax=r.readUshort(t,n),n+=2,s.minLeftSideBearing=r.readShort(t,n),n+=2,s.minRightSideBearing=r.readShort(t,n),n+=2,s.xMaxExtent=r.readShort(t,n),n+=2,s.caretSlopeRise=r.readShort(t,n),n+=2,s.caretSlopeRun=r.readShort(t,n),n+=2,s.caretOffset=r.readShort(t,n),n+=2,n+=8,s.metricDataFormat=r.readShort(t,n),n+=2,s.numberOfHMetrics=r.readUshort(t,n),n+=2,s},e.hmtx={},e.hmtx.parse=function(t,n,i,r){for(var s=e._bin,a={aWidth:[],lsBearing:[]},o=0,c=0,l=0;l<r.maxp.numGlyphs;l++)l<r.hhea.numberOfHMetrics&&(o=s.readUshort(t,n),n+=2,c=s.readShort(t,n),n+=2),a.aWidth.push(o),a.lsBearing.push(c);return a},e.kern={},e.kern.parse=function(t,n,i,r){var s=e._bin,a=s.readUshort(t,n);if(n+=2,1==a)return e.kern.parseV1(t,n-2,i,r);var o=s.readUshort(t,n);n+=2;for(var c={glyph1:[],rval:[]},l=0;l<o;l++){n+=2,i=s.readUshort(t,n),n+=2;var h=s.readUshort(t,n);n+=2;var u=h>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;n=e.kern.readFormat0(t,n,c)}return c},e.kern.parseV1=function(t,n,i,r){var s=e._bin;s.readFixed(t,n),n+=4;var a=s.readUint(t,n);n+=4;for(var o={glyph1:[],rval:[]},c=0;c<a;c++){s.readUint(t,n),n+=4;var l=s.readUshort(t,n);n+=2,s.readUshort(t,n),n+=2;var h=l>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;n=e.kern.readFormat0(t,n,o)}return o},e.kern.readFormat0=function(t,n,i){var r=e._bin,s=-1,a=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2;for(var o=0;o<a;o++){var c=r.readUshort(t,n);n+=2;var l=r.readUshort(t,n);n+=2;var h=r.readShort(t,n);n+=2,c!=s&&(i.glyph1.push(c),i.rval.push({glyph2:[],vals:[]}));var u=i.rval[i.rval.length-1];u.glyph2.push(l),u.vals.push(h),s=c}return n},e.loca={},e.loca.parse=function(t,n,i,r){var s=e._bin,a=[],o=r.head.indexToLocFormat,c=r.maxp.numGlyphs+1;if(0==o)for(var l=0;l<c;l++)a.push(s.readUshort(t,n+(l<<1))<<1);if(1==o)for(l=0;l<c;l++)a.push(s.readUint(t,n+(l<<2)));return a},e.maxp={},e.maxp.parse=function(t,n,i){var r=e._bin,s={},a=r.readUint(t,n);return n+=4,s.numGlyphs=r.readUshort(t,n),n+=2,65536==a&&(s.maxPoints=r.readUshort(t,n),n+=2,s.maxContours=r.readUshort(t,n),n+=2,s.maxCompositePoints=r.readUshort(t,n),n+=2,s.maxCompositeContours=r.readUshort(t,n),n+=2,s.maxZones=r.readUshort(t,n),n+=2,s.maxTwilightPoints=r.readUshort(t,n),n+=2,s.maxStorage=r.readUshort(t,n),n+=2,s.maxFunctionDefs=r.readUshort(t,n),n+=2,s.maxInstructionDefs=r.readUshort(t,n),n+=2,s.maxStackElements=r.readUshort(t,n),n+=2,s.maxSizeOfInstructions=r.readUshort(t,n),n+=2,s.maxComponentElements=r.readUshort(t,n),n+=2,s.maxComponentDepth=r.readUshort(t,n),n+=2),s},e.name={},e.name.parse=function(t,n,i){var r=e._bin,s={};r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);n+=2,r.readUshort(t,n);for(var o,c=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],l=n+=2,h=0;h<a;h++){var u=r.readUshort(t,n);n+=2;var d=r.readUshort(t,n);n+=2;var p=r.readUshort(t,n);n+=2;var f=r.readUshort(t,n);n+=2;var A=r.readUshort(t,n);n+=2;var g=r.readUshort(t,n);n+=2;var m,b=c[f],v=l+12*a+g;if(0==u)m=r.readUnicode(t,v,A/2);else if(3==u&&0==d)m=r.readUnicode(t,v,A/2);else if(0==d)m=r.readASCII(t,v,A);else if(1==d)m=r.readUnicode(t,v,A/2);else if(3==d)m=r.readUnicode(t,v,A/2);else{if(1!=u)throw"unknown encoding "+d+", platformID: "+u;m=r.readASCII(t,v,A),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var y="p"+u+","+p.toString(16);null==s[y]&&(s[y]={}),s[y][void 0!==b?b:f]=m,s[y]._lang=p}for(var x in s)if(null!=s[x].postScriptName&&1033==s[x]._lang)return s[x];for(var x in s)if(null!=s[x].postScriptName&&0==s[x]._lang)return s[x];for(var x in s)if(null!=s[x].postScriptName&&3084==s[x]._lang)return s[x];for(var x in s)if(null!=s[x].postScriptName)return s[x];for(var x in s){o=x;break}return console.debug("returning name table with languageID "+s[o]._lang),s[o]},e["OS/2"]={},e["OS/2"].parse=function(t,n,i){var r=e._bin.readUshort(t,n);n+=2;var s={};if(0==r)e["OS/2"].version0(t,n,s);else if(1==r)e["OS/2"].version1(t,n,s);else if(2==r||3==r||4==r)e["OS/2"].version2(t,n,s);else{if(5!=r)throw"unknown OS/2 table version: "+r;e["OS/2"].version5(t,n,s)}return s},e["OS/2"].version0=function(t,n,i){var r=e._bin;return i.xAvgCharWidth=r.readShort(t,n),n+=2,i.usWeightClass=r.readUshort(t,n),n+=2,i.usWidthClass=r.readUshort(t,n),n+=2,i.fsType=r.readUshort(t,n),n+=2,i.ySubscriptXSize=r.readShort(t,n),n+=2,i.ySubscriptYSize=r.readShort(t,n),n+=2,i.ySubscriptXOffset=r.readShort(t,n),n+=2,i.ySubscriptYOffset=r.readShort(t,n),n+=2,i.ySuperscriptXSize=r.readShort(t,n),n+=2,i.ySuperscriptYSize=r.readShort(t,n),n+=2,i.ySuperscriptXOffset=r.readShort(t,n),n+=2,i.ySuperscriptYOffset=r.readShort(t,n),n+=2,i.yStrikeoutSize=r.readShort(t,n),n+=2,i.yStrikeoutPosition=r.readShort(t,n),n+=2,i.sFamilyClass=r.readShort(t,n),n+=2,i.panose=r.readBytes(t,n,10),n+=10,i.ulUnicodeRange1=r.readUint(t,n),n+=4,i.ulUnicodeRange2=r.readUint(t,n),n+=4,i.ulUnicodeRange3=r.readUint(t,n),n+=4,i.ulUnicodeRange4=r.readUint(t,n),n+=4,i.achVendID=[r.readInt8(t,n),r.readInt8(t,n+1),r.readInt8(t,n+2),r.readInt8(t,n+3)],n+=4,i.fsSelection=r.readUshort(t,n),n+=2,i.usFirstCharIndex=r.readUshort(t,n),n+=2,i.usLastCharIndex=r.readUshort(t,n),n+=2,i.sTypoAscender=r.readShort(t,n),n+=2,i.sTypoDescender=r.readShort(t,n),n+=2,i.sTypoLineGap=r.readShort(t,n),n+=2,i.usWinAscent=r.readUshort(t,n),n+=2,i.usWinDescent=r.readUshort(t,n),n+2},e["OS/2"].version1=function(t,n,i){var r=e._bin;return n=e["OS/2"].version0(t,n,i),i.ulCodePageRange1=r.readUint(t,n),n+=4,i.ulCodePageRange2=r.readUint(t,n),n+4},e["OS/2"].version2=function(t,n,i){var r=e._bin;return n=e["OS/2"].version1(t,n,i),i.sxHeight=r.readShort(t,n),n+=2,i.sCapHeight=r.readShort(t,n),n+=2,i.usDefault=r.readUshort(t,n),n+=2,i.usBreak=r.readUshort(t,n),n+=2,i.usMaxContext=r.readUshort(t,n),n+2},e["OS/2"].version5=function(t,n,i){var r=e._bin;return n=e["OS/2"].version2(t,n,i),i.usLowerOpticalPointSize=r.readUshort(t,n),n+=2,i.usUpperOpticalPointSize=r.readUshort(t,n),n+2},e.post={},e.post.parse=function(t,n,i){var r=e._bin,s={};return s.version=r.readFixed(t,n),n+=4,s.italicAngle=r.readFixed(t,n),n+=4,s.underlinePosition=r.readShort(t,n),n+=2,s.underlineThickness=r.readShort(t,n),n+=2,s},null==e&&(e={}),null==e.U&&(e.U={}),e.U.codeToGlyph=function(t,e){var n=t.cmap,i=-1;if(null!=n.p0e4?i=n.p0e4:null!=n.p3e1?i=n.p3e1:null!=n.p1e0?i=n.p1e0:null!=n.p0e3&&(i=n.p0e3),-1==i)throw"no familiar platform and encoding!";var r=n.tables[i];if(0==r.format)return e>=r.map.length?0:r.map[e];if(4==r.format){for(var s=-1,a=0;a<r.endCount.length;a++)if(e<=r.endCount[a]){s=a;break}return-1==s||r.startCount[s]>e?0:65535&(0!=r.idRangeOffset[s]?r.glyphIdArray[e-r.startCount[s]+(r.idRangeOffset[s]>>1)-(r.idRangeOffset.length-s)]:e+r.idDelta[s])}if(12==r.format){if(e>r.groups[r.groups.length-1][1])return 0;for(a=0;a<r.groups.length;a++){var o=r.groups[a];if(o[0]<=e&&e<=o[1])return o[2]+(e-o[0])}return 0}throw"unknown cmap table format "+r.format},e.U.glyphToPath=function(t,n){var i={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[n]){var r=t.SVG.entries[n];return null==r?i:("string"==typeof r&&(r=e.SVG.toPath(r),t.SVG.entries[n]=r),r)}if(t.CFF){var s={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},a=t.CFF,o=t.CFF.Private;if(a.ROS){for(var c=0;a.FDSelect[c+2]<=n;)c+=2;o=a.FDArray[a.FDSelect[c+1]].Private}e.U._drawCFF(t.CFF.CharStrings[n],s,a,o,i)}else t.glyf&&e.U._drawGlyf(n,t,i);return i},e.U._drawGlyf=function(t,n,i){var r=n.glyf[t];null==r&&(r=n.glyf[t]=e.glyf._parseGlyf(n,t)),null!=r&&(r.noc>-1?e.U._simpleGlyph(r,i):e.U._compoGlyph(r,n,i))},e.U._simpleGlyph=function(t,n){for(var i=0;i<t.noc;i++){for(var r=0==i?0:t.endPts[i-1]+1,s=t.endPts[i],a=r;a<=s;a++){var o=a==r?s:a-1,c=a==s?r:a+1,l=1&t.flags[a],h=1&t.flags[o],u=1&t.flags[c],d=t.xs[a],p=t.ys[a];if(a==r)if(l){if(!h){e.U.P.moveTo(n,d,p);continue}e.U.P.moveTo(n,t.xs[o],t.ys[o])}else h?e.U.P.moveTo(n,t.xs[o],t.ys[o]):e.U.P.moveTo(n,(t.xs[o]+d)/2,(t.ys[o]+p)/2);l?h&&e.U.P.lineTo(n,d,p):u?e.U.P.qcurveTo(n,d,p,t.xs[c],t.ys[c]):e.U.P.qcurveTo(n,d,p,(d+t.xs[c])/2,(p+t.ys[c])/2)}e.U.P.closePath(n)}},e.U._compoGlyph=function(t,n,i){for(var r=0;r<t.parts.length;r++){var s={cmds:[],crds:[]},a=t.parts[r];e.U._drawGlyf(a.glyphIndex,n,s);for(var o=a.m,c=0;c<s.crds.length;c+=2){var l=s.crds[c],h=s.crds[c+1];i.crds.push(l*o.a+h*o.b+o.tx),i.crds.push(l*o.c+h*o.d+o.ty)}for(c=0;c<s.cmds.length;c++)i.cmds.push(s.cmds[c])}},e.U._getGlyphClass=function(t,n){var i=e._lctf.getInterval(n,t);return-1==i?0:n[i+2]},e.U._applySubs=function(t,n,i,r){for(var s=t.length-n-1,a=0;a<i.tabs.length;a++)if(null!=i.tabs[a]){var o,c=i.tabs[a];if(!c.coverage||-1!=(o=e._lctf.coverageIndex(c.coverage,t[n])))if(1==i.ltype)t[n],1==c.fmt?t[n]=t[n]+c.delta:t[n]=c.newg[o];else if(4==i.ltype)for(var l=c.vals[o],h=0;h<l.length;h++){var u=l[h],d=u.chain.length;if(!(d>s)){for(var p=!0,f=0,A=0;A<d;A++){for(;-1==t[n+f+(1+A)];)f++;u.chain[A]!=t[n+f+(1+A)]&&(p=!1)}if(p){for(t[n]=u.nglyph,A=0;A<d+f;A++)t[n+A+1]=-1;break}}}else if(5==i.ltype&&2==c.fmt)for(var g=e._lctf.getInterval(c.cDef,t[n]),m=c.cDef[g+2],b=c.scset[m],v=0;v<b.length;v++){var y=b[v],x=y.input;if(!(x.length>s)){for(p=!0,A=0;A<x.length;A++){var _=e._lctf.getInterval(c.cDef,t[n+1+A]);if(-1==g&&c.cDef[_+2]!=x[A]){p=!1;break}}if(p){var E=y.substLookupRecords;for(h=0;h<E.length;h+=2)E[h],E[h+1]}}}else if(6==i.ltype&&3==c.fmt){if(!e.U._glsCovered(t,c.backCvg,n-c.backCvg.length))continue;if(!e.U._glsCovered(t,c.inptCvg,n))continue;if(!e.U._glsCovered(t,c.ahedCvg,n+c.inptCvg.length))continue;var w=c.lookupRec;for(v=0;v<w.length;v+=2){g=w[v];var C=r[w[v+1]];e.U._applySubs(t,n+g,C,r)}}}},e.U._glsCovered=function(t,n,i){for(var r=0;r<n.length;r++)if(-1==e._lctf.coverageIndex(n[r],t[i+r]))return!1;return!0},e.U.glyphsToPath=function(t,n,i){for(var r={cmds:[],crds:[]},s=0,a=0;a<n.length;a++){var o=n[a];if(-1!=o){for(var c=a<n.length-1&&-1!=n[a+1]?n[a+1]:0,l=e.U.glyphToPath(t,o),h=0;h<l.crds.length;h+=2)r.crds.push(l.crds[h]+s),r.crds.push(l.crds[h+1]);for(i&&r.cmds.push(i),h=0;h<l.cmds.length;h++)r.cmds.push(l.cmds[h]);i&&r.cmds.push("X"),s+=t.hmtx.aWidth[o],a<n.length-1&&(s+=e.U.getPairAdjustment(t,o,c))}}return r},e.U.P={},e.U.P.moveTo=function(t,e,n){t.cmds.push("M"),t.crds.push(e,n)},e.U.P.lineTo=function(t,e,n){t.cmds.push("L"),t.crds.push(e,n)},e.U.P.curveTo=function(t,e,n,i,r,s,a){t.cmds.push("C"),t.crds.push(e,n,i,r,s,a)},e.U.P.qcurveTo=function(t,e,n,i,r){t.cmds.push("Q"),t.crds.push(e,n,i,r)},e.U.P.closePath=function(t){t.cmds.push("Z")},e.U._drawCFF=function(t,n,i,r,s){for(var a=n.stack,o=n.nStems,c=n.haveWidth,l=n.width,h=n.open,u=0,d=n.x,p=n.y,f=0,A=0,g=0,m=0,b=0,v=0,y=0,x=0,_=0,E=0,w={val:0,size:0};u<t.length;){e.CFF.getCharString(t,u,w);var C=w.val;if(u+=w.size,"o1"==C||"o18"==C)a.length%2!=0&&!c&&(l=a.shift()+r.nominalWidthX),o+=a.length>>1,a.length=0,c=!0;else if("o3"==C||"o23"==C)a.length%2!=0&&!c&&(l=a.shift()+r.nominalWidthX),o+=a.length>>1,a.length=0,c=!0;else if("o4"==C)a.length>1&&!c&&(l=a.shift()+r.nominalWidthX,c=!0),h&&e.U.P.closePath(s),p+=a.pop(),e.U.P.moveTo(s,d,p),h=!0;else if("o5"==C)for(;a.length>0;)d+=a.shift(),p+=a.shift(),e.U.P.lineTo(s,d,p);else if("o6"==C||"o7"==C)for(var S=a.length,M="o6"==C,I=0;I<S;I++){var T=a.shift();M?d+=T:p+=T,M=!M,e.U.P.lineTo(s,d,p)}else if("o8"==C||"o24"==C){S=a.length;for(var B=0;B+6<=S;)f=d+a.shift(),A=p+a.shift(),g=f+a.shift(),m=A+a.shift(),d=g+a.shift(),p=m+a.shift(),e.U.P.curveTo(s,f,A,g,m,d,p),B+=6;"o24"==C&&(d+=a.shift(),p+=a.shift(),e.U.P.lineTo(s,d,p))}else{if("o11"==C)break;if("o1234"==C||"o1235"==C||"o1236"==C||"o1237"==C)"o1234"==C&&(A=p,g=(f=d+a.shift())+a.shift(),E=m=A+a.shift(),v=m,x=p,d=(y=(b=(_=g+a.shift())+a.shift())+a.shift())+a.shift(),e.U.P.curveTo(s,f,A,g,m,_,E),e.U.P.curveTo(s,b,v,y,x,d,p)),"o1235"==C&&(f=d+a.shift(),A=p+a.shift(),g=f+a.shift(),m=A+a.shift(),_=g+a.shift(),E=m+a.shift(),b=_+a.shift(),v=E+a.shift(),y=b+a.shift(),x=v+a.shift(),d=y+a.shift(),p=x+a.shift(),a.shift(),e.U.P.curveTo(s,f,A,g,m,_,E),e.U.P.curveTo(s,b,v,y,x,d,p)),"o1236"==C&&(f=d+a.shift(),A=p+a.shift(),g=f+a.shift(),E=m=A+a.shift(),v=m,y=(b=(_=g+a.shift())+a.shift())+a.shift(),x=v+a.shift(),d=y+a.shift(),e.U.P.curveTo(s,f,A,g,m,_,E),e.U.P.curveTo(s,b,v,y,x,d,p)),"o1237"==C&&(f=d+a.shift(),A=p+a.shift(),g=f+a.shift(),m=A+a.shift(),_=g+a.shift(),E=m+a.shift(),b=_+a.shift(),v=E+a.shift(),y=b+a.shift(),x=v+a.shift(),Math.abs(y-d)>Math.abs(x-p)?d=y+a.shift():p=x+a.shift(),e.U.P.curveTo(s,f,A,g,m,_,E),e.U.P.curveTo(s,b,v,y,x,d,p));else if("o14"==C){if(a.length>0&&!c&&(l=a.shift()+i.nominalWidthX,c=!0),4==a.length){var R=a.shift(),P=a.shift(),D=a.shift(),L=a.shift(),U=e.CFF.glyphBySE(i,D),F=e.CFF.glyphBySE(i,L);e.U._drawCFF(i.CharStrings[U],n,i,r,s),n.x=R,n.y=P,e.U._drawCFF(i.CharStrings[F],n,i,r,s)}h&&(e.U.P.closePath(s),h=!1)}else if("o19"==C||"o20"==C)a.length%2!=0&&!c&&(l=a.shift()+r.nominalWidthX),o+=a.length>>1,a.length=0,c=!0,u+=o+7>>3;else if("o21"==C)a.length>2&&!c&&(l=a.shift()+r.nominalWidthX,c=!0),p+=a.pop(),d+=a.pop(),h&&e.U.P.closePath(s),e.U.P.moveTo(s,d,p),h=!0;else if("o22"==C)a.length>1&&!c&&(l=a.shift()+r.nominalWidthX,c=!0),d+=a.pop(),h&&e.U.P.closePath(s),e.U.P.moveTo(s,d,p),h=!0;else if("o25"==C){for(;a.length>6;)d+=a.shift(),p+=a.shift(),e.U.P.lineTo(s,d,p);f=d+a.shift(),A=p+a.shift(),g=f+a.shift(),m=A+a.shift(),d=g+a.shift(),p=m+a.shift(),e.U.P.curveTo(s,f,A,g,m,d,p)}else if("o26"==C)for(a.length%2&&(d+=a.shift());a.length>0;)f=d,A=p+a.shift(),d=g=f+a.shift(),p=(m=A+a.shift())+a.shift(),e.U.P.curveTo(s,f,A,g,m,d,p);else if("o27"==C)for(a.length%2&&(p+=a.shift());a.length>0;)A=p,g=(f=d+a.shift())+a.shift(),m=A+a.shift(),d=g+a.shift(),p=m,e.U.P.curveTo(s,f,A,g,m,d,p);else if("o10"==C||"o29"==C){var N="o10"==C?r:i;if(0==a.length)console.debug("error: empty stack");else{var k=a.pop(),O=N.Subrs[k+N.Bias];n.x=d,n.y=p,n.nStems=o,n.haveWidth=c,n.width=l,n.open=h,e.U._drawCFF(O,n,i,r,s),d=n.x,p=n.y,o=n.nStems,c=n.haveWidth,l=n.width,h=n.open}}else if("o30"==C||"o31"==C){var Q=a.length,G=(B=0,"o31"==C);for(B+=Q-(S=-3&Q);B<S;)G?(A=p,g=(f=d+a.shift())+a.shift(),p=(m=A+a.shift())+a.shift(),S-B==5?(d=g+a.shift(),B++):d=g,G=!1):(f=d,A=p+a.shift(),g=f+a.shift(),m=A+a.shift(),d=g+a.shift(),S-B==5?(p=m+a.shift(),B++):p=m,G=!0),e.U.P.curveTo(s,f,A,g,m,d,p),B+=4}else{if("o"==(C+"").charAt(0))throw console.debug("Unknown operation: "+C,t),C;a.push(C)}}}n.x=d,n.y=p,n.nStems=o,n.haveWidth=c,n.width=l,n.open=h};var n=e,i={Typr:n};return t.Typr=n,t.default=i,Object.defineProperty(t,"__esModule",{value:!0}),t}({}).Typr}
/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/,function(){return function(t){var e=Uint8Array,n=Uint16Array,i=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(t,e){for(var r=new n(31),s=0;s<31;++s)r[s]=e+=1<<t[s-1];var a=new i(r[30]);for(s=1;s<30;++s)for(var o=r[s];o<r[s+1];++o)a[o]=o-r[s]<<5|s;return[r,a]},c=o(r,2),l=c[0],h=c[1];l[28]=258,h[258]=28;for(var u=o(s,0)[0],d=new n(32768),p=0;p<32768;++p){var f=(43690&p)>>>1|(21845&p)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,d[p]=((65280&f)>>>8|(255&f)<<8)>>>1}var A=function(t,e,i){for(var r=t.length,s=0,a=new n(e);s<r;++s)++a[t[s]-1];var o,c=new n(e);for(s=0;s<e;++s)c[s]=c[s-1]+a[s-1]<<1;if(i){o=new n(1<<e);var l=15-e;for(s=0;s<r;++s)if(t[s])for(var h=s<<4|t[s],u=e-t[s],p=c[t[s]-1]++<<u,f=p|(1<<u)-1;p<=f;++p)o[d[p]>>>l]=h}else for(o=new n(r),s=0;s<r;++s)t[s]&&(o[s]=d[c[t[s]-1]++]>>>15-t[s]);return o},g=new e(288);for(p=0;p<144;++p)g[p]=8;for(p=144;p<256;++p)g[p]=9;for(p=256;p<280;++p)g[p]=7;for(p=280;p<288;++p)g[p]=8;var m=new e(32);for(p=0;p<32;++p)m[p]=5;var b=A(g,9,1),v=A(m,5,1),y=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},x=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},_=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],w=function(t,e,n){var i=new Error(e||E[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,w),!n)throw i;return i},C=function(t,o,c){var h=t.length;if(!h||c&&!c.l&&h<5)return o||new e(0);var d=!o||c,p=!c||c.i;c||(c={}),o||(o=new e(3*h));var f,g=function(t){var n=o.length;if(t>n){var i=new e(Math.max(2*n,t));i.set(o),o=i}},m=c.f||0,E=c.p||0,C=c.b||0,S=c.l,M=c.d,I=c.m,T=c.n,B=8*h;do{if(!S){c.f=m=x(t,E,1);var R=x(t,E+1,3);if(E+=3,!R){var P=t[(z=((f=E)/8|0)+(7&f&&1)+4)-4]|t[z-3]<<8,D=z+P;if(D>h){p&&w(0);break}d&&g(C+P),o.set(t.subarray(z,D),C),c.b=C+=P,c.p=E=8*D;continue}if(1==R)S=b,M=v,I=9,T=5;else if(2==R){var L=x(t,E,31)+257,U=x(t,E+10,15)+4,F=L+x(t,E+5,31)+1;E+=14;for(var N=new e(F),k=new e(19),O=0;O<U;++O)k[a[O]]=x(t,E+3*O,7);E+=3*U;var Q=y(k),G=(1<<Q)-1,H=A(k,Q,1);for(O=0;O<F;){var z,j=H[x(t,E,G)];if(E+=15&j,(z=j>>>4)<16)N[O++]=z;else{var V=0,W=0;for(16==z?(W=3+x(t,E,3),E+=2,V=N[O-1]):17==z?(W=3+x(t,E,7),E+=3):18==z&&(W=11+x(t,E,127),E+=7);W--;)N[O++]=V}}var q=N.subarray(0,L),X=N.subarray(L);I=y(q),T=y(X),S=A(q,I,1),M=A(X,T,1)}else w(1);if(E>B){p&&w(0);break}}d&&g(C+131072);for(var Y=(1<<I)-1,J=(1<<T)-1,K=E;;K=E){var Z=(V=S[_(t,E)&Y])>>>4;if((E+=15&V)>B){p&&w(0);break}if(V||w(2),Z<256)o[C++]=Z;else{if(256==Z){K=E,S=null;break}var $=Z-254;if(Z>264){var tt=r[O=Z-257];$=x(t,E,(1<<tt)-1)+l[O],E+=tt}var et=M[_(t,E)&J],nt=et>>>4;if(et||w(3),E+=15&et,X=u[nt],nt>3&&(tt=s[nt],X+=_(t,E)&(1<<tt)-1,E+=tt),E>B){p&&w(0);break}d&&g(C+131072);for(var it=C+$;C<it;C+=4)o[C]=o[C-X],o[C+1]=o[C+1-X],o[C+2]=o[C+2-X],o[C+3]=o[C+3-X];C=it}}c.l=S,c.p=K,c.b=C,S&&(m=1,c.m=I,c.d=M,c.n=T)}while(!m);return C==o.length?o:function(t,r,s){(null==r||r<0)&&(r=0),(null==s||s>t.length)&&(s=t.length);var a=new(t instanceof n?n:t instanceof i?i:e)(s-r);return a.set(t.subarray(r,s)),a}(o,0,C)},S=new e(0),M="undefined"!=typeof TextDecoder&&new TextDecoder;try{M.decode(S,{stream:!0})}catch(t){}return t.convert_streams=function(t){var e=new DataView(t),n=0;function i(){var t=e.getUint16(n);return n+=2,t}function r(){var t=e.getUint32(n);return n+=4,t}function s(t){m.setUint16(b,t),b+=2}function a(t){m.setUint32(b,t),b+=4}for(var o={signature:r(),flavor:r(),length:r(),numTables:i(),reserved:i(),totalSfntSize:r(),majorVersion:i(),minorVersion:i(),metaOffset:r(),metaLength:r(),metaOrigLength:r(),privOffset:r(),privLength:r()},c=0;Math.pow(2,c)<=o.numTables;)c++;c--;for(var l=16*Math.pow(2,c),h=16*o.numTables-l,u=12,d=[],p=0;p<o.numTables;p++)d.push({tag:r(),offset:r(),compLength:r(),origLength:r(),origChecksum:r()}),u+=16;var f,A=new Uint8Array(12+16*d.length+d.reduce((function(t,e){return t+e.origLength+4}),0)),g=A.buffer,m=new DataView(g),b=0;return a(o.flavor),s(o.numTables),s(l),s(c),s(h),d.forEach((function(t){a(t.tag),a(t.origChecksum),a(u),a(t.origLength),t.outOffset=u,(u+=t.origLength)%4!=0&&(u+=4-u%4)})),d.forEach((function(e){var n,i=t.slice(e.offset,e.offset+e.compLength);if(e.compLength!=e.origLength){var r=new Uint8Array(e.origLength);n=new Uint8Array(i,2),C(n,r)}else r=new Uint8Array(i);A.set(r,e.outOffset);var s=0;(u=e.outOffset+e.origLength)%4!=0&&(s=4-u%4),A.set(new Uint8Array(s).buffer,e.outOffset+e.origLength),f=u+s})),g.slice(0,f)},Object.defineProperty(t,"__esModule",{value:!0}),t}({}).convert_streams},function(t,e){const n={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,a=4,o=8,c=16,l=32;let h;function u(t){if(!h){const t={R:s,L:r,D:a,C:c,U:l,T:o};h=new Map;for(let e in i){let n=0;i[e].split(",").forEach((i=>{let[r,s]=i.split("+");r=parseInt(r,36),s=s?parseInt(s,36):0,h.set(n+=r,t[e]);for(let i=s;i--;)h.set(++n,t[e])}))}}return h.get(t)||l}const d=1,p=2,f=3,A=4,g=[null,"isol","init","fina","medi"];function m(t){const e=new Uint8Array(t.length);let n=l,i=d,h=-1;for(let g=0;g<t.length;g++){const m=t.codePointAt(g);let b=0|u(m),v=d;b&o||(n&(r|a|c)?b&(s|a|c)?(v=f,i!==d&&i!==f||e[h]++):b&(r|l)&&(i!==p&&i!==A||e[h]--):n&(s|l)&&(i!==p&&i!==A||e[h]--),i=e[g]=v,n=b,h=g,m>65535&&g++)}return e}function b(e,n){const i=e.GDEF&&e.GDEF.glyphClassDef;return i?t.U._getGlyphClass(n,i):0}function v(...t){for(let e=0;e<t.length;e++)if("number"==typeof t[e])return t[e]}function y(e){const i=Object.create(null),r=e["OS/2"],s=e.hhea,a=e.head.unitsPerEm,o=v(r&&r.sTypoAscender,s&&s.ascender,a),c={unitsPerEm:a,ascender:o,descender:v(r&&r.sTypoDescender,s&&s.descender,0),capHeight:v(r&&r.sCapHeight,o),xHeight:v(r&&r.sxHeight,o),lineGap:v(r&&r.sTypoLineGap,s&&s.lineGap),supportsCodePoint:n=>t.U.codeToGlyph(e,n)>0,forEachGlyph(r,s,a,o){let l=0;const h=1/c.unitsPerEm*s,u=function(e,n){const i=[];for(let r=0;r<n.length;r++){const s=n.codePointAt(r);s>65535&&r++,i.push(t.U.codeToGlyph(e,s))}const r=e.GSUB;if(r){const{lookupList:e,featureList:s}=r;let a;const o=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,c=[];s.forEach((r=>{if(o.test(r.tag))for(let s=0;s<r.tab.length;s++){if(c[r.tab[s]])continue;c[r.tab[s]]=!0;const o=e[r.tab[s]],l=/^(isol|init|fina|medi)$/.test(r.tag);l&&!a&&(a=m(n));for(let n=0;n<i.length;n++)a&&l&&g[a[n]]!==r.tag||t.U._applySubs(i,n,o,e)}}))}return i}(e,r);let d=0;const p=function(e,n){const i=new Int16Array(3*n.length);let r=0;for(;r<n.length;r++){const c=n[r];if(-1===c)continue;i[3*r+2]=e.hmtx.aWidth[c];const l=e.GPOS;if(l){const h=l.lookupList;for(let l=0;l<h.length;l++){const u=h[l];for(let l=0;l<u.tabs.length;l++){const h=u.tabs[l];if(1===u.ltype){if(-1!==t._lctf.coverageIndex(h.coverage,c)&&h.pos){o(h.pos,r);break}}else if(2===u.ltype){let e=null,i=s();if(-1!==i){const s=t._lctf.coverageIndex(h.coverage,n[i]);if(-1!==s){if(1===h.fmt){const t=h.pairsets[s];for(let n=0;n<t.length;n++)t[n].gid2===c&&(e=t[n])}else if(2===h.fmt){const r=t.U._getGlyphClass(n[i],h.classDef1),s=t.U._getGlyphClass(c,h.classDef2);e=h.matrix[r][s]}if(e){e.val1&&o(e.val1,i),e.val2&&o(e.val2,r);break}}}}else if(4===u.ltype){const e=t._lctf.coverageIndex(h.markCoverage,c);if(-1!==e){const o=s(a),c=-1===o?-1:t._lctf.coverageIndex(h.baseCoverage,n[o]);if(-1!==c){const t=h.markArray[e],n=h.baseArray[c][t.markClass];i[3*r]=n.x-t.x+i[3*o]-i[3*o+2],i[3*r+1]=n.y-t.y+i[3*o+1];break}}}else if(6===u.ltype){const a=t._lctf.coverageIndex(h.mark1Coverage,c);if(-1!==a){const o=s();if(-1!==o){const s=n[o];if(3===b(e,s)){const e=t._lctf.coverageIndex(h.mark2Coverage,s);if(-1!==e){const t=h.mark1Array[a],n=h.mark2Array[e][t.markClass];i[3*r]=n.x-t.x+i[3*o]-i[3*o+2],i[3*r+1]=n.y-t.y+i[3*o+1];break}}}}}}}}else if(e.kern&&!e.cff){const t=s();if(-1!==t){const r=e.kern.glyph1.indexOf(n[t]);if(-1!==r){const n=e.kern.rval[r].glyph2.indexOf(c);-1!==n&&(i[3*t+2]+=e.kern.rval[r].vals[n])}}}}return i;function s(t){for(let e=r-1;e>=0;e--)if(-1!==n[e]&&(!t||t(n[e])))return e;return-1}function a(t){return 1===b(e,t)}function o(t,e){for(let n=0;n<3;n++)i[3*e+n]+=t[n]||0}}(e,u);return u.forEach(((c,u)=>{if(-1!==c){let r=i[c];if(!r){const{cmds:s,crds:a}=t.U.glyphToPath(e,c);let o,l,h,u,d="",p=0;for(let t=0,e=s.length;t<e;t++){const e=n[s[t]];d+=s[t];for(let t=1;t<=e;t++)d+=(t>1?",":"")+a[p++]}if(a.length){o=l=1/0,h=u=-1/0;for(let t=0,e=a.length;t<e;t+=2){let e=a[t],n=a[t+1];e<o&&(o=e),n<l&&(l=n),e>h&&(h=e),n>u&&(u=n)}}else o=h=l=u=0;r=i[c]={index:c,advanceWidth:e.hmtx.aWidth[c],xMin:o,yMin:l,xMax:h,yMax:u,path:d}}o.call(null,r,l+p[3*u]*h,p[3*u+1]*h,d),l+=p[3*u+2]*h,a&&(l+=a*s)}d+=r.codePointAt(d)>65535?2:1})),l}};return c}return function(n){const i=new Uint8Array(n,0,4),r=t._bin.readASCII(i,0,4);if("wOFF"===r)n=e(n);else if("wOF2"===r)throw new Error("woff2 fonts not supported");return y(t.parse(n)[0])}}],init:(t,e,n)=>n(t(),e())});
/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/const $u=Uu({name:"FontResolver",dependencies:[function(t,e){const n=Object.create(null),i=Object.create(null);function r(e,r){let s=n[e];s?r(s):i[e]?i[e].push(r):(i[e]=[r],function(e,n){const i=t=>{console.error(`Failure loading font ${e}`,t)};try{const r=new XMLHttpRequest;r.open("get",e,!0),r.responseType="arraybuffer",r.onload=function(){if(r.status>=400)i(new Error(r.statusText));else if(r.status>0)try{const i=t(r.response);i.src=e,n(i)}catch(t){i(t)}},r.onerror=i,r.send()}catch(t){i(t)}}(e,(t=>{t.src=e,n[e]=t,i[e].forEach((e=>e(t))),delete i[e]})))}return function(t,i,{lang:s,fonts:a=[],style:o="normal",weight:c="normal",unicodeFontsURL:l}={}){const h=new Uint8Array(t.length),u=[];t.length||A();const d=new Map,p=[];if("italic"!==o&&(o="normal"),"number"!=typeof c&&(c="bold"===c?700:400),a&&!Array.isArray(a)&&(a=[a]),(a=a.slice().filter((t=>!t.lang||t.lang.test(s))).reverse()).length){const e=1,i=2;let s=0;!function o(c=0){for(let l=c,f=t.length;l<f;l++){const c=t.codePointAt(l);if(s===e&&u[h[l-1]].supportsCodePoint(c)||/\s/.test(t[l]))h[l]=h[l-1],s===i&&(p[p.length-1][1]=l);else for(let t=h[l],f=a.length;t<=f;t++)if(t===f){(s===i?p[p.length-1]:p[p.length]=[l,l])[1]=l,s=i}else{h[l]=t;const{src:i,unicodeRange:p}=a[t];if(!p||g(c,p)){const t=n[i];if(!t)return void r(i,(()=>{o(l)}));if(t.supportsCodePoint(c)){let n=d.get(t);"number"!=typeof n&&(n=u.length,u.push(t),d.set(t,n)),h[l]=n,s=e;break}}}c>65535&&l+1<f&&(h[l+1]=h[l],l++,s===i&&(p[p.length-1][1]=l))}f()}()}else p.push([0,t.length-1]),f();function f(){if(p.length){const n=p.map((e=>t.substring(e[0],e[1]+1))).join("\n");e.getFontsForString(n,{lang:s||void 0,style:o,weight:c,dataUrl:l}).then((({fontUrls:t,chars:e})=>{const n=u.length;let i=0;p.forEach((t=>{for(let r=0,s=t[1]-t[0];r<=s;r++)h[t[0]+r]=e[i++]+n;i++}));let s=0;t.forEach(((e,i)=>{r(e,(e=>{u[i+n]=e,++s===t.length&&A()}))}))}))}else A()}function A(){i({chars:h,fonts:u})}function g(t,e){for(let n=0;n<e.length;n++){const[i,r=i]=e[n];if(i<=t&&t<=r)return!0}return!1}}},Zu,function(){return function(t){var e=function(){this.buckets=new Map};e.prototype.add=function(t){var e=t>>5;this.buckets.set(e,(this.buckets.get(e)||0)|1<<(31&t))},e.prototype.has=function(t){var e=this.buckets.get(t>>5);return void 0!==e&&0!=(e&1<<(31&t))},e.prototype.serialize=function(){var t=[];return this.buckets.forEach((function(e,n){t.push((+n).toString(36)+":"+e.toString(36))})),t.join(",")},e.prototype.deserialize=function(t){var e=this;this.buckets.clear(),t.split(",").forEach((function(t){var n=t.split(":");e.buckets.set(parseInt(n[0],36),parseInt(n[1],36))}))};var n=Math.pow(2,8),i=n-1,r=~i;function s(t){var e=function(t){return t&r}(t).toString(16),i=function(t){return(t&r)+n-1}(t).toString(16);return"codepoint-index/plane"+(t>>16)+"/"+e+"-"+i+".json"}function a(t,e){var n=t&i,r=e.codePointAt(n/6|0);return 0!=((r=(r||48)-48)&1<<n%6)}function o(t,e){!function(t,e){var n;(n=t,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(t){return t.split("-").map((function(t){return parseInt(t.trim(),16)}))}))).forEach((function(t){var n=t[0],i=t[1];void 0===i&&(i=n),e(n,i)}))}(t,(function(t,n){for(var i=t;i<=n;i++)e(i)}))}var c={},l={},h=new WeakMap,u="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(t){var n=h.get(t);return n||(n=new e,o(t.ranges,(function(t){return n.add(t)})),h.set(t,n)),n}var p,f=new Map;function A(t,e,n){return t[e]?e:t[n]?n:function(t){for(var e in t)return e}(t)}function g(t,e){var n=e;if(!t.includes(n)){n=1/0;for(var i=0;i<t.length;i++)Math.abs(t[i]-e)<Math.abs(n-e)&&(n=t[i])}return n}function m(t){return p||(p=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(t){p.add(t)}))),p.has(t)}return t.CodePointSet=e,t.clearCache=function(){c={},l={}},t.getFontsForString=function(t,e){void 0===e&&(e={});var n,i=e.lang;void 0===i&&(i=/\p{Script=Hangul}/u.test(n=t)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(n)?"ja":"en");var r=e.category;void 0===r&&(r="sans-serif");var o=e.style;void 0===o&&(o="normal");var h=e.weight;void 0===h&&(h=400);var p=(e.dataUrl||u).replace(/\/$/g,""),b=new Map,v=new Uint8Array(t.length),y={},x={},_=new Array(t.length),E=new Map,w=!1;function C(t){var e=f.get(t);return e||(e=fetch(p+"/"+t).then((function(t){if(!t.ok)throw new Error(t.statusText);return t.json().then((function(t){if(!Array.isArray(t)||1!==t[0])throw new Error("Incorrect schema version; need 1, got "+t[0]);return t[1]}))})).catch((function(e){if(p!==u)return w||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+p+'", trying default CDN. '+e.message),w=!0),p=u,f.delete(t),C(t);throw e})),f.set(t,e)),e}for(var S=function(e){var n=t.codePointAt(e),i=s(n);_[e]=i,c[i]||E.has(i)||E.set(i,C(i).then((function(t){c[i]=t}))),n>65535&&(e++,M=e)},M=0;M<t.length;M++)S(M);return Promise.all(E.values()).then((function(){E.clear();for(var e=function(e){var r=t.codePointAt(e),s=null,o=c[_[e]],h=void 0;for(var u in o){var d=x[u];if(void 0===d&&(d=x[u]=new RegExp(u).test(i||"en")),d){for(var p in h=u,o[u])if(a(r,o[u][p])){s=p;break}break}}if(!s)t:for(var f in o)if(f!==h)for(var A in o[f])if(a(r,o[f][A])){s=A;break t}s||(console.debug("No font coverage for U+"+r.toString(16)),s="latin"),_[e]=s,l[s]||E.has(s)||E.set(s,C("font-meta/"+s+".json").then((function(t){l[s]=t}))),r>65535&&(e++,n=e)},n=0;n<t.length;n++)e(n);return Promise.all(E.values())})).then((function(){for(var e,n=null,i=0;i<t.length;i++){var s=t.codePointAt(i);if(n&&(m(s)||d(n).has(s)))v[i]=v[i-1];else{n=l[_[i]];var a=y[n.id];if(!a){var c=n.typeforms,u=A(c,r,"sans-serif"),f=A(c[u],o,"normal"),x=g(null===(e=c[u])||void 0===e?void 0:e[f],h);a=y[n.id]=p+"/font-files/"+n.id+"/"+u+"."+f+"."+x+".woff"}var E=b.get(a);null==E&&(E=b.size,b.set(a,E)),v[i]=E}s>65535&&(i++,v[i]=v[i-1])}return{fontUrls:Array.from(b.keys()),chars:v}}))},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(t,e,n)=>t(e,n())});const td=()=>(self.performance||Date).now(),ed=ku();let nd;const id=[];let rd=0;function sd(){const t=td();for(;id.length&&td()-t<5;)id.shift()();rd=id.length?setTimeout(sd,0):0}const ad=(...t)=>new Promise(((e,n)=>{id.push((()=>{const i=td();try{ed.webgl.generateIntoCanvas(...t),e({timing:td()-i})}catch(t){n(t)}})),rd||(rd=setTimeout(sd,0))})),od=4,cd=2e3,ld={};let hd=0;function ud(t,e,n,i,r,s,a,o,c,l){const h="TroikaTextSDFGenerator_JS_"+hd++%od;let u=ld[h];return u||(u=ld[h]={workerModule:Uu({name:h,workerId:h,dependencies:[ku,td],init(t,e){const n=t().javascript.generate;return function(...t){const i=e();return{textureData:n(...t),timing:e()-i}}},getTransferables:t=>[t.textureData.buffer]}),requests:0,idleTimer:null}),u.requests++,clearTimeout(u.idleTimer),u.workerModule(t,e,n,i,r,s).then((({textureData:n,timing:i})=>{const r=td(),s=new Uint8Array(4*n.length);for(let t=0;t<n.length;t++)s[4*t+l]=n[t];return ed.webglUtils.renderImageData(a,s,o,c,t,e,1<<3-l),i+=td()-r,0==--u.requests&&(u.idleTimer=setTimeout((()=>{!function(t){Du[t]&&Du[t].forEach((function(t){t()})),Pu[t]&&(Pu[t].terminate(),delete Pu[t])}(h)}),cd)),{timing:i}}))}const dd=ed.webglUtils.resizeWebGLCanvasWithoutClearing,pd={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},fd=new Nn;function Ad(){return(self.performance||Date).now()}const gd=Object.create(null);function md(t,e){t=function(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({},t);const n=Ad(),{defaultFontURL:i}=pd,r=[];if(i&&r.push({label:"default",src:yd(i)}),t.font&&r.push({label:"user",src:yd(t.font)}),t.font=r,t.text=""+t.text,t.sdfGlyphSize=t.sdfGlyphSize||pd.sdfGlyphSize,t.unicodeFontsURL=t.unicodeFontsURL||pd.unicodeFontsURL,null!=t.colorRanges){let e={};for(let n in t.colorRanges)if(t.colorRanges.hasOwnProperty(n)){let i=t.colorRanges[n];"number"!=typeof i&&(i=fd.set(i).getHex()),e[n]=i}t.colorRanges=e}Object.freeze(t);const{textureWidth:s,sdfExponent:a}=pd,{sdfGlyphSize:o}=t,c=s/o*4;let l=gd[o];if(!l){const t=document.createElement("canvas");t.width=s,t.height=256*o/c,l=gd[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:t,sdfTexture:new he(t,void 0,void 0,void 0,N,N),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,function(t){const e=t.sdfCanvas;e.addEventListener("webglcontextlost",(e=>{console.log("Context Lost",e),e.preventDefault(),t.contextLost=!0})),e.addEventListener("webglcontextrestored",(e=>{console.log("Context Restored",e),t.contextLost=!1;const n=[];t.glyphsByFont.forEach((e=>{e.forEach((e=>{n.push(bd(e,t,!0))}))})),Promise.all(n).then((()=>{xd(t),t.sdfTexture.needsUpdate=!0}))}))}(l)}const{sdfTexture:h,sdfCanvas:u}=l;Ed(t).then((i=>{const{glyphIds:r,glyphFontIndices:d,fontData:p,glyphPositions:f,fontSize:A,timings:g}=i,m=[],b=new Float32Array(4*r.length);let v=0,y=0;const x=Ad(),_=p.map((t=>{let e=l.glyphsByFont.get(t.src);return e||l.glyphsByFont.set(t.src,e=new Map),e}));r.forEach(((t,e)=>{const n=d[e],{src:s,unitsPerEm:a}=p[n];let c=_[n].get(t);if(!c){const{path:e,pathBounds:r}=i.glyphData[s][t],a=Math.max(r[2]-r[0],r[3]-r[1])/o*(pd.sdfMargin*o+.5),h=l.glyphCount++,u=[r[0]-a,r[1]-a,r[2]+a,r[3]+a];_[n].set(t,c={path:e,atlasIndex:h,sdfViewBox:u}),m.push(c)}const{sdfViewBox:h}=c,u=f[y++],g=f[y++],x=A/a;b[v++]=u+h[0]*x,b[v++]=g+h[1]*x,b[v++]=u+h[2]*x,b[v++]=g+h[3]*x,r[e]=c.atlasIndex})),g.quads=(g.quads||0)+(Ad()-x);const E=Ad();g.sdf={};const w=u.height,C=Math.ceil(l.glyphCount/c),S=Math.pow(2,Math.ceil(Math.log2(C*o)));S>w&&(console.info(`Increasing SDF texture size ${w}->${S}`),dd(u,s,S),h.dispose()),Promise.all(m.map((e=>bd(e,l,t.gpuAccelerateSDF).then((({timing:t})=>{g.sdf[e.atlasIndex]=t}))))).then((()=>{m.length&&!l.contextLost&&(xd(l),h.needsUpdate=!0),g.sdfTotal=Ad()-E,g.total=Ad()-n,e(Object.freeze({parameters:t,sdfTexture:h,sdfGlyphSize:o,sdfExponent:a,glyphBounds:b,glyphAtlasIndices:r,glyphColors:i.glyphColors,caretPositions:i.caretPositions,chunkedBounds:i.chunkedBounds,ascender:i.ascender,descender:i.descender,lineHeight:i.lineHeight,capHeight:i.capHeight,xHeight:i.xHeight,topBaseline:i.topBaseline,blockBounds:i.blockBounds,visibleBounds:i.visibleBounds,timings:i.timings}))}))})),Promise.resolve().then((()=>{var t;l.contextLost||(t=u)._warm||(ed.webgl.isSupported(t),t._warm=!0)}))}function bd({path:t,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:i,sdfCanvas:r,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:c}=pd,l=Math.max(n[2]-n[0],n[3]-n[1]),h=Math.floor(e/4);return function(t,e,n,i,r,s,a,o,c,l,h=!0){return h?ad(t,e,n,i,r,s,a,o,c,l).then(null,(h=>(nd||(console.warn("WebGL SDF generation failed, falling back to JS",h),nd=!0),ud(t,e,n,i,r,s,a,o,c,l)))):ud(t,e,n,i,r,s,a,o,c,l)}(i,i,t,n,l,c,r,h%(o/i)*i,Math.floor(h/(o/i))*i,e%4,a)}let vd;function yd(t){return vd||(vd="undefined"==typeof document?{}:document.createElement("a")),vd.href=t,vd.href}function xd(t){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:n}=t,{width:i,height:r}=e,s=t.sdfCanvas.getContext("webgl");let a=n.image.data;a&&a.length===i*r*4||(a=new Uint8Array(i*r*4),n.image={width:i,height:r,data:a},n.flipY=!1,n.isDataTexture=!0),s.readPixels(0,0,i,r,s.RGBA,s.UNSIGNED_BYTE,a)}}const _d=Uu({name:"Typesetter",dependencies:[function(t,e){const n=1/0,i=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",s=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:a="",font:u,lang:d,sdfGlyphSize:p=64,fontSize:f=400,fontWeight:A=1,fontStyle:g="normal",letterSpacing:m=0,lineHeight:b="normal",maxWidth:v=n,direction:y,textAlign:x="left",textIndent:_=0,whiteSpace:E="normal",overflowWrap:w="normal",anchorX:C=0,anchorY:S=0,metricsOnly:M=!1,unicodeFontsURL:I,preResolvedFonts:T=null,includeCaretPositions:B=!1,chunkedBoundsSize:R=8192,colorRanges:P=null},D){const L=l(),U={fontLoad:0,typesetting:0};a.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),f=+f,m=+m,v=+v,b=b||"normal",_=+_,function({text:e,lang:n,fonts:i,style:r,weight:s,preResolvedFonts:a,unicodeFontsURL:o},c){const l=({chars:t,fonts:e})=>{let n,i;const r=[];for(let s=0;s<t.length;s++)t[s]!==i?(i=t[s],r.push(n={start:s,end:s,fontObj:e[t[s]]})):n.end=s;c(r)};a?l(a):t(e,l,{lang:n,fonts:i,style:r,weight:s,unicodeFontsURL:o})}({text:a,lang:d,style:g,weight:A,fonts:"string"==typeof u?[{src:u}]:u,unicodeFontsURL:I,preResolvedFonts:T},(t=>{U.fontLoad=l()-L;const u=isFinite(v);let d=null,p=null,A=null,g=null,I=null,T=null,F=null,N=null,k=0,O=0,Q="nowrap"!==E;const G=new Map,H=l();let z=_,j=0,V=new h;const W=[V];t.forEach((t=>{const{fontObj:e}=t,{ascender:n,descender:o,unitsPerEm:c,lineGap:l,capHeight:d,xHeight:p}=e;let A=G.get(e);if(!A){const t=f/c,i="normal"===b?(n-o+l)*t:b*f,r=(i-(n-o)*t)/2,s=Math.min(i,(n-o)*t),a=(n+o)/2*t+s/2;A={index:G.size,src:e.src,fontObj:e,fontSizeMult:t,unitsPerEm:c,ascender:n*t,descender:o*t,capHeight:d*t,xHeight:p*t,lineHeight:i,baseline:-r-n*t,caretTop:a,caretBottom:a-s},G.set(e,A)}const{fontSizeMult:g}=A,y=a.slice(t.start,t.end+1);let x,E;e.forEachGlyph(y,f,m,((e,n,o,c)=>{n+=j,c+=t.start,x=n,E=e;const l=a.charAt(c),d=e.advanceWidth*g,p=V.count;let b;if("isEmpty"in e||(e.isWhitespace=!!l&&new RegExp(r).test(l),e.canBreakAfter=!!l&&s.test(l),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax||i.test(l)),e.isWhitespace||e.isEmpty||O++,Q&&u&&!e.isWhitespace&&n+d+z>v&&p){if(V.glyphAt(p-1).glyphObj.canBreakAfter)b=new h,z=-n;else for(let t=p;t--;){if(0===t&&"break-word"===w){b=new h,z=-n;break}if(V.glyphAt(t).glyphObj.canBreakAfter){b=V.splitAt(t+1);const e=b.glyphAt(0).x;z-=e;for(let t=b.count;t--;)b.glyphAt(t).x-=e;break}}b&&(V.isSoftWrapped=!0,V=b,W.push(V),k=v)}let y=V.glyphAt(V.count);y.glyphObj=e,y.x=n+z,y.y=o,y.width=d,y.charIndex=c,y.fontData=A,"\n"===l&&(V=new h,W.push(V),z=-(n+d+m*f)+_)})),j=x+E.advanceWidth*g+m*f}));let q=0;W.forEach((t=>{let e=!0;for(let n=t.count;n--;){const i=t.glyphAt(n);e&&!i.glyphObj.isWhitespace&&(t.width=i.x+i.width,t.width>k&&(k=t.width),e=!1);let{lineHeight:r,capHeight:s,xHeight:a,baseline:o}=i.fontData;r>t.lineHeight&&(t.lineHeight=r);const c=o-t.baseline;c<0&&(t.baseline+=c,t.cap+=c,t.ex+=c),t.cap=Math.max(t.cap,t.baseline+s),t.ex=Math.max(t.ex,t.baseline+a)}t.baseline-=q,t.cap-=q,t.ex-=q,q+=t.lineHeight}));let X=0,Y=0;if(C&&("number"==typeof C?X=-C:"string"==typeof C&&(X=-k*("left"===C?0:"center"===C?.5:"right"===C?1:o(C)))),S&&("number"==typeof S?Y=-S:"string"==typeof S&&(Y="top"===S?0:"top-baseline"===S?-W[0].baseline:"top-cap"===S?-W[0].cap:"top-ex"===S?-W[0].ex:"middle"===S?q/2:"bottom"===S?q:"bottom-baseline"===S?-W[W.length-1].baseline:o(S)*q)),!M){const t=e.getEmbeddingLevels(a,y);d=new Uint16Array(O),p=new Uint8Array(O),A=new Float32Array(2*O),g={},F=[n,n,-n,-n],N=[],B&&(T=new Float32Array(4*a.length)),P&&(I=new Uint8Array(3*O));let i,r,s=0,o=-1,l=-1;if(W.forEach(((h,u)=>{let{count:f,width:m}=h;if(f>0){let u=0;for(let t=f;t--&&h.glyphAt(t).glyphObj.isWhitespace;)u++;let b=0,v=0;if("center"===x)b=(k-m)/2;else if("right"===x)b=k-m;else if("justify"===x&&h.isSoftWrapped){let t=0;for(let e=f-u;e--;)h.glyphAt(e).glyphObj.isWhitespace&&t++;v=(k-m)/t}if(v||b){let t=0;for(let e=0;e<f;e++){let n=h.glyphAt(e);const i=n.glyphObj;n.x+=b+t,0!==v&&i.isWhitespace&&e<f-u&&(t+=v,n.width+=v)}}const y=e.getReorderSegments(a,t,h.glyphAt(0).charIndex,h.glyphAt(h.count-1).charIndex);for(let t=0;t<y.length;t++){const[e,n]=y[t];let i=1/0,r=-1/0;for(let t=0;t<f;t++)if(h.glyphAt(t).charIndex>=e){let e=t,s=t;for(;s<f;s++){let t=h.glyphAt(s);if(t.charIndex>n)break;s<f-u&&(i=Math.min(i,t.x),r=Math.max(r,t.x+t.width))}for(let t=e;t<s;t++){const e=h.glyphAt(t);e.x=r-(e.x+e.width-i)}break}}let _;const E=t=>_=t;for(let u=0;u<f;u++){const f=h.glyphAt(u);_=f.glyphObj;const m=_.index,b=1&t.levels[f.charIndex];if(b){const t=e.getMirroredCharacter(a[f.charIndex]);t&&f.fontData.fontObj.forEachGlyph(t,0,0,E)}if(B){const{charIndex:t,fontData:e}=f,n=f.x+X,i=f.x+f.width+X;T[4*t]=b?i:n,T[4*t+1]=b?n:i,T[4*t+2]=h.baseline+e.caretBottom+Y,T[4*t+3]=h.baseline+e.caretTop+Y;const r=t-o;r>1&&c(T,o,r),o=t}if(P){const{charIndex:t}=f;for(;t>l;)l++,P.hasOwnProperty(l)&&(r=P[l])}if(!_.isWhitespace&&!_.isEmpty){const t=s++,{fontSizeMult:e,src:a,index:o}=f.fontData,c=g[a]||(g[a]={});c[m]||(c[m]={path:_.path,pathBounds:[_.xMin,_.yMin,_.xMax,_.yMax]});const l=f.x+X,u=f.y+h.baseline+Y;A[2*t]=l,A[2*t+1]=u;const b=l+_.xMin*e,v=u+_.yMin*e,y=l+_.xMax*e,x=u+_.yMax*e;b<F[0]&&(F[0]=b),v<F[1]&&(F[1]=v),y>F[2]&&(F[2]=y),x>F[3]&&(F[3]=x),t%R==0&&(i={start:t,end:t,rect:[n,n,-n,-n]},N.push(i)),i.end++;const E=i.rect;if(b<E[0]&&(E[0]=b),v<E[1]&&(E[1]=v),y>E[2]&&(E[2]=y),x>E[3]&&(E[3]=x),d[t]=m,p[t]=o,P){const e=3*t;I[e]=r>>16&255,I[e+1]=r>>8&255,I[e+2]=255&r}}}}})),T){const t=a.length-o;t>1&&c(T,o,t)}}const J=[];G.forEach((({index:t,src:e,unitsPerEm:n,ascender:i,descender:r,lineHeight:s,capHeight:a,xHeight:o})=>{J[t]={src:e,unitsPerEm:n,ascender:i,descender:r,lineHeight:s,capHeight:a,xHeight:o}})),U.typesetting=l()-H,D({glyphIds:d,glyphFontIndices:p,glyphPositions:A,glyphData:g,fontData:J,caretPositions:T,glyphColors:I,chunkedBounds:N,fontSize:f,topBaseline:Y+W[0].baseline,blockBounds:[X,Y-q,X+k,Y],visibleBounds:F,timings:U})}))}function o(t){let e=t.match(/^([\d.]+)%$/),n=e?parseFloat(e[1]):NaN;return isNaN(n)?0:n/100}function c(t,e,n){const i=t[4*e],r=t[4*e+1],s=t[4*e+2],a=t[4*e+3],o=(r-i)/n;for(let r=0;r<n;r++){const n=4*(e+r);t[n]=i+o*r,t[n+1]=i+o*(r+1),t[n+2]=s,t[n+3]=a}}function l(){return(self.performance||Date).now()}function h(){this.data=[]}const u=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/u.length)},glyphAt(t){let e=h.flyweight;return e.data=this.data,e.index=t,e},splitAt(t){let e=new h;return e.data=this.data.splice(t*u.length),e}},h.flyweight=u.reduce(((t,e,n,i)=>(Object.defineProperty(t,e,{get(){return this.data[this.index*u.length+n]},set(t){this.data[this.index*u.length+n]=t}}),t)),{data:null,index:0}),{typeset:a,measure:function(t,e){a({...t,metricsOnly:!0},(t=>{const[n,i,r,s]=t.blockBounds;e({width:r-n,height:s-i})}))}}},$u,function(){var t=function(t){var e={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},i={};n.L=1,i[1]="L",Object.keys(e).forEach((function(t,e){n[t]=1<<e+1,i[n[t]]=t})),Object.freeze(n);var r=n.LRI|n.RLI|n.FSI,s=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,o=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,c=n.S|n.WS|n.B|r|n.PDI|o,l=null;function h(t){return function(){if(!l){l=new Map;var t=function(t){if(e.hasOwnProperty(t)){var i=0;e[t].split(",").forEach((function(e){var r=e.split("+"),s=r[0],a=r[1];s=parseInt(s,36),a=a?parseInt(a,36):0,l.set(i+=s,n[t]);for(var o=0;o<a;o++)l.set(++i,n[t])}))}};for(var i in e)t(i)}}(),l.get(t.codePointAt(0))||n.L}var u,d,p,f={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function A(t,e){var n,i=0,r=new Map,s=e&&new Map;return t.split(",").forEach((function t(a){if(-1!==a.indexOf("+"))for(var o=+a;o--;)t(n);else{n=a;var c=a.split(">"),l=c[0],h=c[1];l=String.fromCodePoint(i+=parseInt(l,36)),h=String.fromCodePoint(i+=parseInt(h,36)),r.set(l,h),e&&s.set(h,l)}})),{map:r,reverseMap:s}}function g(){if(!u){var t=A(f.pairs,!0),e=t.map,n=t.reverseMap;u=e,d=n,p=A(f.canonical,!1).map}}function m(t){return g(),u.get(t)||null}function b(t){return g(),d.get(t)||null}function v(t){return g(),p.get(t)||null}var y=n.L,x=n.R,_=n.EN,E=n.ES,w=n.ET,C=n.AN,S=n.CS,M=n.B,I=n.S,T=n.ON,B=n.BN,R=n.NSM,P=n.AL,D=n.LRO,L=n.RLO,U=n.LRE,F=n.RLE,N=n.PDF,k=n.LRI,O=n.RLI,Q=n.FSI,G=n.PDI;var H,z="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1";function j(t){return function(){if(!H){var t=A(z,!0),e=t.map;t.reverseMap.forEach((function(t,n){e.set(n,t)})),H=e}}(),H.get(t)||null}function V(t,e,n,i){var r=t.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);var s=[];return e.paragraphs.forEach((function(r){var a=Math.max(n,r.start),o=Math.min(i,r.end);if(a<o){for(var l=e.levels.slice(a,o+1),u=o;u>=a&&h(t[u])&c;u--)l[u]=r.level;for(var d=r.level,p=1/0,f=0;f<l.length;f++){var A=l[f];A>d&&(d=A),A<p&&(p=1|A)}for(var g=d;g>=p;g--)for(var m=0;m<l.length;m++)if(l[m]>=g){for(var b=m;m+1<l.length&&l[m+1]>=g;)m++;m>b&&s.push([b+n,m+n])}}})),s}function W(t,e,n,i){for(var r=V(t,e,n,i),s=[],a=0;a<t.length;a++)s[a]=a;return r.forEach((function(t){for(var e=t[0],n=t[1],i=s.slice(e,n+1),r=i.length;r--;)s[n-r]=i[r]})),s}return t.closingToOpeningBracket=b,t.getBidiCharType=h,t.getBidiCharTypeName=function(t){return i[h(t)]},t.getCanonicalBracket=v,t.getEmbeddingLevels=function(t,e){for(var n=new Uint32Array(t.length),i=0;i<t.length;i++)n[i]=h(t[i]);var l=new Map;function u(t,e){var i=n[t];n[t]=e,l.set(i,l.get(i)-1),i&a&&l.set(a,l.get(a)-1),l.set(e,(l.get(e)||0)+1),e&a&&l.set(a,(l.get(a)||0)+1)}for(var d=new Uint8Array(t.length),p=new Map,f=[],A=null,g=0;g<t.length;g++)A||f.push(A={start:g,end:t.length-1,level:"rtl"===e?1:"ltr"===e?0:Ge(g,!1)}),n[g]&M&&(A.end=g,A=null);for(var H=F|U|L|D|r|G|N|M,z=function(t){return t+(1&t?1:2)},j=function(t){return t+(1&t?2:1)},V=0;V<f.length;V++){var W=[{_level:(A=f[V]).level,_override:0,_isolate:0}],q=void 0,X=0,Y=0,J=0;l.clear();for(var K=A.start;K<=A.end;K++){var Z=n[K];if(q=W[W.length-1],l.set(Z,(l.get(Z)||0)+1),Z&a&&l.set(a,(l.get(a)||0)+1),Z&H)if(Z&(F|U)){d[K]=q._level;var $=(Z===F?j:z)(q._level);$<=125&&!X&&!Y?W.push({_level:$,_override:0,_isolate:0}):X||Y++}else if(Z&(L|D)){d[K]=q._level;var tt=(Z===L?j:z)(q._level);tt<=125&&!X&&!Y?W.push({_level:tt,_override:Z&L?x:y,_isolate:0}):X||Y++}else if(Z&r){Z&Q&&(Z=1===Ge(K+1,!0)?O:k),d[K]=q._level,q._override&&u(K,q._override);var et=(Z===O?j:z)(q._level);et<=125&&0===X&&0===Y?(J++,W.push({_level:et,_override:0,_isolate:1,_isolInitIndex:K})):X++}else if(Z&G){if(X>0)X--;else if(J>0){for(Y=0;!W[W.length-1]._isolate;)W.pop();var nt=W[W.length-1]._isolInitIndex;null!=nt&&(p.set(nt,K),p.set(K,nt)),W.pop(),J--}q=W[W.length-1],d[K]=q._level,q._override&&u(K,q._override)}else Z&N?(0===X&&(Y>0?Y--:!q._isolate&&W.length>1&&(W.pop(),q=W[W.length-1])),d[K]=q._level):Z&M&&(d[K]=A.level);else d[K]=q._level,q._override&&Z!==B&&u(K,q._override)}for(var it=[],rt=null,st=A.start;st<=A.end;st++){var at=n[st];if(!(at&o)){var ot=d[st],ct=at&r,lt=at===G;rt&&ot===rt._level?(rt._end=st,rt._endsWithIsolInit=ct):it.push(rt={_start:st,_end:st,_level:ot,_startsWithPDI:lt,_endsWithIsolInit:ct})}}for(var ht=[],ut=0;ut<it.length;ut++){var dt=it[ut];if(!dt._startsWithPDI||dt._startsWithPDI&&!p.has(dt._start)){for(var pt=[rt=dt],ft=void 0;rt&&rt._endsWithIsolInit&&null!=(ft=p.get(rt._end));)for(var At=ut+1;At<it.length;At++)if(it[At]._start===ft){pt.push(rt=it[At]);break}for(var gt=[],mt=0;mt<pt.length;mt++)for(var bt=pt[mt],vt=bt._start;vt<=bt._end;vt++)gt.push(vt);for(var yt=d[gt[0]],xt=A.level,_t=gt[0]-1;_t>=0;_t--)if(!(n[_t]&o)){xt=d[_t];break}var Et=gt[gt.length-1],wt=d[Et],Ct=A.level;if(!(n[Et]&r))for(var St=Et+1;St<=A.end;St++)if(!(n[St]&o)){Ct=d[St];break}ht.push({_seqIndices:gt,_sosType:Math.max(xt,yt)%2?x:y,_eosType:Math.max(Ct,wt)%2?x:y})}}for(var Mt=0;Mt<ht.length;Mt++){var It=ht[Mt],Tt=It._seqIndices,Bt=It._sosType,Rt=It._eosType;if(l.get(R))for(var Pt=0;Pt<Tt.length;Pt++){var Dt=Tt[Pt];if(n[Dt]&R){for(var Lt=Bt,Ut=Pt-1;Ut>=0;Ut--)if(!(n[Tt[Ut]]&o)){Lt=n[Tt[Ut]];break}u(Dt,Lt&(r|G)?T:Lt)}}if(l.get(_))for(var Ft=0;Ft<Tt.length;Ft++){var Nt=Tt[Ft];if(n[Nt]&_)for(var kt=Ft-1;kt>=-1;kt--){var Ot=-1===kt?Bt:n[Tt[kt]];if(Ot&s){Ot===P&&u(Nt,C);break}}}if(l.get(P))for(var Qt=0;Qt<Tt.length;Qt++){var Gt=Tt[Qt];n[Gt]&P&&u(Gt,x)}if(l.get(E)||l.get(S))for(var Ht=1;Ht<Tt.length-1;Ht++){var zt=Tt[Ht];if(n[zt]&(E|S)){for(var jt=0,Vt=0,Wt=Ht-1;Wt>=0&&(jt=n[Tt[Wt]])&o;Wt--);for(var qt=Ht+1;qt<Tt.length&&(Vt=n[Tt[qt]])&o;qt++);jt===Vt&&(n[zt]===E?jt===_:jt&(_|C))&&u(zt,jt)}}if(l.get(_))for(var Xt=0;Xt<Tt.length;Xt++){var Yt=Tt[Xt];if(n[Yt]&_){for(var Jt=Xt-1;Jt>=0&&n[Tt[Jt]]&(w|o);Jt--)u(Tt[Jt],_);for(var Kt=Xt+1;Kt<Tt.length&&n[Tt[Kt]]&(w|o);Kt++)u(Tt[Kt],_)}}if(l.get(w)||l.get(E)||l.get(S))for(var Zt=0;Zt<Tt.length;Zt++){var $t=Tt[Zt];if(n[$t]&(w|E|S)){u($t,T);for(var te=Zt-1;te>=0&&n[Tt[te]]&o;te--)u(Tt[te],T);for(var ee=Zt+1;ee<Tt.length&&n[Tt[ee]]&o;ee++)u(Tt[ee],T)}}if(l.get(_))for(var ne=0,ie=Bt;ne<Tt.length;ne++){var re=Tt[ne],se=n[re];se&_?ie===y&&u(re,y):se&s&&(ie=se)}if(l.get(a)){for(var ae=x|_|C,oe=ae|y,ce=[],le=[],he=0;he<Tt.length;he++)if(n[Tt[he]]&a){var ue=t[Tt[he]],de=void 0;if(null!==m(ue)){if(!(le.length<63))break;le.push({char:ue,seqIndex:he})}else if(null!==(de=b(ue)))for(var pe=le.length-1;pe>=0;pe--){var fe=le[pe].char;if(fe===de||fe===b(v(ue))||m(v(fe))===ue){ce.push([le[pe].seqIndex,he]),le.length=pe;break}}}ce.sort((function(t,e){return t[0]-e[0]}));for(var Ae=0;Ae<ce.length;Ae++){for(var ge=ce[Ae],me=ge[0],be=ge[1],ve=!1,ye=0,xe=me+1;xe<be;xe++){var _e=Tt[xe];if(n[_e]&oe){ve=!0;var Ee=n[_e]&ae?x:y;if(Ee===ze(_e)){ye=Ee;break}}}if(ve&&!ye){ye=Bt;for(var we=me-1;we>=0;we--){var Ce=Tt[we];if(n[Ce]&oe){var Se=n[Ce]&ae?x:y;ye=Se!==ze(Ce)?Se:ze(Ce);break}}}if(ye){if(n[Tt[me]]=n[Tt[be]]=ye,ye!==ze(Tt[me]))for(var Me=me+1;Me<Tt.length;Me++)if(!(n[Tt[Me]]&o)){h(t[Tt[Me]])&R&&(n[Tt[Me]]=ye);break}if(ye!==ze(Tt[be]))for(var Ie=be+1;Ie<Tt.length;Ie++)if(!(n[Tt[Ie]]&o)){h(t[Tt[Ie]])&R&&(n[Tt[Ie]]=ye);break}}}for(var Te=0;Te<Tt.length;Te++)if(n[Tt[Te]]&a){for(var Be=Te,Re=Te,Pe=Bt,De=Te-1;De>=0;De--){if(!(n[Tt[De]]&o)){Pe=n[Tt[De]]&ae?x:y;break}Be=De}for(var Le=Rt,Ue=Te+1;Ue<Tt.length;Ue++){if(!(n[Tt[Ue]]&(a|o))){Le=n[Tt[Ue]]&ae?x:y;break}Re=Ue}for(var Fe=Be;Fe<=Re;Fe++)n[Tt[Fe]]=Pe===Le?Pe:ze(Tt[Fe]);Te=Re}}}for(var Ne=A.start;Ne<=A.end;Ne++){var ke=d[Ne],Oe=n[Ne];if(1&ke?Oe&(y|_|C)&&d[Ne]++:Oe&x?d[Ne]++:Oe&(C|_)&&(d[Ne]+=2),Oe&o&&(d[Ne]=0===Ne?A.level:d[Ne-1]),Ne===A.end||h(t[Ne])&(I|M))for(var Qe=Ne;Qe>=0&&h(t[Qe])&c;Qe--)d[Qe]=A.level}}return{levels:d,paragraphs:f};function Ge(e,i){for(var s=e;s<t.length;s++){var a=n[s];if(a&(x|P))return 1;if(a&(M|y)||i&&a===G)return 0;if(a&r){var o=He(s);s=-1===o?t.length:o}}return 0}function He(e){for(var i=1,s=e+1;s<t.length;s++){var a=n[s];if(a&M)break;if(a&G){if(0==--i)return s}else a&r&&i++}return-1}function ze(t){return 1&d[t]?x:y}},t.getMirroredCharacter=j,t.getMirroredCharactersMap=function(t,e,n,i){var r=t.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);for(var s=new Map,a=n;a<=i;a++)if(1&e[a]){var o=j(t[a]);null!==o&&s.set(a,o)}return s},t.getReorderSegments=V,t.getReorderedIndices=W,t.getReorderedString=function(t,e,n,i){var r=W(t,e,n,i),s=[].concat(t);return r.forEach((function(n,i){s[i]=(1&e.levels[n]?j(t[n]):null)||t[n]})),s.join("")},t.openingToClosingBracket=m,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return t}],init:(t,e,n)=>t(e,n())}),Ed=Uu({name:"Typesetter",dependencies:[_d],init:t=>function(e){return new Promise((n=>{t.typeset(e,n)}))},getTransferables(t){const e=[];for(let n in t)t[n]&&t[n].buffer&&e.push(t[n].buffer);return e}}),wd={};const Cd="aTroikaGlyphIndex";class Sd extends Zl{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new ke,this.boundingBox=new ye}computeBoundingSphere(){}computeBoundingBox(){}setSide(t){const e=this.getIndex().count;this.setDrawRange(t===d?e/2:0,t===p?e:e/2)}set detail(t){if(t!==this._detail){this._detail=t,("number"!=typeof t||t<1)&&(t=1);let e=function(t){let e=wd[t];if(!e){const n=new Xi(1,1,t,t),i=n.clone(),r=n.attributes,s=i.attributes,a=new ri,o=r.uv.count;for(let t=0;t<o;t++)s.position.array[3*t]*=-1,s.normal.array[3*t+2]*=-1;["position","normal","uv"].forEach((t=>{a.setAttribute(t,new Jn([...r[t].array,...s[t].array],r[t].itemSize))})),a.setIndex([...n.index.array,...i.index.array.map((t=>t+o))]),a.translate(.5,.5,0),e=wd[t]=a}return e}(t);["position","normal","uv"].forEach((t=>{this.attributes[t]=e.attributes[t].clone()})),this.setIndex(e.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,e,n,i,r){Md(this,"aTroikaGlyphBounds",t,4),Md(this,Cd,e,1),Md(this,"aTroikaGlyphColor",r,3),this._blockBounds=n,this._chunkedBounds=i,this.instanceCount=e.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:e,boundingBox:n}=this;if(e){const{PI:i,floor:r,min:s,max:a,sin:o,cos:c}=Math,l=i/2,h=2*i,u=Math.abs(e),d=t[0]/u,p=t[2]/u,f=r((d+l)/h)!==r((p+l)/h)?-u:s(o(d)*u,o(p)*u),A=r((d-l)/h)!==r((p-l)/h)?u:a(o(d)*u,o(p)*u),g=r((d+i)/h)!==r((p+i)/h)?2*u:a(u-c(d)*u,u-c(p)*u);n.min.set(f,t[1],e<0?-g:0),n.max.set(A,t[3],e<0?0:g)}else n.min.set(t[0],t[1],0),n.max.set(t[2],t[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let e=this.getAttribute(Cd).count,n=this._chunkedBounds;if(n)for(let i=n.length;i--;){e=n[i].end;let r=n[i].rect;if(r[1]<t.w&&r[3]>t.y&&r[0]<t.z&&r[2]>t.x)break}this.instanceCount=e}}function Md(t,e,n,i){const r=t.getAttribute(e);n?r&&r.array.length===n.length?(r.array.set(n),r.needsUpdate=!0):(t.setAttribute(e,new to(n,i)),delete t._maxInstanceCount,t.dispose()):r&&t.deleteAttribute(e)}const Id=new Gn({color:16777215,side:p,transparent:!0}),Td=8421504,Bd=new qe,Rd=new me,Pd=new me,Dd=[],Ld=new me,Ud="+x+y";function Fd(t){return Array.isArray(t)?t[0]:t}let Nd=()=>{const t=new _i(new Xi(1,1),Id);return Nd=()=>t,t},kd=()=>{const t=new _i(new Xi(1,1,32,1),Id);return kd=()=>t,t};const Od={type:"syncstart"},Qd={type:"synccomplete"},Gd=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Hd=Gd.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class zd extends _i{constructor(){super(new Sd,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Td,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Ud,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(Od),md({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},(e=>{this._isSyncing=!1,this._textRenderInfo=e,this.geometry.updateGlyphs(e.glyphBounds,e.glyphAtlasIndices,e.blockBounds,e.chunkedBounds,e.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{n.forEach((t=>t&&t()))}))),this.dispatchEvent(Qd),t&&t()}))))}onBeforeRender(t,e,n,i,r,s){this.sync(),r.isTroikaTextMaterial&&this._prepareForRender(r),r._hadOwnSide=r.hasOwnProperty("side"),this.geometry.setSide(r._actualSide=r.side),r.side=u}onAfterRender(t,e,n,i,r,s){r._hadOwnSide?r.side=r._actualSide:delete r.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let t=this._derivedMaterial;const e=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Id.clone());if(t&&t.baseMaterial===e||(t=this._derivedMaterial=function(t){const e=qu(t,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new zt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ue(0,0,0,0)},uTroikaClipRect:{value:new ue(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new zt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Nn},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new jt},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:t,fragmentShader:e}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(e)&&(e=e.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(t)||(t=t.replace(Ou,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:e}}});return e.transparent=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}(e),e.addEventListener("dispose",(function n(){e.removeEventListener("dispose",n),t.dispose()}))),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let e=t._outlineMtl;return e||(e=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),e.isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,t.addEventListener("dispose",(function n(){t.removeEventListener("dispose",n),e.dispose()}))),[e,t]}return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return Fd(this.material).getDepthMaterial()}get customDistanceMaterial(){return Fd(this.material).getDistanceMaterial()}_prepareForRender(t){const e=t.isTextOutlineMaterial,n=t.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:t,blockBounds:r}=i;n.uTroikaSDFTexture.value=t,n.uTroikaSDFTextureSize.value.set(t.image.width,t.image.height),n.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,n.uTroikaSDFExponent.value=i.sdfExponent,n.uTroikaTotalBounds.value.fromArray(r),n.uTroikaUseGlyphColors.value=!e&&!!i.glyphColors;let s,a,o,c=0,l=0,h=0,u=0,d=0;if(e){let{outlineWidth:t,outlineOffsetX:e,outlineOffsetY:n,outlineBlur:i,outlineOpacity:r}=this;c=this._parsePercent(t)||0,l=Math.max(0,this._parsePercent(i)||0),s=r,u=this._parsePercent(e)||0,d=this._parsePercent(n)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(o=this.strokeColor,n.uTroikaStrokeColor.value.set(null==o?Td:o),a=this.strokeOpacity,null==a&&(a=1)),s=this.fillOpacity;n.uTroikaDistanceOffset.value=c,n.uTroikaPositionOffset.value.set(u,d),n.uTroikaBlurRadius.value=l,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=a,n.uTroikaFillOpacity.value=null==s?1:s,n.uTroikaCurveRadius.value=this.curveRadius||0;let p=this.clipRect;if(p&&Array.isArray(p)&&4===p.length)n.uTroikaClipRect.value.fromArray(p);else{const t=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(r[0]-t,r[1]-t,r[2]+t,r[3]+t)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const r=e?this.outlineColor||0:this.color;if(null==r)delete t.color;else{const e=t.hasOwnProperty("color")?t.color:t.color=new Nn;r===e._input&&"object"!=typeof r||e.set(e._input=r)}let s=this.orientation||Ud;if(s!==t._orientation){let e=n.uTroikaOrient.value;s=s.replace(/[^-+xyz]/g,"");let i=s!==Ud&&s.match(/^([-+])([xyz])([-+])([xyz])$/);if(i){let[,t,n,r,s]=i;Rd.set(0,0,0)[n]="-"===t?1:-1,Pd.set(0,0,0)[s]="-"===r?-1:1,Bd.lookAt(Ld,Rd.cross(Pd),Pd),e.setFromMatrix4(Bd)}else e.identity();t._orientation=s}}_parsePercent(t){if("string"==typeof t){let e=t.match(/^(-?[\d.]+)%$/),n=e?parseFloat(e[1]):NaN;t=(isNaN(n)?0:n/100)*this.fontSize}return t}localPositionToTextCoords(t,e=new zt){e.copy(t);const n=this.curveRadius;return n&&(e.x=Math.atan2(t.x,Math.abs(n)-Math.abs(t.z))*Math.abs(n)),e}worldPositionToTextCoords(t,e=new zt){return Rd.copy(t),this.localPositionToTextCoords(this.worldToLocal(Rd),e)}raycast(t,e){const{textRenderInfo:n,curveRadius:i}=this;if(n){const r=n.blockBounds,s=i?kd():Nd(),a=s.geometry,{position:o,uv:c}=a.attributes;for(let t=0;t<c.count;t++){let e=r[0]+c.getX(t)*(r[2]-r[0]);const n=r[1]+c.getY(t)*(r[3]-r[1]);let s=0;i&&(s=i-Math.cos(e/i)*i,e=Math.sin(e/i)*i),o.setXYZ(t,e,n,s)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,s.matrixWorld=this.matrixWorld,s.material.side=this.material.side,Dd.length=0,s.raycast(t,Dd);for(let t=0;t<Dd.length;t++)Dd[t].object=this,e.push(Dd[t])}}copy(t){const e=this.geometry;return super.copy(t),this.geometry=e,Hd.forEach((e=>{this[e]=t[e]})),this}clone(){return(new this.constructor).copy(this)}}Gd.forEach((t=>{const e="_private_"+t;Object.defineProperty(zd.prototype,t,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})}));const jd=class{},Vd={sphere:new Zc(.1),box:new Vh(.2,.2,.2,2,.05),floor:new Xi(40,40,20,20).rotateX(-Math.PI/2),plane:new Xi(.8,.6)},Wd={plastic:new il({color:"white",metalness:0,roughness:.2}),"vertex-color-plastic":new il({color:"white",metalness:0,roughness:.2,vertexColors:!0}),plasticA:new il({color:"#71A9F7",metalness:0,roughness:.1}),plasticB:new il({color:"#DE3163",metalness:0,roughness:.2}),plasticC:new il({color:"#50C878",metalness:0,roughness:.3}),plasticD:new il({color:"#333333",metalness:0,roughness:.3}),gold:new il({color:"gold",metalness:.9,roughness:.2}),wireframe:new Gn({color:0,wireframe:!0}),shadow:new el({opacity:.4,color:"#000010"})},qd=1,Xd=2,Yd=4,Jd=8,Kd=String.raw;function Zd(t){const e=document.createElement("template");return e.innerHTML=t,e}const $d=new Map([[Object,iu({})],[xu,iu({})],[Da,iu({mixins:[t=>class extends t{static name="RendererSceneLoadedState";static shortHandEventDescriptions={ready:"Fired when all elements have successfully loaded."};async allAttributesChangedCallback(){await super.allAttributesChangedCallback(),this.classList.add("loading"),this.properties.scene&&this.properties.camera?(await this.properties.scene.object,this.object.compile(this.properties.scene.object,this.properties.camera)):console.warn("Scene started without camera or scene");let t=setTimeout((()=>{for(const t of this.sceneChildren)t.isShortHandElement&&!t.ready&&console.warn(`After 10 seconds ${Zh(t)} was not ready.`)}),1e4);Promise.all(Array.from(this.sceneChildren).map((t=>t.object instanceof Promise?t.object:null))).then((()=>{this.classList.remove("loading"),this.classList.add("ready"),this.emit("ready"),console.log(Zh(this)+": All elements ready."),Wd.shadow.needsUpdate=!0,clearTimeout(t)}))}}],"xr-session":{as:"session",type:"SHWebXRSessionConfig",stage:4,default:"sh-xr-session"},"tone-mapping":{as:"toneMapping",type:"number",default:"THREE.ACESFilmicToneMapping",stage:1},exposure:{example:1,as:"toneMappingExposure",default:1,stage:1},alpha:{stage:10},"logarithmic-depth-buffer":{as:"logarithmicDepthBuffer",default:!0,stage:1},"local-clipping":{as:"localClippingEnabled",default:!1,stage:1},antialias:{default:!0,stage:2},scene:{type:"Element",stage:4},camera:{type:"Camera",stage:4},shadows:{as:"shadowMapEnabled",default:!0,stage:4},"shadow-type":{as:"shadowMapType",type:"number",default:"THREE.VSMShadowMap",stage:4,map:{basic:"THREE.BasicShadowMap",hard:"THREE.PCFShadowMap",soft:"THREE.PCFSoftShadowMap",vsm:"THREE.VSMShadowMap"}}})],[xn,iu({"layer-mask":{as:"layers.mask",type:"number"},location:{as:"position",type:"Vector3",stage:1},scale:{as:"scale",type:"Vector3",stage:1},rotate:{as:"rotation",type:"Euler",stage:1},quaternion:{type:"Quaternion",stage:1},visibility:{as:"visible",type:"boolean",stage:1,map:{hidden:"false",visible:"true"}}})],[wa,iu({})],[Li,iu({fov:{default:70,constructorArgument:0},near:{default:.01,constructorArgument:2},far:{default:2e3,constructorArgument:3}})],[Fl,iu({color:{type:"Color",example:"skyblue"},intensity:{type:"number",example:1},"cast-shadow":{as:"castShadow",default:!0},"shadow-samples":{as:"shadow.blurSamples",default:3},"shadow-bias":{as:"shadow.bias",default:-2e-5},"shadow-radius":{as:"shadow.radius",type:"number"},"shadow-map-size":{as:"shadow.mapSize",type:"Vector2",default:"512 512"},"shadow-normal-bias":{as:"shadow.normalBias",default:1e-4},"shadow-far":{as:"shadow.camera.far",type:"number"}})],[Jl,iu({"cast-shadow":void 0,"shadow-samples":void 0,"shadow-bias":void 0,"shadow-map-size":void 0,"shadow-normal-bias":void 0,"shadow-far":void 0})],[Hl,iu({distance:{type:"number"}})],[ql,iu({distance:{type:"number"}})],[_i,iu({geometry:{type:"BufferGeometry",constructorArgument:0,map:Vd,example:"#sphere-geometry"},material:{type:"Material[]?",constructorArgument:1,map:Wd,example:"#my-material"},"depth-material":{as:"customDepthMaterial",type:"Material"},"cast-shadow":{as:"castShadow",default:!0,stage:1},"receive-shadow":{as:"receiveShadow",default:!1,stage:1}})],[Do,iu({material:{type:"Material",default:"black",constructorArgument:1,map:{black:new Mo({color:0}),white:new Mo({color:16777215}),dashed:new ol({color:0})}},geometry:{type:"BufferGeometry",constructorArgument:0,example:"path(M-.1.3.5-.4.8-.5.7-.2 0 .4C.1.5.1.6.2.5.2.6.3.7.2.7A.142.142 90 01.1.8.5.5 90 00-.1.5Q-.15.49-.15.55T-.3.68-.38.6-.25.45-.2.4A.5.5 90 00-.5.2.142.142 90 01-.4.1C-.4 0-.3.1-.2.1-.3.2-.2.2-.1.3M.5-.4.5-.2.7-.2.52-.22.5-.4)"}})],[Ua,iu({mixins:[t=>class extends t{static name="SceneHTML";static template=Zd(Kd`
      <style> :host { position: relative; } </style>
      <slot></slot>
    `)}],"background-intensity":{as:"backgroundIntensity",type:"number",stage:1},"background-color":{as:"background",type:"Color",stage:1},"background-image":{as:"background",type:"Texture",stage:1,example:"linear-gradient(0deg, #09131e, #5f4f00 48%, orange 48%, rgba(246,255,144,1) 49%, rgba(40,170,196,1) 69%, rgba(9,9,121,1) 100%)"},environment:{as:"environment",type:"Texture",stage:1,example:"linear-gradient(0deg, #09131e, #5f4f00 48%, orange 48%, rgba(246,255,144,1) 49%, rgba(40,170,196,1) 69%, rgba(9,9,121,1) 100%)"},"background-blur":{as:"backgroundBlurriness",default:0,stage:1}})],[he,iu({repeat:{type:"Vector2",default:"1 1",stage:1},offset:{type:"Vector2",default:"1 1",stage:1},"wrap-s":{as:"wrapS",type:"number",default:"THREE.RepeatWrapping",stage:1},"wrap-t":{as:"wrapT",type:"number",default:"THREE.RepeatWrapping",stage:1},mapping:{type:"number",default:"THREE.UVMapping",stage:1,map:{standard:300,reflection:T,refraction:B}},"flip-y":{as:"flipY",type:"boolean",stage:1}})],[Qn,iu({color:{type:"Color"},fog:{type:"boolean"},"alpha-hash":{as:"alphaHash",type:"boolean"},"alpha-to-coverage":{as:"alphaToCoverage",type:"boolean"},"alpha-test":{as:"alphaTest",type:"number"},"depth-write":{as:"depthWrite",type:"boolean"},map:{type:"Texture",stage:1,needsUpdate:!0,map:{none:null}},"vertex-colors":{as:"vertexColors",type:"boolean"},"backface-visibility":{as:"side",type:"number",map:{visible:p,hidden:u,only:d}},"tone-mapped":{as:"toneMapped",type:"boolean"},dithering:{type:"boolean"},visibility:{as:"visible",type:"boolean",map:{visible:!0,hidden:!1}},opacity:{type:"number"},transparent:{type:"boolean"},"environment-map":{as:"envMap",type:"Texture",stage:1,needsUpdate:!0,map:{none:null}},"normal-map":{as:"normalMap",type:"Texture",stage:1,needsUpdate:!0,map:{none:null}},"normal-scale":{as:"normalScale",type:"Vector2",stage:1},"displacement-map":{as:"displacementMap",type:"Texture",stage:1,needsUpdate:!0,map:{none:null}},"displacement-bias":{as:"displacementBias",type:"number",stage:1},"displacement-scale":{as:"displacementScale",type:"number",stage:1},"light-map":{as:"lightMap",type:"Texture",stage:1,needsUpdate:!0,map:{none:null}},"light-map-intensity":{as:"lightMapIntensity",type:"number",stage:1},"mix-blend-mode":{as:"blending",type:"number",map:{normal:"THREE.NormalBlending",multiply:"THREE.MultiplyBlending",lighten:"THREE.AdditiveBlending",difference:"THREE.SubtractiveBlending"}}})],[Gn,iu({"tone-mapped":{as:"toneMapped",default:!1}})],[rl,iu({"bump-map":{as:"bumpMap",type:"Texture",stage:1,needsUpdate:!0,map:{none:null}},"bump-scale":{as:"bumpScale",default:1},shininess:{type:"number"},reflectivity:{type:"number"},reflectivity:{type:"number"},"refraction-ratio":{as:"refractionRatio",type:"number"},emissive:{type:"Color"},"emissive-intensity":{as:"emissiveIntensity",type:"number"},combine:{default:g,map:{mix:g,add:m,multiply:A}}})],[ma,iu({"depth-packing":{as:"depthPacking",type:"number",map:{depth:gt,basic:3200}}})],[nl,iu({metalness:{type:"number"},roughness:{type:"number"},"roughness-map":{as:"roughnessMap",type:"Texture",stage:1,needsUpdate:!0,map:{none:null}},emissive:{type:"Color"},"emissive-intensity":{as:"emissiveIntensity",type:"number"}})],[il,iu({transmission:{type:"number"},thickness:{type:"number"}})],[sl,iu({})],[ri,iu({mixins:[t=>class extends t{static name="GeometryModifiers";static documentation="The position/scale/quaternion/rotation properties should not be updated once set.";allAttributesChangedCallback(){return super.allAttributesChangedCallback().then((()=>{this.properties.location&&"object"==typeof this.properties.location&&this.object.translate(this.properties.location.x,this.properties.location.y,this.properties.location.z),this.properties.quaternion&&this.object.applyQuaternion(this.properties.quaternion),this.properties.scale&&this.object.scale(this.properties.scale.x,this.properties.scale.y,this.properties.scale.z),this.properties.rotate&&(0!==this.properties.rotate.x&&this.object.rotateX(this.properties.rotate.x),0!==this.properties.rotate.y&&this.object.rotateY(this.properties.rotate.y),0!==this.properties.rotate.z&&this.object.rotateZ(this.properties.rotate.z))}))}}],location:{type:"Vector3",stage:12},scale:{type:"Vector3",stage:12},rotate:{type:"Euler",stage:12},quaternion:{type:"Quaternion",stage:12}})],[Zc,iu({radius:{constructorArgument:0,default:.5,stage:8},"width-segments":{as:"widthSegments",constructorArgument:1,default:32,stage:8},"height-segments":{as:"heightSegments",constructorArgument:2,default:16,stage:8}})],[bc,iu({radius:{constructorArgument:0,default:.5,stage:8},segments:{constructorArgument:1,default:32,stage:8}})],[vc,iu({"radius-top":{constructorArgument:0,default:.5,stage:8},"radius-bottom":{constructorArgument:1,default:.5,stage:8},height:{constructorArgument:2,default:1,stage:8},"segments-radial":{constructorArgument:3,default:32,stage:8},"segments-height":{constructorArgument:4,default:1,stage:8},open:{constructorArgument:5,default:!1,stage:8},"sweep-start":{constructorArgument:6,type:"angle",default:0,stage:8},"sweep-length":{constructorArgument:7,type:"angle",default:360,stage:8}})],[Jc,iu({"inner-radius":{constructorArgument:0,default:.2,stage:8},"outer-radius":{constructorArgument:1,default:.5,stage:8},"round-segments":{constructorArgument:2,default:16,stage:8},"radial-segments":{constructorArgument:3,default:1,stage:8}})],[wi,iu({width:{constructorArgument:0,default:1,stage:8},height:{constructorArgument:1,default:1,stage:8},depth:{constructorArgument:2,default:1,stage:8},segments:{constructorArgument:3,default:2,stage:8}})],[Vh,iu({radius:{constructorArgument:4,default:.2,stage:8}})],[Xi,iu({width:{constructorArgument:0,default:1,stage:8},height:{constructorArgument:1,default:1,stage:8},"width-segments":{as:"widthSegments",constructorArgument:2,default:2,stage:8},"height-segments":{as:"heightSegments",constructorArgument:3,default:2,stage:8}})],[Wh,iu({geometry:void 0,material:void 0,texture:{type:"Texture",constructorArgument:0,stage:8},height:{default:1.6,constructorArgument:1,stage:1},radius:{default:10,constructorArgument:2,stage:1},"cast-shadow":{as:"castShadow",default:!1,stage:1}})],[Fh,iu({size:{constructorArgument:0,default:10,stage:8},divisions:{constructorArgument:1,default:40,stage:8},"color-a":{as:"color",constructorArgument:4,type:"Color",default:"white",stage:8},"color-b":{as:"colorB",constructorArgument:5,type:"Color",default:"white",stage:8},geometry:void 0})],[Nh,iu({radius:{constructorArgument:0,default:5,stage:8},sectors:{constructorArgument:1,default:16,stage:8},rings:{constructorArgument:2,default:8,stage:8},divisions:{constructorArgument:3,default:32,stage:8},"color-a":{as:"color",constructorArgument:4,type:"Color",default:"white",stage:8},"color-b":{as:"colorB",constructorArgument:5,type:"Color",default:"white",stage:8},geometry:void 0})],[Mo,iu({})],[ol,iu({"dash-size":{as:"dashSize",type:"number"},"gap-size":{as:"gapSize",type:"number"}})],[zd,iu({mixins:[t=>class extends t{static name="Text";static documentation="You can set the text content by having it as the text of the element itself e.g. `<sh-text>Hellow world</sh-text>`";static template=Zd(Kd`
        <style> :host { visibility: hidden; } </style>
        <slot name="text"></slot>
        <slot><slot>
      `);noGeometryBVH=!0;#o;#c;constructor(){super(),this.#c=this.#l.bind(this),this.classList.add("text-loading"),this.part.add("text-loading")}#h=null;tick(t,e,n,i,r){if(super.tick(t,e,n,i,r),!(this.object instanceof Promise)){const t=this.getStringContent();this.#h!==t&&(this.#h=t,this.object.text=this.getStringContent(),this.object.sync(this.#c))}}#l(){const t=this.object.geometry.boundingBox,e=this.properties.padding,n=e[0],i=void 0===e[1]?n:e[1],r=void 0===e[2]?n:e[3],s=void 0===e[3]?i:e[3],a=t.max.y-t.min.y+n+r;this.style.setProperty("--text-box-width",t.max.x-t.min.x+s+i),this.style.setProperty("--text-box-height",a),this.style.setProperty("--text-box-left",t.min.x-s),this.style.setProperty("--text-box-right",t.max.x+i),this.style.setProperty("--text-box-bottom",t.min.y-r-a),this.style.setProperty("--text-box-top",t.max.y+n-a),this.style.setProperty("--text-box-radius",this.properties.textBoxRadius)}getStringContent(){return this.#o=this.#o||this.shadowRoot.querySelector('slot[name="text"]'),function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\n/g,"")).replace(/\t/g,"")).replace(/<\/td>/g,"\t")).replace(/<\/table>/g,"\n")).replace(/<\/tr>/g,"\n")).replace(/<\/p>/g,"\n\n")).replace(/<\/div>/g,"\n")).replace(/<\/h>/g,"\n")).replace(/<br>/g,"\n")).replace(/<br( )*\/>/g,"\n"),au.parseFromString("<!doctype html><body>"+t,"text/html").body.textContent.trim()}(this.#o.assignedNodes().map((t=>t.outerHTML?t.outerHTML:t.textContent)).join(""))}async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i),this.object instanceof Promise||this.object.sync(this.#c)}async allAttributesChangedCallback(){const t=new zd;await this.assignPostConstructAttributes(t),t.text=this.getStringContent(),t.sync((()=>{this.updateObject(t),this.#l(),this.classList.remove("text-loading"),this.classList.add("text-rendering-finished"),this.part.remove("text-loading"),this.part.add("text-rendering-finished")})),this.updateObject(t)}}],padding:{default:"0 0 0 0",type:"number[]",stage:4},"text-box-radius":{as:"textBoxRadius",default:0,stage:4,noCustomPropertyRegistration:!0},"anchor-x":{as:"anchorX",type:"string",stage:1},"anchor-y":{as:"anchorY",type:"string",stage:1},"clip-rect":{as:"clipRect",type:"number[]",stage:1},color:{type:"Color",stage:1},"stroke-color":{as:"strokeColor",type:"Color",stage:1},"stroke-width":{as:"strokeWidth",type:"string",stage:1},material:{type:"Material",stage:1,map:Wd},geometry:void 0,"text-align":{as:"textAlign",type:"string",stage:1},font:{type:"string",stage:1},"font-size":{as:"fontSize",type:"number",stage:1},"fill-opacity":{as:"fillOpacity",type:"number",stage:1},radius:{as:"curveRadius",type:"number",stage:1},width:{as:"maxWidth",type:"number",stage:1}})]]);$d.STORED_ON_EL=4,$d.ASSIGNED_AFTER_CONSTRUCTION=1,$d.REQUIRES_RECONSTRUCT=8,$d.ASSIGNED_IN_CONSTRUCTOR=2;var tp=Object.freeze({__proto__:null,ASSIGNED_AFTER_CONSTRUCTION:1,ASSIGNED_IN_CONSTRUCTOR:2,AnimationActionSymbol:jd,REQUIRES_RECONSTRUCT:8,STORED_ON_EL:4,defaultGeomMap:Vd,materialMap:Wd,schemas:$d});const ep=new FinalizationRegistry((t=>{for(const e of t)e.dispose()})),np=new ge,ip=new ge,rp=["number","Quaternion","Vector3","Vector2","Euler","Color"],sp=/^(will-change|id|class|slot|part|style|data-.*|is)$/i,ap=t=>class extends t{static THREEClass;static shortHandSchema=iu({mixins:[vu],transition:{type:"Map<string,number>",stage:4,customPropertySyntax:"*"}});static name="ShortHandElement";static canProxy=!0;static tickPriority=0;#u=new FinalizationRegistry((t=>{console.log(`${t} on ${this.tagName.toLowerCase()} references a cleaned up element.`),this.attributeChangedCallback(t,this.attributes.getNamedItem(t)||"",null)}));isShortHandElement=!0;ready=!1;object;#d;#p=new Map;#f;#A;#g;#m;#b;#v;#y;#x;#_={};postConstruct=new Map;constructorArguments=[];#E={};#w={};#C={};properties={};constructor(){super();const t=new Proxy({},{get:(t,e)=>this.shadowRoot.querySelector(`[ref="${e}"]`)});Object.defineProperty(this,"refs",{get:()=>t}),this.object=new Promise((t=>this.#g=t)),this.#f=new Promise((t=>this.#A=t)),this.#y=new Promise((t=>this.#x=t)),this.#m=new Set,this.#b=new Set,setTimeout((()=>{this.#m.size&&(console.log(`After 4 seconds, ${Zh(this)} still has ${Array.from(this.#m).join(", ")} undefined so it cannot be used.`),console.log(this))}),4e3),this.#S();for(const t of this.constructor.shortHandAttributes){const e=this.constructor.defaultAttributeValue(t),n=this.constructor.shortHandSchema.get(t),{stage:i,constructorArgument:r}=this.#M(t);void 0===e&&"number"==typeof r&&this.#m.add(t);let s=this.attributes.getNamedItem(t)?.value;if("none"===s&&void 0===n?.map?.none&&(s=null),s&&(1&i?this.#b.add(t):this.#m.add(t)),void 0!==e){let n=this.stringToValue(t,e);n instanceof Promise||this.populateConstructorHelper(t,n,!0)}}if(!this.constructor.noWarnForUnrecognisedAttributes)for(const{name:t}of this.attributes)this.constructor.shortHandSchema.has(t)||t.match(sp)||t in this||console.warn(`${Zh(this)} Unrecognised attribute: "${t}"`)}#S(){this.constructor.template&&(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(this.constructor.template.content,!0)))}#I=new Map;populateConstructorHelper(t,e,n){this.#I.set(t,Symbol("Property updated"));const i=this.constructor.shortHandSchema.get(t),r=i.as||t,s=i.multipartAs,a=this.constructor.shortHandSchema.get(t).stage||2,o=this.constructor.shortHandSchema.get(t).constructorArgument;n||(this.#m.delete(t),this.#b.delete(t)),"number"==typeof o?(this.constructorArguments[o]=e,8&a||this.postConstruct.set(s||r,e)):2&a?(s||(this.#_[r]=e),8&a||this.postConstruct.set(s||r,e)):4&a?this.properties[r]=e:1&a&&this.postConstruct.set(s||r,e)}tick(t,e,n,i,r){for(const t in this.#C){const[n,i,r,s,a]=this.#C[t],o=this.properties.transition.get(t),c=this.#E[t];if(o){if(c<1){const n=e/o,i=Math.min(1,c+n),r=eu(i);this.#E[t]=i,this.#w[t]=r}}else this.#E[t]=1,this.#w[t]=1;if(this.#w[t]>=1&&(this.#w[t]=1,delete this.#C[t]),rp.includes(a))switch(a){case"number":n[i]=nu(r,s,this.#w[t]);break;case"Quaternion":n[i].slerpQuaternions(r,s,this.#w[t]);break;case"Euler":np.setFromEuler(r),ip.setFromEuler(s),np.slerp(ip,this.#w[t]),n[i].setFromQuaternion(np,n[i].order);break;case"Vector3":case"Vector2":n[i].lerpVectors(r,s,this.#w[t]);break;case"Color":n[i].lerpColors(r,s,this.#w[t])}}}async connectedCallback(){this.ready||this.#v||0!==this.#b.size||0!==this.#m.size||(this.#v=!0,this.#x(),await this.allAttributesChangedCallback(),this.#v=!1,this.ready=!0),this.#A(),0===this.#b.size&&0===this.#m.size&&this.#x()}async disconnectedCallback(){this.#f=new Promise((t=>this.#A=t))}static defaultAttributeValue(t){const e=this.getSchemaEntry(t);if(void 0!==e.default)return e.default}async attributeChangedCallback(t,e,n){if(e===n)return;const i=this.constructor.shortHandSchema.get(t),{stage:r,property:s,needsUpdate:a}=this.#M(t,n);"none"===(n=n||null)&&void 0===i?.map?.none&&(n=null),this.ready||null!==e||null===n||(1&r?this.#b.add(t):this.#m.add(t));const o=Symbol("Intention to update "+t);if(this.#I.set(t,o),await this.#f,null===n&&(n=this.constructor.defaultAttributeValue(t)),void 0===n)return;let c;const l=i.type||typeof i.default;if(t&&this.properties.transition&&this.properties.transition.has(t)&&rp.includes(l)){let e,n=4&r?this.properties:this.object;if(this.#C[t])e=this.#C[t][3];else if(s.includes(".")){const t=s.split(".");for(;n&&t.length>1;)n=n[t.shift()];n&&(e=n[t.pop()])}else e=n[s];c=e?.clone?e.clone():e}let h=this.stringToValue(t,n);if(h instanceof Promise){this.#p.set(t,h);const e=await h;if(this.#p.get(t)!==h)return;h=e}else this.#p.set(t,null);if(void 0!==h&&this.#I.get(t)===o&&this.populateConstructorHelper(t,h),this.#m.delete(t),this.#b.delete(t),0===this.#b.size&&0===this.#m.size&&this.#x(),this.ready&&void 0!==h)if(8&r)this.ready=!1,this.object instanceof Promise||"function"!=typeof this.object.dispose||this.object.dispose(),this.object=new Promise((t=>this.#g=t));else if(4&r){const e=this.properties[s];"function"!=typeof e.dispose||e.el||e.dispose();const n=i.type||typeof i.default;if(void 0!==c&&this.properties.transition&&this.properties.transition.has(t)&&rp.includes(n)){const e=this.properties;this.#C[t]=[e,s,c,h.clone?h.clone():h,n],this.#E[t]=0,this.#w[t]=0}else this.properties[s]=h}else{const e=await this.object,n=i.multipartAs;let r=e;if(n)for(let e=0,s=n.length;e<s;e++)e===s-1?this.#T(r,n[e],c,h,a,t,i):r=r[n[e]];else this.#T(e,s,c,h,a,t,i)}if(!this.ready&&!this.#v&&0===this.#m.size)try{this.#v=!0,await this.allAttributesChangedCallback(),this.#v=!1,this.ready=!0}catch(t){console.error(Zh(this),t)}}#T(t,e,n,i,r,s,a){const o=s?a.type||typeof a.default:void 0;null===t[e]||"object"!=typeof t[e]||"function"!=typeof t[e].copy||i instanceof he||t[e]instanceof he||i instanceof ri||t[e]instanceof ri||i instanceof Qn||t[e]instanceof Qn||i instanceof _i||t[e]instanceof _i?s&&void 0!==n&&this.properties.transition&&this.properties.transition.has(s)&&rp.includes(o)?(this.#C[s]=[t,e,n,i,a.type||typeof a.default],this.#E[s]=0,this.#w[s]=0):t[e]=i:s&&void 0!==n&&this.properties.transition&&this.properties.transition.has(s)&&rp.includes(o)?(this.#C[s]=[t,e,n,i.clone(),a.type||typeof a.default],this.#E[s]=0,this.#w[s]=0):t[e].copy(i),r&&(t.needsUpdate=!0)}static getSchemaEntry(t){return this.shortHandSchema.get(t)}#M(t){const e=this.constructor.getSchemaEntry(t),n=e.as||t,i=!0===e.needsUpdate;return{stage:this.constructor.shortHandSchema.get(t).stage||2,constructorArgument:this.constructor.shortHandSchema.get(t).constructorArgument,property:n,needsUpdate:i}}async allAttributesChangedCallback(){let t;t=this.constructorArguments.length?new this.constructor.THREEClass(...this.constructorArguments):new this.constructor.THREEClass(this.#_),await this.assignPostConstructAttributes(t),this.updateObject(t)}async assignPostConstructAttributes(t){await this.#y;for(const[e,n]of this.postConstruct.entries())if(void 0!==n)if(e instanceof Array){let i=t;for(let t=0,r=e.length;t<r;t++)t===r-1?this.#T(i,e[t],null,n):i=i[e[t]]}else this.#T(t,e,null,n)}updateObject(t,...e){if(void 0!==this.#d)for(const t of this.#d)t.dispose();this.id&&Object.prototype.hasOwnProperty.call(t,"name")&&!t.name&&(t.name=this.id);const n=new WeakRef(this);Object.defineProperty(t,"el",{get:()=>n.deref(),configurable:!0}),t.self=t,this.#g(t),this.object=t;const i=e;this.#d=i,"function"==typeof t.dispose&&i.push(t),ep.register(this,i)}emit(t,e,n=!0,i=!1,r=!1){i||this.constructor?.shortHandEventNames?.has(t)||console.warn(`${Zh(this)} fired event "${t}" but it is not documented from any mixin.`);const s=new Jh(t,Object.assign({detail:e},{bubbles:n,composed:!0,cancelable:r}));return this.dispatchEvent(s),s}objectAssigned(t,e){this.#u.register(e,t)}onAssign(t,e){}stringToValue(t,e){}};function op(t,e,n,i){for(const[r,s]of e)"mixins"===r?t.get("mixins").push(...s):s?t.get(r)!==s&&(n&&n.set(r,i),t.set(r,s)):t.delete(r)}const cp=new Set,lp=new Map,hp=[],up="",dp=new Map,pp=new Map;function fp(t,e){const n={inherits:!1,initialValue:"none"};for(const[i,r]of e.entries()){r.as&&r.as.includes(".")&&(r.multipartAs=r.as.split("."));let e=!0;(r.noCustomPropertyRegistration||void 0!==r.map?.none)&&(e=!1);const s=r.type||typeof r.default;if(n.name="--"+i,r.customPropertySyntax?(n.syntax=r.customPropertySyntax,e=!0):"number"===s?n.syntax="<number>|<custom-ident>|none":"Color"===s?n.syntax="<color>|<custom-ident>|none":"angle"===s?n.syntax="<angle>|<custom-ident>|none":"percentage"===s?n.syntax="<percentage>|<custom-ident>|none":"Vector3"===s||"Vector2"===s||"Euler"===s||"Quaternion"===s?n.syntax="<number>+|<custom-ident>|none":"boolean"===s?n.syntax="true|false|<custom-ident>|none":(n.syntax="*",e=!1),pp.has(i)&&(e&&pp.get(i).syntax!==n.syntax&&console.warn(`${t}: Trying to redefine CSS property syntax for property ${i} as ${n.syntax}, is is already registered as ${pp.get(i).syntax} in ${pp.get(i).elementName}`),e=!1),e)try{window.CSS.registerProperty(n),pp.set(i,{elementName:t,syntax:n.syntax})}catch(e){console.warn(`${t}:--${i} ${e.message}`)}}}function Ap(t,e){const n=lp.get(t),i=new Map([["mixins",[]]]);op(i,n.class.shortHandSchema),dp.set(t,i);const r=class extends(e(n.class)){};r.shortHandSchema&&op(i,r.shortHandSchema),fp(t,i);const s=Object.freeze([...i.keys()]),a=Object.freeze(["will-change",...s]),o=class extends r{static shortHandSchema=i;static shortHandAttributes=s;static get observedAttributes(){return a}};return n.class=o,o}function gp(t,{type:e,mixin:n,native:i}){cp.add(t);let r=i?i.class:HTMLElement;const s=new Map([["mixins",[]]]),a=[],o=new Set,c=new Map,l=new Set;let h=0,u="",d="";function p(t){if(!t||l.has(t))return;l.add(t);const e=r.signature||r.name;if(r=function(t){if(lu.has(t))return lu.get(t);const e=new Map,n=function(n){if(e.has(n))return e.get(n);const i=t(n);return e.set(n,i),i};return lu.set(t,n),n}(t)(r),r.documentation&&r.documentation!==d&&(d=r.documentation,u+="\n\n"+r.documentation),r.name||console.warn("No name for ",t),r.signature=e+up+r.name,r.shortHandSchema&&op(s,r.shortHandSchema,c,r.name),r.shortHandEventDescriptions)for(const[t,e]of Object.entries(r.shortHandEventDescriptions))a.push({eventName:t,description:e,source:r.name}),o.add(t);Number.isFinite(r.documentationPriority)?h+=r.documentationPriority:h-=1;for(const t of s.get("mixins"))p(t)}p(ap);for(const[t,n]of $d.entries())e.prototype instanceof t&&op(s,n,c,"Schema Entry for "+t.name);for(;s.get("mixins").length;)for(const t of s.get("mixins").splice(0))p(t);for(const[t,n]of $d.entries())e===t&&op(s,n,c,"Schema Entry for "+t.name);for(;s.get("mixins").length;)for(const t of s.get("mixins").splice(0))p(t);for(p(n);s.get("mixins").length;)for(const t of s.get("mixins").splice(0))p(t);s.delete("mixins"),fp(t,s);const f=Object.freeze([...s.keys()]),A=Object.freeze(["will-change",...f]),g=class extends r{static THREEClass=e;static name=function(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}(t);static shortHandEventNames=o;static shortHandSchema=s;static shortHandAttributes=f;static get observedAttributes(){return A}};lp.set(t,{type:e,mixin:n,class:g}),dp.set(t,s),"object"!=typeof process&&queueMicrotask((()=>customElements.define(t,lp.get(t).class,i&&{extends:i.tagName})))}class mp{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const n=this.workersResolve[t];if(n&&n(e),this.queue.length){const{resolve:e,msg:n,transfer:i}=this.queue.shift();this.workersResolve[t]=e,this.workers[t].postMessage(n,i)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise((n=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(t,e)):this.queue.push({resolve:n,msg:t,transfer:e})}))}dispose(){this.workers.forEach((t=>t.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const bp=2,vp=0,yp=1,xp=10;class _p{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Ep{constructor(t,e,n,i){this._dataView=new DataView(t.buffer,t.byteOffset+e,n),this._littleEndian=i,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_skip(t){return this._offset+=t,this}_scan(t,e=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==e&&i<t;)i++,this._offset++;return i<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const wp=[171,75,84,88,32,50,48,187,13,10,26,10];function Cp(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}let Sp,Mp,Ip;const Tp={env:{emscripten_notify_memory_growth:function(t){Ip=new Uint8Array(Mp.exports.memory.buffer)}}};class Bp{init(){return Sp||(Sp="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Rp).then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,Tp))).then(this._init):WebAssembly.instantiate(Buffer.from(Rp,"base64"),Tp).then(this._init),Sp)}_init(t){Mp=t.instance,Tp.env.emscripten_notify_memory_growth(0)}decode(t,e=0){if(!Mp)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=t.byteLength,i=Mp.exports.malloc(n);Ip.set(t,i),e=e||Number(Mp.exports.ZSTD_findDecompressedSize(i,n));const r=Mp.exports.malloc(e),s=Mp.exports.ZSTD_decompress(r,e,i,n),a=Ip.slice(r,r+s);return Mp.exports.free(i),Mp.exports.free(r),a}}const Rp="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Pp=new WeakMap;let Dp,Lp=0;class Up extends Tl{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new mp,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}async detectSupportAsync(t){return this.workerConfig={astcSupported:await t.hasFeatureAsync("texture-compression-astc"),etc1Supported:await t.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await t.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await t.hasFeatureAsync("texture-compression-bc"),bptcSupported:await t.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await t.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(t){return!0===t.isWebGPURenderer?this.workerConfig={astcSupported:t.hasFeature("texture-compression-astc"),etc1Supported:t.hasFeature("texture-compression-etc1"),etc2Supported:t.hasFeature("texture-compression-etc2"),dxtSupported:t.hasFeature("texture-compression-bc"),bptcSupported:t.hasFeature("texture-compression-bptc"),pvrtcSupported:t.hasFeature("texture-compression-pvrtc")}:(this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new Pl(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),n=new Pl(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,i]).then((([t,e])=>{const n=Up.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(Up.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Up.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Up.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=e,this.workerPool.setWorkerCreator((()=>{const t=new Worker(this.workerSourceURL),e=this.transcoderBinary.slice(0);return t.postMessage({type:"init",config:this.workerConfig,transcoderBinary:e},[e]),t}))})),Lp>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Lp++}return this.transcoderPending}load(t,e,n,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Pl(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(t,(t=>{if(Pp.has(t)){return Pp.get(t).promise.then(e).catch(i)}this._createTexture(t).then((t=>e?e(t):null)).catch(i)}),n,i)}_createTextureFrom(t,e){const{faces:n,width:i,height:r,format:s,type:a,error:o,dfdFlags:c}=t;if("error"===a)return Promise.reject(o);let l;if(6===e.faceCount)l=new Xo(n,s,Q);else{const t=n[0].mipmaps;l=e.layerCount>1?new qo(t,i,r,e.layerCount,s,Q):new Wo(t,i,r,s,Q)}return l.minFilter=1===n[0].mipmaps.length?N:O,l.magFilter=N,l.generateMipmaps=!1,l.needsUpdate=!0,l.colorSpace=Op(e),l.premultiplyAlpha=!!(1&c),l}async _createTexture(t,e={}){const n=function(t){const e=new Uint8Array(t.buffer,t.byteOffset,wp.length);if(e[0]!==wp[0]||e[1]!==wp[1]||e[2]!==wp[2]||e[3]!==wp[3]||e[4]!==wp[4]||e[5]!==wp[5]||e[6]!==wp[6]||e[7]!==wp[7]||e[8]!==wp[8]||e[9]!==wp[9]||e[10]!==wp[10]||e[11]!==wp[11])throw new Error("Missing KTX 2.0 identifier.");const n=new _p,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new Ep(t,wp.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();const s=r._nextUint32();n.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),o=r._nextUint32(),c=r._nextUint32(),l=r._nextUint32(),h=r._nextUint64(),u=r._nextUint64(),d=new Ep(t,wp.length+i,3*s*8,!0);for(let e=0;e<s;e++)n.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const p=new Ep(t,a,o,!0),f={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},A=(f.descriptorBlockSize/4-6)/4;for(let t=0;t<A;t++){const e={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=p._nextInt32(),e.sampleUpper=p._nextInt32()):(e.sampleLower=p._nextUint32(),e.sampleUpper=p._nextUint32()),f.samples[t]=e}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(f);const g=new Ep(t,c,l,!0);for(;g._offset<l;){const t=g._nextUint32(),e=g._scan(t),i=Cp(e),r=g._scan(t-e.byteLength);n.keyValue[i]=i.match(/^ktx/i)?Cp(r):r,g._offset%4&&g._skip(4-g._offset%4)}if(u<=0)return n;const m=new Ep(t,h,u,!0),b=m._nextUint16(),v=m._nextUint16(),y=m._nextUint32(),x=m._nextUint32(),_=m._nextUint32(),E=m._nextUint32(),w=[];for(let t=0;t<s;t++)w.push({imageFlags:m._nextUint32(),rgbSliceByteOffset:m._nextUint32(),rgbSliceByteLength:m._nextUint32(),alphaSliceByteOffset:m._nextUint32(),alphaSliceByteLength:m._nextUint32()});const C=h+m._offset,S=C+y,M=S+x,I=M+_,T=new Uint8Array(t.buffer,t.byteOffset+C,y),B=new Uint8Array(t.buffer,t.byteOffset+S,x),R=new Uint8Array(t.buffer,t.byteOffset+M,_),P=new Uint8Array(t.buffer,t.byteOffset+I,E);return n.globalData={endpointCount:b,selectorCount:v,imageDescs:w,endpointsData:T,selectorsData:B,tablesData:R,extendedData:P},n}(new Uint8Array(t));if(0!==n.vkFormat)return async function(t){const{vkFormat:e}=t;if(void 0===Np[e])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let n;2===t.supercompressionScheme&&(Dp||(Dp=new Promise((async t=>{const e=new Bp;await e.init(),t(e)}))),n=await Dp);const i=[];for(let r=0;r<t.levels.length;r++){const s=Math.max(1,t.pixelWidth>>r),a=Math.max(1,t.pixelHeight>>r),o=t.pixelDepth?Math.max(1,t.pixelDepth>>r):0,c=t.levels[r];let l,h;if(0===t.supercompressionScheme)l=c.levelData;else{if(2!==t.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");l=n.decode(c.levelData,c.uncompressedByteLength)}h=kp[e]===z?new Float32Array(l.buffer,l.byteOffset,l.byteLength/Float32Array.BYTES_PER_ELEMENT):kp[e]===j?new Uint16Array(l.buffer,l.byteOffset,l.byteLength/Uint16Array.BYTES_PER_ELEMENT):l,i.push({data:h,width:s,height:a,depth:o})}let r;if(Fp.has(Np[e]))r=0===t.pixelDepth?new Ja(i[0].data,t.pixelWidth,t.pixelHeight):new Ae(i[0].data,t.pixelWidth,t.pixelHeight,t.pixelDepth);else{if(t.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new Wo(i,t.pixelWidth,t.pixelHeight)}return r.mipmaps=i,r.type=kp[e],r.format=Np[e],r.colorSpace=Op(t),r.needsUpdate=!0,Promise.resolve(r)}(n);const i=e,r=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:i},[t]))).then((t=>this._createTextureFrom(t.data,n)));return Pp.set(t,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Lp--,this}}Up.BasisFormat={ETC1S:0,UASTC_4x4:1},Up.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Up.EngineFormat={RGBAFormat:W,RGBA_ASTC_4x4_Format:at,RGBA_BPTC_Format:ct,RGBA_ETC2_EAC_Format:st,RGBA_PVRTC_4BPPV1_Format:nt,RGBA_S3TC_DXT5_Format:tt,RGB_ETC1_Format:it,RGB_ETC2_Format:rt,RGB_PVRTC_4BPPV1_Format:et,RGB_S3TC_DXT1_Format:K},Up.BasisWorker=function(){let t,e,n;const i=_EngineFormat,r=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",(function(a){const u=a.data;switch(u.type){case"init":t=u.config,d=u.transcoderBinary,e=new Promise((t=>{n={wasmBinary:d,onRuntimeInitialized:t},BASIS(n)})).then((()=>{n.initializeBasis(),void 0===n.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":e.then((()=>{try{const{faces:e,buffers:a,width:d,height:p,hasAlpha:f,format:A,dfdFlags:g}=function(e){const a=new n.KTX2File(new Uint8Array(e));function u(){a.close(),a.delete()}if(!a.isValid())throw u(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const d=a.isUASTC()?s.UASTC_4x4:s.ETC1S,p=a.getWidth(),f=a.getHeight(),A=a.getLayers()||1,g=a.getLevels(),m=a.getFaces(),b=a.getHasAlpha(),v=a.getDFDFlags(),{transcoderFormat:y,engineFormat:x}=function(e,n,a,h){let u,d;const p=e===s.ETC1S?o:c;for(let i=0;i<p.length;i++){const r=p[i];if(t[r.if]&&(r.basisFormat.includes(e)&&!(h&&r.transcoderFormat.length<2)&&(!r.needsPowerOfTwo||l(n)&&l(a))))return u=r.transcoderFormat[h?1:0],d=r.engineFormat[h?1:0],{transcoderFormat:u,engineFormat:d}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),u=r.RGBA32,d=i.RGBAFormat,{transcoderFormat:u,engineFormat:d}}(d,p,f,b);if(!p||!f||!g)throw u(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!a.startTranscoding())throw u(),new Error("THREE.KTX2Loader: .startTranscoding failed");const _=[],E=[];for(let t=0;t<m;t++){const e=[];for(let n=0;n<g;n++){const i=[];let r,s;for(let e=0;e<A;e++){const o=a.getImageLevelInfo(n,e,t);0!==t||0!==n||0!==e||o.origWidth%4==0&&o.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),g>1?(r=o.origWidth,s=o.origHeight):(r=o.width,s=o.height);const c=new Uint8Array(a.getImageTranscodedSizeInBytes(n,e,0,y));if(!a.transcodeImage(c,n,e,t,y,0,-1,-1))throw u(),new Error("THREE.KTX2Loader: .transcodeImage failed.");i.push(c)}const o=h(i);e.push({data:o,width:r,height:s}),E.push(o.buffer)}_.push({mipmaps:e,width:p,height:f,format:x})}return u(),{faces:_,buffers:E,width:p,height:f,hasAlpha:b,format:x,dfdFlags:v}}(u.buffer);self.postMessage({type:"transcode",id:u.id,faces:e,width:d,height:p,hasAlpha:f,format:A,dfdFlags:g},a)}catch(t){console.error(t),self.postMessage({type:"error",id:u.id,error:t.message})}}))}var d}));const a=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=a.sort((function(t,e){return t.priorityETC1S-e.priorityETC1S})),c=a.sort((function(t,e){return t.priorityUASTC-e.priorityUASTC}));function l(t){return t<=2||0==(t&t-1)&&0!==t}function h(t){if(1===t.length)return t[0];let e=0;for(let n=0;n<t.length;n++){e+=t[n].byteLength}const n=new Uint8Array(e);let i=0;for(let e=0;e<t.length;e++){const r=t[e];n.set(r,i),i+=r.byteLength}return n}};const Fp=new Set([W,J,Y]),Np={109:W,97:W,37:W,43:W,103:J,83:J,16:J,22:J,100:Y,76:Y,15:Y,9:Y,166:ot,165:ot},kp={109:z,97:j,37:Q,43:Q,103:z,83:j,16:Q,22:Q,100:z,76:j,15:Q,9:Q,166:Q,165:Q};function Op(t){const e=t.dataFormatDescriptor[0];return e.colorPrimaries===yp?e.transferFunction===bp?bt:vt:e.colorPrimaries===xp?e.transferFunction===bp?yt:xt:(e.colorPrimaries===vp||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),mt)}function Qp(t,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(2===e||1===e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,r=[];if(2===e)for(let t=1;t<=i;t++)r.push(n.getX(0)),r.push(n.getX(t)),r.push(n.getX(t+1));else for(let t=0;t<i;t++)t%2==0?(r.push(n.getX(t)),r.push(n.getX(t+1)),r.push(n.getX(t+2))):(r.push(n.getX(t+2)),r.push(n.getX(t+1)),r.push(n.getX(t)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}function Gp(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Hp={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class zp{constructor(t){this.parser=t,this.name=Hp.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const r=e.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let a;const o=new Nn(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],vt);const c=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new Yl(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new ql(o),a.distance=c;break;case"spot":a=new Hl(o),a.distance=c,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,Bf(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=e.createUniqueName(s.name||"light_"+t),i=Promise.resolve(a),e.cache.add(n,i),i}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,n=this.parser,i=n.json.nodes[t],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(t){return n._getNodeRef(e.cache,r,t)}))}}class jp{constructor(){this.name=Hp.KHR_MATERIALS_UNLIT}getMaterialType(){return Gn}extendParams(t,e,n){const i=[];t.color=new Nn(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;t.color.setRGB(e[0],e[1],e[2],vt),t.opacity=e[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture,bt))}return Promise.all(i)}}class Vp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(e.emissiveIntensity=i),Promise.resolve()}}class Wp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new zt(t,t)}return Promise.all(r)}}class qp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(e.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(e.iridescenceIOR=s.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class Xp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new Nn(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=i.extensions[this.name];if(void 0!==s.sheenColorFactor){const t=s.sheenColorFactor;e.sheenColor.setRGB(t[0],t[1],t[2],vt)}return void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,bt)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class Yp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class Jp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return e.attenuationColor=(new Nn).setRGB(a[0],a[1],a[2],vt),Promise.all(r)}}class Kp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return e.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Zp{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return e.specularColor=(new Nn).setRGB(a[0],a[1],a[2],vt),void 0!==s.specularColorTexture&&r.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,bt)),Promise.all(r)}}class $p{constructor(t){this.parser=t,this.name=Hp.EXT_MATERIALS_BUMP}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return e.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&r.push(n.assignTexture(e,"bumpMap",s.bumpTexture)),Promise.all(r)}}class tf{constructor(t){this.parser=t,this.name=Hp.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?il:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.anisotropyStrength&&(e.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(e.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(n.assignTexture(e,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class ef{constructor(t){this.parser=t,this.name=Hp.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,s)}}class nf{constructor(t){this.parser=t,this.name=Hp.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const t=n.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(t,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class rf{constructor(t){this.parser=t,this.name=Hp.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const t=n.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(t,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class sf{constructor(t){this.name=Hp.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,a=t.byteStride,o=new Uint8Array(e,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,a,o,t.mode,t.filter).then((function(t){return t.buffer})):r.ready.then((function(){const e=new ArrayBuffer(s*a);return r.decodeGltfBuffer(new Uint8Array(e),s,a,o,t.mode,t.filter),e}))}))}return null}}class af{constructor(t){this.name=Hp.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,n=e.nodes[t];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=e.meshes[n.mesh];for(const t of i.primitives)if(t.mode!==mf.TRIANGLES&&t.mode!==mf.TRIANGLE_STRIP&&t.mode!==mf.TRIANGLE_FAN&&void 0!==t.mode)return null;const r=n.extensions[this.name].attributes,s=[],a={};for(const t in r)s.push(this.parser.getDependency("accessor",r[t]).then((e=>(a[t]=e,a[t]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(t)),Promise.all(s).then((t=>{const e=t.pop(),n=e.isGroup?e.children:[e],i=t[0].count,r=[];for(const t of n){const e=new qe,n=new me,s=new ge,o=new me(1,1,1),c=new co(t.geometry,t.material,i);for(let t=0;t<i;t++)a.TRANSLATION&&n.fromBufferAttribute(a.TRANSLATION,t),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,t),a.SCALE&&o.fromBufferAttribute(a.SCALE,t),c.setMatrixAt(t,e.compose(n,s,o));for(const e in a)if("_COLOR_0"===e){const t=a[e];c.instanceColor=new to(t.array,t.itemSize,t.normalized)}else"TRANSLATION"!==e&&"ROTATION"!==e&&"SCALE"!==e&&t.geometry.setAttribute(e,a[e]);xn.prototype.copy.call(c,t),this.parser.assignFinalMaterial(c),r.push(c)}return e.isGroup?(e.clear(),e.add(...r),e):r[0]})))}}const of="glTF",cf=1313821514,lf=5130562;class hf{constructor(t){this.name=Hp.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==of)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(t,12);let s=0;for(;s<i;){const e=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,i===cf){const i=new Uint8Array(t,12+s,e);this.content=n.decode(i)}else if(i===lf){const n=12+s;this.body=t.slice(n,n+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class uf{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Hp.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,a={},o={},c={};for(const t in s){const e=_f[t]||t.toLowerCase();a[e]=s[t]}for(const e in t.attributes){const i=_f[e]||e.toLowerCase();if(void 0!==s[e]){const r=n.accessors[t.attributes[e]],s=bf[r.componentType];c[i]=s.name,o[i]=!0===r.normalized}}return e.getDependency("bufferView",r).then((function(t){return new Promise((function(e,n){i.decodeDracoFile(t,(function(t){for(const e in t.attributes){const n=t.attributes[e],i=o[e];void 0!==i&&(n.normalized=i)}e(t)}),a,c,vt,n)}))}))}}class df{constructor(){this.name=Hp.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&e.texCoord!==t.channel||void 0!==e.offset||void 0!==e.rotation||void 0!==e.scale?(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t):t}}class pf{constructor(){this.name=Hp.KHR_MESH_QUANTIZATION}}class ff extends dl{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let t=0;t!==i;t++)e[t]=n[r+t];return e}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,c=3*a,l=i-e,h=(n-e)/l,u=h*h,d=u*h,p=t*c,f=p-c,A=-2*d+3*u,g=d-u,m=1-A,b=g-u+h;for(let t=0;t!==a;t++){const e=s[f+t+a],n=s[f+t+o]*l,i=s[p+t+a],c=s[p+t]*l;r[t]=m*e+b*n+A*i+g*c}return r}}const Af=new ge;class gf extends ff{interpolate_(t,e,n,i){const r=super.interpolate_(t,e,n,i);return Af.fromArray(r).normalize().toArray(r),r}}const mf={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},bf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vf={9728:U,9729:N,9984:1004,9985:k,9986:F,9987:O},yf={33071:D,33648:L,10497:P},xf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_f={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ef={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},wf={CUBICSPLINE:void 0,LINEAR:ht,STEP:lt},Cf="OPAQUE",Sf="MASK",Mf="BLEND";function If(t){return void 0===t.DefaultMaterial&&(t.DefaultMaterial=new nl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:u})),t.DefaultMaterial}function Tf(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function Bf(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Rf(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Pf(t){let e;const n=t.extensions&&t.extensions[Hp.KHR_DRACO_MESH_COMPRESSION];if(e=n?"draco:"+n.bufferView+":"+n.indices+":"+Df(n.attributes):t.indices+":"+Df(t.attributes)+":"+t.mode,void 0!==t.targets)for(let n=0,i=t.targets.length;n<i;n++)e+=":"+Df(t.targets[n]);return e}function Df(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function Lf(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Uf=new qe;class Ff{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Gp,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,r=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||i&&r<98?this.textureLoader=new Ul(this.options.manager):this.textureLoader=new $l(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Pl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};return Tf(r,s,i),Bf(s,i),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){for(const t of s.scenes)t.updateMatrixWorld();t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n].joints;for(let e=0,n=i.length;e<n;e++)t[i[e]].isBone=!0}for(let e=0,i=t.length;e<i;e++){const i=t[e];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),r=(t,e)=>{const n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(const[n,i]of t.children.entries())r(i,e.children[n])};return r(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&n.push(r)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this._invokeOne((function(t){return t.loadNode&&t.loadNode(e)}));break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":i=this.loadCamera(e);break;default:if(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)})),!i)throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((function(e,i){return n.getDependency(t,i)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[Hp.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(t,r){n.load(Kl.resolveURL(e.uri,i.path),t,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)}))}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse){const t=xf[i.type],e=bf[i.componentType],n=!0===i.normalized,r=new e(i.count*t);return Promise.resolve(new qn(r,t,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(t){const r=t[0],s=xf[i.type],a=bf[i.componentType],o=a.BYTES_PER_ELEMENT,c=o*s,l=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let d,p;if(h&&h!==c){const t=Math.floor(l/h),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let c=e.cache.get(n);c||(d=new a(r,t*h,i.count*h/o),c=new Fa(d,h/o),e.cache.add(n,c)),p=new ka(c,s,l%h/o,u)}else d=null===r?new a(i.count*s):new a(r,l,i.count*s),p=new qn(d,s,u);if(void 0!==i.sparse){const e=xf.SCALAR,n=bf[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,l=new n(t[1],o,i.sparse.count*e),h=new a(t[2],c,i.sparse.count*s);null!==r&&(p=new qn(p.array.slice(),p.itemSize,p.normalized));for(let t=0,e=l.length;t<e;t++){const e=l[t];if(p.setX(e,h[t*s]),s>=2&&p.setY(e,h[t*s+1]),s>=3&&p.setZ(e,h[t*s+2]),s>=4&&p.setW(e,h[t*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t].source,r=e.images[i];let s=this.textureLoader;if(r.uri){const t=n.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,i,s)}loadTextureImage(t,e,n){const i=this,r=this.json,s=r.textures[t],a=r.images[e],o=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const c=this.loadImageSource(e,n).then((function(e){e.flipY=!1,e.name=s.name||a.name||"",""===e.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(e.name=a.uri);const n=(r.samplers||{})[s.sampler]||{};return e.magFilter=vf[n.magFilter]||N,e.minFilter=vf[n.minFilter]||O,e.wrapS=yf[n.wrapS]||P,e.wrapT=yf[n.wrapT]||P,i.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[o]=c,c}loadImageSource(t,e){const n=this,i=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const s=i.images[t],a=self.URL||self.webkitURL;let o=s.uri||"",c=!1;if(void 0!==s.bufferView)o=n.getDependency("bufferView",s.bufferView).then((function(t){c=!0;const e=new Blob([t],{type:s.mimeType});return o=a.createObjectURL(e),o}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(t){return new Promise((function(n,i){let s=n;!0===e.isImageBitmapLoader&&(s=function(t){const e=new he(t);e.needsUpdate=!0,n(e)}),e.load(Kl.resolveURL(t,r.path),s,void 0,i)}))})).then((function(t){var e;return!0===c&&a.revokeObjectURL(o),t.userData.mimeType=s.mimeType||((e=s.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),t}));return this.sourceCache[t]=l,l}assignTexture(t,e,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),r.extensions[Hp.KHR_TEXTURE_TRANSFORM]){const t=void 0!==n.extensions?n.extensions[Hp.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=r.associations.get(s);s=r.extensions[Hp.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),r.associations.set(s,e)}}return void 0!==i&&(s.colorSpace=i),t[e]=s,s}))}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0===e.attributes.tangent,r=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new ko,Qn.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new Mo,Qn.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,this.cache.add(t,e)),n=e}if(i||r||s){let t="ClonedMaterial:"+n.uuid+":";i&&(t+="derivative-tangents:"),r&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),r&&(e.vertexColors=!0),s&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}t.material=n}getMaterialType(){return nl}loadMaterial(t){const e=this,n=this.json,i=this.extensions,r=n.materials[t];let s;const a={},o=[];if((r.extensions||{})[Hp.KHR_MATERIALS_UNLIT]){const t=i[Hp.KHR_MATERIALS_UNLIT];s=t.getMaterialType(),o.push(t.extendParams(a,r,e))}else{const n=r.pbrMetallicRoughness||{};if(a.color=new Nn(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;a.color.setRGB(t[0],t[1],t[2],vt),a.opacity=t[3]}void 0!==n.baseColorTexture&&o.push(e.assignTexture(a,"map",n.baseColorTexture,bt)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(e.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),o.push(e.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),o.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)}))))}!0===r.doubleSided&&(a.side=p);const c=r.alphaMode||Cf;if(c===Mf?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,c===Sf&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==Gn&&(o.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new zt(1,1),void 0!==r.normalTexture.scale)){const t=r.normalTexture.scale;a.normalScale.set(t,t)}if(void 0!==r.occlusionTexture&&s!==Gn&&(o.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==Gn){const t=r.emissiveFactor;a.emissive=(new Nn).setRGB(t[0],t[1],t[2],vt)}return void 0!==r.emissiveTexture&&s!==Gn&&o.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,bt)),Promise.all(o).then((function(){const n=new s(a);return r.name&&(n.name=r.name),Bf(n,r),e.associations.set(n,{materials:t}),r.extensions&&Tf(i,n,r),n}))}createUniqueName(t){const e=_h.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function r(t){return n[Hp.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return Nf(n,t,e)}))}const s=[];for(let n=0,a=t.length;n<a;n++){const a=t[n],o=Pf(a),c=i[o];if(c)s.push(c.promise);else{let t;t=a.extensions&&a.extensions[Hp.KHR_DRACO_MESH_COMPRESSION]?r(a):Nf(new ri,a,e),i[o]={primitive:a,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){const e=this,n=this.json,i=this.extensions,r=n.meshes[t],s=r.primitives,a=[];for(let t=0,e=s.length;t<e;t++){const e=void 0===s[t].material?If(this.cache):this.getDependency("material",s[t].material);a.push(e)}return a.push(e.loadGeometries(s)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],c=[];for(let n=0,l=o.length;n<l;n++){const l=o[n],h=s[n];let u;const d=a[n];if(h.mode===mf.TRIANGLES||h.mode===mf.TRIANGLE_STRIP||h.mode===mf.TRIANGLE_FAN||void 0===h.mode)u=!0===r.isSkinnedMesh?new Xa(l,d):new _i(l,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),h.mode===mf.TRIANGLE_STRIP?u.geometry=Qp(u.geometry,1):h.mode===mf.TRIANGLE_FAN&&(u.geometry=Qp(u.geometry,2));else if(h.mode===mf.LINES)u=new Fo(l,d);else if(h.mode===mf.LINE_STRIP)u=new Do(l,d);else if(h.mode===mf.LINE_LOOP)u=new No(l,d);else{if(h.mode!==mf.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new zo(l,d)}Object.keys(u.geometry.morphAttributes).length>0&&Rf(u,r),u.name=e.createUniqueName(r.name||"mesh_"+t),Bf(u,r),h.extensions&&Tf(i,u,h),e.assignFinalMaterial(u),c.push(u)}for(let n=0,i=c.length;n<i;n++)e.associations.set(c[n],{meshes:t,primitives:n});if(1===c.length)return r.extensions&&Tf(i,c[0],r),c[0];const l=new wa;r.extensions&&Tf(i,l,r),e.associations.set(l,{meshes:t});for(let t=0,e=c.length;t<e;t++)l.add(c[t]);return l}))}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new Li(Ht.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new or(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),Bf(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],n=[];for(let t=0,i=e.joints.length;t<i;t++)n.push(this._loadNodeShallow(e.joints[t]));return void 0!==e.inverseBindMatrices?n.push(this.getDependency("accessor",e.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(t){const n=t.pop(),i=t,r=[],s=[];for(let t=0,a=i.length;t<a;t++){const a=i[t];if(a){r.push(a);const e=new qe;null!==n&&e.fromArray(n.array,16*t),s.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}return new $a(r,s)}))}loadAnimation(t){const e=this.json,n=this,i=e.animations[t],r=i.name?i.name:"animation_"+t,s=[],a=[],o=[],c=[],l=[];for(let t=0,e=i.channels.length;t<e;t++){const e=i.channels[t],n=i.samplers[e.sampler],r=e.target,h=r.node,u=void 0!==i.parameters?i.parameters[n.input]:n.input,d=void 0!==i.parameters?i.parameters[n.output]:n.output;void 0!==r.node&&(s.push(this.getDependency("node",h)),a.push(this.getDependency("accessor",u)),o.push(this.getDependency("accessor",d)),c.push(n),l.push(r))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(c),Promise.all(l)]).then((function(t){const e=t[0],i=t[1],s=t[2],a=t[3],o=t[4],c=[];for(let t=0,r=e.length;t<r;t++){const r=e[t],l=i[t],h=s[t],u=a[t],d=o[t];if(void 0===r)continue;r.updateMatrix&&r.updateMatrix();const p=n._createAnimationTracks(r,l,h,u,d);if(p)for(let t=0;t<p.length;t++)c.push(p[t])}return new wl(r,void 0,c)}))}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]})),e}))}loadNode(t){const e=this,n=this.json.nodes[t],i=e._loadNodeShallow(t),r=[],s=n.children||[];for(let t=0,n=s.length;t<n;t++)r.push(e.getDependency("node",s[t]));const a=void 0===n.skin?Promise.resolve(null):e.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),a]).then((function(t){const e=t[0],n=t[1],i=t[2];null!==i&&e.traverse((function(t){t.isSkinnedMesh&&t.bind(i,Uf)}));for(let t=0,i=n.length;t<i;t++)e.add(n[t]);return e}))}_loadNodeShallow(t){const e=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];const r=e.nodes[t],s=r.name?i.createUniqueName(r.name):"",a=[],o=i._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return o&&a.push(o),void 0!==r.camera&&a.push(i.getDependency("camera",r.camera).then((function(t){return i._getNodeRef(i.cameraCache,r.camera,t)}))),i._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){a.push(t)})),this.nodeCache[t]=Promise.all(a).then((function(e){let a;if(a=!0===r.isBone?new Ya:e.length>1?new wa:1===e.length?e[0]:new xn,a!==e[0])for(let t=0,n=e.length;t<n;t++)a.add(e[t]);if(r.name&&(a.userData.name=r.name,a.name=s),Bf(a,r),r.extensions&&Tf(n,a,r),void 0!==r.matrix){const t=new qe;t.fromArray(r.matrix),a.applyMatrix4(t)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=t,a})),this.nodeCache[t]}loadScene(t){const e=this.extensions,n=this.json.scenes[t],i=this,r=new wa;n.name&&(r.name=i.createUniqueName(n.name)),Bf(r,n),n.extensions&&Tf(e,r,n);const s=n.nodes||[],a=[];for(let t=0,e=s.length;t<e;t++)a.push(i.getDependency("node",s[t]));return Promise.all(a).then((function(t){for(let e=0,n=t.length;e<n;e++)r.add(t[e]);return i.associations=(t=>{const e=new Map;for(const[t,n]of i.associations)(t instanceof Qn||t instanceof he)&&e.set(t,n);return t.traverse((t=>{const n=i.associations.get(t);null!=n&&e.set(t,n)})),e})(r),r}))}_createAnimationTracks(t,e,n,i,r){const s=[],a=t.name?t.name:t.uuid,o=[];let c;switch(Ef[r.path]===Ef.weights?t.traverse((function(t){t.morphTargetInfluences&&o.push(t.name?t.name:t.uuid)})):o.push(a),Ef[r.path]){case Ef.weights:c=vl;break;case Ef.rotation:c=xl;break;case Ef.position:case Ef.scale:c=El;break;default:if(1===n.itemSize)c=vl;else c=El}const l=void 0!==i.interpolation?wf[i.interpolation]:ht,h=this._getArrayFromAccessor(n);for(let t=0,n=o.length;t<n;t++){const n=new c(o[t]+"."+Ef[r.path],e.array,h,l);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(n),s.push(n)}return s}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const t=Lf(e.constructor),n=new Float32Array(e.length);for(let i=0,r=e.length;i<r;i++)n[i]=e[i]*t;e=n}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof xl?gf:ff)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Nf(t,e,n){const i=e.attributes,r=[];function s(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(const e in i){const n=_f[e]||e.toLowerCase();n in t.attributes||r.push(s(i[e],n))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));r.push(i)}return ee.workingColorSpace!==vt&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ee.workingColorSpace}" not supported.`),Bf(t,e),function(t,e,n){const i=e.attributes,r=new ye;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new me(e[0],e[1],e[2]),new me(s[0],s[1],s[2])),t.normalized){const e=Lf(bf[t.componentType]);r.min.multiplyScalar(e),r.max.multiplyScalar(e)}}const s=e.targets;if(void 0!==s){const t=new me,e=new me;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,a=i.max;if(void 0!==s&&void 0!==a){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),i.normalized){const t=Lf(bf[i.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(t)}t.boundingBox=r;const a=new ke;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=a}(t,e,n),Promise.all(r).then((function(){return void 0!==e.targets?function(t,e,n){let i=!1,r=!1,s=!1;for(let t=0,n=e.length;t<n;t++){const n=e[t];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const a=[],o=[],c=[];for(let l=0,h=e.length;l<h;l++){const h=e[l];if(i){const e=void 0!==h.POSITION?n.getDependency("accessor",h.POSITION):t.attributes.position;a.push(e)}if(r){const e=void 0!==h.NORMAL?n.getDependency("accessor",h.NORMAL):t.attributes.normal;o.push(e)}if(s){const e=void 0!==h.COLOR_0?n.getDependency("accessor",h.COLOR_0):t.attributes.color;c.push(e)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(c)]).then((function(e){const n=e[0],a=e[1],o=e[2];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=a),s&&(t.morphAttributes.color=o),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}const kf=new WeakMap;function Of(){let t,e;function n(t,e,n,i,r,s){const a=s.num_components(),o=n.num_points()*a,c=o*r.BYTES_PER_ELEMENT,l=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),h=t._malloc(c);e.GetAttributeDataArrayForAllPoints(n,s,l,c,h);const u=new r(t.HEAPF32.buffer,h,o).slice();return t._free(h),{name:i,array:u,itemSize:a}}onmessage=function(i){const r=i.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const i=r.buffer,s=r.taskConfig;e.then((t=>{const e=t.draco,a=new e.Decoder;try{const t=function(t,e,i,r){const s=r.attributeIDs,a=r.attributeTypes;let o,c;const l=e.GetEncodedGeometryType(i);if(l===t.TRIANGULAR_MESH)o=new t.Mesh,c=e.DecodeArrayToMesh(i,i.byteLength,o);else{if(l!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new t.PointCloud,c=e.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!c.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+c.error_msg());const h={index:null,attributes:[]};for(const i in s){const c=self[a[i]];let l,u;if(r.useUniqueIDs)u=s[i],l=e.GetAttributeByUniqueId(o,u);else{if(u=e.GetAttributeId(o,t[s[i]]),-1===u)continue;l=e.GetAttribute(o,u)}const d=n(t,e,o,i,c,l);"color"===i&&(d.vertexColorSpace=r.vertexColorSpace),h.attributes.push(d)}l===t.TRIANGULAR_MESH&&(h.index=function(t,e,n){const i=n.num_faces(),r=3*i,s=4*r,a=t._malloc(s);e.GetTrianglesUInt32Array(n,s,a);const o=new Uint32Array(t.HEAPF32.buffer,a,r).slice();return t._free(a),{array:o,itemSize:1}}(t,e,o));return t.destroy(o),h}(e,a,new Int8Array(i),s),o=t.attributes.map((t=>t.array.buffer));t.index&&o.push(t.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:t},o)}catch(t){console.error(t),self.postMessage({type:"error",id:r.id,error:t.message})}finally{e.destroy(a)}}))}}}var Qf=function(){var t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),e=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var n,i=WebAssembly.validate(t)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",r=WebAssembly.instantiate(s(i),{}).then((function(t){(n=t.instance).exports.__wasm_call_ctors()}));function s(t){for(var n=new Uint8Array(t.length),i=0;i<t.length;++i){var r=t.charCodeAt(i);n[i]=r>96?r-97:r>64?r-39:r+4}var s=0;for(i=0;i<t.length;++i)n[s++]=n[i]<60?e[n[i]]:64*(n[i]-60)+n[++i];return n.buffer.slice(0,s)}function a(t,e,i,r,s,a){var o=n.exports.sbrk,c=i+3&-4,l=o(c*r),h=o(s.length),u=new Uint8Array(n.exports.memory.buffer);u.set(s,h);var d=t(l,i,r,h,s.length);if(0==d&&a&&a(l,c,r),e.set(u.subarray(l,l+i*r)),o(l-o(0)),0!=d)throw new Error("Malformed buffer data: "+d)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},l=[],h=0;function u(t){var e={object:new Worker(t),pending:0,requests:{}};return e.object.onmessage=function(t){var n=t.data;e.pending-=n.count,e.requests[n.id][n.action](n.value),delete e.requests[n.id]},e}function d(t){for(var e="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(s(i))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+a.toString()+p.toString(),n=new Blob([e],{type:"text/javascript"}),r=URL.createObjectURL(n),o=0;o<t;++o)l[o]=u(r);URL.revokeObjectURL(r)}function p(t){r.then((function(){var e=t.data;try{var i=new Uint8Array(e.count*e.size);a(n.exports[e.mode],i,e.count,e.size,e.source,n.exports[e.filter]),self.postMessage({id:e.id,count:e.count,action:"resolve",value:i},[i.buffer])}catch(t){self.postMessage({id:e.id,count:e.count,action:"reject",value:t})}}))}return{ready:r,supported:!0,useWorkers:function(t){d(t)},decodeVertexBuffer:function(t,e,i,r,s){a(n.exports.meshopt_decodeVertexBuffer,t,e,i,r,n.exports[o[s]])},decodeIndexBuffer:function(t,e,i,r){a(n.exports.meshopt_decodeIndexBuffer,t,e,i,r)},decodeIndexSequence:function(t,e,i,r){a(n.exports.meshopt_decodeIndexSequence,t,e,i,r)},decodeGltfBuffer:function(t,e,i,r,s,l){a(n.exports[c[s]],t,e,i,r,n.exports[o[l]])},decodeGltfBufferAsync:function(t,e,i,s,u){return l.length>0?function(t,e,n,i,r){for(var s=l[0],a=1;a<l.length;++a)l[a].pending<s.pending&&(s=l[a]);return new Promise((function(a,o){var c=new Uint8Array(n),l=h++;s.pending+=t,s.requests[l]={resolve:a,reject:o},s.object.postMessage({id:l,count:t,size:e,source:c,mode:i,filter:r},[c.buffer])}))}(t,e,i,c[s],o[u]):r.then((function(){var r=new Uint8Array(t*e);return a(n.exports[c[s]],r,t,e,i,n.exports[o[u]]),r}))}}}(),Gf=Uint8Array,Hf=Uint16Array,zf=Int32Array,jf=new Gf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vf=new Gf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Wf=new Gf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qf=function(t,e){for(var n=new Hf(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var r=new zf(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return{b:n,r:r}},Xf=qf(jf,2),Yf=Xf.b,Jf=Xf.r;
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/Yf[28]=258,Jf[258]=28;for(var Kf=qf(Vf,0).b,Zf=new Hf(32768),$f=0;$f<32768;++$f){var tA=(43690&$f)>>1|(21845&$f)<<1;tA=(61680&(tA=(52428&tA)>>2|(13107&tA)<<2))>>4|(3855&tA)<<4,Zf[$f]=((65280&tA)>>8|(255&tA)<<8)>>1}var eA=function(t,e,n){for(var i=t.length,r=0,s=new Hf(e);r<i;++r)t[r]&&++s[t[r]-1];var a,o=new Hf(e);for(r=1;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;if(n){a=new Hf(1<<e);var c=15-e;for(r=0;r<i;++r)if(t[r])for(var l=r<<4|t[r],h=e-t[r],u=o[t[r]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)a[Zf[u]>>c]=l}else for(a=new Hf(i),r=0;r<i;++r)t[r]&&(a[r]=Zf[o[t[r]-1]++]>>15-t[r]);return a},nA=new Gf(288);for($f=0;$f<144;++$f)nA[$f]=8;for($f=144;$f<256;++$f)nA[$f]=9;for($f=256;$f<280;++$f)nA[$f]=7;for($f=280;$f<288;++$f)nA[$f]=8;var iA=new Gf(32);for($f=0;$f<32;++$f)iA[$f]=5;var rA=eA(nA,9,1),sA=eA(iA,5,1),aA=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},oA=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},cA=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},lA=function(t){return(t+7)/8|0},hA=function(t,e,n){return(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length),new Gf(t.subarray(e,n))},uA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],dA=function(t,e,n){var i=new Error(e||uA[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,dA),!n)throw i;return i},pA=function(t,e,n,i){var r=t.length,s=i?i.length:0;if(!r||e.f&&!e.l)return n||new Gf(0);var a=!n,o=a||2!=e.i,c=e.i;a&&(n=new Gf(3*r));var l=function(t){var e=n.length;if(t>e){var i=new Gf(Math.max(2*e,t));i.set(n),n=i}},h=e.f||0,u=e.p||0,d=e.b||0,p=e.l,f=e.d,A=e.m,g=e.n,m=8*r;do{if(!p){h=oA(t,u,1);var b=oA(t,u+1,3);if(u+=3,!b){var v=t[(B=lA(u)+4)-4]|t[B-3]<<8,y=B+v;if(y>r){c&&dA(0);break}o&&l(d+v),n.set(t.subarray(B,y),d),e.b=d+=v,e.p=u=8*y,e.f=h;continue}if(1==b)p=rA,f=sA,A=9,g=5;else if(2==b){var x=oA(t,u,31)+257,_=oA(t,u+10,15)+4,E=x+oA(t,u+5,31)+1;u+=14;for(var w=new Gf(E),C=new Gf(19),S=0;S<_;++S)C[Wf[S]]=oA(t,u+3*S,7);u+=3*_;var M=aA(C),I=(1<<M)-1,T=eA(C,M,1);for(S=0;S<E;){var B,R=T[oA(t,u,I)];if(u+=15&R,(B=R>>4)<16)w[S++]=B;else{var P=0,D=0;for(16==B?(D=3+oA(t,u,3),u+=2,P=w[S-1]):17==B?(D=3+oA(t,u,7),u+=3):18==B&&(D=11+oA(t,u,127),u+=7);D--;)w[S++]=P}}var L=w.subarray(0,x),U=w.subarray(x);A=aA(L),g=aA(U),p=eA(L,A,1),f=eA(U,g,1)}else dA(1);if(u>m){c&&dA(0);break}}o&&l(d+131072);for(var F=(1<<A)-1,N=(1<<g)-1,k=u;;k=u){var O=(P=p[cA(t,u)&F])>>4;if((u+=15&P)>m){c&&dA(0);break}if(P||dA(2),O<256)n[d++]=O;else{if(256==O){k=u,p=null;break}var Q=O-254;if(O>264){var G=jf[S=O-257];Q=oA(t,u,(1<<G)-1)+Yf[S],u+=G}var H=f[cA(t,u)&N],z=H>>4;H||dA(3),u+=15&H;U=Kf[z];if(z>3){G=Vf[z];U+=cA(t,u)&(1<<G)-1,u+=G}if(u>m){c&&dA(0);break}o&&l(d+131072);var j=d+Q;if(d<U){var V=s-U,W=Math.min(U,j);for(V+d<0&&dA(3);d<W;++d)n[d]=i[V+d]}for(;d<j;++d)n[d]=n[d-U]}}e.l=p,e.p=k,e.b=d,e.f=h,p&&(h=1,e.m=A,e.d=f,e.n=g)}while(!h);return d!=n.length&&a?hA(n,0,d):n.subarray(0,d)},fA=new Gf(0),AA=function(t,e){return t[e]|t[e+1]<<8},gA=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},mA=function(t,e){return gA(t,e)+4294967296*gA(t,e+4)};function bA(t,e){return pA(t,{i:2},e&&e.out,e&&e.dictionary)}var vA="undefined"!=typeof TextDecoder&&new TextDecoder;try{vA.decode(fA,{stream:!0}),1}catch(t){}function yA(t,e){if(e){for(var n="",i=0;i<t.length;i+=16384)n+=String.fromCharCode.apply(null,t.subarray(i,i+16384));return n}if(vA)return vA.decode(t);var r=function(t){for(var e="",n=0;;){var i=t[n++],r=(i>127)+(i>223)+(i>239);if(n+r>t.length)return{s:e,r:hA(t,n-1)};r?3==r?(i=((15&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=1&r?String.fromCharCode((31&i)<<6|63&t[n++]):String.fromCharCode((15&i)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(i)}}(t),s=r.s;return(n=r.r).length&&dA(8),s}var xA=function(t,e){return e+30+AA(t,e+26)+AA(t,e+28)},_A=function(t,e,n){var i=AA(t,e+28),r=yA(t.subarray(e+46,e+46+i),!(2048&AA(t,e+8))),s=e+46+i,a=gA(t,e+20),o=n&&4294967295==a?EA(t,s):[a,gA(t,e+24),gA(t,e+42)],c=o[0],l=o[1],h=o[2];return[AA(t,e+10),c,l,r,s+AA(t,e+30)+AA(t,e+32),h]},EA=function(t,e){for(;1!=AA(t,e);e+=4+AA(t,e+2));return[mA(t,e+12),mA(t,e+4),mA(t,e+20)]};class wA{parse(t){const e={},n=t.split("\n");let i=null,r=e;const s=[e];for(const t of n)if(t.includes("=")){const e=t.split("="),n=e[0].trim(),i=e[1].trim();if(i.endsWith("{")){const t={};s.push(t),r[n]=t,r=t}else r[n]=i}else if(t.endsWith("{")){const t=r[i]||{};s.push(t),r[i]=t,r=t}else if(t.endsWith("}")){if(s.pop(),0===s.length)continue;r=s[s.length-1]}else if(t.endsWith("(")){const e={};s.push(e),i=t.split("(")[0].trim()||i,r[i]=e,r=e}else t.endsWith(")")?(s.pop(),r=s[s.length-1]):i=t.trim();return e}}let CA;try{CA=import.meta.url}catch(t){const e=document.getElementsByTagName("script");CA=e[e.length-1].src.split("?")[0]}const SA=new Up;let MA;SA.setTranscoderPath(new URL("../KTX2/",CA).href);const IA=new Promise((t=>MA=t));let TA=!1;const BA=new class extends Tl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Pl(r.manager);s.setPath(r.path),s.setResponseType("arraybuffer"),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(n))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e=new wA;function n(t){const e=t.slice(0,7),n=new Uint8Array([80,88,82,45,85,83,68,67]);return e.every(((t,e)=>t===n[e]))}const i=function(t,e){for(var n={},i=t.length-22;101010256!=gA(t,i);--i)(!i||t.length-i>65558)&&dA(13);var r=AA(t,i+8);if(!r)return{};var s=gA(t,i+16),a=4294967295==s||65535==r;if(a){var o=gA(t,i-12);(a=101075792==gA(t,o))&&(r=gA(t,o+32),s=gA(t,o+48))}for(var c=e&&e.filter,l=0;l<r;++l){var h=_A(t,s,a),u=h[0],d=h[1],p=h[2],f=h[3],A=h[4],g=h[5],m=xA(t,g);s=A,c&&!c({name:f,size:d,originalSize:p,compression:u})||(u?8==u?n[f]=bA(t.subarray(m,m+d),{out:new Gf(p)}):dA(14,"unknown compression type "+u):n[f]=hA(t,m,m+d))}return n}(new Uint8Array(t)),r=function(t){const i={};(new Pl).setResponseType("arraybuffer");for(const r in t){if(r.endsWith("png")){const e=new Blob([t[r]],{type:{type:"image/png"}});i[r]=URL.createObjectURL(e)}if(r.endsWith("usd")||r.endsWith("usda")){if(n(t[r])){console.warn("THREE.USDZLoader: Crate files (.usdc or binary .usd) are not supported.");continue}const s=yA(t[r]);i[r]=e.parse(s)}}return i}(i),s=function(t){if(t.length<1)return;const e=Object.keys(t)[0];let i=!1;if(e.endsWith("usda"))return t[e];if(e.endsWith("usdc"))i=!0;else if(e.endsWith("usd")){if(!n(t[e]))return t[e];i=!0}i&&console.warn("THREE.USDZLoader: Crate files (.usdc or binary .usd) are not supported.")}(i);if(void 0===s)return console.warn("THREE.USDZLoader: No usda file found."),new wa;const a=yA(s),o=e.parse(a);function c(t,e){if(t){if(void 0!==e){const n=`def Mesh "${e}"`;if(n in t)return t[n]}for(const e in t){const n=t[e];if(e.startsWith("def Mesh"))return"point3f[] points"in t&&(n["point3f[] points"]=t["point3f[] points"]),"texCoord2f[] primvars:st"in t&&(n["texCoord2f[] primvars:st"]=t["texCoord2f[] primvars:st"]),"int[] primvars:st:indices"in t&&(n["int[] primvars:st:indices"]=t["int[] primvars:st:indices"]),n;if("object"==typeof n){const t=c(n);if(t)return t}}}}function l(t){if(!t)return;let e=new ri;if("int[] faceVertexIndices"in t){const n=JSON.parse(t["int[] faceVertexIndices"]);e.setIndex(n)}if("point3f[] points"in t){const n=JSON.parse(t["point3f[] points"].replace(/[()]*/g,"")),i=new qn(new Float32Array(n),3);e.setAttribute("position",i)}if("normal3f[] normals"in t){const n=JSON.parse(t["normal3f[] normals"].replace(/[()]*/g,"")),i=new qn(new Float32Array(n),3);e.setAttribute("normal",i)}else e.computeVertexNormals();if("float2[] primvars:st"in t&&(t["texCoord2f[] primvars:st"]=t["float2[] primvars:st"]),"texCoord2f[] primvars:st"in t){const n=JSON.parse(t["texCoord2f[] primvars:st"].replace(/[()]*/g,"")),i=new qn(new Float32Array(n),2);if("int[] primvars:st:indices"in t){e=e.toNonIndexed();const n=JSON.parse(t["int[] primvars:st:indices"]);e.setAttribute("uv",function(t,e){const n=t.array,i=t.itemSize,r=new n.constructor(e.length*i);let s=0,a=0;for(let t=0,o=e.length;t<o;t++){s=e[t]*i;for(let t=0;t<i;t++)r[a++]=n[s++]}return new qn(r,i)}(i,n))}else e.setAttribute("uv",i)}return e}function h(t,e=""){for(const n in t){const i=t[n];if(n.startsWith("def Material"+e))return i;if("object"==typeof i){const t=h(i,e);if(t)return t}}}function u(t,e){e["float inputs:rotation"]&&(t.rotation=parseFloat(e["float inputs:rotation"])),e["float2 inputs:scale"]&&(t.repeat=(new zt).fromArray(JSON.parse("["+e["float2 inputs:scale"].replace(/[()]*/g,"")+"]"))),e["float2 inputs:translation"]&&(t.offset=(new zt).fromArray(JSON.parse("["+e["float2 inputs:translation"].replace(/[()]*/g,"")+"]")))}function d(t,e){for(const n in t){const i=t[n];if(n.startsWith(`def Shader "${e}"`))return i;if("object"==typeof i){const t=d(i,e);if(t)return t}}}function p(t){if("asset inputs:file"in t){const e=t["asset inputs:file"].replace(/@*/g,""),n=(new Ul).load(r[e]),i={'"clamp"':D,'"mirror"':L,'"repeat"':P};return"token inputs:wrapS"in t&&(n.wrapS=i[t["token inputs:wrapS"]]),"token inputs:wrapT"in t&&(n.wrapT=i[t["token inputs:wrapT"]]),n}return null}function f(t){const e=l(function(t){if(t){if("prepend references"in t){const e=t["prepend references"].split("@"),n=e[1].replace(/^.\//,""),i=e[2].replace(/^<\//,"").replace(/>$/,"");return c(r[n],i)}return c(t)}}(t)),n=function(t){const e=new il;if(void 0!==t){if('def Shader "PreviewSurface"'in t){const n=t['def Shader "PreviewSurface"'];if("color3f inputs:diffuseColor.connect"in n){const i=n["color3f inputs:diffuseColor.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.map=p(r),e.map.colorSpace=bt,'def Shader "Transform2d_diffuse"'in t&&u(e.map,t['def Shader "Transform2d_diffuse"'])}else if("color3f inputs:diffuseColor"in n){const t=n["color3f inputs:diffuseColor"].replace(/[()]*/g,"");e.color.fromArray(JSON.parse("["+t+"]"))}if("color3f inputs:emissiveColor.connect"in n){const i=n["color3f inputs:emissiveColor.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.emissiveMap=p(r),e.emissiveMap.colorSpace=bt,e.emissive.set(16777215),'def Shader "Transform2d_emissive"'in t&&u(e.emissiveMap,t['def Shader "Transform2d_emissive"'])}else if("color3f inputs:emissiveColor"in n){const t=n["color3f inputs:emissiveColor"].replace(/[()]*/g,"");e.emissive.fromArray(JSON.parse("["+t+"]"))}if("normal3f inputs:normal.connect"in n){const i=n["normal3f inputs:normal.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.normalMap=p(r),e.normalMap.colorSpace=mt,'def Shader "Transform2d_normal"'in t&&u(e.normalMap,t['def Shader "Transform2d_normal"'])}if("float inputs:roughness.connect"in n){const i=n["float inputs:roughness.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.roughness=1,e.roughnessMap=p(r),e.roughnessMap.colorSpace=mt,'def Shader "Transform2d_roughness"'in t&&u(e.roughnessMap,t['def Shader "Transform2d_roughness"'])}else"float inputs:roughness"in n&&(e.roughness=parseFloat(n["float inputs:roughness"]));if("float inputs:metallic.connect"in n){const i=n["float inputs:metallic.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.metalness=1,e.metalnessMap=p(r),e.metalnessMap.colorSpace=mt,'def Shader "Transform2d_metallic"'in t&&u(e.metalnessMap,t['def Shader "Transform2d_metallic"'])}else"float inputs:metallic"in n&&(e.metalness=parseFloat(n["float inputs:metallic"]));if("float inputs:clearcoat.connect"in n){const i=n["float inputs:clearcoat.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.clearcoat=1,e.clearcoatMap=p(r),e.clearcoatMap.colorSpace=mt,'def Shader "Transform2d_clearcoat"'in t&&u(e.clearcoatMap,t['def Shader "Transform2d_clearcoat"'])}else"float inputs:clearcoat"in n&&(e.clearcoat=parseFloat(n["float inputs:clearcoat"]));if("float inputs:clearcoatRoughness.connect"in n){const i=n["float inputs:clearcoatRoughness.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.clearcoatRoughness=1,e.clearcoatRoughnessMap=p(r),e.clearcoatRoughnessMap.colorSpace=mt,'def Shader "Transform2d_clearcoatRoughness"'in t&&u(e.clearcoatRoughnessMap,t['def Shader "Transform2d_clearcoatRoughness"'])}else"float inputs:clearcoatRoughness"in n&&(e.clearcoatRoughness=parseFloat(n["float inputs:clearcoatRoughness"]));if("float inputs:ior"in n&&(e.ior=parseFloat(n["float inputs:ior"])),"float inputs:occlusion.connect"in n){const i=n["float inputs:occlusion.connect"],r=d(o,/(\w+).output/.exec(i)[1]);e.aoMap=p(r),e.aoMap.colorSpace=mt,'def Shader "Transform2d_occlusion"'in t&&u(e.aoMap,t['def Shader "Transform2d_occlusion"'])}}if('def Shader "diffuseColor_texture"'in t){const n=t['def Shader "diffuseColor_texture"'];e.map=p(n),e.map.colorSpace=bt}if('def Shader "normal_texture"'in t){const n=t['def Shader "normal_texture"'];e.normalMap=p(n),e.normalMap.colorSpace=mt}}return e}(function(t){if(t){if("rel material:binding"in t){const e=t["rel material:binding"].replace(/^<\//,"").replace(/>$/,"").split("/");return h(o,` "${e[1]}"`)}return h(t)}}(t)),i=e?new _i(e,n):new xn;if("matrix4d xformOp:transform"in t){const e=JSON.parse("["+t["matrix4d xformOp:transform"].replace(/[()]*/g,"")+"]");i.matrix.fromArray(e),i.matrix.decompose(i.position,i.quaternion,i.scale)}return i}const A=new wa;return function t(e,n){for(const i in e)if(i.startsWith("def Scope"))t(e[i],n);else if(i.startsWith("def Xform")){const r=f(e[i]);/def Xform "(\w+)"/.test(i)&&(r.name=/def Xform "(\w+)"/.exec(i)[1]),n.add(r),t(e[i],r)}}(o,A),A}},RA=new class extends Tl{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new Wp(t)})),this.register((function(t){return new ef(t)})),this.register((function(t){return new nf(t)})),this.register((function(t){return new rf(t)})),this.register((function(t){return new Xp(t)})),this.register((function(t){return new Yp(t)})),this.register((function(t){return new Jp(t)})),this.register((function(t){return new Kp(t)})),this.register((function(t){return new Vp(t)})),this.register((function(t){return new Zp(t)})),this.register((function(t){return new qp(t)})),this.register((function(t){return new tf(t)})),this.register((function(t){return new $p(t)})),this.register((function(t){return new zp(t)})),this.register((function(t){return new sf(t)})),this.register((function(t){return new af(t)}))}load(t,e,n,i){const r=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const e=Kl.extractUrlBase(t);s=Kl.resolveURL(e,this.path)}else s=Kl.extractUrlBase(t);this.manager.itemStart(t);const a=function(e){i?i(e):console.error(e),r.manager.itemError(t),r.manager.itemEnd(t)},o=new Pl(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{r.parse(n,s,(function(n){e(n),r.manager.itemEnd(t)}),a)}catch(t){a(t)}}),n,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let r;const s={},a={},o=new TextDecoder;if("string"==typeof t)r=JSON.parse(t);else if(t instanceof ArrayBuffer){if(o.decode(new Uint8Array(t,0,4))===of){try{s[Hp.KHR_BINARY_GLTF]=new hf(t)}catch(t){return void(i&&i(t))}r=JSON.parse(s[Hp.KHR_BINARY_GLTF].content)}else r=JSON.parse(o.decode(t))}else r=t;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new Ff(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](c);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[e.name]=e,s[e.name]=!0}if(r.extensionsUsed)for(let t=0;t<r.extensionsUsed.length;++t){const e=r.extensionsUsed[t],n=r.extensionsRequired||[];switch(e){case Hp.KHR_MATERIALS_UNLIT:s[e]=new jp;break;case Hp.KHR_DRACO_MESH_COMPRESSION:s[e]=new uf(r,this.dracoLoader);break;case Hp.KHR_TEXTURE_TRANSFORM:s[e]=new df;break;case Hp.KHR_MESH_QUANTIZATION:s[e]=new pf;break;default:n.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}c.setExtensions(s),c.setPlugins(a),c.parse(n,i)}parseAsync(t,e){const n=this;return new Promise((function(i,r){n.parse(t,e,i,r)}))}},PA=new class extends Tl{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,n,i){const r=new Pl(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,(t=>{this.parse(t,e,i)}),n,i)}parse(t,e,n=(()=>{})){this.decodeDracoFile(t,e,null,null,bt).catch(n)}decodeDracoFile(t,e,n,i,r=vt,s=(()=>{})){const a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:r};return this.decodeGeometry(t,a).then(e).catch(s)}decodeGeometry(t,e){const n=JSON.stringify(e);if(kf.has(t)){const e=kf.get(t);if(e.key===n)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,s=t.byteLength,a=this._getWorker(r,s).then((n=>(i=n,new Promise(((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return a.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),kf.set(t,{key:n,promise:a}),a}_createGeometry(t){const e=new ri;t.index&&e.setIndex(new qn(t.index.array,1));for(let n=0;n<t.attributes.length;n++){const i=t.attributes[n],r=i.name,s=i.array,a=i.itemSize,o=new qn(s,a);"color"===r&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=s instanceof Float32Array==!1),e.setAttribute(r,o)}return e}_assignVertexColorSpace(t,e){if(e!==bt)return;const n=new Nn;for(let e=0,i=t.count;e<i;e++)n.fromBufferAttribute(t,e).convertSRGBToLinear(),t.setXYZ(e,n.r,n.g,n.b)}_loadLibrary(t,e){const n=new Pl(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),n.setWithCredentials(this.withCredentials),new Promise(((e,i)=>{n.load(t,e,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const n=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const i=Of.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const n=e.data;switch(n.type){case"decode":t._callbacks[n.id].resolve(n);break;case"error":t._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[t]=e,n._taskLoad+=e,n}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function DA(t){PA.setDecoderPath(t)}RA.setDRACOLoader(PA),RA.setKTX2Loader(SA),RA.setMeshoptDecoder(Qf),PA.setDecoderPath(new URL("../DRACO/",import.meta.url).href);const LA=String.raw,UA=LA`<style>

  sh-renderer-webgl button:hover {
    box-shadow: 0 0 0.6em #00000044;
  }

  sh-renderer-webgl button:active {
    border-color: #dddddd;
    color: #dddddd;
    box-shadow: 0 0 0.3em #00000044;
  }

  :root:has(.clickable.hover) sh-renderer-webgl,
  :root:has(a .hover) sh-renderer-webgl {
    cursor: pointer;
  }

  sh-xr-session.vr-supported:not(:is(.in-ar, .in-vr, .in-inline-xr))~* button.enter-vr,
  sh-xr-session.ar-supported:not(:is(.in-ar, .in-vr, .in-inline-xr))~* button.enter-ar,
  sh-xr-session.inline-xr-supported:not(:is(.in-ar, .in-vr, .in-inline-xr))~* button.enter-inline-xr {
    display:inline;
  }

  sh-xr-session:is(.in-ar, .in-vr, .in-inline-xr)~* button.end-session {
    display:inline;
  }

</style>`;let FA=window.document.styleSheets[0];FA||(document.head.appendChild(document.createElement("style")),FA=window.document.styleSheets[0]);for(const t of UA.split("\n\n").slice(1,-1))FA.insertRule(t,FA.cssRules.length);const NA=document.createElement("template");NA.innerHTML=LA`
  <style>
  :host {
    position: relative;
    display: inline-block;
    width: 512px;
    height: 512px;
    touch-action: none;
  }
  canvas {
    touch-action: none;
  }
  canvas, [part~=content] {
    position: absolute;
    inset: 0;
    top: auto;
  }
  [part~=content] > slot {
    pointer-events: auto;
    position: absolute;
    top: 0;
    left: 0;
  }
  [part~=content] {
    padding: 1em;
    pointer-events: none;
    display: flex;
    flex-direction: row;
    align-items: flex-end;
    justify-content: center;
  }

  ::slotted(button) {
    font-size: 1.5em;
    border: 0.1em solid white;
    border-radius: 0.5em;
    background-color: #00000044;
    color: white;
    box-shadow: 0 0 0em #00000044;
    transition: box-shadow 300ms ease;
    margin: 0 0.5em;
    cursor: pointer;
    display: none;
  }
  </style>
  <slot name="scene"></slot>
  <div part="content">
    <slot></slot>
  </div>
`;let kA=yu,OA=0;function QA(){OA--}function*GA(t){for(const e of t)if("SLOT"===e.tagName)for(const t of e.assignedElements())yield t,yield*GA(t.children);else yield e}const HA=[],zA=Da,jA="WebGLRenderer";var VA=Object.freeze({__proto__:null,mixin:t=>class extends t{static shortHandSchema=iu({mixins:HA,"log-depth-buffer":{as:"logarithmicDepthBuffer ",default:!0},"power-preference":{as:"powerPreference",type:"string"}});static shortHandEventDescriptions={postrender:"An event containing statistics about the previously rendered frame, use this to display stats like framerate or number of drawcalls to help debug performance issues."};isShRenderer=!0;static name=jA;width;height;left;top;static documentation=kA;static template=NA;constructor(){super();new ResizeObserver((()=>{this.#B()})).observe(this),this.prevTime=0}async connectedCallback(){let t,e=this.getRootNode().styleSheets[0];e||(this.getRootNode().appendChild(document.createElement("style")),e=this.getRootNode().styleSheets[0]);for(const t of UA.split("\n\n").slice(1,-1))e.insertRule(t,e.cssRules.length);if(this.properties.session||(this.properties.session=await(this.getRootNode().querySelector("sh-xr-session")?.object)),this.properties.scene||(this.properties.scene=this.querySelector("sh-scene")),this.properties.scene&&!this.properties.camera&&(t=this.querySelector("sh-camera-perspective"),t&&(await t.object,this.properties.camera||(this.properties.camera=await t.object))),this.properties.scene&&!this.properties.camera){let e=this.properties.scene.querySelector("sh-user");e&&(t=e.shadowRoot.querySelector("[part~=camera]"),t&&(await t.object,this.properties.camera||(this.properties.camera=await t.object)))}await super.connectedCallback(),this.properties.camera&&this.#B({width:this.offsetWidth,height:this.offsetHeight})}tick(t,e,n,i,r){this.properties.camera||tu("Renderer: Could not find camera"),this.properties.scene||tu("Renderer: Could not find scene");try{if(this.properties.scene.object&&!(this.properties.scene.object instanceof Promise)&&this.properties.camera){const s=this.getRootNode().host;s&&s.isShortHandElement&&s.tick.call(s,t,e,n,i,r),this.properties.scene.tick(t,e,n,i,r);for(const s of this.sceneChildren)s.isShortHandElement&&void 0!==s.tick&&s.tick(t,e,n,i,r);const a=performance.now();this.object.render(this.properties.scene.object,this.properties.camera),this.object.info.render.duration=performance.now()-a,this.object.info.render.fps=OA,this.object.info.render.xrFrame=n,this.emit("postrender",this.object.info.render,!0),OA++,setTimeout(QA,1e3)}super.tick(t,e,n,i,r)}catch(t){console.error(t)}}async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i),!0===this.ready&&(this.object.shadowMap.enabled=this.properties.shadowMapEnabled,this.object.shadowMap.type=this.properties.shadowMapType)}#R=[];get sceneChildren(){return GA(this.#R)}async allAttributesChangedCallback(){this.#R=uu(this.properties.scene,"*").sort(((t,e)=>(t.isShortHandElement?t.constructor.tickPriority:0)-(e.isShortHandElement?e.constructor.tickPriority:0))),await super.allAttributesChangedCallback();const t=this.object;!function(t){TA||(TA=!0,SA.detectSupport(t),MA())}(t),t.setAnimationLoop(((t,e)=>{const n=(t-this.prevTime)/1e3;this.prevTime=t,this.tick(t,n,e,this,this.properties.session)})),t.setPixelRatio(devicePixelRatio),t.xr.enabled=!0,t.xr.cameraAutoUpdate=!0,t.info.autoReset=!0,t.domElement.part.add("canvas"),this.shadowRoot.insertBefore(t.domElement,this.shadowRoot.querySelector("slot")),this.#B({width:this.offsetWidth,height:this.offsetHeight})}async#B(){this.width=this.offsetWidth,this.height=this.offsetHeight,this.left=this.offsetLeft,this.top=this.offsetTop,(await this.object).setSize(this.width,this.height),this.properties.camera&&(this.properties.camera.aspect=this.width/this.height,this.properties.camera.updateProjectionMatrix());for(const t of this.sceneChildren)t.isShortHandElement&&void 0!==t.renderResize&&t.renderResize(this.width,this.height)}},mixins:HA,name:jA,type:zA});const{isArray:WA}=Array,{getPrototypeOf:qA,getOwnPropertyDescriptor:XA}=Object,YA=[],JA=()=>document.createRange(),KA=(t,e,n)=>(t.set(e,n),n),ZA=(t,e)=>e.reduceRight($A,t),$A=(t,e)=>t.childNodes[e],{setPrototypeOf:tg}=Object;let eg;var ng=(t,e,n)=>(eg||(eg=JA()),n?eg.setStartAfter(t):eg.setStartBefore(t),eg.setEndAfter(e),eg.deleteContents(),t);const ig=({firstChild:t,lastChild:e},n)=>ng(t,e,n);let rg=!1;const sg=(t,e)=>rg&&11===t.nodeType?1/e<0?e?ig(t,!0):t.lastChild:e?t.valueOf():t.firstChild:t,ag=t=>document.createComment(t);class og extends((t=>{function e(t){return tg(t,new.target.prototype)}return e.prototype=t.prototype,e})(DocumentFragment)){#P=ag("<>");#D=ag("</>");#L=YA;constructor(t){super(t),this.replaceChildren(this.#P,...t.childNodes,this.#D),rg=!0}get firstChild(){return this.#P}get lastChild(){return this.#D}get parentNode(){return this.#P.parentNode}remove(){ig(this,!1)}replaceWith(t){ig(this,!0).replaceWith(t)}valueOf(){const{parentNode:t}=this;if(t===this)this.#L===YA&&(this.#L=[...this.childNodes]);else{if(t){let{firstChild:t,lastChild:e}=this;for(this.#L=[t];t!==e;)this.#L.push(t=t.nextSibling)}this.replaceChildren(...this.#L)}return this}}const cg=(t,e,n)=>t.setAttribute(e,n),lg=(t,e)=>t.removeAttribute(e);let hg;const ug=(t,e,n)=>{n=n.slice(1),hg||(hg=new WeakMap);const i=hg.get(t)||KA(hg,t,{});let r=i[n];return r&&r[0]&&t.removeEventListener(n,...r),r=WA(e)?e:[e,!1],i[n]=r,r[0]&&t.addEventListener(n,...r),e},dg=(t,e)=>{const{t:n,n:i}=t;let r=!1;switch(typeof e){case"object":if(null!==e){(i||n).replaceWith(t.n=e.valueOf());break}case"undefined":r=!0;default:n.data=r?"":e,i&&(t.n=null,i.replaceWith(n))}return e},pg=(t,e,n)=>t[n]=e,fg=(t,e,n)=>pg(t,e,n.slice(1)),Ag=(t,e,n)=>null==e?(lg(t,n),e):pg(t,e,n),gg=(t,e)=>("function"==typeof e?e(t):e.current=t,e),mg=(t,e,n)=>(null==e?lg(t,n):cg(t,n,e),e),bg=(t,e,n)=>(t.toggleAttribute(n.slice(1),e),e),vg=(t,e,n)=>{const{length:i}=e;if(t.data=`[${i}]`,i)return((t,e,n,i,r)=>{const s=n.length;let a=e.length,o=s,c=0,l=0,h=null;for(;c<a||l<o;)if(a===c){const e=o<s?l?i(n[l-1],-0).nextSibling:i(n[o-l],0):r;for(;l<o;)t.insertBefore(i(n[l++],1),e)}else if(o===l)for(;c<a;)h&&h.has(e[c])||t.removeChild(i(e[c],-1)),c++;else if(e[c]===n[l])c++,l++;else if(e[a-1]===n[o-1])a--,o--;else if(e[c]===n[o-1]&&n[l]===e[a-1]){const r=i(e[--a],-1).nextSibling;t.insertBefore(i(n[l++],1),i(e[c++],-1).nextSibling),t.insertBefore(i(n[--o],1),r),e[a]=n[o]}else{if(!h){h=new Map;let t=l;for(;t<o;)h.set(n[t],t++)}if(h.has(e[c])){const r=h.get(e[c]);if(l<r&&r<o){let s=c,u=1;for(;++s<a&&s<o&&h.get(e[s])===r+u;)u++;if(u>r-l){const s=i(e[c],0);for(;l<r;)t.insertBefore(i(n[l++],1),s)}else t.replaceChild(i(n[l++],1),i(e[c++],-1))}else c++}else t.removeChild(i(e[c++],-1))}return n})(t.parentNode,n,e,sg,t);switch(n.length){case 1:n[0].remove();case 0:break;default:ng(sg(n[0],0),sg(n.at(-1),-0),!1)}return YA},yg=new Map([["aria",(t,e)=>{for(const n in e){const i=e[n],r="role"===n?n:`aria-${n}`;null==i?lg(t,r):cg(t,r,i)}return e}],["class",(t,e)=>Ag(t,e,null==e?"class":"className")],["data",(t,e)=>{const{dataset:n}=t;for(const t in e)null==e[t]?delete n[t]:n[t]=e[t];return e}],["ref",gg],["style",(t,e)=>null==e?Ag(t,e,"style"):pg(t.style,e,"cssText")]]),xg=(t,e,n)=>{switch(e[0]){case".":return fg;case"?":return bg;case"@":return ug;default:return n||"ownerSVGElement"in t?"ref"===e?gg:mg:yg.get(e)||(e in t?e.startsWith("on")?pg:((t,e)=>{let n;do{n=XA(t,e)}while(!n&&(t=qA(t)));return n})(t,e)?.set?Ag:mg:mg)}},_g=(t,e)=>(t.textContent=null==e?"":e,e),Eg=(t,e,n)=>({a:t,b:e,c:n}),wg=(t,e,n,i)=>({v:YA,u:t,t:e,n:n,c:i}),Cg=()=>Eg(null,null,YA);var Sg=t=>(e,n)=>{const{a:i,b:r,c:s}=t(e,n),a=document.importNode(i,!0);let o=YA;if(r!==YA){o=[];for(let t,e,n=0;n<r.length;n++){const{a:i,b:s,c:c}=r[n],l=i===e?t:t=ZA(a,e=i);o[n]=wg(s,l,c,s===vg?[]:s===dg?Cg():null)}}return{b:s?a.firstChild:new og(a),c:o}};const Mg=/^(?:plaintext|script|style|textarea|title|xmp)$/i,Ig=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Tg=/<([a-zA-Z0-9]+[a-zA-Z0-9:._-]*)([^>]*?)(\/?)>/g,Bg=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,Rg=/[\x01\x02]/g;let Pg,Dg,Lg=document.createElement("template");const Ug=t=>{const e=[];let n;for(;n=t.parentNode;)e.push(e.indexOf.call(n.childNodes,t)),t=n;return e},Fg=()=>document.createTextNode(""),Ng=(t,e,n)=>{const i=((t,e)=>{if(e)return Pg||(Pg=document.createElementNS("http://www.w3.org/2000/svg","svg"),Dg=JA(),Dg.selectNodeContents(Pg)),Dg.createContextualFragment(t);Lg.innerHTML=t;const{content:n}=Lg;return Lg=Lg.cloneNode(!1),n})(((t,e,n)=>{let i=0;return t.join("").trim().replace(Tg,((t,e,i,r)=>`<${e}${i.replace(Bg,"=$2$1").trimEnd()}${r?n||Ig.test(e)?" /":`></${e}`:""}>`)).replace(Rg,(t=>""===t?`\x3c!--${e+i++}--\x3e`:e+i++))})(t,Og,n),n),{length:r}=t;let s=YA;if(r>1){const t=[],a=document.createTreeWalker(i,129);let o=0,c=`${Og}${o++}`;for(s=[];o<r;){const i=a.nextNode();if(8===i.nodeType){if(i.data===c){const n=WA(e[o-1])?vg:dg;n===dg&&t.push(i),s.push(Eg(Ug(i),n,null)),c=`${Og}${o++}`}}else{let t;for(;i.hasAttribute(c);){t||(t=Ug(i));const e=i.getAttribute(c);s.push(Eg(t,xg(i,e,n),e)),lg(i,c),c=`${Og}${o++}`}!n&&Mg.test(i.localName)&&i.textContent.trim()===`\x3c!--${c}--\x3e`&&(s.push(Eg(t||Ug(i),_g,null)),c=`${Og}${o++}`)}}for(o=0;o<t.length;o++)t[o].replaceWith(Fg())}const{childNodes:a}=i;let{length:o}=a;return o<1?(o=1,i.appendChild(Fg())):1===o&&1!==r&&1!==a[0].nodeType&&(o=0),KA(kg,t,Eg(i,s,1===o))},kg=new WeakMap,Og="is";var Qg=t=>(e,n)=>kg.get(e)||Ng(e,n,t);const Gg=Sg(Qg(!1)),Hg=Sg(Qg(!0)),zg=(t,{s:e,t:n,v:i})=>{if(t.a!==n){const{b:r,c:s}=(e?Hg:Gg)(n,i);t.a=n,t.b=r,t.c=s}for(let{c:e}=t,n=0;n<e.length;n++){const t=i[n],r=e[n];switch(r.u){case vg:r.v=vg(r.t,jg(r.c,t),r.v);break;case dg:const e=t instanceof Vg?zg(r.c||(r.c=Cg()),t):(r.c=null,t);e!==r.v&&(r.v=dg(r,e));break;default:t!==r.v&&(r.v=r.u(r.t,t,r.n,r.v))}}return t.b},jg=(t,e)=>{let n=0,{length:i}=e;for(i<t.length&&t.splice(i);n<i;n++){const i=e[n];i instanceof Vg?e[n]=zg(t[n]||(t[n]=Cg()),i):t[n]=null}return e};class Vg{constructor(t,e,n){this.s=t,this.t=e,this.v=n}toDOM(t=Cg()){return zg(t,this)}}
/*! (c) Andrea Giammarchi - MIT */const Wg=(t=>(e,...n)=>new Vg(t,e,n))(!1),qg=new WeakMap;var Xg=(t,e)=>((t,e,n)=>{const i=qg.get(t)||KA(qg,t,Cg()),{b:r}=i,s=n&&"function"==typeof e?e():e,a=s instanceof Vg?s.toDOM(i):s;return r!==a&&t.replaceChildren((i.b=a).valueOf()),t})(t,e,!0)
/*! @license DOMPurify 3.1.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.0/LICENSE */;const{entries:Yg,setPrototypeOf:Jg,isFrozen:Kg,getPrototypeOf:Zg,getOwnPropertyDescriptor:$g}=Object;let{freeze:tm,seal:em,create:nm}=Object,{apply:im,construct:rm}="undefined"!=typeof Reflect&&Reflect;tm||(tm=function(t){return t}),em||(em=function(t){return t}),im||(im=function(t,e,n){return t.apply(e,n)}),rm||(rm=function(t,e){return new t(...e)});const sm=bm(Array.prototype.forEach),am=bm(Array.prototype.pop),om=bm(Array.prototype.push),cm=bm(String.prototype.toLowerCase),lm=bm(String.prototype.toString),hm=bm(String.prototype.match),um=bm(String.prototype.replace),dm=bm(String.prototype.indexOf),pm=bm(String.prototype.trim),fm=bm(Object.prototype.hasOwnProperty),Am=bm(RegExp.prototype.test),gm=(mm=TypeError,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return rm(mm,e)});var mm;function bm(t){return function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return im(t,e,i)}}function vm(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cm;Jg&&Jg(t,null);let i=e.length;for(;i--;){let r=e[i];if("string"==typeof r){const t=n(r);t!==r&&(Kg(e)||(e[i]=t),r=t)}t[r]=!0}return t}function ym(t){for(let e=0;e<t.length;e++){fm(t,e)||(t[e]=null)}return t}function xm(t){const e=nm(null);for(const[n,i]of Yg(t)){fm(t,n)&&(Array.isArray(i)?e[n]=ym(i):i&&"object"==typeof i&&i.constructor===Object?e[n]=xm(i):e[n]=i)}return e}function _m(t,e){for(;null!==t;){const n=$g(t,e);if(n){if(n.get)return bm(n.get);if("function"==typeof n.value)return bm(n.value)}t=Zg(t)}return function(){return null}}const Em=tm(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),wm=tm(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Cm=tm(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Sm=tm(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Mm=tm(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Im=tm(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Tm=tm(["#text"]),Bm=tm(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Rm=tm(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Pm=tm(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Dm=tm(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Lm=em(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Um=em(/<%[\w\W]*|[\w\W]*%>/gm),Fm=em(/\${[\w\W]*}/gm),Nm=em(/^data-[\-\w.\u00B7-\uFFFF]/),km=em(/^aria-[\-\w]+$/),Om=em(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Qm=em(/^(?:\w+script|data):/i),Gm=em(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Hm=em(/^html$/i),zm=em(/^[a-z][.\w]*(-[.\w]+)+$/i);var jm=Object.freeze({__proto__:null,MUSTACHE_EXPR:Lm,ERB_EXPR:Um,TMPLIT_EXPR:Fm,DATA_ATTR:Nm,ARIA_ATTR:km,IS_ALLOWED_URI:Om,IS_SCRIPT_OR_DATA:Qm,ATTR_WHITESPACE:Gm,DOCTYPE_NAME:Hm,CUSTOM_ELEMENT:zm});const Vm=function(){return"undefined"==typeof window?null:window};var Wm=function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vm();const n=e=>t(e);if(n.version="3.1.0",n.removed=[],!e||!e.document||9!==e.document.nodeType)return n.isSupported=!1,n;let{document:i}=e;const r=i,s=r.currentScript,{DocumentFragment:a,HTMLTemplateElement:o,Node:c,Element:l,NodeFilter:h,NamedNodeMap:u=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:d,DOMParser:p,trustedTypes:f}=e,A=l.prototype,g=_m(A,"cloneNode"),m=_m(A,"nextSibling"),b=_m(A,"childNodes"),v=_m(A,"parentNode");if("function"==typeof o){const t=i.createElement("template");t.content&&t.content.ownerDocument&&(i=t.content.ownerDocument)}let y,x="";const{implementation:_,createNodeIterator:E,createDocumentFragment:w,getElementsByTagName:C}=i,{importNode:S}=r;let M={};n.isSupported="function"==typeof Yg&&"function"==typeof v&&_&&void 0!==_.createHTMLDocument;const{MUSTACHE_EXPR:I,ERB_EXPR:T,TMPLIT_EXPR:B,DATA_ATTR:R,ARIA_ATTR:P,IS_SCRIPT_OR_DATA:D,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:U}=jm;let{IS_ALLOWED_URI:F}=jm,N=null;const k=vm({},[...Em,...wm,...Cm,...Mm,...Tm]);let O=null;const Q=vm({},[...Bm,...Rm,...Pm,...Dm]);let G=Object.seal(nm(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),H=null,z=null,j=!0,V=!0,W=!1,q=!0,X=!1,Y=!0,J=!1,K=!1,Z=!1,$=!1,tt=!1,et=!1,nt=!0,it=!1,rt=!0,st=!1,at={},ot=null;const ct=vm({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let lt=null;const ht=vm({},["audio","video","img","source","image","track"]);let ut=null;const dt=vm({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pt="http://www.w3.org/1998/Math/MathML",ft="http://www.w3.org/2000/svg",At="http://www.w3.org/1999/xhtml";let gt=At,mt=!1,bt=null;const vt=vm({},[pt,ft,At],lm);let yt=null;const xt=["application/xhtml+xml","text/html"];let _t=null,Et=null;const wt=i.createElement("form"),Ct=function(t){return t instanceof RegExp||t instanceof Function},St=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Et||Et!==t){if(t&&"object"==typeof t||(t={}),t=xm(t),yt=-1===xt.indexOf(t.PARSER_MEDIA_TYPE)?"text/html":t.PARSER_MEDIA_TYPE,_t="application/xhtml+xml"===yt?lm:cm,N=fm(t,"ALLOWED_TAGS")?vm({},t.ALLOWED_TAGS,_t):k,O=fm(t,"ALLOWED_ATTR")?vm({},t.ALLOWED_ATTR,_t):Q,bt=fm(t,"ALLOWED_NAMESPACES")?vm({},t.ALLOWED_NAMESPACES,lm):vt,ut=fm(t,"ADD_URI_SAFE_ATTR")?vm(xm(dt),t.ADD_URI_SAFE_ATTR,_t):dt,lt=fm(t,"ADD_DATA_URI_TAGS")?vm(xm(ht),t.ADD_DATA_URI_TAGS,_t):ht,ot=fm(t,"FORBID_CONTENTS")?vm({},t.FORBID_CONTENTS,_t):ct,H=fm(t,"FORBID_TAGS")?vm({},t.FORBID_TAGS,_t):{},z=fm(t,"FORBID_ATTR")?vm({},t.FORBID_ATTR,_t):{},at=!!fm(t,"USE_PROFILES")&&t.USE_PROFILES,j=!1!==t.ALLOW_ARIA_ATTR,V=!1!==t.ALLOW_DATA_ATTR,W=t.ALLOW_UNKNOWN_PROTOCOLS||!1,q=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,X=t.SAFE_FOR_TEMPLATES||!1,Y=!1!==t.SAFE_FOR_XML,J=t.WHOLE_DOCUMENT||!1,$=t.RETURN_DOM||!1,tt=t.RETURN_DOM_FRAGMENT||!1,et=t.RETURN_TRUSTED_TYPE||!1,Z=t.FORCE_BODY||!1,nt=!1!==t.SANITIZE_DOM,it=t.SANITIZE_NAMED_PROPS||!1,rt=!1!==t.KEEP_CONTENT,st=t.IN_PLACE||!1,F=t.ALLOWED_URI_REGEXP||Om,gt=t.NAMESPACE||At,G=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&Ct(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(G.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&Ct(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(G.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(G.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),X&&(V=!1),tt&&($=!0),at&&(N=vm({},Tm),O=[],!0===at.html&&(vm(N,Em),vm(O,Bm)),!0===at.svg&&(vm(N,wm),vm(O,Rm),vm(O,Dm)),!0===at.svgFilters&&(vm(N,Cm),vm(O,Rm),vm(O,Dm)),!0===at.mathMl&&(vm(N,Mm),vm(O,Pm),vm(O,Dm))),t.ADD_TAGS&&(N===k&&(N=xm(N)),vm(N,t.ADD_TAGS,_t)),t.ADD_ATTR&&(O===Q&&(O=xm(O)),vm(O,t.ADD_ATTR,_t)),t.ADD_URI_SAFE_ATTR&&vm(ut,t.ADD_URI_SAFE_ATTR,_t),t.FORBID_CONTENTS&&(ot===ct&&(ot=xm(ot)),vm(ot,t.FORBID_CONTENTS,_t)),rt&&(N["#text"]=!0),J&&vm(N,["html","head","body"]),N.table&&(vm(N,["tbody"]),delete H.tbody),t.TRUSTED_TYPES_POLICY){if("function"!=typeof t.TRUSTED_TYPES_POLICY.createHTML)throw gm('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof t.TRUSTED_TYPES_POLICY.createScriptURL)throw gm('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');y=t.TRUSTED_TYPES_POLICY,x=y.createHTML("")}else void 0===y&&(y=function(t,e){if("object"!=typeof t||"function"!=typeof t.createPolicy)return null;let n=null;const i="data-tt-policy-suffix";e&&e.hasAttribute(i)&&(n=e.getAttribute(i));const r="dompurify"+(n?"#"+n:"");try{return t.createPolicy(r,{createHTML:t=>t,createScriptURL:t=>t})}catch(t){return console.warn("TrustedTypes policy "+r+" could not be created."),null}}(f,s)),null!==y&&"string"==typeof x&&(x=y.createHTML(""));tm&&tm(t),Et=t}},Mt=vm({},["mi","mo","mn","ms","mtext"]),It=vm({},["foreignobject","desc","title","annotation-xml"]),Tt=vm({},["title","style","font","a","script"]),Bt=vm({},[...wm,...Cm,...Sm]),Rt=vm({},[...Mm,...Im]),Pt=function(t){om(n.removed,{element:t});try{t.parentNode.removeChild(t)}catch(e){t.remove()}},Dt=function(t,e){try{om(n.removed,{attribute:e.getAttributeNode(t),from:e})}catch(t){om(n.removed,{attribute:null,from:e})}if(e.removeAttribute(t),"is"===t&&!O[t])if($||tt)try{Pt(e)}catch(t){}else try{e.setAttribute(t,"")}catch(t){}},Lt=function(t){let e=null,n=null;if(Z)t="<remove></remove>"+t;else{const e=hm(t,/^[\r\n\t ]+/);n=e&&e[0]}"application/xhtml+xml"===yt&&gt===At&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");const r=y?y.createHTML(t):t;if(gt===At)try{e=(new p).parseFromString(r,yt)}catch(t){}if(!e||!e.documentElement){e=_.createDocument(gt,"template",null);try{e.documentElement.innerHTML=mt?x:r}catch(t){}}const s=e.body||e.documentElement;return t&&n&&s.insertBefore(i.createTextNode(n),s.childNodes[0]||null),gt===At?C.call(e,J?"html":"body")[0]:J?e.documentElement:s},Ut=function(t){return E.call(t.ownerDocument||t,t,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},Ft=function(t){return"function"==typeof c&&t instanceof c},Nt=function(t,e,i){M[t]&&sm(M[t],(t=>{t.call(n,e,i,Et)}))},kt=function(t){let e=null;if(Nt("beforeSanitizeElements",t,null),(i=t)instanceof d&&("string"!=typeof i.nodeName||"string"!=typeof i.textContent||"function"!=typeof i.removeChild||!(i.attributes instanceof u)||"function"!=typeof i.removeAttribute||"function"!=typeof i.setAttribute||"string"!=typeof i.namespaceURI||"function"!=typeof i.insertBefore||"function"!=typeof i.hasChildNodes))return Pt(t),!0;var i;const r=_t(t.nodeName);if(Nt("uponSanitizeElement",t,{tagName:r,allowedTags:N}),t.hasChildNodes()&&!Ft(t.firstElementChild)&&Am(/<[/\w]/g,t.innerHTML)&&Am(/<[/\w]/g,t.textContent))return Pt(t),!0;if(7===t.nodeType)return Pt(t),!0;if(Y&&8===t.nodeType&&Am(/<[/\w]/g,t.data))return Pt(t),!0;if(!N[r]||H[r]){if(!H[r]&&Qt(r)){if(G.tagNameCheck instanceof RegExp&&Am(G.tagNameCheck,r))return!1;if(G.tagNameCheck instanceof Function&&G.tagNameCheck(r))return!1}if(rt&&!ot[r]){const e=v(t)||t.parentNode,n=b(t)||t.childNodes;if(n&&e){for(let i=n.length-1;i>=0;--i)e.insertBefore(g(n[i],!0),m(t))}}return Pt(t),!0}return t instanceof l&&!function(t){let e=v(t);e&&e.tagName||(e={namespaceURI:gt,tagName:"template"});const n=cm(t.tagName),i=cm(e.tagName);return!!bt[t.namespaceURI]&&(t.namespaceURI===ft?e.namespaceURI===At?"svg"===n:e.namespaceURI===pt?"svg"===n&&("annotation-xml"===i||Mt[i]):Boolean(Bt[n]):t.namespaceURI===pt?e.namespaceURI===At?"math"===n:e.namespaceURI===ft?"math"===n&&It[i]:Boolean(Rt[n]):t.namespaceURI===At?!(e.namespaceURI===ft&&!It[i])&&!(e.namespaceURI===pt&&!Mt[i])&&!Rt[n]&&(Tt[n]||!Bt[n]):!("application/xhtml+xml"!==yt||!bt[t.namespaceURI]))}(t)?(Pt(t),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!Am(/<\/no(script|embed|frames)/i,t.innerHTML)?(X&&3===t.nodeType&&(e=t.textContent,sm([I,T,B],(t=>{e=um(e,t," ")})),t.textContent!==e&&(om(n.removed,{element:t.cloneNode()}),t.textContent=e)),Nt("afterSanitizeElements",t,null),!1):(Pt(t),!0)},Ot=function(t,e,n){if(nt&&("id"===e||"name"===e)&&(n in i||n in wt))return!1;if(V&&!z[e]&&Am(R,e));else if(j&&Am(P,e));else if(!O[e]||z[e]){if(!(Qt(t)&&(G.tagNameCheck instanceof RegExp&&Am(G.tagNameCheck,t)||G.tagNameCheck instanceof Function&&G.tagNameCheck(t))&&(G.attributeNameCheck instanceof RegExp&&Am(G.attributeNameCheck,e)||G.attributeNameCheck instanceof Function&&G.attributeNameCheck(e))||"is"===e&&G.allowCustomizedBuiltInElements&&(G.tagNameCheck instanceof RegExp&&Am(G.tagNameCheck,n)||G.tagNameCheck instanceof Function&&G.tagNameCheck(n))))return!1}else if(ut[e]);else if(Am(F,um(n,L,"")));else if("src"!==e&&"xlink:href"!==e&&"href"!==e||"script"===t||0!==dm(n,"data:")||!lt[t]){if(W&&!Am(D,um(n,L,"")));else if(n)return!1}else;return!0},Qt=function(t){return"annotation-xml"!==t&&hm(t,U)},Gt=function(t){Nt("beforeSanitizeAttributes",t,null);const{attributes:e}=t;if(!e)return;const i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:O};let r=e.length;for(;r--;){const s=e[r],{name:a,namespaceURI:o,value:c}=s,l=_t(a);let h="value"===a?c:pm(c);if(i.attrName=l,i.attrValue=h,i.keepAttr=!0,i.forceKeepAttr=void 0,Nt("uponSanitizeAttribute",t,i),h=i.attrValue,i.forceKeepAttr)continue;if(Dt(a,t),!i.keepAttr)continue;if(!q&&Am(/\/>/i,h)){Dt(a,t);continue}X&&sm([I,T,B],(t=>{h=um(h,t," ")}));const u=_t(t.nodeName);if(Ot(u,l,h)){if(!it||"id"!==l&&"name"!==l||(Dt(a,t),h="user-content-"+h),y&&"object"==typeof f&&"function"==typeof f.getAttributeType)if(o);else switch(f.getAttributeType(u,l)){case"TrustedHTML":h=y.createHTML(h);break;case"TrustedScriptURL":h=y.createScriptURL(h)}try{o?t.setAttributeNS(o,a,h):t.setAttribute(a,h),am(n.removed)}catch(t){}}}Nt("afterSanitizeAttributes",t,null)},Ht=function t(e){let n=null;const i=Ut(e);for(Nt("beforeSanitizeShadowDOM",e,null);n=i.nextNode();)Nt("uponSanitizeShadowNode",n,null),kt(n)||(n.content instanceof a&&t(n.content),Gt(n));Nt("afterSanitizeShadowDOM",e,null)};return n.sanitize=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null,s=null,o=null,l=null;if(mt=!t,mt&&(t="\x3c!--\x3e"),"string"!=typeof t&&!Ft(t)){if("function"!=typeof t.toString)throw gm("toString is not a function");if("string"!=typeof(t=t.toString()))throw gm("dirty is not a string, aborting")}if(!n.isSupported)return t;if(K||St(e),n.removed=[],"string"==typeof t&&(st=!1),st){if(t.nodeName){const e=_t(t.nodeName);if(!N[e]||H[e])throw gm("root node is forbidden and cannot be sanitized in-place")}}else if(t instanceof c)i=Lt("\x3c!----\x3e"),s=i.ownerDocument.importNode(t,!0),1===s.nodeType&&"BODY"===s.nodeName||"HTML"===s.nodeName?i=s:i.appendChild(s);else{if(!$&&!X&&!J&&-1===t.indexOf("<"))return y&&et?y.createHTML(t):t;if(i=Lt(t),!i)return $?null:et?x:""}i&&Z&&Pt(i.firstChild);const h=Ut(st?t:i);for(;o=h.nextNode();)kt(o)||(o.content instanceof a&&Ht(o.content),Gt(o));if(st)return t;if($){if(tt)for(l=w.call(i.ownerDocument);i.firstChild;)l.appendChild(i.firstChild);else l=i;return(O.shadowroot||O.shadowrootmode)&&(l=S.call(r,l,!0)),l}let u=J?i.outerHTML:i.innerHTML;return J&&N["!doctype"]&&i.ownerDocument&&i.ownerDocument.doctype&&i.ownerDocument.doctype.name&&Am(Hm,i.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+i.ownerDocument.doctype.name+">\n"+u),X&&sm([I,T,B],(t=>{u=um(u,t," ")})),y&&et?y.createHTML(u):u},n.setConfig=function(){St(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),K=!0},n.clearConfig=function(){Et=null,K=!1},n.isValidAttribute=function(t,e,n){Et||St({});const i=_t(t),r=_t(e);return Ot(i,r,n)},n.addHook=function(t,e){"function"==typeof e&&(M[t]=M[t]||[],om(M[t],e))},n.removeHook=function(t){if(M[t])return am(M[t])},n.removeHooks=function(t){M[t]&&(M[t]=[])},n.removeAllHooks=function(){M={}},n}();let qm=yu;const Xm={ALLOWED_ATTR:["style","name"],ADD_TAGS:["style","slot"],USE_PROFILES:{html:!0},FORCE_BODY:!0,CUSTOM_ELEMENT_HANDLING:{tagNameCheck:t=>t.match(/^sh-/),attributeNameCheck:()=>!0,allowCustomizedBuiltInElements:!0}},Ym=/<([a-z0-9-]+)[^<>]+$/i,Jm=/([a-z0-9-]+)="$/i,Km=/SLOT_CONTENTS\(\s*(.*)\s*\)/;class Zm{#U;#F;#N;constructor(t){this.href=t}build(t){this.#F=this.#F||window.getComputedStyle(t);const e=!this.href.content.querySelector("slot:not([name])"),n=Array.from(this.href.content.querySelectorAll("slot")).map((t=>t.outerHTML)).join("");t.shadowRoot.innerHTML=n,this.#U=[[],[]];let i=this.href.innerHTML;let r;("<style>\n:host {\n\tdisplay: block;\n}\n</style>\n"+Wm.sanitize(i,Xm)+(e?"<slot></slot>":"")).split(/\$\{(?<attr>[^$]+)\}/g).forEach(((t,e)=>this.#U[e%2].push(e%2?t.split("|"):t)));for(let t=0,e=this.#U[1].length;t<e;t++){const e=this.#U[1][t],n=this.#U[0][t].match(Ym);n&&(r=n[1]);const i=this.#U[0][t].trim().match(Jm)?.[1];if(i&&r){const n=dp.get(r)?.get(i);n?this.#U[1][t][2]=n:(console.log("No schema found, "+r+" "+i),console.log(this.#U[0][t]+"${"+e+"}"+(this.#U[0][t+1]||"")))}}this.update(t),this.#N=uu(t.shadowRoot,"*")}#k(t,e){const[n,i,r]=t,s=n.match(Km);if(s){let t;const n=s[1];return t=n?e.shadowRoot.querySelector('slot[name="'+n+'"]'):e.shadowRoot.querySelector("slot"),t?Wg(t.assignedNodes().map((t=>t.outerHTML?t.outerHTML:t.textContent))):""}let a=this.#F.getPropertyValue("--"+n)||e.getAttribute(n);return"none"!==a||r.map&&void 0===r.map.none||(a=e.getAttribute(n)||null),a||i||""}update(t){Xg(t.shadowRoot,Wg(this.#U[0],...this.#U[1].map((e=>this.#k(e,t)))))}dispose(){console.log("Removed from DOM")}visible=!0;layers=new sn;raycast(t,e){if(this.#N)for(const n of this.#N){const i=n.object;i&&i.raycast&&n.properties&&(2===n.properties.pointerEvents||(1===n.properties.pointerEvents||void 0===n.properties.pointerEvents)&&i.visible)&&i.raycast(t,e)}}getEls(){return this.#N}}const $m=new MutationObserver((t=>{t.forEach((t=>{t.target.object instanceof Promise||t.target.object.update(t.target)}))})),tb={attributes:!0},eb=new Map,nb=document.createElement("template");nb.innerHTML=ru`
<style>
  sh-mesh, sh-line {
    /* --geometry: rect(var(--text-box-width, 1) var(--text-box-height, 1) var(--text-box-radius, 0) var(--text-box-radius, 0) var(--text-box-left, 0) var(--text-box-top, 0)); */
  }
  sh-text {
    --font: https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnPKruQQ.ttf;
  }
</style>
<sh-text text-box-radius="\${text-box-radius|0}" visibility="\${visibility|visible}" part="text" padding="\${padding|none}" location="\${location|none}" pointer-events="none" scale="\${scale|none}" rotate="\${rotate|none}" cast-shadow="false" anchor-x="\${anchor-x|center}" anchor-y="\${anchor-y|middle}" font-size="\${font-size|0.1}" color="\${color|black}" width="\${width|none}">
  <div slot="text">\${SLOT_CONTENTS()|}</div>
  <sh-line location="0 0 -0.01" part="line" pointer-events="none" material="black" geometry="\${path|path2d(m-.1-.2h.2a.1.1 90 01.1.1v.2a.1.1 90 01-.1.1h-.2a.1.1 90 01-.1-.1v-.2a.1.1 90 01.1-.1)}"></sh-line>
  <sh-mesh location="0 0 -0.01" visibility="\${visibility|visible}" pointer-events="\${pointer-events|auto}" part="mesh" cast-shadow="\${cast-shadow|false}" receive-shadow="\${receive-shadow|false}" material="\${material|plastic}" geometry="\${path|path2d(m-.1-.2h.2a.1.1 90 01.1.1v.2a.1.1 90 01-.1.1h-.2a.1.1 90 01-.1-.1v-.2a.1.1 90 01.1-.1)}"></sh-mesh>
</sh-text>
`,eb.set("text-shape",nb);const ib=Zm,rb=t=>class extends t{static shortHandSchema=iu({href:{type:"Element",stage:12}});static name="Use";static documentation=qm;static noWarnForUnrecognisedAttributes=!0;#O={};properties={pointerEvents:2};constructor(){super(),$m.observe(this,tb),this.attachShadow({mode:"open"}),this.shadowRoot.addEventListener("slotchange",(async()=>{(await this.object).update(this)}))}stringToValue(t,e){if("href"===t){const t=e.trim().match(/^((std:(?<stdPath>[^\s]+))|(?<url>[^\s]+)#(?<id>[^\s]+))$/i);if(t){if(t.groups.stdPath){if(eb.has(t.groups.stdPath))return eb.get(t.groups.stdPath);throw Error(`No template called "${t.groups.stdPath}" in the standard template library.`)}if(t.groups.url)return fetch(t.groups.url).then((t=>t.text())).then((e=>{const n=Wm.sanitize(e,Xm),i=document.createElement("template");i.innerHTML=n;const r=i.content.getElementById(t.groups.id);if(r){if("TEMPLATE"===r.tagName)return r;{const t=document.createElement("template");return t.innerHTML=r.outerHTML,t}}throw Error(`Could not find element with id ${t.groups.id} on ${t.groups.url}`)}))}}return super.stringToValue(t,e)}tick(t,e,n,i,r){super.tick(t,e,n,i,r);const s=window.getComputedStyle(this);if(this.object instanceof Zm){let a=!1;for(const t of this.__shTrackedAttributes){const e=s.getPropertyValue("--"+t);e!==this.#O[t]&&(this.#O[t]=e,a=!0)}a&&this.object.update(this);for(const s of this.object.getEls())!s.tick||s.object instanceof Promise||s.isShRenderer||s.tick(t,e,n,i,r)}}async allAttributesChangedCallback(){const t=new Zm(this.properties.href);await this.assignPostConstructAttributes(t),t.build(this),this.updateObject(t)}};function sb(t,e){gp(t,{type:Zm,mixin:t=>class extends(rb(t)){static shortHandSchema=iu({});static name="QuickStart";static documentation=`A wrapper for <sh-use href="${e}">`;async allAttributesChangedCallback(){const t=new Zm(this.stringToValue("href",e));await this.assignPostConstructAttributes(t),t.build(this),this.updateObject(t)}}})}var ab=Object.freeze({__proto__:null,UseClass:Zm,mixin:rb,name:"Use",registerTemplateToElement:sb,standardTemplates:eb,type:ib});const ob=[],cb=["transform","location","rotate","scale"],lb=new ge,hb=new me,ub=new WeakMap;function db(t){!t.object||t.object instanceof Promise||(t.object.__hasInitial||(t.object.__hasInitial=!0,1===t.object.scale.x&&1===t.object.scale.y&&1===t.object.scale.z||(t.object.__initialScale=t.object.scale.clone()),t.object.position.length()>0&&(t.object.__initialPosition=t.object.position.clone()),0===t.object.quaternion.x&&0===t.object.quaternion.y&&0===t.object.quaternion.z&&1===t.object.quaternion.w||(t.object.__initialQuaternion=t.object.quaternion.clone())),"string"==typeof t.properties.transform?ub.get(t).decompose(t.object.position,t.object.quaternion,t.object.scale):(t.object.position.set(0,0,0),t.object.quaternion.identity(),t.object.scale.set(1,1,1)),t.postConstruct.has("quaternion")?(lb.copy(t.postConstruct.get("quaternion")),t.object.quaternion.multiply(lb)):t.postConstruct.has("rotation")?(lb.setFromEuler(t.postConstruct.get("rotation")),t.object.quaternion.multiply(lb)):t.object.__initialQuaternion&&t.object.quaternion.multiply(t.object.__initialQuaternion),hb.copy(t.object.position),t.postConstruct.has("position")?hb.add(t.postConstruct.get("position")):t.object.__initialPosition&&hb.add(t.object.__initialPosition),t.object.position.copy(hb),hb.copy(t.object.scale),t.postConstruct.has("scale")?hb.multiply(t.postConstruct.get("scale")):t.object.__initialScale&&hb.multiply(t.object.__initialScale),t.object.scale.copy(hb))}const pb=ru`<style>

@keyframes object-animation {
  0% {--t: 0;}
  100% {--t: 1;}
}

</style>`;let fb=window.document.styleSheets[0];fb||(document.head.appendChild(document.createElement("style")),fb=window.document.styleSheets[0]);for(const t of pb.split("\n\n").slice(1,-1))fb.insertRule(t,fb.cssRules.length);function Ab(t){return t.toLowerCase().replace(/[\s.#[\]]/g,"-")}const gb=document.createElement("template");gb.innerHTML=ru`
<style>
  sh-renderer-webgl {
    min-width: 100%;
    min-height: 100%;
  }
</style>
<sh-renderer-webgl scene="sh-scene" id="renderer" part="renderer" exposure="\${exposure|2.5}">
  <sh-scene slot="scene">
    <sh-model part="model" src="\${src}" scale="\${scale|none}" location="\${location|none}" rotate="\${rotate|none}" transform="\${transform|none}"></sh-model>
    <sh-mesh part="floor-shadow" material="shadow" geometry="floor" receive-shadow="true" cast-shadow="false" pointer-events="none"></sh-mesh>
    <sh-light-ambient color="\${ambient-light|#2e2e40}" intensity="1"></sh-light-ambient>
    <sh-light-directional part="directional-light" location="1 1 1" color="\${directional-light|#fcf8d9}" intensity="0.8"></sh-light-directional>
    <sh-orbit-controls camera="sh-camera-perspective" scroll-action="\${scroll-action|zoom}" pivot="\${camera-pivot|0 0.2 0}"></sh-orbit-controls>
    <sh-camera-perspective location="\${camera-position|0 0.6 0.8}" part="camera"></sh-camera-perspective>
    <slot name="scene"></slot>
  </sh-scene>
  <slot></slot>
</sh-renderer-webgl>
`,eb.set("model",gb);const mb=new qe,bb=wa,vb="Model";var yb=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=vb;static shortHandSchema=new Map([["src",{type:"url",stage:12,example:"./my-model.usdz"}],["instance-proxy-limit",{as:"modelCreateInstancesLimit",type:"number",stage:12}],["batches",{default:!1,stage:12}]]);#Q;#G;objectMaterials=new Map;objectsByName=new Map;constructor(){super(),this.attachShadow({mode:"open"})}async allAttributesChangedCallback(){const t=["material","hover","mesh","group"];if(await IA,!this.properties.src)throw"No src provided";let e;const n=Yh(this.properties.src).toLowerCase();if(n.endsWith(".glb")||n.endsWith(".gltf"))e=await(i=this.properties.src,new Promise((function(t,e){RA.load(i,t,(function(t){console.log(i+" "+(t.loaded/t.total*100).toFixed(1)+"% loaded")}),e)})));else{if(!n.endsWith(".usd")&&!n.endsWith(".usdz"))throw Error("Unrecognised format");{const t=await function(t){return new Promise((function(e,n){BA.load(t,e,(function(e){console.log(t+" "+(e.loaded/e.total*100).toFixed(1)+"% loaded")}),n)}))}(this.properties.src);e={scene:t,animations:t.animations}}}var i;const r=e.scene;if(this.#Q=new Ch(e.scene),this.objectAnimations=new Map(e.animations.map((t=>[t.name,this.#Q.clipAction(t)]))||[]),!1!==this.shAddShadowDom){let n="",i="";const s=this.attributes.getNamedItem("will-change")?.value||"";e.animations.length&&(i+=`\n\t\t\t\t\t@keyframes object-animation {\n\t\t\t\t\t\tfrom {--t: 0.0;}\n\t\t\t\t\t\tto {--t: 1.0;}\n\t\t\t\t\t}\n\t\t\t\t\t:host {\n\t\t\t\t\t\tanimation-timing-function: linear;\n\t\t\t\t\t\tanimation-iteration-count: infinite;\n\t\t\t\t\t\t${e.animations.map(((t,e)=>{const n=Ab(t.name);return`--animation-${n}-duration: ${t.duration}s;\n--animation-${n}-weight: ${0===e?1:0};`})).join("\n")}\n\t\t\t\t\t}\n\t\t\t\t`);let a=!0;for(const r of e.animations){const e=crypto.randomUUID(),o=Ab(r.name);window.CSS.registerProperty&&window.CSS.registerProperty({name:"--"+e,syntax:"<number>",inherits:!0,initialValue:"0"}),t.push(o),n+=`<sh-animation-proxy will-change="t weight ${s}" t="0" paused="${!a}" weight="${a?1:0}" target="${r.name}" part="animation ${o}"></sh-animation-proxy>\n`;let c=window.document.styleSheets[0];c||(document.head.appendChild(document.createElement("style")),c=window.document.styleSheets[0]),c.insertRule(`\n\t\t\t\t@keyframes object-animation-${o} {\n\t\t\t\t\t0% {--${e}: 0.0;}\n\t\t\t\t\t100% {--${e}: 1.0;}\n\t\t\t\t}`,c.cssRules.length),i+=`\n\t\t\t\t[part~="${o}"] {\n\t\t\t\t\t--weight: var(--animation-${o}-weight, ${a?1:0});\n\t\t\t\t\t--t: var(--${e});\n\t\t\t\t\tanimation-duration: var(--animation-${o}-duration);\n\t\t\t\t\tanimation-timing-function: linear;\n\t\t\t\t\tanimation-iteration-count: infinite;\n\t\t\t\t}`,a=!1}const o=new Map,c=new Map,l=[];let h=0,u=0;r.traverse((e=>{if(e.material){if(!o.has(e.material)){if(e.material.name||(e.material.name="material-"+h++),0===e.material.transmission&&e.material instanceof il){const t=e.material;e.material=c.get(t)||(new nl).copy(t),c.set(t,e.material)}this.objectMaterials.set(e.material.name,e.material);const n=Ab(e.material.name);t.push(n);let i="";e.isMeshPhysicalMaterial?i="physical":e.isMeshSimpleMaterial&&(i="simple");const r=document.createElement("sh-material-proxy");s&&r.setAttribute("will-change",s),r.setAttribute("target",e.material.name),r.setAttribute("id",n+"-proxy"),r.setAttribute("part",`material ${e?.userData?.part||""} ${i} ${n}`),l.push(r)}let n=0;o.has(e.material)&&(n=o.get(e.material)),o.set(e.material,n+1)}})),this.properties.batches&&(this.#G=new Map);const d=new Map;for(const[t,e]of o.entries())e>1&&d.set(t,{count:0,maxIndex:0,maxVertex:0,objects:[]});const p=new Map,f=[],A=new Map;r.traverse((e=>{if(e!==r){if(e instanceof xn){e.name||(e.name="unamed-object-"+u++);let n="";e.isMesh&&(n="mesh"),e.isInstancedMesh?n="mesh instanced-mesh":e.isGroup?n="group":e.isLight&&(n="light");const i=e.isLight?document.createElement("sh-light-proxy"):document.createElement("sh-object-proxy");s&&i.setAttribute("will-change",s),i.setAttribute("target",e.name);let r=!1;if(e.isMesh){const t=o.get(e.material);if(this.properties.batches&&t>1){r=!0;const t=d.get(e.material);t.count+=1,t.objects.push(e),t.maxIndex+=e.geometry.index.count,t.maxVertex+=e.geometry.attributes.position.count}i.setAttribute("material","#"+Ab(e.material.name)+"-proxy")}const a=Ab(e.name);if(r){const t=new wa;t.dummyGeometry=e.geometry,A.set(e,t),this.objectsByName.set(e.name,t),p.set(t,i)}else this.objectsByName.set(e.name,e),p.set(e,i);t.push(a),i.id=a;for(const[t,n]of Object.entries(e.userData))dp.get("sh-object-proxy").has(t)&&i.setAttribute(t,n);i.setAttribute("part",`object ${e?.userData?.part||""} ${n} ${a}`);const c=void 0===this.properties.modelCreateInstancesLimit?16:this.properties.modelCreateInstancesLimit;if(e.isInstancedMesh&&e.count<c)for(let t=0;t<e.count;t++){const e=document.createElement("sh-instance-proxy");e.setAttribute("target","#"+a),e.setAttribute("index",t),e.setAttribute("part",`instance ${a}-instance instance-${t}`),i.appendChild(e),f.push(e)}}}else p.set(e,this)}));for(const[t,e]of A){e.visible=t.visible,e.name=t.name+"_dummy",e.isDummyForBatchedMesh=!0,t.parent.add(e),t.removeFromParent();for(const n of t.children)e.add(n)}const g=[...f,...Array.from(p.values())];r.raycast=function(t,e){for(const n of g)if(n.isBatchedMesh){n.raycast(t,e);for(const t of e)t.object===n&&(t.object=A.get(d.get(t.object.material).objects[t.batchId]))}else{const i=n.object;if(i===r)continue;!i||i instanceof Promise||i.isDummyForBatchedMesh||i.visible&&0!==i.el.properties.pointerEvents&&i.raycast(t,e)}},this.getRootNode().host&&this.setAttribute("exportparts",t.join(", ")),this.shadowRoot.innerHTML=`<style>\n\t\t\t\t:host {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t}\n\t\t\t\t${i}\n\t\t\t</style>\n\t\t\t${n}\n\t\t\t<slot></slot>\n\t`,r.traverse((t=>{if(t!==r&&t instanceof xn){const e=p.get(t);t.parent===r?this.shadowRoot.appendChild(e):p.get(t.parent).appendChild(e)}}));for(const[t,{count:e,maxIndex:n,maxVertex:i,objects:s}]of d.entries()){const a=new So(e,i,n,t);a.name=t.name+"_batched_mesh",g.unshift(a);for(const t of s){const e=a.addGeometry(t.geometry),n=A.get(t),i=[];n.raycast=function(e,r){t.matrixWorld.copy(n.matrixWorld),t.raycast(e,i),i.length&&(i[0].object=n),r.push(...i),i.splice(0)},this.#G.set(n,{index:e,batchedMesh:a})}r.add(a)}for(const t of l)this.shadowRoot.appendChild(t)}this.updateObject(r),db(this),await this.assignPostConstructAttributes(this.object)}tick(t,e,n,i,r){if(this.#G)for(const[t,{index:e,batchedMesh:n}]of this.#G)mb.copy(this.object.matrixWorld).invert().multiply(t.matrixWorld),n.castShadow=t.castShadow,n.receiveShadow=t.receiveShadow,n.setMatrixAt(e,mb),n.setVisibleAt(e,t.visible);if(this.#Q&&this.#Q.update(e),this.shadowRoot)for(const s of this.shadowRoot.children)s.tick&&s.tick(t,e,n,i,r);super.tick(t,e,n,i,r)}},name:vb,type:bb});const xb=new ye,_b=new me,Eb=new me,wb=new qe,Cb=new ke,Sb=new me,Mb=Yl,Ib="DirectionalLight";var Tb=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=Ib;#H;#z;static shortHandSchema=new Map([["shadow-radius",{as:"shadow.radius",default:2}],["auto-shadow-focus",{as:"autoShadow",default:!0,stage:4}],["shadow-focus",{as:"shadowCameraFocus",default:'sh-object-proxy,sh-mesh:not([cast-shadow="false"]),sh-model:not([cast-shadow="false"])',stage:4}],["shadow-helper",{as:"shadowCameraHelper",default:!1,stage:4}]]);tick(t,e,n,i,r){if(super.tick(t,e,n,i,r),!this.ready||!this.properties.autoShadow)return;const s=this.object.shadow.camera;s.getWorldDirection(_b),s.getWorldPosition(Eb),wb.copy(s.matrixWorld),wb.invert(),this.properties.shadowCameraHelper?(this.#z||(this.#z=new Qh(this.object.shadow.camera),this.object.add(this.#z)),this.#z.visible=!0):this.#z&&(this.#z.visible=!1),s.near=1,s.far=5,s.left=1e5,s.right=-1e5,s.top=-1e5,s.bottom=1e5,this.#H.forEach((function(t){if(!t.object||t.object instanceof Promise)return;xb.setFromObject(t.object),xb.getBoundingSphere(Cb);const e=Xh(Eb,_b,Cb.center),n=function(t,e,n,i){var r=Xh(t,e,n);return i.copy(e),i.multiplyScalar(r),i.add(n),i}(Eb,_b,Cb.center,Sb),i=n.applyMatrix4(wb);s.near=Math.min(-e-Cb.radius-.5,s.near),s.far=Math.max(-e+Cb.radius+.5,s.far),s.left=Math.min(-Cb.radius+i.x,s.left),s.right=Math.max(Cb.radius+i.x,s.right),s.top=Math.max(Cb.radius+i.y,s.top),s.bottom=Math.min(-Cb.radius+i.y,s.bottom)})),s.updateProjectionMatrix(),this.#z&&this.#z.update()}async allAttributesChangedCallback(){await super.allAttributesChangedCallback(),this.#H&&this.#H.dispose(),this.#H=cu(this.getRootNode().host?.shadowRoot||this.closest("sh-scene")||document,this.properties.shadowCameraFocus)}},name:Ib,type:Mb});const Bb={type:"change"},Rb={type:"start"},Pb={type:"end"},Db=new We,Lb=new Hi,Ub=Math.cos(70*Ht.DEG2RAD);const Fb=class extends Rt{constructor(t,c){super(),this.object=t,this.domElement=c,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new me,this.cursor=new me,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e,MIDDLE:n,RIGHT:i},this.touches={ONE:r,TWO:a},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",nt),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",nt),this._domElementKeyEvents=null},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(Bb),l.update(),u=h.NONE},this.update=function(){const e=new me,n=(new ge).setFromUnitVectors(t.up,new me(0,1,0)),i=n.clone().invert(),r=new me,s=new ge,a=new me,o=2*Math.PI;return function(c=null){const m=l.object.position;e.copy(m).sub(l.target),e.applyQuaternion(n),p.setFromVector3(e),l.autoRotate&&u===h.NONE&&D(function(t){return null!==t?2*Math.PI/60*l.autoRotateSpeed*t:2*Math.PI/60/60*l.autoRotateSpeed}(c)),l.enableDamping?(p.theta+=f.theta*l.dampingFactor,p.phi+=f.phi*l.dampingFactor):(p.theta+=f.theta,p.phi+=f.phi);let b=l.minAzimuthAngle,v=l.maxAzimuthAngle;isFinite(b)&&isFinite(v)&&(b<-Math.PI?b+=o:b>Math.PI&&(b-=o),v<-Math.PI?v+=o:v>Math.PI&&(v-=o),p.theta=b<=v?Math.max(b,Math.min(v,p.theta)):p.theta>(b+v)/2?Math.max(b,p.theta):Math.min(v,p.theta)),p.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,p.phi)),p.makeSafe(),!0===l.enableDamping?l.target.addScaledVector(g,l.dampingFactor):l.target.add(g),l.target.sub(l.cursor),l.target.clampLength(l.minTargetRadius,l.maxTargetRadius),l.target.add(l.cursor);let y=!1;if(l.zoomToCursor&&I||l.object.isOrthographicCamera)p.radius=G(p.radius);else{const t=p.radius;p.radius=G(p.radius*A),y=t!=p.radius}if(e.setFromSpherical(p),e.applyQuaternion(i),m.copy(l.target).add(e),l.object.lookAt(l.target),!0===l.enableDamping?(f.theta*=1-l.dampingFactor,f.phi*=1-l.dampingFactor,g.multiplyScalar(1-l.dampingFactor)):(f.set(0,0,0),g.set(0,0,0)),l.zoomToCursor&&I){let n=null;if(l.object.isPerspectiveCamera){const t=e.length();n=G(t*A);const i=t-n;l.object.position.addScaledVector(S,i),l.object.updateMatrixWorld(),y=!!i}else if(l.object.isOrthographicCamera){const t=new me(M.x,M.y,0);t.unproject(l.object);const i=l.object.zoom;l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/A)),l.object.updateProjectionMatrix(),y=i!==l.object.zoom;const r=new me(M.x,M.y,0);r.unproject(l.object),l.object.position.sub(r).add(t),l.object.updateMatrixWorld(),n=e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),l.zoomToCursor=!1;null!==n&&(this.screenSpacePanning?l.target.set(0,0,-1).transformDirection(l.object.matrix).multiplyScalar(n).add(l.object.position):(Db.origin.copy(l.object.position),Db.direction.set(0,0,-1).transformDirection(l.object.matrix),Math.abs(l.object.up.dot(Db.direction))<Ub?t.lookAt(l.target):(Lb.setFromNormalAndCoplanarPoint(l.object.up,l.target),Db.intersectPlane(Lb,l.target))))}else if(l.object.isOrthographicCamera){const t=l.object.zoom;l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/A)),t!==l.object.zoom&&(l.object.updateProjectionMatrix(),y=!0)}return A=1,I=!1,!!(y||r.distanceToSquared(l.object.position)>d||8*(1-s.dot(l.object.quaternion))>d||a.distanceToSquared(l.target)>d)&&(l.dispatchEvent(Bb),r.copy(l.object.position),s.copy(l.object.quaternion),a.copy(l.target),!0)}}(),this.dispose=function(){l.domElement.removeEventListener("contextmenu",rt),l.domElement.removeEventListener("pointerdown",J),l.domElement.removeEventListener("pointercancel",Z),l.domElement.removeEventListener("wheel",$),l.domElement.removeEventListener("pointermove",K),l.domElement.removeEventListener("pointerup",Z);l.domElement.getRootNode().removeEventListener("keydown",tt,{capture:!0}),null!==l._domElementKeyEvents&&(l._domElementKeyEvents.removeEventListener("keydown",nt),l._domElementKeyEvents=null)};const l=this,h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let u=h.NONE;const d=1e-6,p=new Bh,f=new Bh;let A=1;const g=new me,m=new zt,b=new zt,v=new zt,y=new zt,x=new zt,_=new zt,E=new zt,w=new zt,C=new zt,S=new me,M=new zt;let I=!1;const T=[],B={};let R=!1;function P(t){const e=Math.abs(.01*t);return Math.pow(.95,l.zoomSpeed*e)}function D(t){f.theta-=t}function L(t){f.phi-=t}const U=function(){const t=new me;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),g.add(t)}}(),F=function(){const t=new me;return function(e,n){!0===l.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(l.object.up,t)),t.multiplyScalar(e),g.add(t)}}(),N=function(){const t=new me;return function(e,n){const i=l.domElement;if(l.object.isPerspectiveCamera){const r=l.object.position;t.copy(r).sub(l.target);let s=t.length();s*=Math.tan(l.object.fov/2*Math.PI/180),U(2*e*s/i.clientHeight,l.object.matrix),F(2*n*s/i.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(U(e*(l.object.right-l.object.left)/l.object.zoom/i.clientWidth,l.object.matrix),F(n*(l.object.top-l.object.bottom)/l.object.zoom/i.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function k(t){l.object.isPerspectiveCamera||l.object.isOrthographicCamera?A/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function O(t){l.object.isPerspectiveCamera||l.object.isOrthographicCamera?A*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function Q(t,e){if(!l.zoomToCursor)return;I=!0;const n=l.domElement.getBoundingClientRect(),i=t-n.left,r=e-n.top,s=n.width,a=n.height;M.x=i/s*2-1,M.y=-r/a*2+1,S.set(M.x,M.y,1).unproject(l.object).sub(l.object.position).normalize()}function G(t){return Math.max(l.minDistance,Math.min(l.maxDistance,t))}function H(t){m.set(t.clientX,t.clientY)}function z(t){y.set(t.clientX,t.clientY)}function j(t){if(1===T.length)m.set(t.pageX,t.pageY);else{const e=at(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);m.set(n,i)}}function V(t){if(1===T.length)y.set(t.pageX,t.pageY);else{const e=at(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);y.set(n,i)}}function W(t){const e=at(t),n=t.pageX-e.x,i=t.pageY-e.y,r=Math.sqrt(n*n+i*i);E.set(0,r)}function q(t){if(1==T.length)b.set(t.pageX,t.pageY);else{const e=at(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);b.set(n,i)}v.subVectors(b,m).multiplyScalar(l.rotateSpeed);const e=l.domElement;D(2*Math.PI*v.x/e.clientHeight),L(2*Math.PI*v.y/e.clientHeight),m.copy(b)}function X(t){if(1===T.length)x.set(t.pageX,t.pageY);else{const e=at(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);x.set(n,i)}_.subVectors(x,y).multiplyScalar(l.panSpeed),N(_.x,_.y),y.copy(x)}function Y(t){const e=at(t),n=t.pageX-e.x,i=t.pageY-e.y,r=Math.sqrt(n*n+i*i);w.set(0,r),C.set(0,Math.pow(w.y/E.y,l.zoomSpeed)),k(C.y),E.copy(w);Q(.5*(t.pageX+e.x),.5*(t.pageY+e.y))}function J(t){!1!==l.enabled&&(0===T.length&&(l.domElement.setPointerCapture(t.pointerId),l.domElement.addEventListener("pointermove",K),l.domElement.addEventListener("pointerup",Z)),function(t){for(let e=0;e<T.length;e++)if(T[e]==t.pointerId)return!0;return!1}(t)||(function(t){T.push(t.pointerId)}(t),"touch"===t.pointerType?it(t):function(t){let r;switch(t.button){case 0:r=l.mouseButtons.LEFT;break;case 1:r=l.mouseButtons.MIDDLE;break;case 2:r=l.mouseButtons.RIGHT;break;default:r=-1}switch(r){case n:if(!1===l.enableZoom)return;!function(t){Q(t.clientX,t.clientX),E.set(t.clientX,t.clientY)}(t),u=h.DOLLY;break;case e:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enablePan)return;z(t),u=h.PAN}else{if(!1===l.enableRotate)return;H(t),u=h.ROTATE}break;case i:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enableRotate)return;H(t),u=h.ROTATE}else{if(!1===l.enablePan)return;z(t),u=h.PAN}break;default:u=h.NONE}u!==h.NONE&&l.dispatchEvent(Rb)}(t)))}function K(t){!1!==l.enabled&&("touch"===t.pointerType?function(t){switch(st(t),u){case h.TOUCH_ROTATE:if(!1===l.enableRotate)return;q(t),l.update();break;case h.TOUCH_PAN:if(!1===l.enablePan)return;X(t),l.update();break;case h.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(t){l.enableZoom&&Y(t),l.enablePan&&X(t)}(t),l.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(t){l.enableZoom&&Y(t),l.enableRotate&&q(t)}(t),l.update();break;default:u=h.NONE}}(t):function(t){switch(u){case h.ROTATE:if(!1===l.enableRotate)return;!function(t){b.set(t.clientX,t.clientY),v.subVectors(b,m).multiplyScalar(l.rotateSpeed);const e=l.domElement;D(2*Math.PI*v.x/e.clientHeight),L(2*Math.PI*v.y/e.clientHeight),m.copy(b),l.update()}(t);break;case h.DOLLY:if(!1===l.enableZoom)return;!function(t){w.set(t.clientX,t.clientY),C.subVectors(w,E),C.y>0?k(P(C.y)):C.y<0&&O(P(C.y)),E.copy(w),l.update()}(t);break;case h.PAN:if(!1===l.enablePan)return;!function(t){x.set(t.clientX,t.clientY),_.subVectors(x,y).multiplyScalar(l.panSpeed),N(_.x,_.y),y.copy(x),l.update()}(t)}}(t))}function Z(t){switch(function(t){delete B[t.pointerId];for(let e=0;e<T.length;e++)if(T[e]==t.pointerId)return void T.splice(e,1)}(t),T.length){case 0:l.domElement.releasePointerCapture(t.pointerId),l.domElement.removeEventListener("pointermove",K),l.domElement.removeEventListener("pointerup",Z),l.dispatchEvent(Pb),u=h.NONE;break;case 1:const e=T[0],n=B[e];it({pointerId:e,pageX:n.x,pageY:n.y})}}function $(t){!1!==l.enabled&&!1!==l.enableZoom&&u===h.NONE&&(t.preventDefault(),l.dispatchEvent(Rb),function(t){Q(t.clientX,t.clientY),t.deltaY<0?O(P(t.deltaY)):t.deltaY>0&&k(P(t.deltaY)),l.update()}(function(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}t.ctrlKey&&!R&&(n.deltaY*=10);return n}(t)),l.dispatchEvent(Pb))}function tt(t){if("Control"===t.key){R=!0;l.domElement.getRootNode().addEventListener("keyup",et,{passive:!0,capture:!0})}}function et(t){if("Control"===t.key){R=!1;l.domElement.getRootNode().removeEventListener("keyup",et,{passive:!0,capture:!0})}}function nt(t){!1!==l.enabled&&!1!==l.enablePan&&function(t){let e=!1;switch(t.code){case l.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?L(2*Math.PI*l.rotateSpeed/l.domElement.clientHeight):N(0,l.keyPanSpeed),e=!0;break;case l.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?L(-2*Math.PI*l.rotateSpeed/l.domElement.clientHeight):N(0,-l.keyPanSpeed),e=!0;break;case l.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?D(2*Math.PI*l.rotateSpeed/l.domElement.clientHeight):N(l.keyPanSpeed,0),e=!0;break;case l.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?D(-2*Math.PI*l.rotateSpeed/l.domElement.clientHeight):N(-l.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),l.update())}(t)}function it(t){switch(st(t),T.length){case 1:switch(l.touches.ONE){case r:if(!1===l.enableRotate)return;j(t),u=h.TOUCH_ROTATE;break;case s:if(!1===l.enablePan)return;V(t),u=h.TOUCH_PAN;break;default:u=h.NONE}break;case 2:switch(l.touches.TWO){case a:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(t){l.enableZoom&&W(t),l.enablePan&&V(t)}(t),u=h.TOUCH_DOLLY_PAN;break;case o:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(t){l.enableZoom&&W(t),l.enableRotate&&j(t)}(t),u=h.TOUCH_DOLLY_ROTATE;break;default:u=h.NONE}break;default:u=h.NONE}u!==h.NONE&&l.dispatchEvent(Rb)}function rt(t){!1!==l.enabled&&t.preventDefault()}function st(t){let e=B[t.pointerId];void 0===e&&(e=new zt,B[t.pointerId]=e),e.set(t.pageX,t.pageY)}function at(t){const e=t.pointerId===T[0]?T[1]:T[0];return B[e]}l.domElement.addEventListener("contextmenu",rt),l.domElement.addEventListener("pointerdown",J),l.domElement.addEventListener("pointercancel",Z),l.domElement.addEventListener("wheel",$,{passive:!1});l.domElement.getRootNode().addEventListener("keydown",tt,{passive:!0,capture:!0}),this.update()}},Nb="OrbitControls";var kb=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=Nb;#j;#V;static shortHandSchema=new Map([["camera",{type:"Camera",constructorArgument:0,stage:8}],["autoRotate",{default:!1,stage:1}],["pivot",{as:"target",type:"Vector3",stage:1}],["scroll-action",{as:"enableZoom",default:"zoom",map:{zoom:!0,none:!1}}],["min-zoom",{as:"maxDistance",default:1/0,stage:1}],["max-zoom",{as:"minDistance",default:0,stage:1}],["min-polar-angle",{as:"minPolarAngle",type:"angle",default:0,stage:1}],["max-polar-angle",{as:"maxPolarAngle",type:"angle",default:180,stage:1}]]);constructor(){super(),this.#j=new Promise((t=>this.#V=t))}tick(t,e,n,i,r){super.tick(t,e,n,i,r),this.object.enabled=this.constructorArguments[0].self===i.properties.camera.self,this.object instanceof Promise||this.object.update(e),this.renderer||this.#V(i.object.domElement)}async allAttributesChangedCallback(){this.constructorArguments[1]||(this.constructorArguments[1]=await this.#j),await super.allAttributesChangedCallback(),this.object.update()}},name:Nb,type:Fb});const Ob=new class extends Ll{constructor(t){super(t),this.type=j}parse(t){const e=function(t,e){switch(t){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(e||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(e||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(e||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(e||""))}},n=function(t,e,n){e=e||1024;let i=t.pos,r=-1,s=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));for(;0>(r=o.indexOf("\n"))&&s<e&&i<t.byteLength;)a+=o,s+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));return-1<r&&(!1!==n&&(t.pos+=s+r+1),a+o.slice(0,r))},i=function(t,e,n,i){const r=t[e+3],s=Math.pow(2,r-128)/255;n[i+0]=t[e+0]*s,n[i+1]=t[e+1]*s,n[i+2]=t[e+2]*s,n[i+3]=1},r=function(t,e,n,i){const r=t[e+3],s=Math.pow(2,r-128)/255;n[i+0]=jn.toHalfFloat(Math.min(t[e+0]*s,65504)),n[i+1]=jn.toHalfFloat(Math.min(t[e+1]*s,65504)),n[i+2]=jn.toHalfFloat(Math.min(t[e+2]*s,65504)),n[i+3]=jn.toHalfFloat(1)},s=new Uint8Array(t);s.pos=0;const a=function(t){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let c,l;for((t.pos>=t.byteLength||!(c=n(t)))&&e(1,"no header found"),(l=c.match(/^#\?(\S+)/))||e(3,"bad initial token"),o.valid|=1,o.programtype=l[1],o.string+=c+"\n";c=n(t),!1!==c;)if(o.string+=c+"\n","#"!==c.charAt(0)){if((l=c.match(i))&&(o.gamma=parseFloat(l[1])),(l=c.match(r))&&(o.exposure=parseFloat(l[1])),(l=c.match(s))&&(o.valid|=2,o.format=l[1]),(l=c.match(a))&&(o.valid|=4,o.height=parseInt(l[1],10),o.width=parseInt(l[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=c+"\n";return 2&o.valid||e(3,"missing format specifier"),4&o.valid||e(3,"missing image size specifier"),o}(s),o=a.width,c=a.height,l=function(t,n,i){const r=n;if(r<8||r>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);r!==(t[2]<<8|t[3])&&e(3,"wrong scanline width");const s=new Uint8Array(4*n*i);s.length||e(4,"unable to allocate buffer space");let a=0,o=0;const c=4*r,l=new Uint8Array(4),h=new Uint8Array(c);let u=i;for(;u>0&&o<t.byteLength;){o+4>t.byteLength&&e(1),l[0]=t[o++],l[1]=t[o++],l[2]=t[o++],l[3]=t[o++],2==l[0]&&2==l[1]&&(l[2]<<8|l[3])==r||e(3,"bad rgbe scanline format");let n,i=0;for(;i<c&&o<t.byteLength;){n=t[o++];const r=n>128;if(r&&(n-=128),(0===n||i+n>c)&&e(3,"bad scanline data"),r){const e=t[o++];for(let t=0;t<n;t++)h[i++]=e}else h.set(t.subarray(o,o+n),i),i+=n,o+=n}const d=r;for(let t=0;t<d;t++){let e=0;s[a]=h[t+e],e+=r,s[a+1]=h[t+e],e+=r,s[a+2]=h[t+e],e+=r,s[a+3]=h[t+e],a+=4}u--}return s}(s.subarray(s.pos),o,c);let h,u,d;switch(this.type){case z:d=l.length/4;const t=new Float32Array(4*d);for(let e=0;e<d;e++)i(l,4*e,t,4*e);h=t,u=z;break;case j:d=l.length/4;const e=new Uint16Array(4*d);for(let t=0;t<d;t++)r(l,4*t,e,4*t);h=e,u=j;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:o,height:c,data:h,header:a.string,gamma:a.gamma,exposure:a.exposure,type:u}}setDataType(t){return this.type=t,this}load(t,e,n,i){return super.load(t,(function(t,n){switch(t.type){case z:case j:t.colorSpace=vt,t.minFilter=N,t.magFilter=N,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,n)}),n,i)}},Qb=he,Gb="ImageTexture",Hb={class:HTMLImageElement,tagName:"img"};var zb=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=Gb;static canProxy=!1;static shortHandSchema=iu({src:{stage:4,type:"string",example:"some/image.hdr"}});constructor(){super(),this.style.display="none"}async allAttributesChangedCallback(){let t;if(Yh(this.src).toLowerCase().endsWith(".hdr")){const{texture:e,textureData:n}=await new Promise((t=>Ob.load(this.src,(function(e,n){t({texture:e,textureData:n})}))));t=e}else this.complete||await new Promise((t=>this.addEventListener("load",t,{once:!0}))),t=new he(this);t.needsUpdate=!0,await this.assignPostConstructAttributes(t),this.updateObject(t)}},name:Gb,native:Hb,type:Qb});const jb=Vo,Vb="VideoTexture",Wb={class:HTMLVideoElement,tagName:"video"};var qb=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=Vb;static canProxy=!1;#W;constructor(){super(),this.style.display="none",this.#W=new Promise((t=>this.addEventListener("loadedmetadata",t,{once:!0})))}async allAttributesChangedCallback(){await this.#W;const t=new Vo(this);t.needsUpdate=!0,await this.assignPostConstructAttributes(t),this.updateObject(t)}},name:Vb,native:Wb,type:jb});const Xb=new me,Yb=new me,Jb=new qe,Kb=new qe,Zb=new ge,$b=new Nn("white"),tv=new Nn("white"),ev=new Nn("white"),nv=[],iv=new Map;async function rv(t,e,n){let i,r,s,a=!1;return r=iv.get(t),r?(i=r.get(e),i||(a=!0)):(r=new Map,iv.set(t,r),a=!0),a?(i={instancedMesh:new co(t,e,1),slots:[!0]},Xb.set(0,0,0),Jb.compose(Xb,Zb,Xb),i.instancedMesh.setMatrixAt(0,Jb),i.instancedMesh.setColorAt(0,$b),s=0,r.set(e,i)):(s=i.slots.indexOf(!1),-1===s&&(s=i.slots.length,i.slots[s]=!0,await new Promise((r=>queueMicrotask((()=>{if(i.slots.length>i.instancedMesh.count){n.remove(i.instancedMesh);const r=i.instancedMesh,s=r.count;i.instancedMesh=new co(t,e,i.slots.length),console.log(i.instancedMesh.count),i.instancedMesh.setColorAt(0,$b),i.instancedMesh.instanceMatrix.array.set(r.instanceMatrix.array),i.instancedMesh.instanceColor.array.set(r.instanceColor.array),i.instancedMesh.receiveShadow=r.receiveShadow,i.instancedMesh.castShadow=r.castShadow,Xb.multiplyScalar(0),Jb.compose(Xb,Zb,Xb);for(let t=s;t<i.slots.length;t++)i.instancedMesh.setMatrixAt(t,Jb);i.instancedMesh.instanceMatrix.needsUpdate=!0,r.dispose()}r()})))))),n.add(i.instancedMesh),[i,s]}let sv=yu;class av{#q;#X;r=0;g=0;b=0;constructor(t,e){this.#q=t,this.#X=e}copy(t){this.r=t.r,this.g=t.g,this.b=t.b,this.#q.instancedMesh.setColorAt(this.#X,t),this.#q.instancedMesh.instanceColor.needsUpdate=!0}lerpColors(t,e,n){this.#q.instancedMesh.getColorAt(this.#X,$b),$b.lerpColors(tv.copy(t),ev.copy(e),n),this.copy($b)}}class ov extends xn{instancedMeshDescription;isInstancedMeshProxy=!0;#X;#Y;#J=new qe;constructor(t,e,n){super(),this.instancedMeshDescription=t;const i=new av(t,e);this.material=t.instancedMesh.material,this.geometry=t.instancedMesh.geometry,this.#Y=new _i(this.geometry,this.material),this.#X=e,this.scene=n,Object.defineProperties(this,{color:{configurable:!1,enumerable:!0,value:i}})}add(){throw Error("This isn't a real mesh it cannot have child elements.")}removeFromParent(){}dispose(){!function(t,e,n,i){let r,s;s=iv.get(e),s&&(r=s.get(n),r&&(r.slots[i]=!1,r.slots.includes(!0)?(r.instancedMesh.getMatrixAt(i,Jb),Jb.decompose(Xb,Zb,Yb),Yb.set(0,0,0),Jb.compose(Xb,Zb,Yb),r.instancedMesh.setMatrixAt(i,Jb),r.instancedMesh.instanceMatrix.needsUpdate=!0):(s.delete(n),t.remove(r.instancedMesh),r.instancedMesh.dispose())))}(this.scene,this.geometry,this.material,this.#X)}set receiveShadow(t){this.instancedMeshDescription&&(this.instancedMeshDescription.instancedMesh.receiveShadow=t)}set castShadow(t){this.instancedMeshDescription&&(this.instancedMeshDescription.instancedMesh.castShadow=t)}raycast(t,e){const n=this.instancedMeshDescription.instancedMesh;this.instancedMeshDescription.instancedMeshInHeirarchy?this.#Y.matrixWorld.copy(this.matrixWorld):n.getMatrixAt(this.#X,this.#Y.matrixWorld),this.#Y.raycast(t,nv);for(let t=0,n=nv.length;t<n;t++){const n=nv[t];n.object=this,e.push(n)}nv.length=0}syncVectorChanges(){const t=this.instancedMeshDescription.instancedMesh;for(let e=0;e<16;e++)if(this.#J.elements[e]!==this.matrixWorld.elements[e]){let e=Jb;this.instancedMeshDescription.instancedMeshInHeirarchy?this.parent.uuid===t.uuid?e=this.matrix:Jb.copy(this.matrixWorld).premultiply(Kb.copy(t.matrixWorld).invert()):e=this.matrixWorld,t.setMatrixAt(this.#X,e),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere(),this.#J.copy(this.matrixWorld);break}}}const cv=_i,lv="InstancedMesh";var hv=Object.freeze({__proto__:null,InstancedMeshProxy:ov,getNewInstancedMesh:rv,mixin:t=>class extends t{static name=lv;static shortHandSchema=new Map([["color",{type:"Color",default:"white",stage:1}],["mesh",{type:"Mesh",stage:12}],["geometry",{type:"BufferGeometry",stage:12,map:$d.get(_i).get("geometry").map}],["material",{type:"Material",stage:12,map:Wd}],["scene",{type:"Scene",stage:12}]]);static documentation=sv;tick(t,e,n,i,r){super.tick(t,e,n,i,r),this.ready&&this.object.syncVectorChanges()}async allAttributesChangedCallback(){let t,e;if(this.properties.mesh?(t=this.properties.mesh.geometry,e=this.properties.mesh.material):(t=this.properties.geometry,e=this.properties.material),!t)return console.warn("Geometry is not defined"),void console.log(this);const n=this.properties.scene||await this.closest("sh-scene").object,[i,r]=await rv(t,e,n),s=new ov(i,r,n);await this.assignPostConstructAttributes(s),this.updateObject(s),this.object.syncVectorChanges()}},name:lv,type:cv});const uv=Yo,dv="CanvasTexture",pv={class:HTMLCanvasElement,tagName:"canvas"};var fv=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=dv;constructor(){let t;super();const e=this,n=this.getContext;this.getContext=function(i,r){if("2d"!==i)throw Error("Non 2D canvas not supported yet");return t=n.call(this,"2d",r),new Proxy(t,{get(n,i){const r=t[i];return r.bind?(e.ready&&(e.object.needsUpdate=!0),r.bind(t)):r},set:(e,n,i)=>t[n]=i})}}async allAttributesChangedCallback(){const t=new Yo(this);t.needsUpdate=this.true,await this.assignPostConstructAttributes(t),this.updateObject(t)}},name:dv,native:pv,type:uv});const Av={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function gv(t){const e=await fetch(t);if(e.ok)return e.json();throw new Error(e.statusText)}async function mv(t,e,n=null,i=!0){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await async function(t){if(!t)throw new Error("No basePath supplied");return await gv(`${t}/profilesList.json`)}(e);let s;if(t.profiles.some((t=>{const n=r[t];return n&&(s={profileId:t,profilePath:`${e}/${n.path}`,deprecated:!!n.deprecated}),!!s})),!s){if(!n)throw new Error("No matching profile name found");const t=r[n];if(!t)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${e}/${t.path}`,deprecated:!!t.deprecated}}const a=await gv(s.profilePath);let o;if(i){let e;if(e="any"===t.handedness?a.layouts[Object.keys(a.layouts)[0]]:a.layouts[t.handedness],!e)throw new Error(`No matching handedness, ${t.handedness}, in profile ${s.profileId}`);e.assetPath&&(o=s.profilePath.replace("profile.json",e.assetPath))}return{profile:a,assetPath:o}}const bv={xAxis:0,yAxis:0,button:0,state:Av.ComponentState.DEFAULT};class vv{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===Av.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(bv)}updateFromComponent({xAxis:t,yAxis:e,button:n,state:i}){const{normalizedXAxis:r,normalizedYAxis:s}=function(t=0,e=0){let n=t,i=e;if(Math.sqrt(t*t+e*e)>1){const r=Math.atan2(e,t);n=Math.cos(r),i=Math.sin(r)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5}}(t,e);switch(this.componentProperty){case Av.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?r:.5;break;case Av.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case Av.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case Av.ComponentProperty.STATE:this.valueNodeProperty===Av.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class yv{constructor(t,e){if(!(t&&e&&e.visualResponses&&e.gamepadIndices&&0!==Object.keys(e.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach((t=>{const n=new vv(e.visualResponses[t]);this.visualResponses[t]=n})),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Av.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=Av.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||1===this.values.button?this.values.state=Av.ComponentState.PRESSED:(e.touched||this.values.button>Av.ButtonTouchThreshold)&&(this.values.state=Av.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Av.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Av.AxisTouchThreshold&&(this.values.state=Av.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Av.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Av.AxisTouchThreshold&&(this.values.state=Av.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((t=>{t.updateFromComponent(this.values)}))}}class xv{constructor(t,e,n){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((t=>{const e=this.layoutDescription.components[t];this.components[t]=new yv(t,e)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach((e=>{t.push(e.data)})),t}updateFromGamepad(){Object.values(this.components).forEach((t=>{t.updateFromGamepad(this.xrInputSource.gamepad)}))}}class _v extends xn{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t||(this.envMap=t,this.traverse((t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}))),this}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((t=>{Object.values(t.visualResponses).forEach((t=>{const{valueNode:e,minNode:n,maxNode:i,value:r,valueNodeProperty:s}=t;e&&(s===Av.VisualResponseProperty.VISIBILITY?e.visible=r:s===Av.VisualResponseProperty.TRANSFORM&&(e.quaternion.slerpQuaternions(n.quaternion,i.quaternion,r),e.position.lerpVectors(n.position,i.position,r)))}))})))}}function Ev(t,e){!function(t,e){Object.values(t.components).forEach((t=>{const{type:n,touchPointNodeName:i,visualResponses:r}=t;if(n===Av.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const e=new Zc(.001),n=new Gn({color:255}),i=new _i(e,n);t.touchPointNode.add(i)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach((t=>{const{valueNodeName:n,minNodeName:i,maxNodeName:r,valueNodeProperty:s}=t;if(s===Av.VisualResponseProperty.TRANSFORM){if(t.minNode=e.getObjectByName(i),t.maxNode=e.getObjectByName(r),!t.minNode)return void console.warn(`Could not find ${i} in the model`);if(!t.maxNode)return void console.warn(`Could not find ${r} in the model`)}t.valueNode=e.getObjectByName(n),t.valueNode||console.warn(`Could not find ${n} in the model`)}))}))}(t.motionController,e),t.envMap&&e.traverse((e=>{e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)})),t.add(e)}const wv=["select","selectstart","selectend","squeeze","squeezeend","squeezestart"],Cv=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],Sv="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets/dist/profiles",Mv=Sv+"/generic-hand",Iv=String.raw,Tv=["grip","ray","tool"],Bv=["basic","gamepad","hand"],Rv=document.createElement("template");Rv.innerHTML=Iv`
  <style>
  :host {
    position: absolute;
    visibility: hidden;
  }

  /* by default things in the slots are invisible until they have a controller that uses them */
  ::slotted([slot]) {
    --visibility: hidden;
  }
  ::slotted([slot="feet"]) {
    --visibility: visible;
  }
  </style>
  <sh-camera-perspective part="camera" location="0 1.6 0">
    <slot name="head-locked"></slot>
  </sh-camera-perspective>
  <sh-group id="user"><slot></slot></sh-group>
  <sh-group id="feet"><slot name="feet"></slot></sh-group>
`+[...Cv].map((t=>`<slot name="right-${t}" class="hand right"></slot><slot name="left-${t}" class="hand left"></slot>`)).join("\n")+Tv.flatMap((t=>Bv.map((e=>e+"-"+t)))).map((t=>`<slot name="right-${t}"></slot><slot name="left-${t}"></slot><slot name="none-${t}"></slot>`)).join("\n")+Tv.flatMap((t=>[0,1,2,3].map((e=>t+"-"+e)))).map((t=>`<slot name="transient-pointer-${t}"></slot>`)).join("\n")+[0,1,2,3,4,5,6,7,8,9].map((t=>"screen-"+t)).map((t=>`<slot name="${t}"></slot>`)).join("\n");const Pv=Array.from(Rv.content.querySelectorAll("slot[name]")).map((t=>t.name));let Dv=yu;const Lv=new ge,Uv=new me,Fv=new me,Nv=new class{constructor(t,e){this.gltfLoader=t,this.path=e||"https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets/dist/profiles",this._assetCache={}}createControllerModel(t){const e=new _v;let n=null;return t.addEventListener("connected",(t=>{const i=t.data;"tracked-pointer"===i.targetRayMode&&i.gamepad&&mv(i,this.path,"generic-trigger").then((({profile:t,assetPath:r})=>{e.motionController=new xv(i,t,r);const s=[],a=[],o={buttons:s,axes:a};if(e.gamepadMappings=o,e.motionController.layoutDescription?.components)for(let[t,n]of Object.entries(e.motionController.layoutDescription.components)){t=t.replace("xr-standard-","");for(const[e,i]of Object.entries(n.gamepadIndices))"button"===e?s[i]=t:a[i]={name:t,type:e}}const c=this._assetCache[e.motionController.assetUrl];if(c)n=c.scene.clone(),Ev(e,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,(t=>{this._assetCache[e.motionController.assetUrl]=t,n=t.scene.clone(),Ev(e,n)}),null,(()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)}))}})).catch((t=>{console.warn(t)}))})),t.addEventListener("disconnected",(()=>{e.motionController=null,e.remove(n),n=null})),e}}(RA,Sv),kv=new Map,Ov=new Set,Qv=new me,Gv=new me(0,-1,0),Hv={position:new me,floorY:0},zv=[[0,1],[0,.75],[0,.5],[0,.25],[0,.1],[30,.4],[-30,.4],[60,.2],[-60,.2],[80,.06],[-80,.06],[0,0]];$d.get(xn).get("mixins").push((t=>class extends t{static name="UserEventDescriptions";static shortHandEventDescriptions={selectstart:"Fired when this object is a child of <sh-user> and the user starts an XR Select Event in WebXR",selectend:"Fired when this object is a child of <sh-user> and the user ends an XR Select Event in WebXR",select:"Fired when this object is a child of <sh-user> and the user completes an XR Select Event in WebXR",squeezestart:"Fired when this object is a child of <sh-user> and the user starts an XR squeeze Event in WebXR",squeezeend:"Fired when this object is a child of <sh-user> and the user ends an XR squeeze Event in WebXR",squeeze:"Fired when this object is a child of <sh-user> and the user completes an XR squeeze Event in WebXR",triggerup:"Event that gets fired when the WebXR input gamepad trigger is released.",triggerdown:"Event that gets fired when the WebXR input gamepad trigger is pressed.",squeezeup:"Event that gets fired when the WebXR input gamepad squeeze is released.",squeezedown:"Event that gets fired when the WebXR input gamepad squeeze is pressed."}}));const jv=wa,Vv="shUser",Wv=t=>class extends t{static name="xrControllerMixin";static shortHandSchema=new Map([["left",{type:"url",stage:4}],["right",{type:"url",stage:4}]]);static shortHandEventDescriptions={gamepad:"Event that gets fired when the WebXR input gamepad changes."};#K=new su;#Z=new su;#$=new su;#tt={};#et=new Map;#nt=new Map;#it;#rt;#a;constructor(){super(),this.shadowRoot.addEventListener("slotchange",(t=>{this.#st(t.target)}));for(const t of this.shadowRoot.querySelectorAll("slot"))this.#tt[t.name]=t,this.#st(t)}async#st(t){const e=this.#Z.get(t),n=t.assignedElements({flatten:!0});if(e)for(const i of n){this.#K.set(i,e);const n=t.name;if(t.className.includes("hand")){const t=n.split("-").slice(1).join("-"),r=e.hand.get(t);r.__isJoint=!0,this.#$.set(i,r)}else if(t.className.includes("screen"))this.#$.set(i,e.targetRaySpace);else{const t=n.split("-").pop();this.#$.set(i,"ray"===t?e.targetRaySpace:e.gripSpace)}i.dataset.active="active"}}getInputSource(t){return this.#K.get(t)}async#at(t,e){await this.ready;const n=await new Promise(((e,n)=>RA.load(t,e,void 0,n))),i=n.scene.children[0],r=i.getObjectByProperty("type","SkinnedMesh");this.material&&("both"!==this.data.materialOverride&&this.data.materialOverride!==e||(r.material=this.material)),r.visible=!1,r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.skeleton.pose();const s=[];for(const e of Cv){const n=i.getObjectByName(e);void 0!==n?(n.jointName=e,s.push(n),n.applyMatrix4(this.object.matrixWorld),n.updateMatrixWorld()):(console.warn("Couldn't find "+e+" in "+t+" hand mesh"),s.push(void 0))}return this.#nt.set("hand-mesh-"+e,r),this.object.add(r),s}#ot(t,e,n=!0){const i="gamepad-"+e.handedness+"-"+e.profiles.join(";"),r=this.#et.get(i);if(r)return r;if(n){const n=this.object,r=this.#a.object.xr.getControllerGrip(t),s=Nv.createControllerModel(r);return r.dispatchEvent({type:"connected",data:e}),this.#et.set(i,s),n.add(s),s}}setupEvents(){super.setupEvents();for(const t of[...wv,"inputsourceschange"])this.#a.properties.session.addEventListener(t,this)}handleEvent(t){if(super.handleEvent(t),"inputsourceschange"===t.type&&this.#ct(t.detail),wv.includes(t.type)){const e=t.type,n=this.#a.object.xr.getReferenceSpace(),i=t.detail,r=i.frame,s=i.inputSource,a=s.handedness;this.#lt([s],r);const o=r.getPose(s.targetRaySpace,n),c={inputSource:s,handedness:a,frame:r,targetRayPose:o};if(!o)return;for(const t of this.#K.getKeysFromValue(s))t.emit(e,c,!1);this.emit(e,c,!1)}}#ct(t){const{added:e,removed:n}=t;for(const t of n){if(t.gamepad){const e=this.#ot(null,t,!1);e&&(e.visible=!1)}for(const e of this.#K.getKeysFromValue(t))this.#K.delete(e),delete e.dataset.active;for(const e of this.#Z.getKeysFromValue(t))this.#Z.delete(e)}const i=Array.from(t.session.inputSources),r=i.filter((t=>"screen"===t.targetRayMode)),s=i.filter((t=>"transient-pointer"===t.targetRayMode));for(const t of e){this.#ot(i.indexOf(t),t,!0).visible=!0;const e=[];if("transient-pointer"===t.targetRayMode){const n=s.indexOf(t);e.push(this.shadowRoot.querySelector(`slot[name="transient-pointer-ray-${n}"]`)),e.push(this.shadowRoot.querySelector(`slot[name="transient-pointer-grip-${n}"]`))}if("screen"===t.targetRayMode){const n=r.indexOf(t);e.push(this.shadowRoot.querySelector(`slot[name="screen-${n}"]`))}if("tracked-pointer"===t.targetRayMode){let n="simple";if(t.hand?n="hand":t.gamepad&&(n="gamepad"),"tracked-pointer"===t.targetRayMode){for(const i of Tv)e.push(this.shadowRoot.querySelector(`slot[name="${t.handedness}-${n}-${i}"]`));t.hand&&e.push(...this.shadowRoot.querySelectorAll("slot.hand."+t.handedness))}}for(const n of e)this.#Z.set(n,t),this.#st(n)}}#ht(t,e,n){e.event=t,this.emit(t,e,!1),this.emit("gamepad",e,!1);for(const i of this.#K.getKeysFromValue(n))i.emit(t,e,!1)}#lt(t,e){const n=this.#a.object.xr.getReferenceSpace();if(e&&n)for(const i of t){const t=this.#nt.get("hand-mesh-"+i.handedness),r=this.#K.getKeysFromValue(i);if(i.hand){if(!this.#it){const t=this.properties.left||Mv+"/left.glb",e=this.properties.right||Mv+"/right.glb";this.#it=this.#at(e,"right").then((t=>this.#it=t)),this.#rt=this.#at(t,"left").then((t=>this.#rt=t));continue}if("right"===i.handedness&&this.#it instanceof Promise)continue;if("left"===i.handedness&&this.#rt instanceof Promise)continue;let s;if("right"===i.handedness&&(s=this.#it),"left"===i.handedness&&(s=this.#rt),!s.length)continue;let a=!1;for(const o of s){const s=i.hand.get(o.jointName);if(s){const i=e.getJointPose(s,n);if(i){if(a=!0,!1===t.visible)for(const t of r)!t.object||t.object instanceof Promise||(t.object.visible="hidden"!==t.getAttribute("visibility"));o.position.copy(i.transform.position),o.quaternion.copy(i.transform.orientation),o.updateMatrixWorld()}}}if(a){t.visible=!0;for(const t of r)if(t.object instanceof xn){db(t);const i=this.#$.get(t);if(i.__isJoint){const r=e.getJointPose(i,n);Lv.copy(r.transform.orientation),t.object.applyQuaternion(Lv),t.object.position.applyQuaternion(Lv).add(r.transform.position)}}}}else if(t&&!0===t.visible){t.visible=!1;for(const t of r)!t.object||t.object instanceof Promise||(t.object.visible=!1)}const s=r;for(const t of s)if(!(t.object instanceof Promise)){const i=this.#$.get(t),r=!i.__isJoint&&e.getPose(i,n);if(r){t.object.position.copy(r.transform.position),t.object.quaternion.copy(r.transform.orientation);const e="hidden"!==t.getAttribute("visibility");t.object.visible=e}}if(i.gamepad&&"tracked-pointer"===i.targetRayMode){const t=this.#ot(null,i,!1);if(!t)break;if(i.gripSpace){const r=e.getPose(i.gripSpace,n);r&&(t.position.copy(r.transform.position),t.quaternion.copy(r.transform.orientation))}if(i.gamepad){const n=kv.get(i),r={buttons:i.gamepad.buttons.map((t=>t.value)),axes:i.gamepad.axes.slice(0)};if(n){const s={handedness:i.handedness,inputSource:i,data:r,frame:e};r.buttons.forEach(((e,r)=>{if(isFinite(n.buttons[r])&&Math.ceil(e)!==Math.ceil(n.buttons[r])){let n=t.gamepadMappings?.buttons[r]||"button"+r;1!==e?this.#ht(n+"down",Object.assign({value:e},s),i):this.#ht(n+"up",Object.assign({value:e},s),i)}}));const a=t.gamepadMappings?.axes;if(a&&a.length){Ov.clear();const t={};if(a.forEach((({name:t},e)=>{if(t){r.axes[e]!==n.axes[e]&&Ov.add(t)}})),Ov.size){a.forEach((({name:e,type:n},i)=>{if(e&&Ov.has(e)){const s=r.axes[i];t[e]=t[e]||{name:e},t[e][n.slice(0,1)]=s}}));for(const[e,n]of Object.entries(t))this.#ht(e+"moved",Object.assign(n,s),i)}}else r.axes.forEach(((e,r)=>{let a=t.gamepadMappings?.axes[r]||"axes"+r;e!==n.axes[r]&&this.#ht(a+"moved",Object.assign({value:e},s),i)}))}kv.set(i,r)}}}}tick(t,e,n,i,r){this.#a||(this.#a=i),r.session&&"visible-blurred"!==r.session.visibilityState&&this.#lt(r.session.inputSources,n),super.tick(t,e,n,i,r)}};var qv=Object.freeze({__proto__:null,mixin:t=>class extends t{static tickPriority=-100;static name=Vv;static template=Rv;static shortHandSchema=new Map([["mixins",[Wv]],["speed",{default:2,stage:4}],["keyboard-navigation",{as:"wasdNav",default:!0,stage:4}]]);static shortHandEventDescriptions={beforegravity:"Fired each frame to with an object containing the current user's feet 'position' and a 'floorY' property, you can set floorY on this object to let the user have a gravity effect to the current floor level."};static documentation=Dv;#ut;#dt=!1;#a;#pt=new rn;#ft=-1;#At=0;#gt=[0,0,0,0];#mt;#bt;height=1.6;constructor(){super(),this.#mt=this.shadowRoot.querySelector("sh-camera-perspective"),this.#ut=this.shadowRoot.querySelector("#feet"),this.#bt=this.shadowRoot.querySelector("#user")}teleport(t){this.#bt.object.position.copy(t),this.#ut.object.position.copy(t),this.#mt.object.position.copy(t).y+=this.height,this.#dt=!0}teleportBy(t){this.#bt.object.position.add(Uv.copy(t));const e=Uv.copy(t).applyQuaternion(Lv.copy(this.#ut.object.quaternion).invert());this.#ut.object.position.add(e),this.#mt.object.position.copy(this.#ut.object.position).y+=this.height,this.#dt=!0}getFeetPosition(t){return t.copy(this.#ut.object.position)}rotate(t){Uv.set(0,0,1),Fv.set(Math.sin(t),0,Math.cos(t)),Lv.setFromUnitVectors(Uv,Fv),this.#ut.object.quaternion.multiply(Lv),this.#mt.object.quaternion.multiply(Lv),this.#dt=!0}tick(t,e,n,i,r){this.#ut.object instanceof Promise||(r&&r.baseReferenceSpace&&this.#dt&&this.#vt(i,r),this.#yt(e,n),super.tick(t,e,n,i,r),this.#a||(this.#a=i,this.setupEvents()))}#vt(t,e){const n=e.baseReferenceSpace,i={x:-this.#ut.object.position.x,y:-this.#ut.object.position.y,z:-this.#ut.object.position.z,w:1},r=Lv.copy(this.#ut.object.quaternion).invert(),s=new XRRigidTransform(i,r),a=n.getOffsetReferenceSpace(s);t.object.xr.setReferenceSpace(a),this.#dt=!1}setupEvents(){this.#a.setAttribute("tabindex","0"),this.#a.addEventListener("renderer-mousedown",this),this.#a.addEventListener("renderer-mouseup",this),this.#a.addEventListener("renderer-mousemove",this),this.#a.addEventListener("renderer-mousecancel",this),this.#a.addEventListener("blur",this),this.addEventListener("thumbstickmoved",this),window.addEventListener("keydown",this),window.addEventListener("keyup",this)}removeEvents(){this.#a.removeEventListener("renderer-mousedown",this),this.#a.removeEventListener("renderer-mouseup",this),this.#a.removeEventListener("renderer-mousemove",this),this.#a.removeEventListener("renderer-mousecancel",this),this.#a.removeEventListener("blur",this),this.removeEventListener("thumbstickmoved",this),window.removeEventListener("keydown",this),window.removeEventListener("keyup",this)}#yt(t,e){const n=this.#ut.object.position;Qv.copy(n),Uv.set(-this.#gt[0]||this.#gt[2],0,-this.#gt[1]||this.#gt[3]);const i=Uv.length();if(i>0){if(Uv.multiplyScalar(this.properties.speed*t/i),e){const t=e.getViewerPose(this.#a.object.xr.getReferenceSpace());Lv.copy(t.transform.orientation).invert()}else{const t=this.#mt.object;Lv.copy(t.quaternion)}Uv.applyQuaternion(Lv).y=0,n.add(Uv)}for(const[t,e]of zv){const i=Hv.position;if(i.subVectors(n,Qv),i.applyAxisAngle(Gv,t*Math.PI/180),i.multiplyScalar(e),i.add(Qv),Hv.floorY=0,Hv.impassable=!1,this.emit("beforegravity",Hv),!Hv.impassable)break}n.copy(Hv.position),Hv.floorY>n.y?(this.#At=Math.max(0,this.#At),this.#At-=-4.9*t,n.y+this.#At>Hv.floorY&&(this.#At=0,n.y=Hv.floorY)):Hv.floorY<n.y?(this.#At=Math.min(0,this.#At),this.#At+=-4.9*t,n.y+this.#At<Hv.floorY&&(this.#At=0,n.y=Hv.floorY)):this.#At=0,n.y+=this.#At,this.teleport(n)}async handleEvent(t){const e=t.detail;if("renderer-mousedown"===t.type&&-1===this.#ft&&0===t.detail.button){const t=this.#mt.object instanceof Promise?await this.#mt.object:this.#mt.object;this.#pt.order=t.rotation.order="YXZ",this.#pt.copy(t.rotation),this.#ft=e.identifier}if("renderer-mousemove"===t.type&&this.#ft===e.identifier){const t=this.#mt.object instanceof Promise?await this.#mt.object:this.#mt.object,n=this.#a.width/this.#a.height*Math.PI*.2*(e.x-e.clickStartX),i=-.2*Math.PI*(e.y-e.clickStartY);t.rotation.copy(this.#pt),t.rotation.x=du(t.rotation.x-i,-Math.PI/2,Math.PI/2),t.rotation.y=(t.rotation.y-n+2*Math.PI)%(2*Math.PI)}if("renderer-mouseup"===t.type&&this.#ft===e.identifier&&(this.#ft=-1),"renderer-mousecancel"===t.type&&this.#ft===e.identifier&&(this.#ft=-1),"keycancel"===t.type&&(this.#gt[0]=0,this.#gt[1]=0,this.#gt[2]=0,this.#gt[3]=0),"keydown"===t.type){if(!this.properties.wasdNav)return;if(!this.#a.matches(":focus"))return;37!==t.keyCode&&65!==t.keyCode||(this.#gt[0]=1,t.stopPropagation(),t.preventDefault()),38!==t.keyCode&&87!==t.keyCode||(this.#gt[1]=1,t.stopPropagation(),t.preventDefault()),39!==t.keyCode&&68!==t.keyCode||(this.#gt[2]=1,t.stopPropagation(),t.preventDefault()),40!==t.keyCode&&83!==t.keyCode||(this.#gt[3]=1,t.stopPropagation(),t.preventDefault())}if("keyup"===t.type){if(!this.#a.matches(":focus"))return;37!==t.keyCode&&65!==t.keyCode||(this.#gt[0]=0,t.stopPropagation(),t.preventDefault()),38!==t.keyCode&&87!==t.keyCode||(this.#gt[1]=0,t.stopPropagation(),t.preventDefault()),39!==t.keyCode&&68!==t.keyCode||(this.#gt[2]=0,t.stopPropagation(),t.preventDefault()),40!==t.keyCode&&83!==t.keyCode||(this.#gt[3]=0,t.stopPropagation(),t.preventDefault())}}},name:Vv,slotNames:Pv,type:jv});const Xv=[],Yv=new MutationObserver((t=>{for(const e of t){const t=e.target;t.isShortHandElement&&Zv.set(t,!0);for(const e of Xv){const n=e.deref();n&&n.isShortHandElement&&t.contains(n)&&Zv.set(n,!0)}}})),Jv=["class","slot","part","style"];Yv.observe(document.firstElementChild,{attributes:!0,subtree:!0,attributeFilter:Jv});const Kv=new WeakMap;document.addEventListener("animationstart",(t=>{if(!t.shIsHandled)if(Kv.has(t.target)){const e=Kv.get(t.target);e[t.animationName]=(e[t.animationName]||0)+1,Kv.set(t.target,e)}else Kv.set(t.target,{[t.animationName]:1})})),window.CSS.registerProperty({name:"--will-change",syntax:"<custom-ident>+|none",inherits:!1,initialValue:"none"});const Zv=new WeakMap;function $v(t){Zv.set(t,!0),t.ready||t.tick.call(t)}const ty=new ge,ey=new me,ny=new me,iy=new Mh(new me,new me(0,-1,0),0,30),ry=new qe;iy.firstHitOnly=!0;const sy=new su;$d.get(xn).get("mixins").push((t=>class extends t{static name="MarkAsGrabbable";static shortHandSchema=iu({"grab-target":{as:"grabTarget",default:-1,type:"number",map:{self:0,parent:1,grandparent:2,greatgrandparent:3},stage:4},"grab-range":{as:"grabRange",type:"number"}});static shortHandEventDescriptions={yank:"Fired when an object is rapidly pulled towards the hand.",grabstart:'Fired when this object has "grab-target" set and is picked up by the user.',grabend:'Fired when this object has "grab-target" set and is let go by the user.'};async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i),"number"==typeof this.properties.grabTarget&&this.properties.grabTarget>-1&&sy.set(this,this.properties.grabTarget)}async connectedCallback(){await super.connectedCallback(),"number"==typeof this.properties.grabTarget&&this.properties.grabTarget>-1&&sy.set(this,this.properties.grabTarget)}async disconnectedCallback(){await super.disconnectedCallback(),sy.delete(this)}#xt=!1;#_t=new me;tick(t,e,n,i,r){if(ly.has(this)){const t=ly.get(this).object;if(this.#xt){db(this);const n=this.object.position.length(),i=Math.max(0,1*(1.1+Math.min(n,5))**2-1);ty.copy(this.object.parent.quaternion).invert(),t.getWorldPosition(ey);const r=ny.subVectors(ey,this.#_t).applyQuaternion(ty).dot(this.object.position),s=ny.length();this.#_t.copy(ey),this.object.position.multiplyScalar((1+i*r/(1+n))**.5),this.postConstruct.has("position")&&this.postConstruct.get("position").copy(this.object.position),r<-1.2*e&&r/s<-.6&&this.emit("yank",{el:this,holdingObject:t},!0)}else this.#xt=!0,t.getWorldPosition(this.#_t)}else this.#xt&&(this.#xt=!1);super.tick(t,e,n,i,r)}}));const ay="SelectGrab",oy=wa,cy=new su,ly=new su;var hy=Object.freeze({__proto__:null,grabbables:sy,held:cy,holdingObjectForPushPull:ly,mixin:t=>class extends t{static name=ay;constructor(){super(),this.addEventListener("selectstart",this),this.addEventListener("selectend",this)}async handleEvent(t){if("selectstart"===t.type){const e=t.detail.targetRayPose;iy.ray.direction.set(0,0,-1).applyQuaternion(ty.copy(e.transform.orientation)),iy.ray.origin.copy(e.transform.position);const n=Array.from(sy.keys()).map((t=>t.object)).filter((t=>t&&!(t instanceof Promise))),i=iy.intersectObjects(n,!0);if(i.length){let{object:t}=i[0];for(;!t.el||!sy.has(t.el);)t=t.parent;let e=t.el;for(let t=0;t<sy.get(e);t++)e=e.parentNode;t=e.object,this.object.updateWorldMatrix(!0,!1),ry.copy(this.object.matrixWorld).invert(),t.parent.updateWorldMatrix(!0,!1),ry.multiply(t.parent.matrixWorld);const n=ey.setFromMatrixPosition(ry).length(),r=t.el.properties.grabRange;if(r&&r>0&&n>r)return;const s=cy.get(e)||t.parent;cy.set(e,s),ly.set(e,this),e.shReparent(this.object),e.classList.add("held"),e.getRootNode().host&&(e.part.add("held"),e.getRootNode().host.emit("grabstart",{part:e,holdingParent:this.object,realParent:s,distance:n})),this.emit("grabstart",{target:e,holdingParent:this.object,realParent:s},!1),e.emit("grabstart",{holdingParent:this.object,realParent:s,distance:n}),$v(e),e.tick.call(e)}}if("selectend"===t.type)for(const[t,e]of ly.entries()){if(e!==this)continue;const n=cy.get(t);t.shReparent(n),t.classList.remove("held"),t.part.remove("held"),cy.delete(t),ly.delete(t),t.getRootNode().host&&t.getRootNode().host.emit("grabend",{part:t,holdingParent:this.object,realParent:n}),this.emit("grabend",{target:t,holdingParent:this.object,realParent:n},!1),t.emit("grabend",{holdingParent:this.object,realParent:n}),$v(t),t.tick.call(t)}}stopHolding(t){const e=[];for(const[n,i]of ly.entries()){if(i!==this)continue;if(t&&t!==n)continue;const r=cy.get(n);n.shReparent(r),cy.delete(n),ly.delete(n),n.classList.remove("held"),n.part.remove("held"),e.push({el:n,realParent:r,holdingParent:this.object})}return e}},name:ay,type:oy});const uy=`\n#define USE_SHADOWMAP\n#include <common>\n#include <packing>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <dithering_pars_fragment>\n\nuniform vec3 colorU;\nuniform float glossiness;\nuniform float rimThreshold;\nuniform float points;\nuniform float ditherRate;\nuniform vec2 ssSize;\nuniform bool objectSpace;\nuniform int mode;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, -s, s, c);\n\treturn m * v;\n}\n\nvarying vec3 vNormal;\nvarying vec3 vFaceNormal;\nvarying vec3 vViewDir;\nvarying vec4 myObjectPosition;\nvarying vec2 vUv;\nconst float dithers[72] = float[72](0.0, 48.0, 12.0, 60.0, 3.0, 51.0, 15.0, 61.0, 32.0, 16.0, 44.0, 28.0, 35.0, 19.0, 47.0, 31.0, 8.0, 56.0, 4.0, 52.0, 11.0, 59.0, 7.0, 55.0, 40.0, 24.0, 36.0, 20.0, 43.0, 27.0, 39.0, 23.0, 2.0, 50.0, 14.0, 62.0, 1.0, 49.0, 13.0, 61.0, 34.0, 18.0, 46.0, 30.0, 33.0, 17.0, 45.0, 29.0, 10.0, 58.0, 6.0, 54.0, 9.0, 57.0, 5.0, 53.0, 42.0, 26.0, 38.0, 22.0, 41.0, 25.0, 37.0, 21.0, 0.0, 48.0, 12.0, 60.0, 3.0, 51.0, 15.0, 61.0);\nconst float hatch[32] = float[32](${new Array(32).fill(1).map(((t,e)=>3*e)).sort((()=>Math.random()-.5)).map((t=>t.toFixed(1))).toString()});\nvoid main() {\n\tvec4 diffuseColor = vec4(colorU, 1.0);\n\t#include <color_fragment>\n\n\n\t// shadow map\n\tDirectionalLightShadow directionalShadow = directionalLightShadows[0];\n\t\n\tfloat shadow = 1.0;\n\t#if defined( USE_SHADOWMAP )\n\tshadow = getShadow(\n\t\tdirectionalShadowMap[0],\n\t\tdirectionalShadow.shadowMapSize,\n\t\tdirectionalShadow.shadowBias,\n\t\tdirectionalShadow.shadowRadius,\n\t\tvDirectionalShadowCoord[0]\n\t);\n\t#endif\n\n\t// directional light\n\tfloat NdotL = dot(vNormal, directionalLights[0].direction);\n\tfloat lightIntensity = floor(smoothstep(0.0, 0.8, NdotL) * 4.) * 0.25 * mix(shadow, 1., 0.5);\n\tvec3 directionalLight = directionalLights[0].color * lightIntensity;\n\n\t// specular reflection\n\tvec3 halfVector = normalize(directionalLights[0].direction + vViewDir);\n\tfloat NdotH = dot(vNormal, halfVector);\n\n\tfloat specularIntensity = pow(NdotH * lightIntensity, 1000.0 / glossiness);\n\tfloat specularIntensitySmooth = smoothstep(0.0, 0.6, specularIntensity);\n\n\tvec3 specular = specularIntensitySmooth * directionalLights[0].color;\n\n\t// rim lighting\n\tfloat rimDot = 1.0 - dot(vViewDir, vNormal);\n\n\tfloat rimAmount = 0.6;\n\t// float rimThreshold = 0.2;\n\tfloat rimIntensity = rimDot * pow(NdotL, rimThreshold);\n\trimIntensity = smoothstep(rimAmount - 0.01, rimAmount + 0.01, rimIntensity);\n\n\tvec3 rim = rimIntensity * directionalLights[0].color;\n\n\tvec3 lightTotal = (ambientLightColor + directionalLight + specular + rim) * 0.33;\n\tvec2 rMyObjectPosition;\n\n\tfloat isLines = float(mode==1||mode==2);\n\tfloat sampleWidth = 8. + isLines * 24.;\n\n\tfloat aX = abs(vFaceNormal.x);\n\tfloat aY = abs(vFaceNormal.y);\n\tfloat aZ = abs(vFaceNormal.z);\n\tfloat max = max(max(aX, aY),aZ);\n\tif (max == aX) rMyObjectPosition = myObjectPosition.yz;\n\tif (max == aY) rMyObjectPosition = myObjectPosition.xz;\n\tif (max == aZ) rMyObjectPosition = myObjectPosition.xy;\n\t\n\trMyObjectPosition = rotate(rMyObjectPosition,isLines*PI*0.33);\n\tvec2 newUV;\n\tif (mode == 3) {\n\t\tvec4 viewPosition = modelViewMatrix * myObjectPosition;\n\t\tvec4 clipPosition = projectionMatrix * viewPosition;\n\t\tvec2 ss = clipPosition.xy * 0.5 + .5;\n\t\tnewUV = mod(ss * ssSize * points*0.01, sampleWidth);\n\t} else {\n\t\tnewUV = objectSpace ? mod(rMyObjectPosition * points, sampleWidth) : mod(rotate(vUv,isLines*PI*0.33) * points, sampleWidth);\n\t}\n\tint x = int(newUV.x);\n\tint y = int(newUV.y);\n\n\tfloat weight;\n\tfloat dither;\n\tif (mode == 0 || mode == 3) {\n\t\tweight = smoothstep(0. , 0.7, 1.-clamp(length(mod(newUV, 1.) - 0.5)*1.8, 0., 1.));\n\t\tint index = (x * 8) + y;\n\t\tdither = ditherRate * (dithers[index] / 64.0);\n\t}\n\tif (mode == 1) {\n\t\tweight = float(dithers[y+x] < hatch[x]) * smoothstep(0.5 , 1.0, pow(2. * (0.5 - abs(0.5 - mod(newUV.x, 1.))), 2.));\n\t\tdither = ditherRate * (hatch[x] / 64.0);\n\t}\n\tif (mode == 2) {\n\t\tweight = float(dithers[x] < hatch[x]) * smoothstep(0.5 , 1.0, pow(2. * (0.5 - abs(0.5 - mod(newUV.y, 1.))), 2.)) +\n\t\t\tfloat(dithers[y+x] < hatch[y]) * smoothstep(0.5 , 1.0, pow(2. * (0.5 - abs(0.5 - mod(newUV.x, 1.))), 2.));\n\t\tdither = ditherRate * ((hatch[x] + hatch[y]) / 128.0);\n\t}\n\n\tfloat grey = 0.2126 * lightTotal.r + 0.7152 * lightTotal.g + 0.0722 * lightTotal.b;\n\tgrey = grey / 0.039;\n\tgrey = floor(grey + 0.5);\n\tgrey = grey * 0.039;\n\tgrey = grey * 1.5;\n\n\tgl_FragColor = vec4(\n\t\tmix(\n\t\t\tdiffuseColor.rgb * (mix(\n\t\t\t\t\tlightTotal*0.7 + 0.3,\n\t\t\t\t\tlightTotal*0.6 + 0.1,\n\t\t\t\t\tfloat((grey * length(diffuseColor.rgb)) < dither) * weight\n\t\t\t\t)\n\t\t\t),\n\t\t\tdirectionalLights[0].color,\n\t\t\tclamp(length(rim) + length(specular),0.,1.)\n\t\t)\n\t, diffuseColor.a);\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n\t#include <fog_fragment>\n\t#include <dithering_fragment>\n}\n`,dy="GraphicToonShader",py=Qn;var fy=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=dy;static shortHandSchema=iu({mixins:[],glossiness:{default:4},"rim-threshold":{as:"uniforms.rimThreshold.value",default:.2},"object-space-points":{as:"uniforms.objectSpace.value",default:!1},points:{as:"uniforms.points.value",default:75},color:{as:"uniforms.colorU.value",type:"Color",default:"white"},"dither-rate":{as:"uniforms.ditherRate.value",default:1.3},mode:{as:"uniforms.mode.value",type:"number",default:"hatching",map:{dots:0,hatching:1,"cross-hatching":2,ssdots:3}}});async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i)}#Et;#wt;async onAssign(t,e){this.#Et&&(this.#Et.onBeforeRender=this.#wt);const n=await e.deref().object;n instanceof _i&&(this.#wt=n.onBeforeRender,this.#Et=n,n.onBeforeRender=t=>t.getSize(this.object.uniforms.ssSize.value))}async allAttributesChangedCallback(){const t=new Ti({lights:!0,vertexColors:!0,fog:!0,uniforms:{...Ji.lights,colorU:{value:new Nn("white")},glossiness:{value:0},rimThreshold:{value:0},points:{value:0},ditherRate:{value:0},mode:{value:0},objectSpace:{value:!1},fogColor:{value:new Nn("white")},fogDensity:{value:0},ssSize:{value:new zt(100,100)}},vertexShader:"\n#include <common>\n#include <shadowmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n\nvarying vec3 vNormal;\nvarying vec3 vFaceNormal;\nvarying vec3 vViewDir;\nvarying vec4 myObjectPosition;\nvarying vec2 vUv;\n\n#ifdef USE_SHADOWMAP\n#else\nvarying vec4 vDirectionalShadowCoord[1];\n#endif\n\nvoid main() {\n    #include <beginnormal_vertex>\n    #include <defaultnormal_vertex>\n\n    #include <begin_vertex>\n\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <color_vertex>\n\n\tvec4 mvPosition = vec4(position, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\t\tmvPosition = instanceMatrix * vec4(position, 1.);\n\t#endif\n\n\tmyObjectPosition = mvPosition;\n    vec4 viewPosition = modelViewMatrix * mvPosition;\n    vec4 clipPosition = projectionMatrix * viewPosition;\n\n    vNormal = normalize(normalMatrix * normal);\n\tvFaceNormal = vec3(normal);\n\n\t#ifdef USE_INSTANCING\n\t\t// this is in lieu of a per-instance normal-matrix\n\t\t// shear transforms in the instance matrix are not supported\n\t\tmat3 m1 = mat3( instanceMatrix );\n\t\tvNormal /= vec3( dot( m1[ 0 ], m1[ 0 ] ), dot( m1[ 1 ], m1[ 1 ] ), dot( m1[ 2 ], m1[ 2 ] ) );\n\t\tvNormal = m1 * vNormal;\n\t#endif\n\n    vViewDir = normalize(-viewPosition.xyz);\n\n\tvUv = vec3( uv, 1 ).xy;\n\n    gl_Position = clipPosition;\n\n\t#include <fog_vertex>\n}\n",fragmentShader:uy});await this.assignPostConstructAttributes(t),this.updateObject(t)}},name:dy,type:py});const Ay=Hl,gy="SpotLight";var my=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=gy;#z;static shortHandSchema=iu({"spot-helper":{as:"spotHelper",default:!1,stage:4},decay:{type:"number"},target:{type:"Object3D"},penumbra:{type:"number"},distance:{type:"number"},angle:{type:"angle"},map:{type:"Texture"}});tick(t,e,n,i,r){super.tick(t,e,n,i,r),this.ready&&(this.properties.spotHelper&&this.object.parent?(this.#z||(this.#z=new Uh(this.object)),this.object.parent.add(this.#z),this.#z.visible=!0,this.#z.update()):(this.#z&&(this.#z.visible=!1),this.object.target.updateWorldMatrix(!0,!1)))}},name:gy,type:Ay});const by=zd,vy="TextInput",yy={class:HTMLInputElement,tagName:"input"};var xy=Object.freeze({__proto__:null,mixin:t=>class extends t{static name=vy;static shortHandSchema=iu();static template=!1;constructor(){super(),this.addEventListener("click",(()=>this.focus())),window.addEventListener("click",(t=>{t instanceof Jh&&t.target!==this&&this.blur()}))}getStringContent(){return this.value}},name:vy,native:yy,type:by});let _y,Ey=yu;function wy(){return _y||(_y=new ch)}const Cy="AudioListener",Sy=ch;var My=Object.freeze({__proto__:null,getListener:wy,mixin:t=>class extends t{static name=Cy;static documentation=Ey;async allAttributesChangedCallback(){const t=wy();await this.assignPostConstructAttributes(t),this.updateObject(t)}},name:Cy,type:Sy});let Iy=yu;const Ty="Audio",By=fh,Ry={class:HTMLAudioElement,tagName:"audio"};var Py=Object.freeze({__proto__:null,mixin:t=>class extends t{static shortHandSchema=iu({static:{default:!1,stage:12},volume:{default:1,stage:4}});static name=Ty;static documentation=Iy;#Ct;constructor(){super(),this.addEventListener("play",this,{once:!0})}get volume(){return this.properties.volume}set volume(t){this.properties.volume=t,this.updateVolume()}updateVolume(){this.#Ct&&this.#Ct.setVolume(this.properties.volume)}async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i),"volume"===t&&this.updateVolume()}handleEvent(t){if("play"===t.type){const t=new(this.properties.static?lh:fh)(wy());t.setMediaElementSource(this),this.object.add(t),this.#Ct=t,this.updateVolume()}}async allAttributesChangedCallback(){const t=new wa;await this.assignPostConstructAttributes(t),this.updateObject(t)}},name:Ty,native:Ry,type:By});let Dy=yu;const Ly="Teleporter",Uy=wa;var Fy=Object.freeze({__proto__:null,mixin:t=>class extends t{static shortHandSchema=iu({enabled:{default:!0,stage:4}});static name=Ly;async handleEvent(t){const e=t.detail;console.log(e),t.type}#St;static documentation=Dy;async connectedCallback(){this.#St=this.closest("sh-user"),this.#St&&this.#St.addEventListener("selectstart",this),await super.connectedCallback()}tick(t,e,n,i,r){super.tick(t,e,n,i,r)}},name:Ly,type:Uy});let Ny=yu,ky=yu,Oy=yu;const Qy=_i,Gy=t=>class extends t{static name="ObjectProxy";static shortHandSchema=iu({target:{type:"string",stage:12},material:{type:"Material",map:Wd},geometry:void 0});static documentation=Ny;addToParent(){}async allAttributesChangedCallback(){if(!this.properties.target)throw Error("This proxy does not have a target: ",this);const t=this.getRootNode().host.objectsByName.get(this.properties.target);await this.assignPostConstructAttributes(t),this.updateObject(t)}tick(t,e,n,i,r){if(super.tick(t,e,n,i,r),this.getRootNode().host)for(const s of this.children)s.tick(t,e,n,i,r)}},Hy=Fl,zy=t=>class extends(Gy(t)){static name="LightProxy";static shortHandSchema=new Map([["target",{type:"string",stage:12}],["color",{type:"Color"}],["intensity",{type:"number"}]])},jy=il,Vy=t=>class extends(Gy(t)){static name="MaterialProxy";static shortHandSchema=new Map([["target",{type:"string",stage:12}]]);static documentation=Oy;async allAttributesChangedCallback(){if(!this.properties.target)throw Error("This proxy does not have a target: ",this);let t;const e=this.getRootNode().host;if(!e||!e.object)return console.warn("Proxy could not find object in parent");t=e.objectMaterials.get(this.properties.target),await this.assignPostConstructAttributes(t),this.updateObject(t)}},Wy=jd,qy=t=>class extends(Gy(t)){static name="AnimationProxy";static shortHandSchema=iu({target:{type:"string",stage:12},"time-scale":{as:"timeScale",stage:1},weight:{type:"number",stage:1},paused:{default:!0,stage:1},t:{default:null,type:"number",stage:4}});static documentation=ky;async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i),"t"===t&&(null==n&&(this.properties.t=null),this.updateT())}updateT(){this.object instanceof Promise||("number"==typeof this.properties.t?(this.object.play(),this.object.time=this.properties.t*this.object._clip.duration):this.object.stop())}async allAttributesChangedCallback(){if(!this.properties.target)throw Error("This proxy does not have a target: ",this);const t=this.getRootNode().host;let e;t&&t.object&&(await t.object,e=t.objectAnimations.get(this.properties.target)),e.loop=2201,e.play(),this.updateT(),await this.assignPostConstructAttributes(e),this.updateObject(e)}},Xy=ov,Yy=new qe,Jy=t=>class extends(Gy(t)){static name="InstancedProxy";static shortHandSchema=new Map([["target",{type:"InstancedMesh",stage:12}],["index",{type:"number",stage:12}],["color",{type:"Color"}]]);static documentation=Ny;async allAttributesChangedCallback(){if(!this.properties.target)throw Error("This proxy does not have a target: ",this);const t=this.properties.target,e=new ov({instancedMesh:t,instancedMeshInHeirarchy:!0},this.properties.index);t.getMatrixAt(this.properties.index,Yy),Yy.decompose(e.position,e.quaternion,e.scale),e.matrix.copy(Yy),await this.assignPostConstructAttributes(e),e.syncVectorChanges(),e.updateMatrixWorld(),this.updateObject(e)}tick(t,e,n,i,r){super.tick(t,e,n,i,r),this.object.syncVectorChanges&&this.object.syncVectorChanges()}};let Ky=yu;const Zy="BatchedMesh",$y=So;var tx=Object.freeze({__proto__:null,mixin:t=>class extends t{static shortHandSchema=iu({material:{type:"Material",map:Wd,stage:4,default:Wd.plastic,example:"#my-material"},items:{type:"BatchedMeshItem[]",default:"sh-mesh-batched-item",stage:4},geometry:void 0});static name=Zy;static documentation=Ky;noGeometryBVH=!0;constructor(){super()}tick(t,e,n,i,r){super.tick(t,e,n,i,r)}objectAssigned(t,e){super.objectAssigned(t,e)}#Mt=64;#It=new WeakMap;async allAttributesChangedCallback(){let t=0,e=0;for(const n of this.properties.items)t++,e+=n.requestedGeometry.attributes.position.count;const n=new So(t,e,this.#Mt,this.properties.material);for(const t of this.properties.items){const e=t.requestedGeometry,i=n.addGeometry(e);this.#It.set(t,i),t.updateMatrixWorld(),n.setMatrixAt(i,t.matrixWorld)}await this.assignPostConstructAttributes(n),this.updateObject(n)}},name:Zy,type:$y});let ex=yu;class nx extends wa{constructor(t){super(),this.for=t.for,this.requestedGeometry=t.requestedGeometry}}Object.assign(gu,{BatchedMeshItem:nx});const ix="BatchedMeshItem",rx=nx;var sx=Object.freeze({__proto__:null,mixin:t=>class extends t{static shortHandSchema=iu({shape:{default:0},geometry:{as:"requestedGeometry",map:Vd,type:"BufferGeometry",default:"box"}});static name=ix;static documentation=ex},name:ix,type:rx});const ax=sb;function ox(t,e){e.schemas,t("sh-xr-session",Su),t("sh-renderer-webgl",VA),t("sh-model",yb),t("sh-orbit-controls",kb),t("sh-light-directional",Tb),t("sh-light-spot",my),t("sh-texture-image",zb),t("sh-texture-video",qb),t("sh-texture-canvas",fv),t("sh-mesh-instanced",hv),t("sh-user",qv),t("sh-select-grab",hy),t("sh-use",ab),t("sh-material-toon-dither",fy),t("sh-text-input",xy),t("sh-audio",Py),t("sh-audio-listener",My),t("sh-teleporter",Fy),t("sh-mesh-batched",tx),t("sh-mesh-batched-item",sx),t("sh-material-proxy",{type:jy,mixin:Vy}),t("sh-object-proxy",{type:Qy,mixin:Gy}),t("sh-animation-proxy",{type:Wy,mixin:qy}),t("sh-light-proxy",{type:Hy,mixin:zy}),t("sh-instance-proxy",{type:Xy,mixin:Jy});for(const[e,n]of[["sh-geometry-sphere",Zc],["sh-geometry-cylinder",vc],["sh-geometry-circle",bc],["sh-geometry-plane",Xi],["sh-geometry-box",wi],["sh-geometry-box-rounded",Vh],["sh-geometry-ring",Jc],["sh-geometry-tube",tl],["sh-geometry-cone",yc],["sh-geometry-torus",$c],["sh-material-basic",Gn],["sh-material-phong",rl],["sh-material-shadow",el],["sh-material-lambert",al],["sh-material-standard",nl],["sh-material-physical",il],["sh-material-toon",sl],["sh-material-depth",ma],["sh-material-line",Mo],["sh-material-line-dashed",ol],["sh-line",Do],["sh-environment",Wh],["sh-light-ambient",Jl],["sh-light-point",ql],["sh-scene",Ua],["sh-group",wa],["sh-camera-perspective",Li],["sh-camera-orthographic",or],["sh-camera-cube",Fi],["sh-mesh",_i],["sh-grid",Fh],["sh-grid-polar",Nh],["sh-text",zd]])t(e,{type:n});const n=document.createElement("template");n.innerHTML=ru`
  <style>
    sh-renderer-webgl {
      min-width: 100%;
      min-height: 100%;
    }
  </style>
  <sh-xr-session part="xrsession" id="xrsession" optional-features="\${optional-features|}"></sh-xr-session>
  <sh-geometry-cylinder id="pointer" height="2" radius-bottom="0.001" radius-top="0.001" location="0 1 0" rotate="-90 0 0"></sh-geometry-cylinder>
  <sh-material-basic color="red" id="red" visibility="hidden"></sh-material-basic>
  <sh-renderer-webgl shadow-type="\${shadow-type|soft}" scene="sh-scene" id="renderer" part="renderer" exposure="\${exposure|1}">
    <sh-scene part="scene" background-image="\${background-image|none}" slot="scene" environment="\${environment|linear-gradient(0deg, rgba(9,18,3,1) 0%, rgba(9,43,22,0.86) 46.18%, rgba(4,53,17,0) 52.43%) 0px 0px, radial-gradient(ellipse at 50% 50%, rgba(237,241,201,1) 0%, rgba(69,168,255,0) 63.19%) 30px 5px / 430px 438px no-repeat no-repeat, linear-gradient(0deg, rgba(19,38,27,1) 50%, rgba(35,107,170,1) 51.39%, rgba(8,5,49,1) 100%)}">
      <sh-user>
        <sh-mesh slot="left-ray" part="debug-ray" pointer-events="none" geometry="#pointer" material="#red" cast-shadow="false"></sh-mesh>
        <sh-mesh slot="right-ray" part="debug-ray" pointer-events="none" geometry="#pointer" material="#red" cast-shadow="false"></sh-mesh>
  
        <sh-select-grab part="grabber left-grip" slot="left-grip"></sh-select-grab>
        <sh-select-grab part="grabber right-grip" slot="right-grip"></sh-select-grab>
        <sh-select-grab part="grabber none-grip" slot="none-grip"></sh-select-grab>
        <sh-select-grab part="grabber transient-pointer-grip-0"  slot="transient-pointer-grip-0"></sh-select-grab>
        <sh-select-grab part="grabber transient-pointer-grip-1"  slot="transient-pointer-grip-1"></sh-select-grab>
        
        ${Pv.map((t=>`<slot data-name="${t}" name="${t}" slot="${t}"></slot>`)).join("\n")}
      </sh-user>
      <slot></slot>
    </sh-scene>
    <button class="enter-vr" data-action="enter-vr">Start VR</button>
    <button class="enter-ar" data-action="enter-ar">Start AR</button>
    <button class="enter-inline-xr" data-action="enter-inline">Start Inline</button>
    <button class="end-session" data-action="end-xr">Exit XR</button>
    <slot name="content"></slot>
  </sh-renderer-webgl>
  `,eb.set("webxr",n),ax("sh-quickstart","std:webxr")}const cx=0,lx=1,hx=2,ux=2,dx=1.25,px=1,fx=32,Ax=65535,gx=Math.pow(2,-24),mx=Symbol("SKIP_GENERATION");function bx(t){return function(t){return t.index?t.index.count:t.attributes.position.count}(t)/3}function vx(t,e){if(!t.index){const n=t.attributes.position.count,i=function(t,e=ArrayBuffer){return t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}(n,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new qn(i,1));for(let t=0;t<n;t++)i[t]=t}}function yx(t){const e=bx(t),n=t.drawRange,i=n.start/3,r=(n.start+n.count)/3,s=Math.max(0,i),a=Math.min(e,r)-s;return[{offset:Math.floor(s),count:Math.floor(a)}]}function xx(t){if(!t.groups||!t.groups.length)return yx(t);const e=[],n=new Set,i=t.drawRange,r=i.start/3,s=(i.start+i.count)/3;for(const e of t.groups){const t=e.start/3,i=(e.start+e.count)/3;n.add(Math.max(r,t)),n.add(Math.min(s,i))}const a=Array.from(n.values()).sort(((t,e)=>t-e));for(let t=0;t<a.length-1;t++){const n=a[t],i=a[t+1];e.push({offset:Math.floor(n),count:Math.floor(i-n)})}return e}function _x(t,e,n,i,r){let s=1/0,a=1/0,o=1/0,c=-1/0,l=-1/0,h=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,A=-1/0,g=-1/0;for(let i=6*e,r=6*(e+n);i<r;i+=6){const e=t[i+0],n=t[i+1],r=e-n,m=e+n;r<s&&(s=r),m>c&&(c=m),e<u&&(u=e),e>f&&(f=e);const b=t[i+2],v=t[i+3],y=b-v,x=b+v;y<a&&(a=y),x>l&&(l=x),b<d&&(d=b),b>A&&(A=b);const _=t[i+4],E=t[i+5],w=_-E,C=_+E;w<o&&(o=w),C>h&&(h=C),_<p&&(p=_),_>g&&(g=_)}i[0]=s,i[1]=a,i[2]=o,i[3]=c,i[4]=l,i[5]=h,r[0]=u,r[1]=d,r[2]=p,r[3]=f,r[4]=A,r[5]=g}function Ex(t,e,n){return n.min.x=e[t],n.min.y=e[t+1],n.min.z=e[t+2],n.max.x=e[t+3],n.max.y=e[t+4],n.max.z=e[t+5],n}function wx(t){let e=-1,n=-1/0;for(let i=0;i<3;i++){const r=t[i+3]-t[i];r>n&&(n=r,e=i)}return e}function Cx(t,e){e.set(t)}function Sx(t,e,n){let i,r;for(let s=0;s<3;s++){const a=s+3;i=t[s],r=e[s],n[s]=i<r?i:r,i=t[a],r=e[a],n[a]=i>r?i:r}}function Mx(t,e,n){for(let i=0;i<3;i++){const r=e[t+2*i],s=e[t+2*i+1],a=r-s,o=r+s;a<n[i]&&(n[i]=a),o>n[i+3]&&(n[i+3]=o)}}function Ix(t){const e=t[3]-t[0],n=t[4]-t[1],i=t[5]-t[2];return 2*(e*n+n*i+i*e)}const Tx=32,Bx=(t,e)=>t.candidate-e.candidate,Rx=new Array(Tx).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),Px=new Float32Array(6);class Dx{constructor(){this.boundingData=new Float32Array(6)}}function Lx(t,e,n,i,r,s){let a=i,o=i+r-1;const c=s.pos,l=2*s.axis;for(;;){for(;a<=o&&n[6*a+l]<c;)a++;for(;a<=o&&n[6*o+l]>=c;)o--;if(!(a<o))return a;for(let t=0;t<3;t++){let n=e[3*a+t];e[3*a+t]=e[3*o+t],e[3*o+t]=n}for(let t=0;t<6;t++){let e=n[6*a+t];n[6*a+t]=n[6*o+t],n[6*o+t]=e}a++,o--}}function Ux(t,e,n,i,r,s){let a=i,o=i+r-1;const c=s.pos,l=2*s.axis;for(;;){for(;a<=o&&n[6*a+l]<c;)a++;for(;a<=o&&n[6*o+l]>=c;)o--;if(!(a<o))return a;{let e=t[a];t[a]=t[o],t[o]=e;for(let t=0;t<6;t++){let e=n[6*a+t];n[6*a+t]=n[6*o+t],n[6*o+t]=e}a++,o--}}}function Fx(t,e){return 65535===e[t+15]}function Nx(t,e){return e[t+6]}function kx(t,e){return e[t+14]}function Ox(t){return t+8}function Qx(t,e){return e[t+6]}function Gx(t,e){return e[t+7]}let Hx,zx,jx,Vx;const Wx=Math.pow(2,32);function qx(t){return"count"in t?1:1+qx(t.left)+qx(t.right)}function Xx(t,e,n){return Hx=new Float32Array(n),zx=new Uint32Array(n),jx=new Uint16Array(n),Vx=new Uint8Array(n),Yx(t,e)}function Yx(t,e){const n=t/4,i=t/2,r="count"in e,s=e.boundingData;for(let t=0;t<6;t++)Hx[n+t]=s[t];if(r){if(e.buffer){const i=e.buffer;Vx.set(new Uint8Array(i),t);for(let e=t,r=t+i.byteLength;e<r;e+=fx){Fx(e/2,jx)||(zx[e/4+6]+=n)}return t+i.byteLength}{const r=e.offset,s=e.count;return zx[n+6]=r,jx[i+14]=s,jx[i+15]=Ax,t+fx}}{const i=e.left,r=e.right,s=e.splitAxis;let a;if(a=Yx(t+fx,i),a/4>Wx)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return zx[n+6]=a/4,a=Yx(a,r),zx[n+7]=s,a}}function Jx(t,e,n,i,r){const{maxDepth:s,verbose:a,maxLeafTris:o,strategy:c,onProgress:l,indirect:h}=r,u=t._indirectBuffer,d=t.geometry,p=d.index?d.index.array:null,f=h?Ux:Lx,A=bx(d),g=new Float32Array(6);let m=!1;const b=new Dx;return _x(e,n,i,b.boundingData,g),function t(n,i,r,l=null,h=0){!m&&h>=s&&(m=!0,a&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(d)));if(r<=o||h>=s)return v(i+r),n.offset=i,n.count=r,n;const A=function(t,e,n,i,r,s){let a=-1,o=0;if(s===cx)a=wx(e),-1!==a&&(o=(e[a]+e[a+3])/2);else if(s===lx)a=wx(t),-1!==a&&(o=function(t,e,n,i){let r=0;for(let s=e,a=e+n;s<a;s++)r+=t[6*s+2*i];return r/n}(n,i,r,a));else if(s===hx){const s=Ix(t);let c=dx*r;const l=6*i,h=6*(i+r);for(let t=0;t<3;t++){const i=e[t],u=(e[t+3]-i)/Tx;if(r<Tx/4){const e=[...Rx];e.length=r;let i=0;for(let r=l;r<h;r+=6,i++){const s=e[i];s.candidate=n[r+2*t],s.count=0;const{bounds:a,leftCacheBounds:o,rightCacheBounds:c}=s;for(let t=0;t<3;t++)c[t]=1/0,c[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0;Mx(r,n,a)}e.sort(Bx);let u=r;for(let t=0;t<u;t++){const n=e[t];for(;t+1<u&&e[t+1].candidate===n.candidate;)e.splice(t+1,1),u--}for(let i=l;i<h;i+=6){const r=n[i+2*t];for(let t=0;t<u;t++){const s=e[t];r>=s.candidate?Mx(i,n,s.rightCacheBounds):(Mx(i,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<u;n++){const i=e[n],l=i.count,h=r-i.count,u=i.leftCacheBounds,d=i.rightCacheBounds;let p=0;0!==l&&(p=Ix(u)/s);let f=0;0!==h&&(f=Ix(d)/s);const A=px+dx*(p*l+f*h);A<c&&(a=t,c=A,o=i.candidate)}}else{for(let t=0;t<Tx;t++){const e=Rx[t];e.count=0,e.candidate=i+u+t*u;const n=e.bounds;for(let t=0;t<3;t++)n[t]=1/0,n[t+3]=-1/0}for(let e=l;e<h;e+=6){let r=~~((n[e+2*t]-i)/u);r>=Tx&&(r=Tx-1);const s=Rx[r];s.count++,Mx(e,n,s.bounds)}const e=Rx[Tx-1];Cx(e.bounds,e.rightCacheBounds);for(let t=Tx-2;t>=0;t--){const e=Rx[t],n=Rx[t+1];Sx(e.bounds,n.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let e=0;e<Tx-1;e++){const n=Rx[e],i=n.count,l=n.bounds,h=Rx[e+1].rightCacheBounds;0!==i&&(0===d?Cx(l,Px):Sx(l,Px,Px)),d+=i;let u=0,p=0;0!==d&&(u=Ix(Px)/s);const f=r-d;0!==f&&(p=Ix(h)/s);const A=px+dx*(u*d+p*f);A<c&&(a=t,c=A,o=n.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}(n.boundingData,l,e,i,r,c);if(-1===A.axis)return v(i+r),n.offset=i,n.count=r,n;const b=f(u,p,e,i,r,A);if(b===i||b===i+r)v(i+r),n.offset=i,n.count=r;else{n.splitAxis=A.axis;const s=new Dx,a=i,o=b-i;n.left=s,_x(e,a,o,s.boundingData,g),t(s,a,o,g,h+1);const c=new Dx,l=b,u=r-o;n.right=c,_x(e,l,u,c.boundingData,g),t(c,l,u,g,h+1)}return n}(b,n,i,g),b;function v(t){l&&l(t/A)}}function Kx(t,e){const n=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){const n=(t.index?t.index.count:t.attributes.position.count)/3,i=n>65536,r=i?4:2,s=e?new SharedArrayBuffer(n*r):new ArrayBuffer(n*r),a=i?new Uint32Array(s):new Uint16Array(s);for(let t=0,e=a.length;t<e;t++)a[t]=t;return a}(n,e.useSharedArrayBuffer),function(t){if(0===t.groups.length)return!1;const e=bx(t),n=xx(t).sort(((t,e)=>t.offset-e.offset)),i=n[n.length-1];i.count=Math.min(e-i.offset,i.count);let r=0;return n.forEach((({count:t})=>r+=t)),e!==r}(n)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),t._indirectBuffer||vx(n,e);const i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=function(t,e=null,n=null,i=null){const r=t.attributes.position,s=t.index?t.index.array:null,a=bx(t),o=r.normalized;let c;null===e?(c=new Float32Array(6*a*4),n=0,i=a):(c=e,n=n||0,i=i||a);const l=r.array,h=r.offset||0;let u=3;r.isInterleavedBufferAttribute&&(u=r.data.stride);const d=["getX","getY","getZ"];for(let t=n;t<n+i;t++){const e=3*t,n=6*t;let i=e+0,a=e+1,p=e+2;s&&(i=s[i],a=s[a],p=s[p]),o||(i=i*u+h,a=a*u+h,p=p*u+h);for(let t=0;t<3;t++){let e,s,h;o?(e=r[d[t]](i),s=r[d[t]](a),h=r[d[t]](p)):(e=l[i+t],s=l[a+t],h=l[p+t]);let u=e;s<u&&(u=s),h<u&&(u=h);let f=e;s>f&&(f=s),h>f&&(f=h);const A=(f-u)/2,g=2*t;c[n+g+0]=u+A,c[n+g+1]=A+(Math.abs(u)+A)*gx}}return c}(n),s=e.indirect?yx(n):xx(n);t._roots=s.map((n=>{const s=Jx(t,r,n.offset,n.count,e),a=qx(s),o=new i(fx*a);return Xx(0,s,o),o}))}class Zx{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,i=-1/0;for(let r=0,s=t.length;r<s;r++){const s=t[r][e];n=s<n?s:n,i=s>i?s:i}this.min=n,this.max=i}setFromPoints(t,e){let n=1/0,i=-1/0;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=t.dot(s);n=a<n?a:n,i=a>i?a:i}this.min=n,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}Zx.prototype.setFromBox=function(){const t=new me;return function(e,n){const i=n.min,r=n.max;let s=1/0,a=-1/0;for(let n=0;n<=1;n++)for(let o=0;o<=1;o++)for(let c=0;c<=1;c++){t.x=i.x*n+r.x*(1-n),t.y=i.y*o+r.y*(1-o),t.z=i.z*c+r.z*(1-c);const l=e.dot(t);s=Math.min(l,s),a=Math.max(l,a)}this.min=s,this.max=a}}();const $x=function(){const t=new me,e=new me,n=new me;return function(i,r,s){const a=i.start,o=t,c=r.start,l=e;n.subVectors(a,c),t.subVectors(i.end,i.start),e.subVectors(r.end,r.start);const h=n.dot(l),u=l.dot(o),d=l.dot(l),p=n.dot(o),f=o.dot(o)*d-u*u;let A,g;A=0!==f?(h*u-p*d)/f:0,g=(h+A*u)/d,s.x=A,s.y=g}}(),t_=function(){const t=new zt,e=new me,n=new me;return function(i,r,s,a){$x(i,r,t);let o=t.x,c=t.y;if(o>=0&&o<=1&&c>=0&&c<=1)return i.at(o,s),void r.at(c,a);if(o>=0&&o<=1)return c<0?r.at(0,a):r.at(1,a),void i.closestPointToPoint(a,!0,s);if(c>=0&&c<=1)return o<0?i.at(0,s):i.at(1,s),void r.closestPointToPoint(s,!0,a);{let t,l;t=o<0?i.start:i.end,l=c<0?r.start:r.end;const h=e,u=n;return i.closestPointToPoint(l,!0,e),r.closestPointToPoint(t,!0,n),h.distanceToSquared(l)<=u.distanceToSquared(t)?(s.copy(h),void a.copy(l)):(s.copy(t),void a.copy(u))}}}(),e_=function(){const t=new me,e=new me,n=new Hi,i=new Dh;return function(r,s){const{radius:a,center:o}=r,{a:c,b:l,c:h}=s;i.start=c,i.end=l;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=a)return!0;i.start=c,i.end=h;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=a)return!0;i.start=l,i.end=h;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=a)return!0;const u=s.getPlane(n);if(Math.abs(u.distanceToPoint(o))<=a){const t=u.projectPoint(o,e);if(s.containsPoint(t))return!0}return!1}}();function n_(t){return Math.abs(t)<1e-15}class i_ extends Pn{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new me)),this.satBounds=new Array(4).fill().map((()=>new Zx)),this.points=[this.a,this.b,this.c],this.sphere=new ke,this.plane=new Hi,this.needsUpdate=!0}intersectsSphere(t){return e_(t,this)}update(){const t=this.a,e=this.b,n=this.c,i=this.points,r=this.satAxes,s=this.satBounds,a=r[0],o=s[0];this.getNormal(a),o.setFromPoints(a,i);const c=r[1],l=s[1];c.subVectors(t,e),l.setFromPoints(c,i);const h=r[2],u=s[2];h.subVectors(e,n),u.setFromPoints(h,i);const d=r[3],p=s[3];d.subVectors(n,t),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}}i_.prototype.closestPointToSegment=function(){const t=new me,e=new me,n=new Dh;return function(i,r=null,s=null){const{start:a,end:o}=i,c=this.points;let l,h=1/0;for(let a=0;a<3;a++){const o=(a+1)%3;n.start.copy(c[a]),n.end.copy(c[o]),t_(n,i,t,e),l=t.distanceToSquared(e),l<h&&(h=l,r&&r.copy(t),s&&s.copy(e))}return this.closestPointToPoint(a,t),l=a.distanceToSquared(t),l<h&&(h=l,r&&r.copy(t),s&&s.copy(a)),this.closestPointToPoint(o,t),l=o.distanceToSquared(t),l<h&&(h=l,r&&r.copy(t),s&&s.copy(o)),Math.sqrt(h)}}(),i_.prototype.intersectsTriangle=function(){const t=new i_,e=new Array(3),n=new Array(3),i=new Zx,r=new Zx,s=new me,a=new me,o=new me,c=new me,l=new me,h=new Dh,u=new Dh,d=new Dh,p=new me;function f(t,e,n){const i=t.points;let r=0,s=-1;for(let t=0;t<3;t++){const{start:o,end:c}=h;o.copy(i[t]),c.copy(i[(t+1)%3]),h.delta(a);const l=n_(e.distanceToPoint(o));if(n_(e.normal.dot(a))&&l){n.copy(h),r=2;break}const u=e.intersectLine(h,p);if(!u&&l&&p.copy(o),(u||l)&&!n_(p.distanceTo(c))){if(r<=1){(1===r?n.start:n.end).copy(p),l&&(s=r)}else if(r>=2){(1===s?n.start:n.end).copy(p),r=2;break}if(r++,2===r&&-1===s)break}}return r}return function(a,h=null,p=!1){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(t.copy(a),t.update(),a=t);const A=this.plane,g=a.plane;if(Math.abs(A.normal.dot(g.normal))>1-1e-10){const t=this.satBounds,o=this.satAxes;n[0]=a.a,n[1]=a.b,n[2]=a.c;for(let e=0;e<4;e++){const r=t[e],s=o[e];if(i.setFromPoints(s,n),r.isSeparated(i))return!1}const c=a.satBounds,l=a.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const n=c[t],r=l[t];if(i.setFromPoints(r,e),n.isSeparated(i))return!1}for(let t=0;t<4;t++){const a=o[t];for(let t=0;t<4;t++){const o=l[t];if(s.crossVectors(a,o),i.setFromPoints(s,e),r.setFromPoints(s,n),i.isSeparated(r))return!1}}return h&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),h.start.set(0,0,0),h.end.set(0,0,0)),!0}{const t=f(this,g,u);if(1===t&&a.containsPoint(u.end))return h&&(h.start.copy(u.end),h.end.copy(u.end)),!0;if(2!==t)return!1;const e=f(a,A,d);if(1===e&&this.containsPoint(d.end))return h&&(h.start.copy(d.end),h.end.copy(d.end)),!0;if(2!==e)return!1;if(u.delta(o),d.delta(c),o.dot(c)<0){let t=d.start;d.start=d.end,d.end=t}const n=u.start.dot(o),i=u.end.dot(o),r=d.start.dot(o),s=d.end.dot(o);return(n===s||r===i||i<r!==n<s)&&(h&&(l.subVectors(u.start,d.start),l.dot(o)>0?h.start.copy(u.start):h.start.copy(d.start),l.subVectors(u.end,d.end),l.dot(o)<0?h.end.copy(u.end):h.end.copy(d.end)),!0)}}}(),i_.prototype.distanceToPoint=function(){const t=new me;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),i_.prototype.distanceToTriangle=function(){const t=new me,e=new me,n=["a","b","c"],i=new Dh,r=new Dh;return function(s,a=null,o=null){const c=a||o?i:null;if(this.intersectsTriangle(s,c))return(a||o)&&(a&&c.getCenter(a),o&&c.getCenter(o)),0;let l=1/0;for(let e=0;e<3;e++){let i;const r=n[e],c=s[r];this.closestPointToPoint(c,t),i=c.distanceToSquared(t),i<l&&(l=i,a&&a.copy(t),o&&o.copy(c));const h=this[r];s.closestPointToPoint(h,t),i=h.distanceToSquared(t),i<l&&(l=i,a&&a.copy(h),o&&o.copy(t))}for(let c=0;c<3;c++){const h=n[c],u=n[(c+1)%3];i.set(this[h],this[u]);for(let c=0;c<3;c++){const h=n[c],u=n[(c+1)%3];r.set(s[h],s[u]),t_(i,r,t,e);const d=t.distanceToSquared(e);d<l&&(l=d,a&&a.copy(t),o&&o.copy(e))}}return Math.sqrt(l)}}();class r_{constructor(t,e,n){this.isOrientedBox=!0,this.min=new me,this.max=new me,this.matrix=new qe,this.invMatrix=new qe,this.points=new Array(8).fill().map((()=>new me)),this.satAxes=new Array(3).fill().map((()=>new me)),this.satBounds=new Array(3).fill().map((()=>new Zx)),this.alignedSatBounds=new Array(3).fill().map((()=>new Zx)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}r_.prototype.update=function(){const t=this.matrix,e=this.min,n=this.max,i=this.points;for(let r=0;r<=1;r++)for(let s=0;s<=1;s++)for(let a=0;a<=1;a++){const o=i[1*r|2*s|4*a];o.x=r?n.x:e.x,o.y=s?n.y:e.y,o.z=a?n.z:e.z,o.applyMatrix4(t)}const r=this.satBounds,s=this.satAxes,a=i[0];for(let t=0;t<3;t++){const e=s[t],n=r[t],o=i[1<<t];e.subVectors(a,o),n.setFromPoints(e,i)}const o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},r_.prototype.intersectsBox=function(){const t=new Zx;return function(e){this.needsUpdate&&this.update();const n=e.min,i=e.max,r=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(t.min=n.x,t.max=i.x,a[0].isSeparated(t))return!1;if(t.min=n.y,t.max=i.y,a[1].isSeparated(t))return!1;if(t.min=n.z,t.max=i.z,a[2].isSeparated(t))return!1;for(let n=0;n<3;n++){const i=s[n],a=r[n];if(t.setFromBox(i,e),a.isSeparated(t))return!1}return!0}}(),r_.prototype.intersectsTriangle=function(){const t=new i_,e=new Array(3),n=new Zx,i=new Zx,r=new me;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(t.copy(s),t.update(),s=t);const a=this.satBounds,o=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let t=0;t<3;t++){const i=a[t],r=o[t];if(n.setFromPoints(r,e),i.isSeparated(n))return!1}const c=s.satBounds,l=s.satAxes,h=this.points;for(let t=0;t<3;t++){const e=c[t],i=l[t];if(n.setFromPoints(i,h),e.isSeparated(n))return!1}for(let t=0;t<3;t++){const s=o[t];for(let t=0;t<4;t++){const a=l[t];if(r.crossVectors(s,a),n.setFromPoints(r,e),i.setFromPoints(r,h),n.isSeparated(i))return!1}}return!0}}(),r_.prototype.closestPointToPoint=function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},r_.prototype.distanceToPoint=function(){const t=new me;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),r_.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map((()=>new Dh)),n=new Array(12).fill().map((()=>new Dh)),i=new me,r=new me;return function(s,a=0,o=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||c)&&(s.getCenter(r),this.closestPointToPoint(r,i),s.closestPointToPoint(i,r),o&&o.copy(i),c&&c.copy(r)),0;const l=a*a,h=s.min,u=s.max,d=this.points;let p=1/0;for(let t=0;t<8;t++){const e=d[t];r.copy(e).clamp(h,u);const n=e.distanceToSquared(r);if(n<p&&(p=n,o&&o.copy(e),c&&c.copy(r),n<l))return Math.sqrt(n)}let f=0;for(let i=0;i<3;i++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){const a=(i+1)%3,o=(i+2)%3,c=1<<i|r<<a|s<<o,l=d[r<<a|s<<o],p=d[c];e[f].set(l,p);const A=t[i],g=t[a],m=t[o],b=n[f],v=b.start,y=b.end;v[A]=h[A],v[g]=r?h[g]:u[g],v[m]=s?h[m]:u[g],y[A]=u[A],y[g]=r?h[g]:u[g],y[m]=s?h[m]:u[g],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let n=0;n<=1;n++){r.x=t?u.x:h.x,r.y=e?u.y:h.y,r.z=n?u.z:h.z,this.closestPointToPoint(r,i);const s=r.distanceToSquared(i);if(s<p&&(p=s,o&&o.copy(i),c&&c.copy(r),s<l))return Math.sqrt(s)}for(let t=0;t<12;t++){const s=e[t];for(let t=0;t<12;t++){const e=n[t];t_(s,e,i,r);const a=i.distanceToSquared(r);if(a<p&&(p=a,o&&o.copy(i),c&&c.copy(r),a<l))return Math.sqrt(a)}}return Math.sqrt(p)}}();class s_{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class a_ extends s_{constructor(){super((()=>new i_))}}const o_=new a_;const c_=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=n=>{e&&t.push(e),e=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}};let l_,h_;const u_=[],d_=new s_((()=>new ye));function p_(t,e,n,i,r,s){l_=d_.getPrimitive(),h_=d_.getPrimitive(),u_.push(l_,h_),c_.setBuffer(t._roots[e]);const a=f_(0,t.geometry,n,i,r,s);c_.clearBuffer(),d_.releasePrimitive(l_),d_.releasePrimitive(h_),u_.pop(),u_.pop();const o=u_.length;return o>0&&(h_=u_[o-1],l_=u_[o-2]),a}function f_(t,e,n,i,r=null,s=0,a=0){const{float32Array:o,uint16Array:c,uint32Array:l}=c_;let h=2*t;if(Fx(h,c)){const p=Nx(t,l),f=kx(h,c);return Ex(t,o,l_),i(p,f,!1,a,s+t,l_)}{const A=Ox(t),g=Qx(t,l);let m,b,v,y,x=A,_=g;if(r&&(v=l_,y=h_,Ex(x,o,v),Ex(_,o,y),m=r(v),b=r(y),b<m)){x=g,_=A;const M=m;m=b,b=M,v=y}v||(v=l_,Ex(x,o,v));const E=n(v,Fx(2*x,c),m,a+1,s+x);let w;if(E===ux){const I=u(x);w=i(I,d(x)-I,!0,a+1,s+x,v)}else w=E&&f_(x,e,n,i,r,s,a+1);if(w)return!0;y=h_,Ex(_,o,y);const C=n(y,Fx(2*_,c),b,a+1,s+_);let S;if(C===ux){const T=u(_);S=i(T,d(_)-T,!0,a+1,s+_,y)}else S=C&&f_(_,e,n,i,r,s,a+1);return!!S;function u(t){const{uint16Array:e,uint32Array:n}=c_;let i=2*t;for(;!Fx(i,e);)i=2*(t=Ox(t));return Nx(t,n)}function d(t){const{uint16Array:e,uint32Array:n}=c_;let i=2*t;for(;!Fx(i,e);)i=2*(t=Qx(t,n));return Nx(t,n)+kx(i,e)}}}const A_=new me,g_=new me;const m_=new me,b_=new me,v_=new me,y_=new zt,x_=new zt,__=new zt,E_=new me,w_=new me,C_=new me,S_=new me;function M_(t,e,n,i,r,s,a,o,c){m_.fromBufferAttribute(e,s),b_.fromBufferAttribute(e,a),v_.fromBufferAttribute(e,o);const l=function(t,e,n,i,r,s){let a;return a=s===d?t.intersectTriangle(i,n,e,!0,r):t.intersectTriangle(e,n,i,s!==p,r),null===a?null:{distance:t.origin.distanceTo(r),point:r.clone()}}(t,m_,b_,v_,S_,c);if(l){i&&(y_.fromBufferAttribute(i,s),x_.fromBufferAttribute(i,a),__.fromBufferAttribute(i,o),l.uv=Pn.getInterpolation(S_,m_,b_,v_,y_,x_,__,new zt)),r&&(y_.fromBufferAttribute(r,s),x_.fromBufferAttribute(r,a),__.fromBufferAttribute(r,o),l.uv1=Pn.getInterpolation(S_,m_,b_,v_,y_,x_,__,new zt)),n&&(E_.fromBufferAttribute(n,s),w_.fromBufferAttribute(n,a),C_.fromBufferAttribute(n,o),l.normal=Pn.getInterpolation(S_,m_,b_,v_,E_,w_,C_,new me),l.normal.dot(t.direction)>0&&l.normal.multiplyScalar(-1));const e={a:s,b:a,c:o,normal:new me,materialIndex:0};Pn.getNormal(m_,b_,v_,e.normal),l.face=e,l.faceIndex=s}return l}function I_(t,e,n,i,r){const s=3*i;let a=s+0,o=s+1,c=s+2;const l=t.index;t.index&&(a=l.getX(a),o=l.getX(o),c=l.getX(c));const{position:h,normal:u,uv:d,uv1:p}=t.attributes,f=M_(n,h,u,d,p,a,o,c,e);return f?(f.faceIndex=i,r&&r.push(f),f):null}function T_(t,e,n,i){const r=t.a,s=t.b,a=t.c;let o=e,c=e+1,l=e+2;n&&(o=n.getX(o),c=n.getX(c),l=n.getX(l)),r.x=i.getX(o),r.y=i.getY(o),r.z=i.getZ(o),s.x=i.getX(c),s.y=i.getY(c),s.z=i.getZ(c),a.x=i.getX(l),a.y=i.getY(l),a.z=i.getZ(l)}function B_(t,e,n,i,r,s,a){const{geometry:o}=n,{index:c}=o,l=o.attributes.position;for(let n=t,o=e+t;n<o;n++){let t;if(t=n,T_(a,3*t,c,l),a.needsUpdate=!0,i(a,t,r,s))return!0}return!1}function R_(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const n=t.geometry,i=n.index?n.index.array:null,r=n.attributes.position;let s,a,o,c,l=0;const h=t._roots;for(let t=0,e=h.length;t<e;t++)s=h[t],a=new Uint32Array(s),o=new Uint16Array(s),c=new Float32Array(s),u(0,l),l+=s.byteLength;function u(t,n,s=!1){const l=2*t;if(o[l+15]===Ax){const e=a[t+6];let n=1/0,s=1/0,h=1/0,u=-1/0,d=-1/0,p=-1/0;for(let t=3*e,a=3*(e+o[l+14]);t<a;t++){let e=i[t];const a=r.getX(e),o=r.getY(e),c=r.getZ(e);a<n&&(n=a),a>u&&(u=a),o<s&&(s=o),o>d&&(d=o),c<h&&(h=c),c>p&&(p=c)}return(c[t+0]!==n||c[t+1]!==s||c[t+2]!==h||c[t+3]!==u||c[t+4]!==d||c[t+5]!==p)&&(c[t+0]=n,c[t+1]=s,c[t+2]=h,c[t+3]=u,c[t+4]=d,c[t+5]=p,!0)}{const i=t+8,r=a[t+6],o=i+n,l=r+n;let h=s,d=!1,p=!1;e?h||(d=e.has(o),p=e.has(l),h=!d&&!p):(d=!0,p=!0);const f=h||p;let A=!1;(h||d)&&(A=u(i,n,h));let g=!1;f&&(g=u(r,n,h));const m=A||g;if(m)for(let e=0;e<3;e++){const n=i+e,s=r+e,a=c[n],o=c[n+3],l=c[s],h=c[s+3];c[t+e]=a<l?a:l,c[t+e+3]=o>h?o:h}return m}}}function P_(t,e,n){let i,r,s,a,o,c;const l=1/n.direction.x,h=1/n.direction.y,u=1/n.direction.z,d=n.origin.x,p=n.origin.y,f=n.origin.z;let A=e[t],g=e[t+3],m=e[t+1],b=e[t+3+1],v=e[t+2],y=e[t+3+2];return l>=0?(i=(A-d)*l,r=(g-d)*l):(i=(g-d)*l,r=(A-d)*l),h>=0?(s=(m-p)*h,a=(b-p)*h):(s=(b-p)*h,a=(m-p)*h),!(i>a||s>r)&&((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),u>=0?(o=(v-f)*u,c=(y-f)*u):(o=(y-f)*u,c=(v-f)*u),!(i>c||o>r)&&((c<r||r!=r)&&(r=c),!(r<0)))}function D_(t,e,n,i,r,s,a){const{geometry:o}=n,{index:c}=o,l=o.attributes.position;for(let o=t,h=e+t;o<h;o++){let t;if(t=n.resolveTriangleIndex(o),T_(a,3*t,c,l),a.needsUpdate=!0,i(a,t,r,s))return!0}return!1}function L_(t,e,n,i,r){c_.setBuffer(t._roots[e]),U_(0,t,n,i,r),c_.clearBuffer()}function U_(t,e,n,i,r){const{float32Array:s,uint16Array:a,uint32Array:o}=c_,c=2*t;if(Fx(c,a)){!function(t,e,n,i,r,s){const{geometry:a,_indirectBuffer:o}=t;for(let t=i,o=i+r;t<o;t++)I_(a,e,n,t,s)}(e,n,i,Nx(t,o),kx(c,a),r)}else{const a=Ox(t);P_(a,s,i)&&U_(a,e,n,i,r);const c=Qx(t,o);P_(c,s,i)&&U_(c,e,n,i,r)}}const F_=["x","y","z"];function N_(t,e,n,i){c_.setBuffer(t._roots[e]);const r=k_(0,t,n,i);return c_.clearBuffer(),r}function k_(t,e,n,i){const{float32Array:r,uint16Array:s,uint32Array:a}=c_;let o=2*t;if(Fx(o,s)){return function(t,e,n,i,r){const{geometry:s,_indirectBuffer:a}=t;let o=1/0,c=null;for(let t=i,a=i+r;t<a;t++){let i;i=I_(s,e,n,t),i&&i.distance<o&&(c=i,o=i.distance)}return c}(e,n,i,Nx(t,a),kx(o,s))}{const s=Gx(t,a),o=F_[s],c=i.direction[o]>=0;let l,h;c?(l=Ox(t),h=Qx(t,a)):(l=Qx(t,a),h=Ox(t));const u=P_(l,r,i)?k_(l,e,n,i):null;if(u){const t=u.point[o];if(c?t<=r[h+s]:t>=r[h+s+3])return u}const d=P_(h,r,i)?k_(h,e,n,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const O_=new ye,Q_=new i_,G_=new i_,H_=new qe,z_=new r_,j_=new r_;function V_(t,e,n,i){c_.setBuffer(t._roots[e]);const r=W_(0,t,n,i);return c_.clearBuffer(),r}function W_(t,e,n,i,r=null){const{float32Array:s,uint16Array:a,uint32Array:o}=c_;let c=2*t;null===r&&(n.boundingBox||n.computeBoundingBox(),z_.set(n.boundingBox.min,n.boundingBox.max,i),r=z_);if(!Fx(c,a)){const a=t+8,c=o[t+6];Ex(a,s,O_);if(r.intersectsBox(O_)&&W_(a,e,n,i,r))return!0;Ex(c,s,O_);return!!(r.intersectsBox(O_)&&W_(c,e,n,i,r))}{const r=e.geometry,l=r.index,h=r.attributes.position,u=n.index,d=n.attributes.position,p=Nx(t,o),f=kx(c,a);if(H_.copy(i).invert(),n.boundsTree){Ex(t,s,j_),j_.matrix.copy(H_),j_.needsUpdate=!0;const e=n.boundsTree.shapecast({intersectsBounds:t=>j_.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let e=3*p,n=3*(f+p);e<n;e+=3)if(T_(G_,e,l,h),G_.needsUpdate=!0,t.intersectsTriangle(G_))return!0;return!1}});return e}for(let t=3*p,e=3*(f+p);t<e;t+=3){T_(Q_,t,l,h),Q_.a.applyMatrix4(H_),Q_.b.applyMatrix4(H_),Q_.c.applyMatrix4(H_),Q_.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(T_(G_,t,u,d),G_.needsUpdate=!0,Q_.intersectsTriangle(G_))return!0}}}const q_=new qe,X_=new r_,Y_=new r_,J_=new me,K_=new me,Z_=new me,$_=new me;function tE(t,e,n,i={},r={},s=0,a=1/0){e.boundingBox||e.computeBoundingBox(),X_.set(e.boundingBox.min,e.boundingBox.max,n),X_.needsUpdate=!0;const o=t.geometry,c=o.attributes.position,l=o.index,h=e.attributes.position,u=e.index,d=o_.getPrimitive(),p=o_.getPrimitive();let f=J_,A=K_,g=null,m=null;r&&(g=Z_,m=$_);let b=1/0,v=null,y=null;return q_.copy(n).invert(),Y_.matrix.copy(q_),t.shapecast({boundsTraverseOrder:t=>X_.distanceToBox(t),intersectsBounds:(t,e,n)=>n<b&&n<a&&(e&&(Y_.min.copy(t.min),Y_.max.copy(t.max),Y_.needsUpdate=!0),!0),intersectsRange:(t,i)=>{if(e.boundsTree){return e.boundsTree.shapecast({boundsTraverseOrder:t=>Y_.distanceToBox(t),intersectsBounds:(t,e,n)=>n<b&&n<a,intersectsRange:(e,r)=>{for(let a=e,o=e+r;a<o;a++){T_(p,3*a,u,h),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=t,n=t+i;e<n;e++){T_(d,3*e,l,c),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,g);if(t<b&&(A.copy(f),m&&m.copy(g),b=t,v=e,y=a),t<s)return!0}}}})}for(let r=0,a=bx(e);r<a;r++){T_(p,3*r,u,h),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=t,n=t+i;e<n;e++){T_(d,3*e,l,c),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,g);if(t<b&&(A.copy(f),m&&m.copy(g),b=t,v=e,y=r),t<s)return!0}}}}),o_.releasePrimitive(d),o_.releasePrimitive(p),b===1/0?null:(i.point?i.point.copy(A):i.point=A.clone(),i.distance=b,i.faceIndex=v,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(q_),A.applyMatrix4(q_),r.distance=A.sub(r.point).length(),r.faceIndex=y),i)}function eE(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const n=t.geometry,i=n.index?n.index.array:null,r=n.attributes.position;let s,a,o,c,l=0;const h=t._roots;for(let t=0,e=h.length;t<e;t++)s=h[t],a=new Uint32Array(s),o=new Uint16Array(s),c=new Float32Array(s),u(0,l),l+=s.byteLength;function u(n,s,l=!1){const h=2*n;if(o[h+15]===Ax){const e=a[n+6];let s=1/0,l=1/0,u=1/0,d=-1/0,p=-1/0,f=-1/0;for(let n=e,a=e+o[h+14];n<a;n++){const e=3*t.resolveTriangleIndex(n);for(let t=0;t<3;t++){let n=e+t;n=i?i[n]:n;const a=r.getX(n),o=r.getY(n),c=r.getZ(n);a<s&&(s=a),a>d&&(d=a),o<l&&(l=o),o>p&&(p=o),c<u&&(u=c),c>f&&(f=c)}}return(c[n+0]!==s||c[n+1]!==l||c[n+2]!==u||c[n+3]!==d||c[n+4]!==p||c[n+5]!==f)&&(c[n+0]=s,c[n+1]=l,c[n+2]=u,c[n+3]=d,c[n+4]=p,c[n+5]=f,!0)}{const t=n+8,i=a[n+6],r=t+s,o=i+s;let h=l,d=!1,p=!1;e?h||(d=e.has(r),p=e.has(o),h=!d&&!p):(d=!0,p=!0);const f=h||p;let A=!1;(h||d)&&(A=u(t,s,h));let g=!1;f&&(g=u(i,s,h));const m=A||g;if(m)for(let e=0;e<3;e++){const r=t+e,s=i+e,a=c[r],o=c[r+3],l=c[s],h=c[s+3];c[n+e]=a<l?a:l,c[n+e+3]=o>h?o:h}return m}}}function nE(t,e,n,i,r){c_.setBuffer(t._roots[e]),iE(0,t,n,i,r),c_.clearBuffer()}function iE(t,e,n,i,r){const{float32Array:s,uint16Array:a,uint32Array:o}=c_,c=2*t;if(Fx(c,a)){!function(t,e,n,i,r,s){const{geometry:a,_indirectBuffer:o}=t;for(let t=i,c=i+r;t<c;t++)I_(a,e,n,o?o[t]:t,s)}(e,n,i,Nx(t,o),kx(c,a),r)}else{const a=Ox(t);P_(a,s,i)&&iE(a,e,n,i,r);const c=Qx(t,o);P_(c,s,i)&&iE(c,e,n,i,r)}}const rE=["x","y","z"];function sE(t,e,n,i){c_.setBuffer(t._roots[e]);const r=aE(0,t,n,i);return c_.clearBuffer(),r}function aE(t,e,n,i){const{float32Array:r,uint16Array:s,uint32Array:a}=c_;let o=2*t;if(Fx(o,s)){return function(t,e,n,i,r){const{geometry:s,_indirectBuffer:a}=t;let o=1/0,c=null;for(let t=i,l=i+r;t<l;t++){let i;i=I_(s,e,n,a?a[t]:t),i&&i.distance<o&&(c=i,o=i.distance)}return c}(e,n,i,Nx(t,a),kx(o,s))}{const s=Gx(t,a),o=rE[s],c=i.direction[o]>=0;let l,h;c?(l=Ox(t),h=Qx(t,a)):(l=Qx(t,a),h=Ox(t));const u=P_(l,r,i)?aE(l,e,n,i):null;if(u){const t=u.point[o];if(c?t<=r[h+s]:t>=r[h+s+3])return u}const d=P_(h,r,i)?aE(h,e,n,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const oE=new ye,cE=new i_,lE=new i_,hE=new qe,uE=new r_,dE=new r_;function pE(t,e,n,i){c_.setBuffer(t._roots[e]);const r=fE(0,t,n,i);return c_.clearBuffer(),r}function fE(t,e,n,i,r=null){const{float32Array:s,uint16Array:a,uint32Array:o}=c_;let c=2*t;null===r&&(n.boundingBox||n.computeBoundingBox(),uE.set(n.boundingBox.min,n.boundingBox.max,i),r=uE);if(!Fx(c,a)){const a=t+8,c=o[t+6];Ex(a,s,oE);if(r.intersectsBox(oE)&&fE(a,e,n,i,r))return!0;Ex(c,s,oE);return!!(r.intersectsBox(oE)&&fE(c,e,n,i,r))}{const r=e.geometry,l=r.index,h=r.attributes.position,u=n.index,d=n.attributes.position,p=Nx(t,o),f=kx(c,a);if(hE.copy(i).invert(),n.boundsTree){Ex(t,s,dE),dE.matrix.copy(hE),dE.needsUpdate=!0;const r=n.boundsTree.shapecast({intersectsBounds:t=>dE.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let n=p,i=f+p;n<i;n++)if(T_(lE,3*e.resolveTriangleIndex(n),l,h),lE.needsUpdate=!0,t.intersectsTriangle(lE))return!0;return!1}});return r}for(let t=p,n=f+p;t<n;t++){const n=e.resolveTriangleIndex(t);T_(cE,3*n,l,h),cE.a.applyMatrix4(hE),cE.b.applyMatrix4(hE),cE.c.applyMatrix4(hE),cE.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(T_(lE,t,u,d),lE.needsUpdate=!0,cE.intersectsTriangle(lE))return!0}}}const AE=new qe,gE=new r_,mE=new r_,bE=new me,vE=new me,yE=new me,xE=new me;function _E(t,e,n,i={},r={},s=0,a=1/0){e.boundingBox||e.computeBoundingBox(),gE.set(e.boundingBox.min,e.boundingBox.max,n),gE.needsUpdate=!0;const o=t.geometry,c=o.attributes.position,l=o.index,h=e.attributes.position,u=e.index,d=o_.getPrimitive(),p=o_.getPrimitive();let f=bE,A=vE,g=null,m=null;r&&(g=yE,m=xE);let b=1/0,v=null,y=null;return AE.copy(n).invert(),mE.matrix.copy(AE),t.shapecast({boundsTraverseOrder:t=>gE.distanceToBox(t),intersectsBounds:(t,e,n)=>n<b&&n<a&&(e&&(mE.min.copy(t.min),mE.max.copy(t.max),mE.needsUpdate=!0),!0),intersectsRange:(i,r)=>{if(e.boundsTree){const o=e.boundsTree;return o.shapecast({boundsTraverseOrder:t=>mE.distanceToBox(t),intersectsBounds:(t,e,n)=>n<b&&n<a,intersectsRange:(e,a)=>{for(let x=e,_=e+a;x<_;x++){const e=o.resolveTriangleIndex(x);T_(p,3*e,u,h),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=i,n=i+r;e<n;e++){const n=t.resolveTriangleIndex(e);T_(d,3*n,l,c),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,g);if(i<b&&(A.copy(f),m&&m.copy(g),b=i,v=e,y=x),i<s)return!0}}}})}for(let a=0,o=bx(e);a<o;a++){T_(p,3*a,u,h),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=i,n=i+r;e<n;e++){const n=t.resolveTriangleIndex(e);T_(d,3*n,l,c),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,g);if(i<b&&(A.copy(f),m&&m.copy(g),b=i,v=e,y=a),i<s)return!0}}}}),o_.releasePrimitive(d),o_.releasePrimitive(p),b===1/0?null:(i.point?i.point.copy(A):i.point=A.clone(),i.distance=b,i.faceIndex=v,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(AE),A.applyMatrix4(AE),r.distance=A.sub(r.point).length(),r.faceIndex=y),i)}const EE=new c_.constructor,wE=new c_.constructor,CE=new s_((()=>new ye)),SE=new ye,ME=new ye,IE=new ye,TE=new ye;let BE=!1;function RE(t,e,n,i,r,s=0,a=0,o=0,c=0,l=null,h=!1){let u,d;h?(u=wE,d=EE):(u=EE,d=wE);const p=u.float32Array,f=u.uint32Array,A=u.uint16Array,g=d.float32Array,m=d.uint32Array,b=d.uint16Array,v=2*e,y=Fx(2*t,A),x=Fx(v,b);let _=!1;if(x&&y)_=h?r(Nx(e,m),kx(2*e,b),Nx(t,f),kx(2*t,A),c,a+e,o,s+t):r(Nx(t,f),kx(2*t,A),Nx(e,m),kx(2*e,b),o,s+t,c,a+e);else if(x){const l=CE.getPrimitive();Ex(e,g,l),l.applyMatrix4(n);const u=Ox(t),d=Qx(t,f);Ex(u,p,SE),Ex(d,p,ME);const A=l.intersectsBox(SE),m=l.intersectsBox(ME);_=A&&RE(e,u,i,n,r,a,s,c,o+1,l,!h)||m&&RE(e,d,i,n,r,a,s,c,o+1,l,!h),CE.releasePrimitive(l)}else{const u=Ox(e),d=Qx(e,m);Ex(u,g,IE),Ex(d,g,TE);const A=l.intersectsBox(IE),b=l.intersectsBox(TE);if(A&&b)_=RE(t,u,n,i,r,s,a,o,c+1,l,h)||RE(t,d,n,i,r,s,a,o,c+1,l,h);else if(A)if(y)_=RE(t,u,n,i,r,s,a,o,c+1,l,h);else{const e=CE.getPrimitive();e.copy(IE).applyMatrix4(n);const l=Ox(t),d=Qx(t,f);Ex(l,p,SE),Ex(d,p,ME);const A=e.intersectsBox(SE),g=e.intersectsBox(ME);_=A&&RE(u,l,i,n,r,a,s,c,o+1,e,!h)||g&&RE(u,d,i,n,r,a,s,c,o+1,e,!h),CE.releasePrimitive(e)}else if(b)if(y)_=RE(t,d,n,i,r,s,a,o,c+1,l,h);else{const e=CE.getPrimitive();e.copy(TE).applyMatrix4(n);const l=Ox(t),u=Qx(t,f);Ex(l,p,SE),Ex(u,p,ME);const A=e.intersectsBox(SE),g=e.intersectsBox(ME);_=A&&RE(d,l,i,n,r,a,s,c,o+1,e,!h)||g&&RE(d,u,i,n,r,a,s,c,o+1,e,!h),CE.releasePrimitive(e)}}return _}const PE=new r_,DE=new ye,LE={strategy:cx,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class UE{static serialize(t,e={}){e={cloneBuffers:!0,...e};const n=t.geometry,i=t._roots,r=t._indirectBuffer,s=n.getIndex();let a;return a=e.cloneBuffers?{roots:i.map((t=>t.slice())),index:s?s.array.slice():null,indirectBuffer:r?r.slice():null}:{roots:i,index:s?s.array:null,indirectBuffer:r},a}static deserialize(t,e,n={}){n={setIndex:!0,indirect:Boolean(t.indirectBuffer),...n};const{index:i,roots:r,indirectBuffer:s}=t,a=new UE(e,{...n,[mx]:!0});if(a._roots=r,a._indirectBuffer=s||null,n.setIndex){const n=e.getIndex();if(null===n){const n=new qn(t.index,1,!1);e.setIndex(n)}else n.array!==i&&(n.array.set(i),n.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({...LE,[mx]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[mx]||(Kx(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new ye)));const{_indirectBuffer:n}=this;this.resolveTriangleIndex=e.indirect?t=>n[t]:t=>t}refit(t=null){return(this.indirect?eE:R_)(this,t)}traverse(t,e=0){const n=this._roots[e],i=new Uint32Array(n),r=new Uint16Array(n);!function e(s,a=0){const o=2*s,c=r[o+15]===Ax;if(c){const e=i[s+6],l=r[o+14];t(a,c,new Float32Array(n,4*s,6),e,l)}else{const r=s+fx/4,o=i[s+6],l=i[s+7];t(a,c,new Float32Array(n,4*s,6),l)||(e(r,a+1),e(o,a+1))}}(0)}raycast(t,e=u){const n=this._roots,i=this.geometry,r=[],s=e.isMaterial,a=Array.isArray(e),o=i.groups,c=s?e.side:e,l=this.indirect?nE:L_;for(let i=0,s=n.length;i<s;i++){const n=a?e[o[i].materialIndex].side:c,s=r.length;if(l(this,i,n,t,r),a){const t=o[i].materialIndex;for(let e=s,n=r.length;e<n;e++)r[e].face.materialIndex=t}}return r}raycastFirst(t,e=u){const n=this._roots,i=this.geometry,r=e.isMaterial,s=Array.isArray(e);let a=null;const o=i.groups,c=r?e.side:e,l=this.indirect?sE:N_;for(let i=0,r=n.length;i<r;i++){const n=l(this,i,s?e[o[i].materialIndex].side:c,t);null!=n&&(null==a||n.distance<a.distance)&&(a=n,s&&(n.face.materialIndex=o[i].materialIndex))}return a}intersectsGeometry(t,e){let n=!1;const i=this._roots,r=this.indirect?pE:V_;for(let s=0,a=i.length;s<a&&(n=r(this,s,t,e),!n);s++);return n}shapecast(t){const e=o_.getPrimitive(),n=this.indirect?D_:B_;let{boundsTraverseOrder:i,intersectsBounds:r,intersectsRange:s,intersectsTriangle:a}=t;if(s&&a){const t=s;s=(i,r,s,o,c)=>!!t(i,r,s,o,c)||n(i,r,this,a,s,o,e)}else s||(s=a?(t,i,r,s)=>n(t,i,this,a,r,s,e):(t,e,n)=>n);let o=!1,c=0;const l=this._roots;for(let t=0,e=l.length;t<e;t++){const e=l[t];if(o=p_(this,t,r,s,i,c),o)break;c+=e.byteLength}return o_.releasePrimitive(e),o}bvhcast(t,e,n){let{intersectsRanges:i,intersectsTriangles:r}=n;const s=o_.getPrimitive(),a=this.geometry.index,o=this.geometry.attributes.position,c=this.indirect?t=>{const e=this.resolveTriangleIndex(t);T_(s,3*e,a,o)}:t=>{T_(s,3*t,a,o)},l=o_.getPrimitive(),h=t.geometry.index,u=t.geometry.attributes.position,d=t.indirect?e=>{const n=t.resolveTriangleIndex(e);T_(l,3*n,h,u)}:t=>{T_(l,3*t,h,u)};if(r){const t=(t,n,i,a,o,h,u,p)=>{for(let f=i,A=i+a;f<A;f++){d(f),l.a.applyMatrix4(e),l.b.applyMatrix4(e),l.c.applyMatrix4(e),l.needsUpdate=!0;for(let e=t,i=t+n;e<i;e++)if(c(e),s.needsUpdate=!0,r(s,l,e,f,o,h,u,p))return!0}return!1};if(i){const e=i;i=function(n,i,r,s,a,o,c,l){return!!e(n,i,r,s,a,o,c,l)||t(n,i,r,s,a,o,c,l)}}else i=t}return function(t,e,n,i){if(BE)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");BE=!0;const r=t._roots,s=e._roots;let a,o=0,c=0;const l=(new qe).copy(n).invert();for(let t=0,e=r.length;t<e;t++){EE.setBuffer(r[t]),c=0;const e=CE.getPrimitive();Ex(0,EE.float32Array,e),e.applyMatrix4(l);for(let r=0,h=s.length;r<h&&(wE.setBuffer(s[t]),a=RE(0,0,n,l,i,o,c,0,0,e),wE.clearBuffer(),c+=s[r].length,!a);r++);if(CE.releasePrimitive(e),EE.clearBuffer(),o+=r[t].length,a)break}return BE=!1,a}(this,t,e,i)}intersectsBox(t,e){return PE.set(t.min,t.max,e),PE.needsUpdate=!0,this.shapecast({intersectsBounds:t=>PE.intersectsBox(t),intersectsTriangle:t=>PE.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},i={},r=0,s=1/0){return(this.indirect?_E:tE)(this,t,e,n,i,r,s)}closestPointToPoint(t,e={},n=0,i=1/0){return function(t,e,n={},i=0,r=1/0){const s=i*i,a=r*r;let o=1/0,c=null;if(t.shapecast({boundsTraverseOrder:t=>(A_.copy(e).clamp(t.min,t.max),A_.distanceToSquared(e)),intersectsBounds:(t,e,n)=>n<o&&n<a,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,A_);const i=e.distanceToSquared(A_);return i<o&&(g_.copy(A_),o=i,c=n),i<s}}),o===1/0)return null;const l=Math.sqrt(o);return n.point?n.point.copy(g_):n.point=g_.clone(),n.distance=l,n.faceIndex=c,n}(this,t,e,n,i)}getBoundingBox(t){t.makeEmpty();return this._roots.forEach((e=>{Ex(0,new Float32Array(e),DE),t.union(DE)})),t}}function FE(t,e,n){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(n.ray.origin),t.object=e,t.distance<n.near||t.distance>n.far?null:t)}const NE=new We,kE=new qe,OE=_i.prototype.raycast;function QE(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;kE.copy(this.matrixWorld).invert(),NE.copy(t.ray).applyMatrix4(kE);const n=this.geometry.boundsTree;if(!0===t.firstHitOnly){const i=FE(n.raycastFirst(NE,this.material),this,t);i&&e.push(i)}else{const i=n.raycast(NE,this.material);for(let n=0,r=i.length;n<r;n++){const r=FE(i[n],this,t);r&&e.push(r)}}}else OE.call(this,t,e)}const GE={as:"pointerEvents",type:"number",stage:4,map:{auto:1,visible:1,none:0,all:2}};let HE=yu;let zE=yu;let jE=yu;const VE=String.raw;let WE=window.document.styleSheets[0];WE||(document.head.appendChild(document.createElement("style")),WE=window.document.styleSheets[0]);const qE=VE`<style>

sh-scene a, .clickable {
  position: absolute;
  contain: strict;
  cursor: pointer;
  border-radius: 1em;
}

@media (any-pointer: fine) {
  sh-scene a, .clickable {
    pointer-events: none;
  }
}

</style>`;for(const t of qE.split("\n\n").slice(1,-1))WE.insertRule(t,WE.cssRules.length);class XE{constructor(t){t=t||{};const e=this;function n(n,i){e[n]=n in t?t[n]:i}n("color",""),n("image","none"),n("attachment","scroll"),n("clip","border-box"),n("origin","padding-box"),n("position","0% 0%"),n("repeat","repeat"),n("size","auto")}toString(){const t=[this.image,this.repeat,this.attachment,this.position+" / "+this.size,this.origin,this.clip];return this.color&&t.unshift(this.color),t.join(" ")}}function YE(t){return t.trim()}function JE(t){return(t||"").split(",").map(YE)}const KE=function(t){const e=[];if(null==t)return e;const n=function(t){const e=[],n=/[,()]/;let i=0,r="";if(null==t)return e;for(;t.length;){const s=n.exec(t);if(!s)break;let a=!1;switch(s[0]){case",":i||(e.push(r.trim()),r="",a=!0);break;case"(":i++;break;case")":i--}const o=s.index+1;r+=t.slice(0,a?o-1:o),t=t.slice(o)}return(r.length||t.length)&&e.push((r+t).trim()),e}(t.backgroundImage),i=t.backgroundColor,r=JE(t.backgroundAttachment),s=JE(t.backgroundClip),a=JE(t.backgroundOrigin),o=JE(t.backgroundPosition),c=JE(t.backgroundRepeat),l=JE(t.backgroundSize);let h;for(let t=0,u=n.length;t<u;t++)h=new XE({image:n[t],attachment:r[t%r.length],clip:s[t%s.length],origin:a[t%a.length],position:o[t%o.length],repeat:c[t%c.length],size:l[t%l.length]}),t===u-1&&(h.color=i),e.push(h);return e};function ZE(t,e,n,i,r){return"%"===e?r*parseFloat(t)*.01:"vw"===e?n*parseFloat(t)*.01:"vh"===e?i*parseFloat(t)*.01:"vmax"===e?Math.max(n,i)*parseFloat(t)*.01:"vmin"===e?Math.min(n,i)*parseFloat(t)*.01:"em"===e||"rem"===e||"cap"===e||"ch"===e||"ex"===e||"ic"===e||"lh"===e?16*parseFloat(t):"px"===e?parseFloat(t):void 0}const $E=document.createElement("div");$E.style.display="none";const tw=window.getComputedStyle($E);const ew=document.createElement("canvas");function nw(t,e,n,i,r=e,s=n){if("auto"===t)return i.width=r,void(i.height=n);if("contain"===t)return void(r<s?(i.width=r,i.height=n):(i.width=e,i.height=s));if("cover"===t)return void(r<s?(i.width=e,i.height=e*s/r):(i.height=n,i.width=n*r/s));const a=t.trim().match(/^(auto|([\d.]+)([^\s]+))\s*(|auto|([\d.]+)([^\s]+))$/);if(a){let[,t,o,c,l,h,u]=a;return t="auto"===t,l="auto"===l||""===l,t||(i.width=ZE(o,c,e,n,r)),l||(i.height=ZE(h,u,e,n,s)),void(l&&t?(i.width=r,i.height=s):t?i.width=i.height*r/s:l&&(i.height=i.width*s/r))}}function iw(t,e){if("deg"===e)return parseFloat(t)*Math.PI/180;if("rad"===e)return parseFloat(t);if("grad"===e)return parseFloat(t)*Math.PI/200;if("turn"===e)return parseFloat(t)*Math.PI*2;throw Error("Unrecognised angle unit: "+e)}const rw=/^(left|top|right|bottom|center)?\s*(([\d.]+)([^\s]+))?\s*(left|top|right|bottom|center)?\s*(([\d.]+)([^\s]+))?$/;function sw(t,e,n,i,r){let[,s,,a,o,c,,l,h]=t.trim().match(rw);const u=e-i,d=n-r;s&&a&&c&&l||(!s||a||c||l?s&&!a&&c&&!l?(a=0,o="px",l=0,h="px"):s&&a&&!c&&!l?(l=a,h=o,c="top",a=0,o="px"):s&&a&&c&&!l?(l=0,h="px"):s&&!a&&c&&l?(a=0,o="px"):!s&&a&&!c&&l&&(s="left",c="top"):(a=0,o="px",l=0,h="px",c="center"===s?"center":"top")),void 0===o&&(o="px"),void 0===h&&(h="px"),void 0===a&&(a=0),void 0===l&&(l=0);const p=[void 0,void 0];for(const[t,i,r]of[[s,a,o],[c,l,h]]){let s,a,o;if("left"===t)s=u,a=1,o=0;else if("right"===t)s=u,a=-1,o=0;else if("top"===t)s=d,a=1,o=1;else{if("bottom"!==t)continue;s=d,a=-1,o=1}p[o]=ZE(i,r,e,n,s),p[o]*=a,"left"===t&&(p[o]+=0),"top"===t&&(p[o]+=0),"right"===t&&(p[o]+=u),"bottom"===t&&(p[o]+=d)}if("center"===s){const t=p.indexOf(void 0);p[t]=.5*(t?d:u)}if("center"===c){const t=p.indexOf(void 0);p[t]=.5*(t?d:u)}return p}function aw(t,e,n,i,r){if(i&&i.length)for(let n=1;n<=i.length;n++)t.addColorStop(r+n*(e-r)/(i.length+1),i[n-1]);return e<=1&&t.addColorStop(e,n),e}const ow=new zt,cw=new zt,lw=new zt(0,0),hw=new zt,uw=new zt,dw=/^((?<shape>circle|ellipse)\s*)?(?<sizeConfig>((?<ellipseX>[\d.]+)%\s+(?<ellipseY>[\d.]+)%)|(?<circleSizeValue>[\d.]+)(?<circleSizeUnit>[^0-9\s]+)|closest-side|closest-corner|farthest-side|farthest-corner)?\s*(at\s+(?<position>.+))?$/;async function pw(t,e){const n=function(t){document.body.appendChild($E),$E.style.background=t;const e=KE(tw);return document.body.removeChild($E),e}(e),i=t.width,r=t.height,s=t.getContext("2d");for(const e of n)if(e.color&&(s.fillStyle=e.color,s.fillRect(0,0,t.width,t.height)),"none"!==e.image){let n,a=!0,[,o,c,l]=e.image.trim().match(/^(repeating-)?(\s*[^(]+)\(\s*(.+)\s*\)$/);if(c=c.trim().toLowerCase(),l=l.trim(),"url"===c)n=await new Promise((n=>{const a=new Image;a.src=l.split('"').join(""),a.addEventListener("load",(()=>{"auto"===e.size?(ew.width=t.width,ew.height=t.height,n(s.createPattern(a,e.repeat))):(nw(e.size,i,r,ew,a.width,a.height),ew.getContext("2d").drawImage(a,0,0,ew.width,ew.height),n(s.createPattern(ew,e.repeat)))}))}));else if("linear-gradient"===c||"conic-gradient"===c||"radial-gradient"===c){nw(e.size,i,r,ew);const t=ew.getContext("2d"),a=l.split(/,(?![^(]*\))/).map((t=>t.trim()));let h,u=1,d=1;if(ow.set(.5*ew.width,.5*ew.height),"linear-gradient"===c){let e=0;const n=a[0].match(/^(([\d.]+)(.+))|(to\s+([^\s]+)\s*([^\s]+)?)$/);n&&(a.shift(),n[5]&&(n[6]?(e=Math.atan(ew.width/ew.height),"right"!==n[5]&&"right"!==n[6]||"bottom"!==n[5]&&"bottom"!==n[6]||(e=Math.PI-e),"left"!==n[5]&&"left"!==n[6]||("bottom"!==n[5]&&"bottom"!==n[6]||(e=Math.PI+e),"top"!==n[5]&&"top"!==n[6]||(e=2*Math.PI-e))):("top"===n[5]&&(e=0),"left"===n[5]&&(e=3*Math.PI/2),"bottom"===n[5]&&(e=Math.PI),"right"===n[5]&&(e=Math.PI/2))),n[2]&&n[3]&&(e=iw(n[2],n[3]))),cw.set(0,-1).rotateAround(lw,e);let i=1/0,r=-1/0;[0,1,2,3].map((t=>{hw.set(ew.width*(1-!(1&t)),ew.height*(1-!(2&t))),hw.subVectors(ow,hw);const e=hw.dot(cw);e<i&&(i=e),e>r&&(r=e)}));const s=[];hw.copy(cw).multiplyScalar(i).add(ow),s[0]=hw.x,s[1]=hw.y,hw.copy(cw).multiplyScalar(r).add(ow),s[2]=hw.x,s[3]=hw.y,h=t.createLinearGradient(...s)}else if("radial-gradient"===c){let e=a[0].match(dw);e?a.shift():e={groups:{}};const n=e.groups.position||"center center";let i,r,s="circle"!==e.groups.shape;if(e.groups.circleSizeUnit&&(s=!1),e.groups.ellipseX&&(s=!0,i=.01*parseFloat(e.groups.ellipseX),r=.01*parseFloat(e.groups.ellipseY)),s){const e=Math.max(ew.width,ew.height),n=(i||1)*ew.width/e,s=(r||1)*ew.height/e;u=e/ew.width,d=e/ew.height,t.setTransform(n,0,0,s,0,0)}const o=sw(n,ew.width*u,ew.height*d,0,0);let c=e.groups.sizeConfig||"farthest-corner";if(e.groups.circleSizeUnit){const n=ZE(e.groups.circleSizeValue,e.groups.circleSizeUnit,ew.width,ew.height,ew.width);h=t.createRadialGradient(...o,0,...o,n)}else{const e=[o[0],o[1],ew.width*u-o[0],ew.height*d-o[1]];hw.set(...o);const n=[uw.set(0,0).sub(hw).length(),uw.set(0,ew.width*u).sub(hw).length(),uw.set(ew.height*d,ew.width*u).sub(hw).length(),uw.set(ew.height*d,0).sub(hw).length()];"closest-side"===c?h=t.createRadialGradient(...o,0,...o,Math.min(...e)):"farthest-side"===c?h=t.createRadialGradient(...o,0,...o,Math.max(...e)):"closest-corner"===c?h=t.createRadialGradient(...o,0,...o,Math.min(...n)):"farthest-corner"===c?h=t.createRadialGradient(...o,0,...o,Math.max(...n)):console.log("Oh dear please report as a bug")}}else if("conic-gradient"===c){let e=a[0].match(/^(?<angle>from\s+(?<angleValue>[\d.]+)(?<angleUnit>[^\s]+))?\s*(at\s+(?<position>.+))?$/);e?a.shift():e={groups:{}};let n=0,i=sw(e.groups.position||"center center",ew.width,ew.height,0,0);e.groups.angle&&(n=iw(e.groups.angleValue,e.groups.angleUnit)),n-=Math.PI/2,h=t.createConicGradient(n,...i)}let p=0,f=0,A="",g=0;const m=[];do{for(let t=0;t<a.length;t++){const e=a[t],n=e.match(/^([\d.]+)%|0$/),i=e.match(/^([\d.]+)(turn|deg|rad|grad)|0$/),r=e.match(/^([\d.]+)([^\s]+)|0$/);if(n)f=aw(h,p+.01*parseFloat(n[1]||0),A,m.splice(0),f);else if(i)f=aw(h,p+iw(i[1],i[2])/(2*Math.PI),A,m.splice(0),f);else if(r)f=aw(h,p+ZE(r[1],r[2],ew.width,ew.height,ew.width)/ew.width,A,m.splice(0),f);else{const n=e.split(/\s+(?![^(]*\))/);let i=[];for(const t of n){const e=t.match(/^([\d.]+)%$|0$/),n=t.match(/^([\d.]+)(turn|deg|rad|grad)$|0$/),r=t.match(/^([\d.]+)([^\s]+)$|0$/);e?i.push(p+.01*parseFloat(e[1]||0)):n?i.push(p+iw(n[1],n[2])/(2*Math.PI)):r?i.push(p+ZE(r[1],r[2],ew.width,ew.height,ew.width)/ew.width):A=t}if(0===t&&(f=aw(h,p,A)),i.length)for(const t of i)f=aw(h,t,A,m.splice(0),f);else 0!==t&&m.push(A)}}p=f}while(o&&p<1&&g++<200);o||(f=aw(h,1,A,m.splice(0),f)),t.fillStyle=h,t.fillRect(0,0,ew.width*u,ew.height*d),n=s.createPattern(ew,e.repeat)}else a=!1,console.warn(this,`${c} is unsupported`);if(a){const a=sw(e.position,t.width,t.height,ew.width,ew.height);s.setTransform(1,0,0,1,...a),s.fillStyle=n,s.fillRect(-i,-r,3*i,3*r)}}}let fw=yu;let Aw=yu;function gw(t,e,n=.1,i=0){const r=e/2,s=t/2,a=i-r,o=2*s-2*n,c=2*r-2*n,l=-1*(2*s-2*n),h=-1*(2*r-2*n);return`path(M ${(n-s).toFixed(4)} ${a.toFixed(4)} h ${o.toFixed(4)} q ${n.toFixed(4)} 0 ${n.toFixed(4)} ${n.toFixed(4)} v ${c.toFixed(4)} q 0 ${n.toFixed(4)} -${n.toFixed(4)} ${n.toFixed(4)} h ${l.toFixed(4)} q ${-n.toFixed(4)} 0 -${n.toFixed(4)} -${n.toFixed(4)} v ${h.toFixed(4)} q 0 ${-n.toFixed(4)} ${n.toFixed(4)} ${-n.toFixed(4)}) `}const mw=[],bw=[];let vw=yu;function yw(t,e,n,i){var r=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(r,yw.prototype),r.expected=e,r.found=n,r.location=i,r.name="SyntaxError",r}function xw(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,t+(n+=n.repeat(e)).slice(0,e))}function _w(t,e,n,i){var r=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(r,_w.prototype),r.expected=e,r.found=n,r.location=i,r.name="SyntaxError",r}function Ew(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,t+(n+=n.repeat(e)).slice(0,e))}function ww(t,e){return t-(e-t)}function Cw(t,e){return t.x=ww(e.x,t.x),t.y=ww(e.y,t.y),t.z=ww(e.z,t.z),t}function Sw(t,e,n,i,r,s,a){n=n*Math.PI/180,t=Math.abs(t),e=Math.abs(e);const o=(s.x-a.x)/2,c=(s.y-a.y)/2,l=Math.cos(n)*o+Math.sin(n)*c,h=-Math.sin(n)*o+Math.cos(n)*c;let u=t*t,d=e*e;const p=l*l,f=h*h,A=p/u+f/d;if(A>1){const n=Math.sqrt(A);u=(t*=n)*t,d=(e*=n)*e}const g=u*f+d*p,m=(u*d-g)/g;let b=Math.sqrt(Math.max(0,m));i===r&&(b=-b);const v=b*t*h/e,y=-b*e*l/t;return[Math.cos(n)*v-Math.sin(n)*y+(s.x+a.x)/2,Math.sin(n)*v+Math.cos(n)*y+(s.y+a.y)/2,Mw(1,0,(l-v)/t,(h-y)/e),Mw((l-v)/t,(h-y)/e,(-l-v)/t,(-h-y)/e)%(2*Math.PI),r,n]}function Mw(t,e,n,i){const r=t*n+e*i,s=Math.sqrt(t*t+e*e)*Math.sqrt(n*n+i*i);let a=Math.acos(Math.max(-1,Math.min(1,r/s)));return t*i-e*n<0&&(a=-a),a}!function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(yw,Error),yw.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n,i=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){i=t[n].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(r):r,a=this.location.source+":"+s.line+":"+s.column;if(i){var o=this.location.end,c=xw("",s.line.toString().length," "),l=i[r.line-1],h=(r.line===o.line?o.column:l.length+1)-r.column||1;e+="\n --\x3e "+a+"\n"+c+" |\n"+s.line+" | "+l+"\n"+c+" | "+xw("",r.column-1," ")+xw("",h,"^")}else e+="\n at "+a}return e},yw.buildMessage=function(t,e){var n={literal:function(t){return'"'+r(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?s(t[0])+"-"+s(t[1]):s(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function i(t){return t.charCodeAt(0).toString(16).toUpperCase()}function r(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function a(t){return n[t.type](t)}return"Expected "+function(t){var e,n,i=t.map(a);if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+r(t)+'"':"end of input"}(e)+" found."},function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(_w,Error),_w.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n,i=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){i=t[n].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(r):r,a=this.location.source+":"+s.line+":"+s.column;if(i){var o=this.location.end,c=Ew("",s.line.toString().length," "),l=i[r.line-1],h=(r.line===o.line?o.column:l.length+1)-r.column||1;e+="\n --\x3e "+a+"\n"+c+" |\n"+s.line+" | "+l+"\n"+c+" | "+Ew("",r.column-1," ")+Ew("",h,"^")}else e+="\n at "+a}return e},_w.buildMessage=function(t,e){var n={literal:function(t){return'"'+r(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?s(t[0])+"-"+s(t[1]):s(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function i(t){return t.charCodeAt(0).toString(16).toUpperCase()}function r(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function a(t){return n[t.type](t)}return"Expected "+function(t){var e,n,i=t.map(a);if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+r(t)+'"':"end of input"}(e)+" found."};const Iw=[function(t,e){var n,i={},r=(e=void 0!==e?e:{}).grammarSource,s={svg_path:Rt},a=Rt,o=",",c=".",l=/^[Mm]/,h=/^[Zz]/,u=/^[Ll]/,d=/^[Hh]/,p=/^[Vv]/,f=/^[Cc]/,A=/^[Ss]/,g=/^[Qq]/,m=/^[Tt]/,b=/^[Aa]/,v=/^[01]/,y=/^[eE]/,x=/^[+\-]/,_=/^[0-9]/,E=/^[ \t\n\r]/,w=Mt(["M","m"],!1,!1),C=Mt(["Z","z"],!1,!1),S=Mt(["L","l"],!1,!1),M=Mt(["H","h"],!1,!1),I=Mt(["V","v"],!1,!1),T=Mt(["C","c"],!1,!1),B=Mt(["S","s"],!1,!1),R=Mt(["Q","q"],!1,!1),P=Mt(["T","t"],!1,!1),D=Mt(["A","a"],!1,!1),L=Mt(["0","1"],!1,!1),U=St(",",!1),F=St(".",!1),N=Mt(["e","E"],!1,!1),k=Mt(["+","-"],!1,!1),O=Mt([["0","9"]],!1,!1),Q=Mt([" ","\t","\n","\r"],!1,!1),G=function(t){if(!t)return[];for(var e=[],n=0;n<t.length;n++)e=e.concat.apply(e,t[n]);var i=e[0];return i&&"m"==i.code&&(delete i.relative,i.code="M"),e},H=function(t,e){return Kt(t,e)},z=function(t,e){return Kt(t,e)},j=function(t,e,n){var i=ie(t,[e]);return n&&(i=i.concat(ie("M"==t?"L":"l",n[1]))),i},V=function(){return ie("Z")},W=function(t,e){return ie(t,e)},q=function(t,e){return Kt(t,e)},X=function(t,e){return ie(t,e.map((function(t){return{x:t}})))},Y=function(t,e){return Kt(t,e)},J=function(t,e){return ie(t,e.map((function(t){return{y:t}})))},K=function(t,e){return ie(t,e)},Z=function(t,e){return Kt(t,e)},$=function(t,e,n){return{x1:t.x,y1:t.y,x2:e.x,y2:e.y,x:n.x,y:n.y}},tt=function(t,e){return ie(t,e)},et=function(t,e){return Kt(t,e)},nt=function(t,e){return{x2:t.x,y2:t.y,x:e.x,y:e.y}},it=function(t,e){return ie(t,e)},rt=function(t,e){return Kt(t,e)},st=function(t,e){return{x1:t.x,y1:t.y,x:e.x,y:e.y}},at=function(t,e){return ie(t,e)},ot=function(t,e){return Kt(t,e)},ct=function(t,e){return ie(t,e)},lt=function(t,e){return Kt(t,e)},ht=function(t,e,n,i,r,s){return{rx:t,ry:e,xAxisRotation:n,largeArc:i,sweep:r,x:s.x,y:s.y}},ut=function(t,e){return{x:t,y:e}},dt=function(t){return 1*t},pt=function(t){return 1*t.join("")},ft=function(t){return"1"==t},At=function(){return""},gt=function(t){return t.join("")},mt=function(t){return t.join("")},bt=function(t){return t.join("")},vt=function(t){return t.join("")},yt=function(){return""},xt=0|e.peg$currPos,_t=[{line:1,column:1}],Et=xt,wt=e.peg$maxFailExpected||[],Ct=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=s[e.startRule]}function St(t,e){return{type:"literal",text:t,ignoreCase:e}}function Mt(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function It(e){var n,i=_t[e];if(i)return i;if(e>=_t.length)n=_t.length-1;else for(n=e;!_t[--n];);for(i={line:(i=_t[n]).line,column:i.column};n<e;)10===t.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return _t[e]=i,i}function Tt(t,e,n){var i=It(t),s=It(e),a={source:r,start:{offset:t,line:i.line,column:i.column},end:{offset:e,line:s.line,column:s.column}};return n&&r&&"function"==typeof r.offset&&(a.start=r.offset(a.start),a.end=r.offset(a.end)),a}function Bt(t){xt<Et||(xt>Et&&(Et=xt,wt=[]),wt.push(t))}function Rt(){var t,e,n,r;for(xt,t=[],e=Jt();e!==i;)t.push(e),e=Jt();for(e=function(){var t,e,n,r,s,a;if(t=xt,e=Pt(),e!==i){for(n=[],r=xt,s=[],a=Jt();a!==i;)s.push(a),a=Jt();for((a=Pt())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;){for(n.push(r),r=xt,s=[],a=Jt();a!==i;)s.push(a),a=Jt();(a=Pt())!==i?r=s=[s,a]:(xt=r,r=i)}t=H(e,n)}else xt=t,t=i;return t}(),e===i&&(e=null),n=[],r=Jt();r!==i;)n.push(r),r=Jt();return G(e)}function Pt(){var e,n,r,s,a,o;if(e=xt,n=function(){var e,n,r,s,a,o,c;e=xt,n=t.charAt(xt),l.test(n)?xt++:(n=i,0===Ct&&Bt(w));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();(s=Qt())!==i?(a=xt,(o=jt())===i&&(o=null),(c=Lt())!==i?a=o=[o,c]:(xt=a,a=i),a===i&&(a=null),e=j(n,s,a)):(xt=e,e=i)}else xt=e,e=i;return e}(),n!==i){for(r=[],s=xt,a=[],o=Jt();o!==i;)a.push(o),o=Jt();for((o=Dt())!==i?s=a=[a,o]:(xt=s,s=i);s!==i;){for(r.push(s),s=xt,a=[],o=Jt();o!==i;)a.push(o),o=Jt();(o=Dt())!==i?s=a=[a,o]:(xt=s,s=i)}e=z(n,r)}else xt=e,e=i;return e}function Dt(){var e;return(e=function(){var e,n;e=xt,n=t.charAt(xt),h.test(n)?xt++:(n=i,0===Ct&&Bt(C));n!==i&&(n=V());return e=n,e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),u.test(n)?xt++:(n=i,0===Ct&&Bt(S));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();(s=Lt())!==i?e=W(n,s):(xt=e,e=i)}else xt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),d.test(n)?xt++:(n=i,0===Ct&&Bt(M));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();(s=Ut())!==i?e=X(n,s):(xt=e,e=i)}else xt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),p.test(n)?xt++:(n=i,0===Ct&&Bt(I));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();(s=Ut())!==i?e=J(n,s):(xt=e,e=i)}else xt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),f.test(n)?xt++:(n=i,0===Ct&&Bt(T));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();s=function(){var t,e,n,r,s,a;if(t=xt,e=Ft(),e!==i){for(n=[],r=xt,(s=jt())===i&&(s=null),(a=Ft())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;)n.push(r),r=xt,(s=jt())===i&&(s=null),(a=Ft())!==i?r=s=[s,a]:(xt=r,r=i);t=Z(e,n)}else xt=t,t=i;return t}(),s!==i?e=K(n,s):(xt=e,e=i)}else xt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),A.test(n)?xt++:(n=i,0===Ct&&Bt(B));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();s=function(){var t,e,n,r,s,a;if(t=xt,e=Nt(),e!==i){for(n=[],r=xt,(s=jt())===i&&(s=null),(a=Nt())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;)n.push(r),r=xt,(s=jt())===i&&(s=null),(a=Nt())!==i?r=s=[s,a]:(xt=r,r=i);t=et(e,n)}else xt=t,t=i;return t}(),s!==i?e=tt(n,s):(xt=e,e=i)}else xt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),g.test(n)?xt++:(n=i,0===Ct&&Bt(R));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();s=function(){var t,e,n,r,s,a;if(t=xt,e=kt(),e!==i){for(n=[],r=xt,(s=jt())===i&&(s=null),(a=kt())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;)n.push(r),r=xt,(s=jt())===i&&(s=null),(a=kt())!==i?r=s=[s,a]:(xt=r,r=i);t=rt(e,n)}else xt=t,t=i;return t}(),s!==i?e=it(n,s):(xt=e,e=i)}else xt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),m.test(n)?xt++:(n=i,0===Ct&&Bt(P));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();s=function(){var t,e,n,r,s,a;if(t=xt,e=Qt(),e!==i){for(n=[],r=xt,(s=jt())===i&&(s=null),(a=Qt())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;)n.push(r),r=xt,(s=jt())===i&&(s=null),(a=Qt())!==i?r=s=[s,a]:(xt=r,r=i);t=ot(e,n)}else xt=t,t=i;return t}(),s!==i?e=at(n,s):(xt=e,e=i)}else xt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=xt,n=t.charAt(xt),b.test(n)?xt++:(n=i,0===Ct&&Bt(D));if(n!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();s=function(){var t,e,n,r,s,a;if(t=xt,e=Ot(),e!==i){for(n=[],r=xt,(s=jt())===i&&(s=null),(a=Ot())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;)n.push(r),r=xt,(s=jt())===i&&(s=null),(a=Ot())!==i?r=s=[s,a]:(xt=r,r=i);t=lt(e,n)}else xt=t,t=i;return t}(),s!==i?e=ct(n,s):(xt=e,e=i)}else xt=e,e=i;return e}()),e}function Lt(){var t,e,n,r,s,a;if(t=xt,(e=Qt())!==i){for(n=[],r=xt,(s=jt())===i&&(s=null),(a=Qt())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;)n.push(r),r=xt,(s=jt())===i&&(s=null),(a=Qt())!==i?r=s=[s,a]:(xt=r,r=i);t=q(e,n)}else xt=t,t=i;return t}function Ut(){var t,e,n,r,s,a;if(t=xt,(e=Ht())!==i){for(n=[],r=xt,(s=jt())===i&&(s=null),(a=Ht())!==i?r=s=[s,a]:(xt=r,r=i);r!==i;)n.push(r),r=xt,(s=jt())===i&&(s=null),(a=Ht())!==i?r=s=[s,a]:(xt=r,r=i);t=Y(e,n)}else xt=t,t=i;return t}function Ft(){var t,e,n,r;return t=xt,(e=Qt())!==i?(jt(),(n=Qt())!==i?(jt(),(r=Qt())!==i?t=$(e,n,r):(xt=t,t=i)):(xt=t,t=i)):(xt=t,t=i),t}function Nt(){var t,e,n;return t=xt,(e=Qt())!==i?(jt(),(n=Qt())!==i?t=nt(e,n):(xt=t,t=i)):(xt=t,t=i),t}function kt(){var t,e,n;return t=xt,(e=Qt())!==i?(jt(),(n=Qt())!==i?t=st(e,n):(xt=t,t=i)):(xt=t,t=i),t}function Ot(){var t,e,n,r,s,a,o;return t=xt,(e=Gt())!==i?(jt(),(n=Gt())!==i?(jt(),(r=Ht())!==i&&jt()!==i&&(s=zt())!==i?(jt(),(a=zt())!==i?(jt(),(o=Qt())!==i?t=ht(e,n,r,s,a,o):(xt=t,t=i)):(xt=t,t=i)):(xt=t,t=i)):(xt=t,t=i)):(xt=t,t=i),t}function Qt(){var t,e,n;return t=xt,(e=Ht())!==i?(jt(),(n=Ht())!==i?t=ut(e,n):(xt=t,t=i)):(xt=t,t=i),t}function Gt(){var t;return xt,(t=Wt())===i&&(t=Yt()),t!==i&&(t=dt(t)),t}function Ht(){var t,e,n;return xt,t=xt,(e=Xt())===i&&(e=null),(n=Wt())!==i?t=e=[e,n]:(xt=t,t=i),t===i&&(t=xt,(e=Xt())===i&&(e=null),(n=Yt())!==i?t=e=[e,n]:(xt=t,t=i)),t!==i&&(t=pt(t)),t}function zt(){var e;return xt,e=t.charAt(xt),v.test(e)?xt++:(e=i,0===Ct&&Bt(L)),e!==i&&(e=ft(e)),e}function jt(){var t,e,n,r,s;if(t=xt,e=[],(n=Jt())!==i)for(;n!==i;)e.push(n),n=Jt();else e=i;if(e!==i){for((n=Vt())===i&&(n=null),r=[],s=Jt();s!==i;)r.push(s),s=Jt();t=e=[e,n,r]}else xt=t,t=i;if(t===i){if(t=xt,e=xt,(n=Vt())!==i){for(r=[],s=Jt();s!==i;)r.push(s),s=Jt();e=n=[n,r]}else xt=e,e=i;e!==i&&(e=At()),t=e}return t}function Vt(){var e;return 44===t.charCodeAt(xt)?(e=o,xt++):(e=i,0===Ct&&Bt(U)),e}function Wt(){var e,n,r;return xt,e=xt,n=function(){var e,n,r,s,a;e=xt,n=xt,r=Yt(),r===i&&(r=null);46===t.charCodeAt(xt)?(s=c,xt++):(s=i,0===Ct&&Bt(F));s!==i&&(a=Yt())!==i?n=r=[r,s,a]:(xt=n,n=i);n===i&&(n=xt,(r=Yt())!==i?(46===t.charCodeAt(xt)?(s=c,xt++):(s=i,0===Ct&&Bt(F)),s!==i?n=r=[r,s]:(xt=n,n=i)):(xt=n,n=i));n!==i&&(n=mt(n));return e=n,e}(),n!==i?((r=qt())===i&&(r=null),e=n=[n,r]):(xt=e,e=i),e===i&&(e=xt,(n=Yt())!==i&&(r=qt())!==i?e=n=[n,r]:(xt=e,e=i)),e!==i&&(e=gt(e)),e}function qt(){var e,n,r,s;return xt,e=xt,n=t.charAt(xt),y.test(n)?xt++:(n=i,0===Ct&&Bt(N)),n!==i?((r=Xt())===i&&(r=null),(s=Yt())!==i?e=n=[n,r,s]:(xt=e,e=i)):(xt=e,e=i),e!==i&&(e=bt(e)),e}function Xt(){var e;return e=t.charAt(xt),x.test(e)?xt++:(e=i,0===Ct&&Bt(k)),e}function Yt(){var e,n;if(xt,e=[],n=t.charAt(xt),_.test(n)?xt++:(n=i,0===Ct&&Bt(O)),n!==i)for(;n!==i;)e.push(n),n=t.charAt(xt),_.test(n)?xt++:(n=i,0===Ct&&Bt(O));else e=i;return e!==i&&(e=vt(e)),e}function Jt(){var e;return xt,e=t.charAt(xt),E.test(e)?xt++:(e=i,0===Ct&&Bt(Q)),e!==i&&(e=yt()),e}function Kt(t,e){if(!e)return[t];for(var n=[t],i=0,r=e.length;i<r;i++)n[i+1]=e[i][1];return n}var Zt,$t,te,ee={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var ne in ee)ee[ne.toUpperCase()]=ee[ne];function ie(t,e){e||(e=[{}]);for(var n=e.length;n--;){var i={code:t,command:ee[t]};for(var r in t==t.toLowerCase()&&(i.relative=!0),e[n])i[r]=e[n][r];e[n]=i}return e}if(n=a(),e.peg$library)return{peg$result:n,peg$currPos:xt,peg$FAILED:i,peg$maxFailExpected:wt,peg$maxFailPos:Et};if(n!==i&&xt===t.length)return n;throw n!==i&&xt<t.length&&Bt({type:"end"}),Zt=wt,$t=Et<t.length?t.charAt(Et):null,te=Et<t.length?Tt(Et,Et+1):Tt(Et,Et),new yw(yw.buildMessage(Zt,$t),Zt,$t,te)},function(t,e){var n,i={},r=(e=void 0!==e?e:{}).grammarSource,s={svg_path:_t},a=_t,o=",",c=".",l=/^[Mm]/,h=/^[Zz]/,u=/^[Ll]/,d=/^[Hh]/,p=/^[Vv]/,f=/^[Cc]/,A=/^[Ss]/,g=/^[Qq]/,m=/^[Tt]/,b=/^[eE]/,v=/^[+\-]/,y=/^[0-9]/,x=/^[ \t\n\r]/,_=bt(["M","m"],!1,!1),E=bt(["Z","z"],!1,!1),w=bt(["L","l"],!1,!1),C=bt(["H","h"],!1,!1),S=bt(["V","v"],!1,!1),M=bt(["C","c"],!1,!1),I=bt(["S","s"],!1,!1),T=bt(["Q","q"],!1,!1),B=bt(["T","t"],!1,!1),R=mt(",",!1),P=mt(".",!1),D=bt(["e","E"],!1,!1),L=bt(["+","-"],!1,!1),U=bt([["0","9"]],!1,!1),F=bt([" ","\t","\n","\r"],!1,!1),N=function(t){if(!t)return[];for(var e=[],n=0;n<t.length;n++)e=e.concat.apply(e,t[n]);var i=e[0];return i&&"m"==i.code&&(delete i.relative,i.code="M"),e},k=function(t,e){return kt(t,e)},O=function(t,e){return kt(t,e)},Q=function(t,e,n){var i=jt(t,[e]);return n&&(i=i.concat(jt("M"==t?"L":"l",n[1]))),i},G=function(){return jt("Z")},H=function(t,e){return jt(t,e)},z=function(t,e){return kt(t,e)},j=function(t,e){return jt(t,e.map((function(t){return{x:t}})))},V=function(t,e){return kt(t,e)},W=function(t,e){return jt(t,e.map((function(t){return{y:t}})))},q=function(t,e){return jt(t,e)},X=function(t,e){return kt(t,e)},Y=function(t,e,n){return{x1:t.x,y1:t.y,z1:t.z,x2:e.x,y2:e.y,z2:e.z,x:n.x,y:n.y,z:n.z}},J=function(t,e){return jt(t,e)},K=function(t,e){return kt(t,e)},Z=function(t,e){return{x2:t.x,y2:t.y,z2:t.z,x:e.x,y:e.y,z:e.z}},$=function(t,e){return jt(t,e)},tt=function(t,e){return kt(t,e)},et=function(t,e){return{x1:t.x,y1:t.y,z1:t.z,x:e.x,y:e.y,z:e.z}},nt=function(t,e){return jt(t,e)},it=function(t,e){return kt(t,e)},rt=function(t,e,n){return{x:t,y:e,z:n}},st=function(t){return 1*t.join("")},at=function(){return""},ot=function(t){return t.join("")},ct=function(t){return t.join("")},lt=function(t){return t.join("")},ht=function(t){return t.join("")},ut=function(){return""},dt=0|e.peg$currPos,pt=[{line:1,column:1}],ft=dt,At=e.peg$maxFailExpected||[],gt=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=s[e.startRule]}function mt(t,e){return{type:"literal",text:t,ignoreCase:e}}function bt(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function vt(e){var n,i=pt[e];if(i)return i;if(e>=pt.length)n=pt.length-1;else for(n=e;!pt[--n];);for(i={line:(i=pt[n]).line,column:i.column};n<e;)10===t.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return pt[e]=i,i}function yt(t,e,n){var i=vt(t),s=vt(e),a={source:r,start:{offset:t,line:i.line,column:i.column},end:{offset:e,line:s.line,column:s.column}};return n&&r&&"function"==typeof r.offset&&(a.start=r.offset(a.start),a.end=r.offset(a.end)),a}function xt(t){dt<ft||(dt>ft&&(ft=dt,At=[]),At.push(t))}function _t(){var t,e,n,r;for(dt,t=[],e=Nt();e!==i;)t.push(e),e=Nt();for(e=function(){var t,e,n,r,s,a;if(t=dt,e=Et(),e!==i){for(n=[],r=dt,s=[],a=Nt();a!==i;)s.push(a),a=Nt();for((a=Et())!==i?r=s=[s,a]:(dt=r,r=i);r!==i;){for(n.push(r),r=dt,s=[],a=Nt();a!==i;)s.push(a),a=Nt();(a=Et())!==i?r=s=[s,a]:(dt=r,r=i)}t=k(e,n)}else dt=t,t=i;return t}(),e===i&&(e=null),n=[],r=Nt();r!==i;)n.push(r),r=Nt();return N(e)}function Et(){var e,n,r,s,a,o;if(e=dt,n=function(){var e,n,r,s,a,o,c;e=dt,n=t.charAt(dt),l.test(n)?dt++:(n=i,0===gt&&xt(_));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();(s=Bt())!==i?(a=dt,(o=Pt())===i&&(o=null),(c=Ct())!==i?a=o=[o,c]:(dt=a,a=i),a===i&&(a=null),e=Q(n,s,a)):(dt=e,e=i)}else dt=e,e=i;return e}(),n!==i){for(r=[],s=dt,a=[],o=Nt();o!==i;)a.push(o),o=Nt();for((o=wt())!==i?s=a=[a,o]:(dt=s,s=i);s!==i;){for(r.push(s),s=dt,a=[],o=Nt();o!==i;)a.push(o),o=Nt();(o=wt())!==i?s=a=[a,o]:(dt=s,s=i)}e=O(n,r)}else dt=e,e=i;return e}function wt(){var e;return(e=function(){var e,n;e=dt,n=t.charAt(dt),h.test(n)?dt++:(n=i,0===gt&&xt(E));n!==i&&(n=G());return e=n,e}())===i&&(e=function(){var e,n,r,s;e=dt,n=t.charAt(dt),u.test(n)?dt++:(n=i,0===gt&&xt(w));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();(s=Ct())!==i?e=H(n,s):(dt=e,e=i)}else dt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=dt,n=t.charAt(dt),d.test(n)?dt++:(n=i,0===gt&&xt(C));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();(s=St())!==i?e=j(n,s):(dt=e,e=i)}else dt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=dt,n=t.charAt(dt),p.test(n)?dt++:(n=i,0===gt&&xt(S));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();(s=St())!==i?e=W(n,s):(dt=e,e=i)}else dt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=dt,n=t.charAt(dt),f.test(n)?dt++:(n=i,0===gt&&xt(M));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();s=function(){var t,e,n,r,s,a;if(t=dt,e=Mt(),e!==i){for(n=[],r=dt,(s=Pt())===i&&(s=null),(a=Mt())!==i?r=s=[s,a]:(dt=r,r=i);r!==i;)n.push(r),r=dt,(s=Pt())===i&&(s=null),(a=Mt())!==i?r=s=[s,a]:(dt=r,r=i);t=X(e,n)}else dt=t,t=i;return t}(),s!==i?e=q(n,s):(dt=e,e=i)}else dt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=dt,n=t.charAt(dt),A.test(n)?dt++:(n=i,0===gt&&xt(I));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();s=function(){var t,e,n,r,s,a;if(t=dt,e=It(),e!==i){for(n=[],r=dt,(s=Pt())===i&&(s=null),(a=It())!==i?r=s=[s,a]:(dt=r,r=i);r!==i;)n.push(r),r=dt,(s=Pt())===i&&(s=null),(a=It())!==i?r=s=[s,a]:(dt=r,r=i);t=K(e,n)}else dt=t,t=i;return t}(),s!==i?e=J(n,s):(dt=e,e=i)}else dt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=dt,n=t.charAt(dt),g.test(n)?dt++:(n=i,0===gt&&xt(T));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();s=function(){var t,e,n,r,s,a;if(t=dt,e=Tt(),e!==i){for(n=[],r=dt,(s=Pt())===i&&(s=null),(a=Tt())!==i?r=s=[s,a]:(dt=r,r=i);r!==i;)n.push(r),r=dt,(s=Pt())===i&&(s=null),(a=Tt())!==i?r=s=[s,a]:(dt=r,r=i);t=tt(e,n)}else dt=t,t=i;return t}(),s!==i?e=$(n,s):(dt=e,e=i)}else dt=e,e=i;return e}())===i&&(e=function(){var e,n,r,s;e=dt,n=t.charAt(dt),m.test(n)?dt++:(n=i,0===gt&&xt(B));if(n!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();s=function(){var t,e,n,r,s,a;if(t=dt,e=Bt(),e!==i){for(n=[],r=dt,(s=Pt())===i&&(s=null),(a=Bt())!==i?r=s=[s,a]:(dt=r,r=i);r!==i;)n.push(r),r=dt,(s=Pt())===i&&(s=null),(a=Bt())!==i?r=s=[s,a]:(dt=r,r=i);t=it(e,n)}else dt=t,t=i;return t}(),s!==i?e=nt(n,s):(dt=e,e=i)}else dt=e,e=i;return e}()),e}function Ct(){var t,e,n,r,s,a;if(t=dt,(e=Bt())!==i){for(n=[],r=dt,(s=Pt())===i&&(s=null),(a=Bt())!==i?r=s=[s,a]:(dt=r,r=i);r!==i;)n.push(r),r=dt,(s=Pt())===i&&(s=null),(a=Bt())!==i?r=s=[s,a]:(dt=r,r=i);t=z(e,n)}else dt=t,t=i;return t}function St(){var t,e,n,r,s,a;if(t=dt,(e=Rt())!==i){for(n=[],r=dt,(s=Pt())===i&&(s=null),(a=Rt())!==i?r=s=[s,a]:(dt=r,r=i);r!==i;)n.push(r),r=dt,(s=Pt())===i&&(s=null),(a=Rt())!==i?r=s=[s,a]:(dt=r,r=i);t=V(e,n)}else dt=t,t=i;return t}function Mt(){var t,e,n,r;return t=dt,(e=Bt())!==i?(Pt(),(n=Bt())!==i?(Pt(),(r=Bt())!==i?t=Y(e,n,r):(dt=t,t=i)):(dt=t,t=i)):(dt=t,t=i),t}function It(){var t,e,n;return t=dt,(e=Bt())!==i?(Pt(),(n=Bt())!==i?t=Z(e,n):(dt=t,t=i)):(dt=t,t=i),t}function Tt(){var t,e,n;return t=dt,(e=Bt())!==i?(Pt(),(n=Bt())!==i?t=et(e,n):(dt=t,t=i)):(dt=t,t=i),t}function Bt(){var t,e,n,r;return t=dt,(e=Rt())!==i?(Pt(),(n=Rt())!==i?(Pt(),(r=Rt())!==i?t=rt(e,n,r):(dt=t,t=i)):(dt=t,t=i)):(dt=t,t=i),t}function Rt(){var e,n,r;return dt,e=dt,(n=Ut())===i&&(n=null),r=function(){var e,n,r,s;e=dt,n=dt,r=function(){var e,n,r,s,a;e=dt,n=dt,r=Ft(),r===i&&(r=null);46===t.charCodeAt(dt)?(s=c,dt++):(s=i,0===gt&&xt(P));s!==i&&(a=Ft())!==i?n=r=[r,s,a]:(dt=n,n=i);n===i&&(n=dt,(r=Ft())!==i?(46===t.charCodeAt(dt)?(s=c,dt++):(s=i,0===gt&&xt(P)),s!==i?n=r=[r,s]:(dt=n,n=i)):(dt=n,n=i));n!==i&&(n=ct(n));return e=n,e}(),r!==i?((s=Lt())===i&&(s=null),n=r=[r,s]):(dt=n,n=i);n===i&&(n=dt,(r=Ft())!==i&&(s=Lt())!==i?n=r=[r,s]:(dt=n,n=i));n!==i&&(n=ot(n));return e=n,e}(),r!==i?e=n=[n,r]:(dt=e,e=i),e===i&&(e=dt,(n=Ut())===i&&(n=null),(r=Ft())!==i?e=n=[n,r]:(dt=e,e=i)),e!==i&&(e=st(e)),e}function Pt(){var t,e,n,r,s;if(t=dt,e=[],(n=Nt())!==i)for(;n!==i;)e.push(n),n=Nt();else e=i;if(e!==i){for((n=Dt())===i&&(n=null),r=[],s=Nt();s!==i;)r.push(s),s=Nt();t=e=[e,n,r]}else dt=t,t=i;if(t===i){if(t=dt,e=dt,(n=Dt())!==i){for(r=[],s=Nt();s!==i;)r.push(s),s=Nt();e=n=[n,r]}else dt=e,e=i;e!==i&&(e=at()),t=e}return t}function Dt(){var e;return 44===t.charCodeAt(dt)?(e=o,dt++):(e=i,0===gt&&xt(R)),e}function Lt(){var e,n,r,s;return dt,e=dt,n=t.charAt(dt),b.test(n)?dt++:(n=i,0===gt&&xt(D)),n!==i?((r=Ut())===i&&(r=null),(s=Ft())!==i?e=n=[n,r,s]:(dt=e,e=i)):(dt=e,e=i),e!==i&&(e=lt(e)),e}function Ut(){var e;return e=t.charAt(dt),v.test(e)?dt++:(e=i,0===gt&&xt(L)),e}function Ft(){var e,n;if(dt,e=[],n=t.charAt(dt),y.test(n)?dt++:(n=i,0===gt&&xt(U)),n!==i)for(;n!==i;)e.push(n),n=t.charAt(dt),y.test(n)?dt++:(n=i,0===gt&&xt(U));else e=i;return e!==i&&(e=ht(e)),e}function Nt(){var e;return dt,e=t.charAt(dt),x.test(e)?dt++:(e=i,0===gt&&xt(F)),e!==i&&(e=ut()),e}function kt(t,e){if(!e)return[t];for(var n=[t],i=0,r=e.length;i<r;i++)n[i+1]=e[i][1];return n}var Ot,Qt,Gt,Ht={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",z:"closepath"};for(var zt in Ht)Ht[zt.toUpperCase()]=Ht[zt];function jt(t,e){e||(e=[{}]);for(var n=e.length;n--;){var i={code:t,command:Ht[t]};for(var r in t==t.toLowerCase()&&(i.relative=!0),e[n])i[r]=e[n][r];e[n]=i}return e}if(n=a(),e.peg$library)return{peg$result:n,peg$currPos:dt,peg$FAILED:i,peg$maxFailExpected:At,peg$maxFailPos:ft};if(n!==i&&dt===t.length)return n;throw n!==i&&dt<t.length&&xt({type:"end"}),Ot=At,Qt=ft<t.length?t.charAt(ft):null,Gt=ft<t.length?yt(ft,ft+1):yt(ft,ft),new _w(_w.buildMessage(Ot,Qt),Ot,Qt,Gt)}];function Tw(t,e=!1){return Bw(t,e,!1)}function Bw(t,e=!1,n=!1){let i,r;if(n){if(e)throw Error("Shapes can't be 3d.");r=new xc}else i=new gc;const s=function(t){var e,n={x:0,y:0},i={x:"x0",y:"y0",z:"z0",x1:"x0",y1:"y0",z1:"z0",x2:"x0",y2:"y0",z2:"z0"};return t.forEach((function(t){for(var r in"moveto"===t.command&&(e=t),t.x0=n.x,t.y0=n.y,t.z0=n.z||0,i)r in t&&(t[r]+=t.relative?t[i[r]]:0);"x"in t||(t.x=n.x),"y"in t||(t.y=n.y),"z"in t||(t.z=n.z||0),t.relative=!1,t.code=t.code.toUpperCase(),"closepath"==t.command&&(t.x=e.x,t.y=e.y,t.z=e.z||0),n=t})),t}(Iw[e?1:0](t)),a=new me;let o=0;const c=new me;let l=0;for(const{code:t,x:n,y:h,z:u=0,x0:d,y0:p,z0:f=0,x1:A,y1:g,z1:m,x2:b,y2:v,z2:y,largeArc:x,sweep:_,xAxisRotation:E,rx:w,ry:C}of s){if("M"===t&&r&&r.moveTo(n,h),"L"===t||"V"===t||"H"===t||"Z"===t){if(i){const t=new me(d,p,f),e=new me(n,h,u);i.add(new uc(t,e))}r&&r.lineTo(n,h)}if("C"===t&&(i&&i.add(new lc(new me(d,p,f),new me(A,g,m),new me(b,v,y),new me(n,h,u))),r&&r.bezierCurveTo(A,g,b,v,n,h),a.set(b,v,y),o=2),"S"===t){const t=new me(d,p,f),e=o?Cw(a.clone(),t):new me(d,p,f);i&&i.add(new lc(t,e,new me(b,v,y),new me(n,h,u))),r&&r.bezierCurveTo(e.x,e.y,b,v,n,h),a.set(b,v,y),o=2}if("Q"===t&&(c.set(A,g,m),l=2,i&&i.add(new pc(new me(d,p,f),new me(A,g,m),new me(n,h,u))),r&&r.quadraticCurveTo(A,g,n,h)),"T"===t){const t=new me(d,p,f),e=l?Cw(c.clone(),t):t.copy();if(i){const r=new me(n,h,u);i.add(new pc(t,e,r))}r&&r.quadraticCurveTo(e.x,e.y,n,h),c.copy(e),l=2}if("A"===t){if(e)throw Error("A command is not valid in 3D path");if(0==w||0==C)i&&i.add(new uc(new zt(d,p,f),new zt(n,h,u))),r&&r.lineTo(n,h);else{const[t,e,s,a,o,c]=Sw(w,C,E,x,_,new zt(d,p),new zt(n,h));i&&i.add(new Ko(t,e,w,C,s,s+a,!o,c)),r&&r.absellipse(t,e,w,C,s,s+a,!o,c)}}o>0&&o--,l>0&&l--}return i||r}const Rw=t=>{const e=+t.x||0,n=+t.y||0,i=+t.width||.5,r=+t.height||.5;let s=+(t.rx||0),a=+(t.ry||s);return s||a?(2*s>i&&(s-=(2*s-i)/2),2*a>r&&(a-=(2*a-r)/2),[["M",e+s,n],["h",i-2*s],["s",s,0,s,a],["v",r-2*a],["s",0,a,-s,a],["h",2*s-i],["s",-s,0,-s,-a],["v",2*a-r],["s",0,-a,s,-a]].flat().join(" ")):[["M",e,n],["h",i],["v",r],["H",e],["Z"]].flat().join(" ")},Pw=Object.freeze({ArcCurve:Zo,CatmullRomCurve3:rc,CubicBezierCurve:cc,CubicBezierCurve3:lc,EllipseCurve:Ko,LineCurve:hc,LineCurve3:uc,QuadraticBezierCurve:dc,QuadraticBezierCurve3:pc,SplineCurve:fc});class Dw extends ri{constructor(t=new xc([new zt(.5,.5),new zt(-.5,.5),new zt(-.5,-.5),new zt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++){a(t[e])}function s(t){return{z:Math.cos(t*Math.PI/2),bs:Math.sin(t*Math.PI/2)}}function a(t){const a=[],o=void 0!==e.curveSegments?e.curveSegments:12,c=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let h=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,d=void 0!==e.bevelSize?e.bevelSize:u-.1,p=void 0!==e.bevelOffset?e.bevelOffset:0,f=void 0!==e.bevelSegments?e.bevelSegments:3,A=void 0!==e.bevelContourFront?e.bevelContourFront:s,g=void 0!==e.bevelContourBack?e.bevelContourBack:s;const m=e.extrudePath,b=void 0!==e.UVGenerator?e.UVGenerator:Lw;let v,y,x,_,E,w=!1;m&&(v=m.getSpacedPoints(c),w=!0,h=!1,y=m.computeFrenetFrames(c,!1),x=new me,_=new me,E=new me),h||(f=0,u=0,d=0,p=0);const C=t.extractPoints(o);let S=C.shape;const M=C.holes;if(!qc.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];qc.isClockWise(e)&&(M[t]=e.reverse())}}const I=qc.triangulateShape(S,M),T=S;for(let t=0,e=M.length;t<e;t++){const e=M[t];S=S.concat(e)}function B(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const R=S.length,P=I.length;function D(t,e,n){let i,r,s;const a=t.x-e.x,o=t.y-e.y,c=n.x-t.x,l=n.y-t.y,h=a*a+o*o,u=a*l-o*c;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(c*c+l*l),p=e.x-o/u,f=e.y+a/u,A=((n.x-l/d-p)*l-(n.y+c/d-f)*c)/(a*l-o*c);i=p+a*A-t.x,r=f+o*A-t.y;const g=i*i+r*r;if(g<=2)return new zt(i,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?c>Number.EPSILON&&(t=!0):a<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(l)&&(t=!0),t?(i=-o,r=a,s=Math.sqrt(h)):(i=a,r=o,s=Math.sqrt(h/2))}return new zt(i/s,r/s)}const L=[];for(let t=0,e=T.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),L[t]=D(T[t],T[n],T[i]);const U=[];let F,N=L.concat();for(let t=0,e=M.length;t<e;t++){const e=M[t];F=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),F[t]=D(e[t],e[i],e[r]);U.push(F),N=N.concat(F)}for(let t=0;t<f;t++){const e=t/f;let{z:n,bs:i}=A?A(e):{z:1,bs:1};n*=u,i=i*d+p;for(let t=0,e=T.length;t<e;t++){const e=B(T[t],L[t],i);Q(e.x,e.y,-n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];F=U[t];for(let t=0,r=e.length;t<r;t++){const r=B(e[t],F[t],i);Q(r.x,r.y,-n)}}}const k=d+p;for(let t=0;t<R;t++){const e=h?B(S[t],N[t],k):S[t];w?(_.copy(y.normals[0]).multiplyScalar(e.x),x.copy(y.binormals[0]).multiplyScalar(e.y),E.copy(v[0]).add(_).add(x),Q(E.x,E.y,E.z)):Q(e.x,e.y,0)}for(let t=1;t<=c;t++)for(let e=0;e<R;e++){const n=h?B(S[e],N[e],k):S[e];w?(_.copy(y.normals[t]).multiplyScalar(n.x),x.copy(y.binormals[t]).multiplyScalar(n.y),E.copy(v[t]).add(_).add(x),Q(E.x,E.y,E.z)):Q(n.x,n.y,l/c*t)}for(let t=f-1;t>=0;t--){const e=t/f;let{z:n,bs:i}=g?g(e):{z:1,bs:1};n*=u,i=i*d+p;for(let t=0,e=T.length;t<e;t++){const e=B(T[t],L[t],i);Q(e.x,e.y,l+n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];F=U[t];for(let t=0,r=e.length;t<r;t++){const r=B(e[t],F[t],i);w?Q(r.x,r.y+v[c-1].y,v[c-1].x+n):Q(r.x,r.y,l+n)}}}function O(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=c+2*f;t<n;t++){const n=R*t,s=R*(t+1);H(e+i+n,e+r+n,e+r+s,e+i+s)}}}function Q(t,e,n){a.push(t),a.push(e),a.push(n)}function G(t,e,r){z(t),z(e),z(r);const s=i.length/3,a=b.generateTopUV(n,i,s-3,s-2,s-1);j(a[0]),j(a[1]),j(a[2])}function H(t,e,r,s){z(t),z(e),z(s),z(e),z(r),z(s);const a=i.length/3,o=b.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);j(o[0]),j(o[1]),j(o[3]),j(o[1]),j(o[2]),j(o[3])}function z(t){i.push(a[3*t+0]),i.push(a[3*t+1]),i.push(a[3*t+2])}function j(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(h){let t=0,e=R*t;for(let t=0;t<P;t++){const n=I[t];G(n[2]+e,n[1]+e,n[0]+e)}t=c+2*f,e=R*t;for(let t=0;t<P;t++){const n=I[t];G(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<P;t++){const e=I[t];G(e[2],e[1],e[0])}for(let t=0;t<P;t++){const e=I[t];G(e[0]+R*c,e[1]+R*c,e[2]+R*c)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;O(T,e),e+=T.length;for(let t=0,n=M.length;t<n;t++){const n=M[t];O(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Jn(i,3)),this.setAttribute("uv",new Jn(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Pw[i.type]).fromJSON(i)),new Dw(n,t.options)}}const Lw={generateTopUV:function(t,e,n,i,r){const s=e[3*n],a=e[3*n+1],o=e[3*i],c=e[3*i+1],l=e[3*r],h=e[3*r+1];return[new zt(s,a),new zt(o,c),new zt(l,h)]},generateSideWallUV:function(t,e,n,i,r,s){const a=e[3*n],o=e[3*n+1],c=e[3*n+2],l=e[3*i],h=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],A=e[3*s],g=e[3*s+1],m=e[3*s+2];return Math.abs(o-h)<Math.abs(a-l)?[new zt(a,1-c),new zt(l,1-u),new zt(d,1-f),new zt(A,1-m)]:[new zt(o,1-c),new zt(h,1-u),new zt(p,1-f),new zt(g,1-m)]}};function Uw(t,e="ExtrudedGeometry-"+function(){return Math.floor(Math.random()*2**50).toString(36).padStart(8,"0")}(),n=!1){if(t.index)return t;const i=t.attributes.position,r=t.attributes.normal,s=t.attributes.color,a=t.attributes.uv;if(n){const e=new Array(i.count).fill(1).map(((t,e)=>e));return t.setIndex(e),t}const o=100*(1+1e-10),c=new me,l=new me;function h(t,e){return`${~~(t.x*o)},${~~(t.y*o)},${~~(t.z*o)},${~~(e.x*o)},${~~(e.y*o)},${~~(e.z*o)}`}const u=[],d=[],p=[],f=[],A=[],g={};for(let t=0,e=i.count;t<e;t++){c.fromBufferAttribute(i,t),r?l.fromBufferAttribute(i,t):l.set(0,0,0);const e=h(c,l);if(!(e in g)){const n=u.length;g[e]=n,u[n]=(new me).fromBufferAttribute(i,t),r&&(d[n]=(new me).fromBufferAttribute(r,t)),s&&(f[n]=(new me).fromBufferAttribute(s,t)),a&&(p[n]=(new zt).fromBufferAttribute(a,t))}A.push(g[e])}t.setIndex(A);const m=new Float32Array(3*u.length);for(let t=0,e=u.length;t<e;t++)u[t].toArray(m,3*t);if(t.setAttribute("position",new qn(m,3)),r){const e=new Float32Array(3*u.length);for(let t=0,n=u.length;t<n;t++)d[t].toArray(e,3*t);t.setAttribute("normal",new qn(e,3))}if(s){const e=new Float32Array(3*u.length);for(let t=0,n=u.length;t<n;t++)f[t].toArray(e,3*t);t.setAttribute("color",new qn(e,3))}if(a){const e=new Float32Array(2*u.length);for(let t=0,n=u.length;t<n;t++)p[t].toArray(e,2*t);t.setAttribute("uv",new qn(e,2))}return t.name=t.name||e,t}Object.assign(gu,{CurvePath:gc});function Fw(t,e){try{return Tw(t,e)}catch(e){const{location:n}=e;return n?console.log(`%c${e.message}\n %c${t.slice(0,n.start.offset)}%c${t.slice(n.start.offset,n.end.offset)}%c${t.slice(n.end.offset)}`,"color:orange;","","font-weight:bold;color:red;",""):console.log(e),!1}}function Nw(){for(const{name:t,example:e,schema:n,className:i,documentation:r}of hp)console.log("%c"+t,"font-size: 1.5em; font-weight: bold; font-decoration: underline;"),console.log("%c"+e,"font-family: courier;"),console.log(`This uses ${i} under the hood. ${r||""}`),console.table(n)}function kw(){for(const t of document.querySelectorAll("*")){const e=t.tagName.toLowerCase();0===e.indexOf("sh-")&&(cp.has(e)||console.warn(`Element ${Zh(t)} begins with "sh-" but is not defined by shorthand`))}}!function(t,e){const n=e.schemas;n.get(xn).get("mixins").unshift((t=>class extends t{static name="AddToParent";async connectedCallback(){await super.connectedCallback(),await this.#Tt(this.#Bt)}shReparent(t){const e=this.object;t.attach(e),this.style.setProperty("--location",`${e.position.x} ${e.position.y} ${e.position.z}`),this.style.setProperty("--scale",`${e.scale.x} ${e.scale.y} ${e.scale.z}`),this.style.setProperty("--quaternion",`${e.quaternion.x} ${e.quaternion.y} ${e.quaternion.z} ${e.quaternion.w}`),this.postConstruct.has("quaternion")?this.postConstruct.get("quaternion").copy(e.quaternion):this.postConstruct.set("quaternion",e.quaternion.clone()),this.postConstruct.has("position")?this.postConstruct.get("position").copy(e.position):this.postConstruct.set("position",e.position.clone()),this.postConstruct.has("scale")?this.postConstruct.get("scale").copy(e.scale):this.postConstruct.set("scale",e.scale.clone())}#Bt=!1;async#Tt(t=!1){if(!this.isConnected)return;this.#Bt=!0;let e=this.parentElement||this.getRootNode().host;if(e.isShortHandElement&&!e.ready&&await e.object,this.assignedSlot){let t=this;for(;t.assignedSlot;)t=t.assignedSlot;e=t.parentElement||t.getRootNode().host}let n=!1;for(;!n&&e;){for(;e&&!e.isShortHandElement;)e=e.parentElement||e.getRootNode().host;if(e){const i=await e.object;if(i instanceof xn)t?(await this.object,this.shReparent(i)):i.add(await this.object),n=!0;else{const t=e.parentElement||e.getRootNode().host;if(t.isShortHandElement&&!t.ready&&await t.object,e.assignedSlot){let t=this;for(;t.assignedSlot;)t=t.assignedSlot;let n=t.parentElement||t.getRootNode().host;e=n===e?n.parentElement:n}else e=t}}}this.ready&&$v(this)}async disconnectedCallback(){(await this.object).removeFromParent()}}))}(0,tp),function(t,e){e.schemas.get(Ua).get("mixins").push((t=>class extends t{static name="SceneFog";static shortHandSchema=new Map([["fog-color",{as:"fog.color",type:"Color"}],["fog-density",{as:"fog.density",type:"number",default:0,example:"0.035"}]]);#Rt=new La;assignPostConstructAttributes(t){return t.fog=this.#Rt,super.assignPostConstructAttributes(t)}}))}(0,tp),function(t,e){e.schemas.get(xn).get("mixins").push((t=>class extends t{static name="Transform";static shortHandSchema=iu({mixins:ob,transform:{type:"string",stage:4}});constructor(){super(),ub.set(this,(new qe).identity())}get#Pt(){return ub.get(this)}stringToValue(t,e){if("transform"===t){try{const t=new DOMMatrix(e);this.#Pt.fromArray(t.toFloat32Array())}catch(t){}return this.object instanceof Promise?this.object.then((()=>db(this))):db(this),e}return super.stringToValue(t,e)}async connectedCallback(){await super.connectedCallback(),await this.object,db(this)}async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i),cb.includes(t)&&(await this.object,db(this))}}))}(0,tp),tp.schemas.get(Object).get("mixins").push((t=>class extends t{static name="StyleAttributes";static markAsDirty=$v;#Dt=new Map;__shTrackedAttributes=new Set;#Lt=[];#F=window.getComputedStyle(this);#Ut=new Map;constructor(){if(super(),Xv.push(new WeakRef(this)),this.addEventListener("animationstart",(t=>{t.shIsHandled=!0,t.target===this&&this.#Ft(t.animationName,1)}),{capture:!0}),Kv.has(this))for(const[t,e]of Object.entries(Kv.get(this)))console.log("Adding unhandled animation: ",t),this.#Ft(t,e);this.addEventListener("animationend",(t=>{t.target===this&&this.#Ft(t.animationName,-1)})),this.addEventListener("transitionstart",(t=>{t.target===this&&this.#Nt(t.propertyName,1)})),this.addEventListener("transitionend",(t=>{t.target===this&&this.#Nt(t.propertyName,-1)})),this.shadowRoot?Yv.observe(this.shadowRoot,{attributes:!0,subtree:!0,attributeFilter:Jv}):this.object instanceof Promise&&this.object.then((()=>{this.shadowRoot&&Yv.observe(this.shadowRoot,{attributes:!0,subtree:!0,attributeFilter:Jv})}))}#Nt(t,e){const n=t.slice(2);if(this.constructor.observedAttributes.includes(n)){const t=(this.#Ut.get(n)||0)+e;t>0?this.#Ut.set(n,t):(0===t||console.warn("Something has gone wrong lost count of animating attributes!"),this.#Ut.delete(n)),this.#Lt=[...this.__shTrackedAttributes,...this.#Ut.keys()]}}#Ft(t,e){for(const n of[...this.getRootNode().styleSheets]){const i=Array.from(n.cssRules).filter((t=>t instanceof CSSKeyframesRule));for(const n of i)if(n.name===t)for(const t of n.cssRules)for(const n of t.style)this.#Nt(n,e)}}tick(t,e,n,i,r){super.tick(t,e,n,i,r),this.#kt()}async attributeChangedCallback(t,e,n,i){if("will-change"===t)return this.#Ot(n||""),void this.#kt();if(this.isConnected&&!0!==i){const e=this.constructor.shortHandSchema.get(t);let i=this.#F.getPropertyValue("--"+t)?.trim()||null;"none"===i&&void 0===e?.map?.none&&(i=null),i&&(n=i)}return i&&(null===n&&(n=this.getAttribute(t)||null),e===n)?void 0:super.attributeChangedCallback(t,e,n)}async connectedCallback(){for(const t of this.constructor.observedAttributes)this.#Dt.set(t,this.getAttribute(t)||null);this.#Ot(this.#F.getPropertyValue("--will-change")||this.getAttribute("will-change")?.trim()||"");for(const[t,e]of this.constructor.shortHandSchema.entries()){let n=this.#F.getPropertyValue("--"+t)?.trim()||null;if("none"===n&&void 0===e?.map?.none&&(n=null),n)if(this.#Dt.set(t,n),this.ready)this.attributeChangedCallback(t,null,n,!0);else{let e=this.stringToValue(t,n);e instanceof Promise&&(e=await e),this.ready?this.attributeChangedCallback(t,null,n,!0):this.populateConstructorHelper(t,e)}}await super.connectedCallback()}#kt(){for(const t of Zv.get(this)?this.constructor.shortHandAttributes:this.#Lt){if(!this.constructor.shortHandSchema.has(t))continue;let e=this.#F.getPropertyValue("--"+t)?.trim()||null;const n=this.#Dt.get(t);if(e!==n){if(this.#Dt.set(t,e),"none"===e){const n=this.constructor.shortHandSchema.get(t);void 0===n?.map?.none&&(e=null)}this.attributeChangedCallback(t,n,e,!0)}}Zv.set(this,!1)}#Ot(t){"none"===t&&(t=""),this.__shTrackedAttributes.clear();for(const e of t.split(/\s+/g).filter((t=>!!t)))this.__shTrackedAttributes.add(e);if(this.__shTrackedAttributes.has("all")){this.__shTrackedAttributes.length=0;for(const t of this.constructor.shortHandAttributes)this.__shTrackedAttributes.add(t)}this.#Lt=[...this.__shTrackedAttributes,...this.#Ut.keys()]}})),function(t,e){const n=e.schemas,i=new Mh,r=new ge,s=[],a=new me,o=new me,c=[];let l=!1;function h(){if(l=!0,c.length){const t=c.shift();t.boundsTree=new UE(t.el?t.el.object:t,{}),setTimeout(h,50)}else l=!1}_i.prototype.raycast=QE,HA.push((t=>class extends t{static shortHandSchema=new Map([["hit-test-enabled",{as:"hitTestEnabled",default:!0,stage:e.STORED_ON_EL}]]);static shortHandEventDescriptions={"renderer-mousedown":"Fired when a 2d pointer starts a click-like activity","renderer-mouseup":"Fired when a 2d pointer ends a click-like activity","renderer-mousemove":"Fired when a 2d pointer moves over the canvas","renderer-mousecancel":"Fired when a 2d pointer leaves the canvas during an event"};static name="HitTest&Raycasting";#Qt=new Map;constructor(){super(),this.addEventListener("pointerenter",(t=>{if(t.target!==this)return;this.#Qt.get(t.pointerId)||this.#Qt.set(t.pointerId,this.#Gt(t))})),this.addEventListener("pointerdown",(t=>{if(t.target!==this)return;const e=this.#Qt.get(t.pointerId)||this.#Gt(t);if(this.#Qt.set(t.pointerId,e),e){let n;e.lastClickTime=Date.now(),e.clickStartX=e.x,e.clickStartY=e.y,e.button=t.button,e.el&&(n=e.el.emit("shpointerdown",e,!0,!1,!0)),n&&n.defaultPrevented||this.emit("renderer-mousedown",e)}}),{capture:!0}),this.addEventListener("pointermove",(t=>{const e=t.clientX-this.left,n=t.clientY-this.top,i=this.#Qt.get(t.pointerId)||this.#Gt(t);i&&(i.x=e/this.width*2-1,i.y=-n/this.height*2+1,this.emit("renderer-mousemove",i))}),{capture:!0}),this.addEventListener("pointerup",(t=>{const e=this.#Qt.get(t.pointerId);e&&(e.el&&e.el.emit("shpointerup",e),this.emit("renderer-mouseup",e),e.button=null,Date.now()-e.lastClickTime<200&&e.lastElementHovered&&e.lastElementHovered.emit("click",e),e.clickStartX=null,e.clickStartY=null)})),this.addEventListener("pointerleave",(t=>{const e=this.#Qt.get(t.pointerId);e&&this.emit("renderer-mousecancel",e)}),{capture:!0}),this.addEventListener("pointercancel",(t=>{const e=this.#Qt.get(t.pointerId);e&&this.emit("renderer-mousecancel",e)})),this.addEventListener("selectstart",(t=>{if(!t.detail)return;const e=this.object.xr.getReferenceSpace(),{inputSource:n,frame:s}=t.detail,c=s.getPose(n.targetRaySpace,e);if(!c)return;o.copy(c.transform.position),a.set(0,0,-1).applyQuaternion(r.copy(c.transform.orientation)),i.set(o,a),this.#Ht();const{object:l}=this.#zt();if(l){const t=l.el,e={el:t,inputSource:n,isXRPointer:!0,get lastElementHovered(){return this.lastElementHoveredRef?.deref()||null},type:n.targetRayMode,targetRayPose:c};t.emit("shpointerdown",e),this.#Qt.set(n,e)}})),this.addEventListener("selectend",(t=>{const{inputSource:e,frame:n}=t.detail;if(this.#Qt.has(e)){const t=this.object.xr.getReferenceSpace(),s=this.#Qt.get(e);this.#Qt.delete(e);const c=n.getPose(e.targetRaySpace,t);if(c){o.copy(c.transform.position),a.set(0,0,-1).applyQuaternion(r.copy(c.transform.orientation)),i.set(o,a),this.#Ht(s.el.object);const{object:t}=this.#zt();if(t){const e=t.el;e.classList.remove("hover"),e.part.remove("hover");const n=e.getRootNode().host;n&&(n.classList.remove("hover"),n.part.remove("hover")),e.emit("shpointerup",s),e===s.el&&e.emit("click",s)}}}}))}#Gt(t){const e=t.clientX-this.left,n=t.clientY-this.top,r=e/this.width*2-1,s=-n/this.height*2+1,c=this.properties.camera;c&&c.isPerspectiveCamera?(o.setFromMatrixPosition(c.matrixWorld),a.set(r,s,.5).unproject(c).sub(o).normalize()):c&&c.isOrthographicCamera&&(o.set(r,s,(c.near+c.far)/(c.near-c.far)).unproject(c),a.set(0,0,-1).transformDirection(c.matrixWorld)),i.set(o,a),this.#Ht();const l={inputSource:Symbol(t.pointerId),identifier:t.pointerId,x:r,y:s,clickStartX:null,clickStartY:null,get lastElementHovered(){return this.lastElementHoveredRef?.deref()||null},lastClickTime:0,type:t.pointerType},{object:h}=this.#zt();if(h){const t=h.el;l.el=t}return l}#Ht(t){if(!t||(s.length=0,i.intersectObject(t,!1,s),!s.length)){s.length=0;for(const t of this.sceneChildren)if(t.object&&"function"==typeof t.object.raycast&&0!==t.properties?.pointerEvents&&(1!==t.properties?.pointerEvents||!1!==t.object.visible)&&(i.intersectObject(t.object,!1,s),s.length))return}}#zt(){if(!s.length)return{};const t=s.find((t=>{let e=t.object.material;if("number"==typeof t.face?.materialIndex&&e instanceof Array&&(e=e[t.face.materialIndex]),!1===e.visible)return!1;const n=e.clippingPlanes;return!n||n.every((function(e){return e.distanceToPoint(t.point)>0}))}));if(!t)return{};let e=t.object;for(;e&&!e.el;)e=e.parent;return{object:e,result:t}}tick(t,e,n,c,l){if(this.properties.hitTestEnabled){if(this.properties.scene.object&&!(this.properties.scene.object instanceof Promise)&&this.properties.camera)for(const t of this.#Qt.values()){let e=null,c=!1;const l=this.object;if(t.isXRPointer){if(n){const e=l.xr.getReferenceSpace(),s=t.inputSource,h=n.getPose(s.targetRaySpace,e);if(!h)continue;o.copy(h.transform.position),a.set(0,0,-1).applyQuaternion(r.copy(h.transform.orientation)),i.set(o,a),c=!0}}else l.xr.isPresenting||(this.properties.camera&&this.properties.camera.isPerspectiveCamera?(o.setFromMatrixPosition(this.properties.camera.matrixWorld),a.set(t.x,t.y,.5).unproject(this.properties.camera).sub(o).normalize(),c=!0):this.properties.camera&&this.properties.camera.isOrthographicCamera&&(o.set(t.x,t.y,(this.properties.camera.near+this.properties.camera.far)/(this.properties.camera.near-this.properties.camera.far)).unproject(this.properties.camera),a.set(0,0,-1).transformDirection(this.properties.camera.matrixWorld),c=!0));if(c&&(i.set(o,a),this.#Ht(),s.length)){const{object:n,result:i}=this.#zt();if(n){const r=n.el,s=n.el.getRootNode().host;r&&Kh(this.sceneChildren,s||r)&&(e=r,t.pointerRayHitPosition=i.point,e===t.lastElementHovered&&e.emit("shpointermove",t,!0))}}if(e!==t.lastElementHovered){const n=t.lastElementHovered?.getRootNode()?.host,i=e?.getRootNode()?.host;null!==e&&(e.emit("shpointerenter",t),e.emit("shpointermove",t,!0),i?(i.classList.add("hover"),e.part.add("hover")):e.classList.add("hover"));for(const e of this.sceneChildren)e!==n&&e!==t.lastElementHovered||(n?(n!==i&&n.classList.remove("hover"),t.lastElementHovered.part.remove("hover"),t.lastElementHovered.emit("shpointerleave",t)):(e.classList.remove("hover"),e.emit("shpointerleave",t)));t.lastElementHoveredRef=e?new WeakRef(e):null}}super.tick(t,e,n,c,l)}else super.tick(t,e,n,c,l)}})),n.get(_i).get("mixins").push((t=>class extends t{static name="GeometryBVH";updateObject(...t){super.updateObject(...t);const e=this.object.geometry||this.object.dummyGeometry;0===this.properties.pointerEvents||this.noGeometryBVH||!e||e.boundsTree||e.awaitingBoundsTree||(e.awaitingBoundsTree=!0,c.push(e),l||h())}})),n.get(xn).get("mixins").push((t=>class extends t{static name="HitTestEventDescriptions";static shortHandEventDescriptions={shpointerdown:"Fired when a 2D or 3D pointer starts starts selecting over this element.",shpointerup:"Fired when a 2D or 3D pointer stops selecting over this element.",shpointerenter:"Fired when a 2D or 3D pointer starts hovering over this element.",shpointerleave:"Fired when a 2D or 3D pointer leaves hovering over this element.",shpointermove:"Fired eachframe while a 2D or 3D pointer starts hovering over this element.",click:"Fired when a 2D or 3D pointer does a selcet type action on an element"}})),n.get(xn).set("pointer-events",GE)}(0,tp),function(t,e){const n=e.schemas,i=new me,r=new me,s=new me;n.get(xn).get("mixins").push((t=>class extends t{static shortHandSchema=new Map([["mixins",[]],["linear-constraint-axis",{as:"linearConstraintAxis",type:"Vector3",stage:e.STORED_ON_EL}],["linear-constraint-target",{as:"linearConstraintTarget",type:"Elements",default:[],stage:e.STORED_ON_EL}],["linear-constraint-options",{as:"linearConstraintOptions",type:"string",stage:e.STORED_ON_EL,notes:"The format is: `[min] [max] [step] [radius limit] [downEventThreshold] [upEventThreshold] [default value if outside of radius]`"}]]);static name="LinearConstraint";static documentation=HE;static shortHandEventDescriptions={linearConstraintDown:"Object being depressed passes down threshold",linearConstraintUp:"Object being raised passes up threshold"};#jt;#Vt;#Wt={min:-1/0,max:1/0,step:0,downEventThreshold:-1/0,upEventThreshold:1/0,radius:0,valueIfOutsideOfRadius:null};#qt=null;#Xt(){!0!==this.#qt&&(this.#qt=!0,this.getRootNode().host&&this.part.add("linear-constraint-active"),this.classList.add("linear-constraint-active"))}#Yt(){!1!==this.#qt&&(this.#qt=!1,this.getRootNode().host&&this.part.remove("linear-constraint-active"),this.classList.remove("linear-constraint-active"))}tick(t,e,n,a,o){let c;if(super.tick(t,e,n,a,o),this.object instanceof Promise||!this.properties.linearConstraintTarget||0===this.properties.linearConstraintTarget.length||!this.properties.linearConstraintAxis||0===(c=this.properties.linearConstraintAxis.length()))return this.#Yt();const l=this.object,h=this.#Wt.step;if(!l)return;this.#jt||(this.#jt=(new me).copy(l.position));const u=s.copy(this.properties.linearConstraintAxis).multiplyScalar(1/c),d=i,p=this.#Wt.min,f=this.#Wt.max,A=this.#Wt.radius,g=this.#Wt.valueIfOutsideOfRadius,m=null!==g,b=this.#Wt.upEventThreshold,v=this.#Wt.downEventThreshold;let y=1/0;const x=r;for(const t of this.properties.linearConstraintTarget)if(t.object instanceof xn){t.parent&&t.parent===l.parent?x.copy(t.object.position):(t.object.getWorldPosition(x),l.parent.worldToLocal(x)),x.sub(this.#jt);const e=x.length();e<y&&(y=e,d.copy(x))}let _=d.dot(u);const E=d.addScaledVector(u,-_).length();if(_=du(_,p,f),h>0&&(_=h*Math.round(_/h)),A&&E>A){if(this.#Yt(),!m)return;_=g}else this.#Xt();null!==this.#Vt&&(_>=b&&this.#Vt<b&&this.emit("linearConstraintUp"),_<=v&&this.#Vt>v&&this.emit("linearConstraintDown")),l.position.copy(u).multiplyScalar(_).add(this.#jt),this.#Vt=_}stringToValue(t,e){if("linear-constraint-options"===t){if(!e)return null;const t=e.trim().split(/\s+/).map((t=>"x"===t||null===t?null:parseFloat(t)));return this.#Wt.min=Number.isFinite(t[0])?t[0]:-1/0,this.#Wt.max=Number.isFinite(t[1])?t[1]:1/0,this.#Wt.step=Number.isFinite(t[2])?t[2]:0,this.#Wt.radius=Number.isFinite(t[3])?t[3]:0,this.#Wt.downEventThreshold=Number.isFinite(t[4])?t[4]:-1/0,this.#Wt.upEventThreshold=Number.isFinite(t[5])?t[5]:1/0,this.#Wt.valueIfOutsideOfRadius=Number.isFinite(t[6])?t[6]:null,Object.assign({},this.#Wt)}return super.stringToValue(t,e)}}))}(0,tp),function(t,e){const n=e.schemas,i=new me,r=new me,s=new me,a=[-1,-1,0],o=new me;n.get(xn).get("mixins").push((t=>class extends t{static shortHandSchema=iu({"plane-constraint-target":{as:"planeConstraintTarget",type:"Elements",default:[],stage:e.STORED_ON_EL},"plane-constraint-limit":{as:"planeConstraintLimit",type:"string",stage:e.STORED_ON_EL,notes:"Format: Radius limit, Height Limit, Out of range behaviour (One of stop, follow, origin), negative values count as no-limit. "},"plane-constraint-step":{as:"planeConstraintStep",type:"Vector3",stage:e.STORED_ON_EL},"plane-constraint-latch":{as:"planeConstraintLatch",type:"boolean",stage:e.STORED_ON_EL,notes:"whether to stay attached to the current element even if another is closer."}});static name="PlaneConstraint";static documentation=zE;#jt;#qt=null;#Jt=null;#Xt(t){!0!==this.#qt&&(this.#Jt=t,this.#qt=!0,this.getRootNode().host&&this.part.add("plane-constraint-active"),this.classList.add("plane-constraint-active"))}#Yt(){!1!==this.#qt&&(this.#Jt=null,this.#qt=!1,this.getRootNode().host&&this.part.remove("plane-constraint-active"),this.classList.remove("plane-constraint-active"))}stringToValue(t,e){if("plane-constraint-limit"===t){if(!e)return null;const t=e.trim().match(/^([-\d.]+)?(?:\s+([-\d.]+))?(?:\s+(stop|follow|origin))?$/);if(t){let e=0;"stop"===t[3]&&(e=0),"follow"===t[3]&&(e=1),"origin"===t[3]&&(e=2);let n=t[2]?parseFloat(t[2]):-1;return[parseFloat(t[1]),n,e]}return null}return super.stringToValue(t,e)}tick(t,e,n,c,l){super.tick(t,e,n,c,l);const h=this.object;if(!h||h instanceof Promise||!this.properties.planeConstraintTarget||0===this.properties.planeConstraintTarget.length)return this.#Yt();this.#jt||(this.#jt=(new me).copy(h.position));const u=s.set(0,1,0),d=i,[p,f,A]=this.properties.planeConstraintLimit||a,g=this.properties.planeConstraintStep||o;let m,b=1/0;const v=r;if(!0===this.properties.planeConstraintLatch&&this.#Jt&&this.properties.planeConstraintTarget.includes(this.#Jt)){const t=this.#Jt;t.parent&&t.parent===h.parent?v.copy(t.object.position):(t.object.getWorldPosition(v),h.parent.worldToLocal(v)),v.sub(this.#jt),d.copy(v),m=t}else for(const t of this.properties.planeConstraintTarget)if(t.object instanceof xn){t.parent&&t.parent===h.parent?v.copy(t.object.position):(t.object.getWorldPosition(v),h.parent.worldToLocal(v)),v.sub(this.#jt);const e=v.length();e<b&&(b=e,d.copy(v),m=t)}g.x&&(d.x=g.x*Math.round(d.x/g.x)),g.y&&(d.y=g.y*Math.round(d.y/g.y)),g.z&&(d.z=g.z*Math.round(d.z/g.z));let y=d.dot(u);const x=d.addScaledVector(u,-y).length(),_=p>0&&x>p,E=f>0&&Math.abs(y)>f-this.#jt.y;if(_||E){if(0===A)return this.#Yt();1===A&&(this.#Xt(m),_&&d.multiplyScalar(p/x)),2===A&&(this.#Yt(),d.set(0,0,0))}else this.#Xt(m);h.position.copy(d).add(this.#jt)}}))}(0,tp),function(t,e){const n=e.schemas,i=new me,r=new me,s=new me,a=new ge,o=new ge,c=new ge,l=new zt(.1,0);n.get(xn).get("mixins").push((t=>class extends t{static shortHandSchema=iu({"magnet-constraint-target":{as:"magnetConstraintTarget",default:[],type:"Elements",stage:e.STORED_ON_EL},"magnet-constraint-range":{as:"magnetConstraintRange",type:"Vector2",stage:e.STORED_ON_EL}});static name="MagnetConstraint";static documentation=vw;static shortHandEventDescriptions={"magnet-connect":"Fired when the attracting object and the magnet object connect fully, this may not fire if the magnet behaviour is removed whilst they are not connected","magnet-disconnect":"Fired when the attracting object and the magnet are no longer fully connected, this may not fire if the magnet behaviour is removed whilst they are connecting"};#Jt=null;#qt=!1;#Kt(t){!0!==this.#qt&&(this.#qt=!0,this.getRootNode().host&&this.part.add("magnet-constraint-active"),this.classList.add("magnet-constraint-active")),this.#Jt!==t&&(this.#Zt(),this.#Jt=t,t.getRootNode().host&&t.part.add("magnet-constraint-target"),t.classList.add("magnet-constraint-target"))}#Zt(){if(!1!==this.#qt&&(this.#qt=!1,this.getRootNode().host&&this.part.remove("magnet-constraint-active"),this.classList.remove("magnet-constraint-active")),null!==this.#Jt){const t=this.#Jt;this.#Jt=null,t.getRootNode().host&&t.part.remove("magnet-constraint-target"),t.classList.remove("magnet-constraint-target")}}#$t;*#te(){return this.#$t!==this.properties.magnetConstraintTarget&&(this.#$t=this.properties.magnetConstraintTarget,this.#Jt=null),this.#Jt&&(yield this.#Jt),yield*this.properties.magnetConstraintTarget}#ee;tick(t,e,n,h,u){super.tick(t,e,n,h,u);const d=this.object,{x:p,y:f}=this.properties.magnetConstraintRange||l;if(!d||d instanceof Promise||!this.properties.magnetConstraintTarget||!this.#Jt&&0===this.properties.magnetConstraintTarget.length)return this.#Zt();db(this);let A,g=1/0;for(const t of this.#te())if(t.object instanceof xn){t.parent&&t.parent===d.parent?r.copy(t.object.position):(d.parent.worldToLocal(t.object.getWorldPosition(i)),r.copy(d.position));const e=i.sub(r).length();e<g&&(s.copy(i),g=e,A=t.object)}if(g<p){this.#Kt(A.el);const t=d.parent,e=du((1-g/p)*(1/(1-du(f/p,0,.9999))),0,1);if(1===e&&1!==this.#ee){const t=A.el;this.emit("magnet-connect",{target:t,magnet:this}),t.emit("magnet-connect",{target:t,magnet:this})}if(1!==e&&1===this.#ee){const t=A.el;this.emit("magnet-disconnect",{target:t}),t.emit("magnet-disconnect",{target:t})}this.#ee=e,t.worldToLocal(A.getWorldPosition(i)),r.copy(d.position),i.lerp(r,1-e).sub(r),t.getWorldQuaternion(c).invert(),A.getWorldQuaternion(a).premultiply(c),o.copy(d.quaternion),a.slerp(o,1-e).multiply(o.invert()),d.applyQuaternion(a),d.position.add(i)}else this.#Zt()}}))}(0,tp),function(t,e){const n=e.schemas,i=new ye,r=new me,s=new zt,a=new zt,o=new zt;n.get(xn).get("mixins").push((t=>class extends t{#ne=!1;#ie;#re;static name="DomHitboxes";static documentation=jE;constructor(){super(),this.#re=function(t){13===t.keyCode&&this.click()}.bind(this)}tick(t,e,n,c,l){if(super.tick(t,e,n,c,l),this.object instanceof xn&&this.matches("a > *, .clickable")){const t=c.properties.camera;i.setFromObject(this.object),s.set(1,1),a.set(-1,-1);let e,n=1/0;for(let e=0;e<8;e++)r.x=(1&e?i.min:i.max).x,r.y=(2&e?i.min:i.max).y,r.z=(4&e?i.min:i.max).z,r.project(t),r.z<1&&(r.x=du(r.x,-1,1),r.y=du(r.y,-1,1),r.x<s.x&&(s.x=r.x),r.y<s.y&&(s.y=r.y),r.x>a.x&&(a.x=r.x),r.y>a.y&&(a.y=r.y),r.z<n&&(n=r.z));o.set(c.width/2,-c.height/2),s.multiply(o),a.multiply(o),o.set(c.width/2,c.height/2),s.add(o),a.add(o),this.#ne?e=this.#ie||this:(this.#ne=!0,this.matches(`a ${this.tagName.toLowerCase()}`)?this.#ie=this.closest("a"):this.addEventListener("keyup",this.#re),e=this.#ie||this,e.setAttribute("tabindex","0"),e.setAttribute("draggable","false"));const l=a.x-s.x,h=s.y-a.y;h&&l&&(e.style.left=s.x+"px",e.style.top=a.y+"px",e.style.width=l+"px",e.style.height=h+"px",e.style.display="block",e.style.zIndex=Math.floor(100*Math.log(1-n))+1e3)}else if(this.#ne){const t=this.#ie||this;this.#ie=null,this.removeEventListener("keyup",this.#re),t.removeAttribute("tabindex"),t.removeAttribute("draggable"),t.style.removeProperty("width"),t.style.removeProperty("height"),t.style.removeProperty("top"),t.style.removeProperty("left"),t.style.removeProperty("z-index")}}}))}(0,tp),function(t,e){const n=e.schemas,i=t=>class extends t{static name="BackgroundTextures";static documentation=fw;#se=new Map;#ae(t){if(this.#se.has(t))return this.#se.get(t);const e=document.createElement("canvas");e.width=256,e.height=256;const n=new Yo(e);return this.#se.set(t,n),n}stringToValue(t,e){const n=this.constructor.getSchemaEntry(t),i=n.type||typeof n.default;let r=super.stringToValue(t,e);return"Texture"===i&&(!r||r instanceof Promise)?Promise.resolve(r).then((async n=>{if(!n&&t){const n=this.#ae(t),i=n.source.data,r=i.getContext("2d");return r.fillStyle="white",r.fillRect(0,0,i.width,i.height),await pw(i,e),n.needsUpdate=!0,"background-image"!==t&&"environment"!==t&&"environment-map"!==t||(n.mapping=T),n}return n})):r}};n.get(Qn).get("mixins").push(i),n.get(Ua).get("mixins").push(i),n.get(Wh).get("mixins").push(i)}(0,tp),function(t,e){const n=new su,i=e.schemas,r=new me,s=new me,a=new me,o="Diorama";t("sh-diorama",{mixin:t=>class extends t{static name=o;static documentation=Aw;static documentationPriority=-1;isSHDiorama=!0;#oe=[];#ce=[];#le;#he;static shortHandSchema=new Map([["width",{default:.5,stage:4,example:.5}],["height",{default:.3,stage:4,example:.3}]]);constructor(){super();for(let t=0;t<4;t++)this.#oe.push(new Hi);for(let t=0;t<4;t++)this.#ce.push(new Hi);n.set(this,[this.#oe,this.#ce]),mw.splice(0),mw.push(...Array.from(n.values()).flatMap((t=>t[0]))),bw.splice(0),bw.push(...Array.from(n.values()).flatMap((t=>t[1]))),this.#le=[];for(let t=0;t<4;t++){const t=new xn;this.#le.push(t)}this.#he=new _i(new Xi(1,1),new Gn({color:"black",side:d})),this.#he.onBeforeRender=(t,e,n)=>{a.setFromMatrixPosition(n.matrixWorld),this.#ue(a)},this.#he.scale.set(this.properties.width,this.properties.height,.01);for(let t=0;t<4;t++){const e=this.#le[t],n=2*(t/4+.125)*Math.PI;e.position.set(.5*this.properties.width*Math.sin(n),.5*this.properties.height*Math.cos(n),0).multiplyScalar(1.39502)}}async attributeChangedCallback(t,e,n,i){if(await super.attributeChangedCallback(t,e,n,i),"width"===t||"height"===t){for(let t=0;t<4;t++){const e=this.#le[t],n=2*(t/4+.125)*Math.PI;e.position.set(.5*this.properties.width*Math.sin(n),.5*this.properties.height*Math.cos(n),0).multiplyScalar(1.39502)}const t=.007,e=.007;this.style.setProperty("--frame-geometry",`${gw(this.properties.width+e,this.properties.height+e,2*t)} / ${gw(this.properties.width-e,this.properties.height-e,t)}, ${gw(.8*this.properties.width,t,t/2,-this.properties.height/2-2*e)}`)}}async allAttributesChangedCallback(){const t=new wa;t.add(this.#he);for(const e of this.#le)t.add(e);await this.assignPostConstructAttributes(t),this.updateObject(t)}#ue(t){for(var e=0;e<4;e++)this.#oe[e].setFromCoplanarPoints(t,this.#le[(e+1)%4].getWorldPosition(r),this.#le[(e+2)%4].getWorldPosition(s)),this.#ce[e].setFromCoplanarPoints(t,this.#le[(e+2)%4].getWorldPosition(s),this.#le[(e+1)%4].getWorldPosition(r))}},type:xn,name:o}),i.get(Qn).get("mixins").push((t=>class extends t{static name="ClippingPlanes";async connectedCallback(){await super.connectedCallback();const t=await this.object;t.clipIntersection=!0,t.clippingPlanes=bw;let e=this.parentNode;for(;e;)e.isSHDiorama&&(t.clipIntersection=!1,t.clippingPlanes=mw),e=e.getRootNode().host&&e.getRootNode()===e?e.getRootNode().host:e.parentNode}}))}(gp,tp),function(t,e){const n=new zt,i=new me,r=new ge,s=new me(1,0,0),a=new me(0,0,1),o=/^(?<shapes>(?:(?<pathtypeA>path|path2d|rect)\((?:[^)]+)\)\s*((?:\/\s*(?<pathtypeB>path|path2d|rect)\((?:[^)]+)\)?))*\s*,?\s*)+)(?<extrudePathOrBevel>(?:(?<steps>[\d.e]+))\s+(?:(?:path3d\((?<extrudePathData>[^)]+)\))|(?:path\((?<frontBevelPathData>[^)]+)\)\s*(?:\spath\((?<backBevelPathData>[^)]+)\))?)?))?(?:\s+(?<depth>[\d.e]+))?(?:\s+(?<bevelSize>[\d.e]+))?(?:\s+(?<bevelThickness>[\d.e]+))?(?:\s+(?<flags>((smooth|ao|inside)\s*)+))?\s*$/i,c=/(?<pathtypeA>path|path2d|rect)\((?<shapeData>[^)]+)\)\s*(\/\s*(?<holes>(?:\s*(?<pathtypeB>path|path2d|rect)\((?:[^)]+)\)?)*))?/gi,l=/(?<pathtype>path|path2d|rect)\((?<holeData>[^)]+)\)/g,h=/(?<width>[\d.e]+)?\s*(?<height>[\d.e]+)?\s*(?<rx>[\d.e]+)?\s*(?<ry>[\d.e]+)?\s*(?<x>[-\d.e]+)?\s*(?<y>[-\d.e]+)?/,u=t=>class extends t{static name="PathParser";static documentation='You can use path() to define geometry e.g. `geometry="path(some svg style path)"` the syntax is `path(shapeA)/path(holeA) path(holeB), path(shapeB)/path(holeC) [{number of  subdivisions} {path3d(path to extrude along) | path(custom bevel path)} ] [depth [bevelSize] [bevelThickness]] ["smooth"] ["ao"] ["inside"]"`\n\nIt also supports rect([width] [height] [radiusX] [radiusY] [offsetX] [offsetY])\n\nsome examples: Two concentric circles, Aligned to be on 0,0 and go up 0.5cm in the y direciton.\n```\ngeometry="path(M0-.027A.027.027 0 110 .027.027.027 0 110-.027) / path(M0-.0225A.0225.0225 0 100 .0225.0225.0225 0 100-.0225), path(M0-.015A.015.015 0 110 .015.015.015 0 110-.015) / path(M0-.01A.01.01 0 100 .01.01.01 0 100-.01) 1 path(m0 0l0 .005) smooth ao"\n```\n\nsome examples: A sword with 0.1 depth and 0.01 bevel\n```\ngeometry="path(M-.1.3.5-.4.8-.5.7-.2 0 .4C.1.5.1.6.2.5.2.6.3.7.2.7A.142.142 90 01.1.8.5.5 90 00-.1.5Q-.15.49-.15.55T-.3.68-.38.6-.25.45-.2.4A.5.5 90 00-.5.2.142.142 90 01-.4.1C-.4 0-.3.1-.2.1-.3.2-.2.2-.1.3M.5-.4.5-.2.7-.2.52-.22.5-.4) 0.1 0.01"\n```\n';stringToValue(t,e){const i=this.constructor.getSchemaEntry(t).type;if("Geometry"!==i&&"BufferGeometry"!==i||this.constructor.THREEClass!==Do){if("Geometry"===i||"BufferGeometry"===i){const t=e.trim().match(o);if(t){let{depth:e,bevelSize:i,bevelThickness:r,flags:s,shapes:a,steps:o,extrudePathData:u,frontBevelPathData:d,backBevelPathData:p}=t.groups;const f=s?s.split(/\s+/):[],A=f.includes("smooth"),g=f.includes("ao"),m=f.includes("inside");o=parseFloat(o||1),e=parseFloat(e||0),i=parseFloat(i||0);const b=parseFloat(r||0);let v,y,x,_;u&&(x=Fw(u)),d&&(v=Fw(d)),p&&(y=Fw(p));let E=!1;const w=Array.from(a.matchAll(c)).map((t=>{_=t.groups.shapeData,"rect"===t.groups.pathtypeA&&(_=Rw(_.trim().match(h).groups));const e=Bw(_,!1,!0);return t.groups.holes&&(e.holes=Array.from(t.groups.holes.matchAll(l)||[]).map((t=>(_=t.groups.holeData,E=!0,"rect"===t.groups.pathtype&&(_=Rw(_.trim().match(h).groups)),Fw(_))))),e}));if(e||x||v){const t=new Dw(w,{depth:e,bevelEnabled:!(!i&&!v||x),bevelSegments:v?o:5,steps:o,bevelSize:i,extrudePath:x,bevelContourFront:v?t=>(v.getPoint(t,n),{z:n.y,bs:m?-n.x:n.x}):void 0,bevelContourBack:y?t=>(y.getPoint(t,n),{z:-n.y,bs:m?-n.x:n.x}):void 0,bevelThickness:r?b:i,curveSegments:8});t.rotateX(-Math.PI/2);let s=t;return m&&(s=function(t){const e=t.index?t.toNonIndexed():t,n=e.attributes.position.array;for(let t=0,e=n.length;t<e;t+=9)[n[t+0],n[t+6]]=[n[t+6],n[t+0]],[n[t+1],n[t+7]]=[n[t+7],n[t+1]],[n[t+2],n[t+8]]=[n[t+8],n[t+2]];return e}(s)),g&&(s=function(t){const e=new Nn,n=100*(1+1e-10),i=[new me,new me,new me],r=new me,s=new me,a=new me;function o(t){return`${~~(t.x*n)},${~~(t.y*n)},${~~(t.z*n)}`}const c=(t.index?t.toNonIndexed():t).attributes.position,l={};for(let t=0,e=c.count/3;t<e;t++){const e=3*t,n=i[0].fromBufferAttribute(c,e+0),a=i[1].fromBufferAttribute(c,e+1),h=i[2].fromBufferAttribute(c,e+2);r.subVectors(h,a),s.subVectors(n,a);const u=(new me).crossVectors(r,s).normalize();for(let t=0;t<3;t++){const e=o(i[t]);e in l||(l[e]=[]),l[e].push(u)}}const h=new Float32Array(3*c.count),u=new qn(h,3,!1);let d=1/0,p=-1/0;for(let t=0,n=c.count/3;t<n;t++){const n=3*t,h=i[0].fromBufferAttribute(c,n+0),f=i[1].fromBufferAttribute(c,n+1),A=i[2].fromBufferAttribute(c,n+2);r.subVectors(A,f),s.subVectors(h,f),a.crossVectors(r,s).normalize();const g=r.copy(h).add(f).add(A).multiplyScalar(1/3);for(let t=0;t<3;t++){const r=i[t],c=l[o(r)],h=s.subVectors(g,r);let f=0;for(let t=0,e=c.length;t<e;t++){const e=c[t];f+=a.dot(e)-.5}f/=c.length,f-=Math.max(10*a.dot(h),0),e.setHSL(0,0,f),d=Math.min(d,e.r),p=Math.max(p,e.r),u.setXYZ(n+t,e.r,e.g,e.b)}}for(let t=0,e=h.length;t<e;t++)h[t]-=d-.1,h[t]*=1/(p-d+.1);return t.setAttribute("color",u),t}(s)),A&&(s=function(t,e=Math.PI/3){const n=Math.cos(e),i=100*(1+1e-10),r=[new me,new me,new me],s=new me,a=new me,o=new me,c=new me;function l(t){return`${~~(t.x*i)},${~~(t.y*i)},${~~(t.z*i)}`}const h=t.index?t.toNonIndexed():t,u=h.attributes.position,d={};for(let t=0,e=u.count/3;t<e;t++){const e=3*t,n=r[0].fromBufferAttribute(u,e+0),i=r[1].fromBufferAttribute(u,e+1),o=r[2].fromBufferAttribute(u,e+2);s.subVectors(o,i),a.subVectors(n,i);const c=(new me).crossVectors(s,a).normalize();for(let t=0;t<3;t++){const e=l(r[t]);e in d||(d[e]=[]),d[e].push(c)}}const p=new Float32Array(3*u.count),f=new qn(p,3,!1);for(let t=0,e=u.count/3;t<e;t++){const e=3*t,i=r[0].fromBufferAttribute(u,e+0),h=r[1].fromBufferAttribute(u,e+1),p=r[2].fromBufferAttribute(u,e+2);s.subVectors(p,h),a.subVectors(i,h),o.crossVectors(s,a).normalize();for(let t=0;t<3;t++){const i=d[l(r[t])];c.set(0,0,0);for(let t=0,e=i.length;t<e;t++){const e=i[t];o.dot(e)>n&&c.add(e)}c.normalize(),f.setXYZ(e+t,c.x,c.y,c.z)}}return h.setAttribute("normal",f),h}(s)),Uw(s,Zh(this)+"-extruded-geometry",E)}return Uw(new Kc(w))}}}else{const t=e.trim().match(/^(path|path2d|path3d|rect)\((.*)\)$/);if(t){let[,e,n]=t;const i="path3d"===e;"rect"===e&&(n=Rw(n.trim().match(h).groups));try{const t=Tw(n,i);return(new ri).setFromPoints(t.getPoints(8))}catch(t){const{location:e}=t;return e?console.log(`%c${t.message}\n %c${n.slice(0,e.start.offset)}%c${n.slice(e.start.offset,e.end.offset)}%c${n.slice(e.end.offset)}`,"color:orange;","","font-weight:bold;color:red;",""):console.log(t),null}}}return super.stringToValue(t,e)}};e.schemas.get(Do).get("mixins").push(u),e.schemas.get(_i).get("mixins").push(u);const d=t=>class extends t{static name="PathParser";stringToValue(t,e){if("CurvePath"===this.constructor.getSchemaEntry(t).type){const t=e.trim().match(/^(path|path2d|path3d)\((.+)\)$/);if(!t)return null;const[,n,i]=t,r="path3d"===n;try{const t=Tw(i,r);return t.is2DPath=!r,t}catch(t){const{location:e}=t;return e?console.log(`%c${t.message}\n %c${i.slice(0,e.start.offset)}%c${i.slice(e.start.offset,e.end.offset)}%c${i.slice(e.end.offset)}`,"color:orange;","","font-weight:bold;color:red;",""):console.log(t),null}}return super.stringToValue(t,e)}};cb.push("offset-path","offset-distance"),ob.push((t=>class extends t{static name="OffsetPath";static shortHandSchema=new Map([["mixins",[d]],["offset-path",{as:"offsetPath",type:"CurvePath",stage:e.STORED_ON_EL}],["offset-distance",{as:"offsetDistance",type:"percentage",stage:e.STORED_ON_EL}]]);#de=[];async#pe(){"object"==typeof this.properties.offsetPath&&void 0!==this.properties.offsetDistance&&(this.properties.offsetPath.getPoint(this.properties.offsetDistance,i),this.properties.offsetPath.is2DPath&&i.applyAxisAngle(s,Math.PI/2),this.object.position.add(i),this.properties.offsetPath.getTangent(this.properties.offsetDistance,i),this.properties.offsetPath.is2DPath&&i.applyAxisAngle(s,Math.PI/2),r.setFromUnitVectors(a,i),this.object.quaternion.multiply(r))}async connectedCallback(){await super.connectedCallback(),await this.#pe()}async attributeChangedCallback(t,e,n,i){await super.attributeChangedCallback(t,e,n,i),"offset-path"!==t&&"offset-distance"!==t||await this.#pe(t)}}))}(0,tp),function(t,e){const n=e.schemas,i=new me;new me,new me;const r=new ge,s=new me,a=new ge,o=new me,c=new rl,l=new vc(1,1,1,32,1,!1),h=new me(0,1,0),u=new me,d=new me,p=new me,f=new me,A=new me,g=new me,m=new me,b=new me,v=new su,y=new su;let x=[];function _(){const t=Array.from(v.entries());x=t.flatMap((([e,n],i)=>t.slice(i+1).map((([t,i])=>[n,i,e,t]))))}function E(t,e,n){const c=e[0],l=e[1],h=t.properties.grabRadius,v=u.subVectors(l,c),y=v.length();if(y>h)return!1;v.normalize(),t.object.updateWorldMatrix(!0,!1),t.object.matrixWorld.decompose(s,a,i);const x=t.properties.grabLength;g.copy(t.properties.grabDirection).normalize().applyQuaternion(r.copy(a));const _=t.properties.grabOffset;p.crossVectors(g,v);const E=d.copy(_||o).applyMatrix4(t.object.matrixWorld),w=c;if(f.crossVectors(v,p),!f.lengthSq())return;A.subVectors(w,E);const C=A.dot(f)/g.dot(f);if(m.copy(E).addScaledVector(g,C),Math.abs(C)>x/2)return!1;if(f.crossVectors(g,p),!f.lengthSq())return;A.subVectors(E,w);const S=A.dot(f)/v.dot(f);if(b.copy(w).addScaledVector(v,S),S<-h||S>y+h)return!1;return!(i.subVectors(m,b).length()>h)&&(n&&t.object.worldToLocal(n.copy(b)),!0)}n.get(Da).get("mixins").push((t=>class extends t{static name="GrabberSystem";tick(t,e,n,r,s){super.tick(t,e,n,r,s);for(const[t,e]of cy){if(!y.has(t))continue;const{worldPosA:n,worldPosB:i,currentParent:r}=y.get(t);n.distanceTo(i)>t.properties.grabRadius&&(cy.delete(t),y.delete(t),t.classList.remove("held"),t.part.remove("held"),t.shReparent(e),r.removeFromParent(),t.emit("grabend",{holdingParent:this.object,realParent:e}),t.getRootNode().host&&t.getRootNode().host.emit("grabend",{part:t,holdingParent:this.object,realParent:e}))}for(const t of x)for(const[e,n]of sy)if(n>=0&&e.properties.grabOffset){const n=t[0],r=t[1],s=t[2],a=i;if(!cy.has(e)&&E(e,t,a)){let t=e;for(let n=0;n<sy.get(e);n++)t=t.parentNode;const i=cy.get(t)||t.object.parent,o=new wa;s.object.add(o),s.object.worldToLocal(o.position.copy(a));const c={worldPosA:n,worldPosB:r,currentParent:o};cy.set(t,i),y.set(t,c),t.classList.add("held"),t.shReparent(o),t.getRootNode().host&&(t.part.add("held"),t.getRootNode().host.emit("grabstart",{part:t,holdingParent:this.object,realParent:i})),t.emit("grabstart",{holdingParent:this.object,realParent:i})}}}})),t("sh-hand-grab",{type:xn,name:"Gripper",mixin:t=>class extends t{#fe;static shortHandSchema=iu({"joint-radius":{as:"pincherRadius",default:0,stage:e.STORED_ON_EL}});static name="Gripper";async connectedCallback(){await super.connectedCallback(),this.#fe=new me,v.set(this,this.#fe),_()}async disconnectedCallback(){await super.disconnectedCallback(),v.delete(this),_()}tick(t,e,n,i,r){super.tick(t,e,n,i,r),this.#fe&&this.ready&&this.object.getWorldPosition(this.#fe)}}}),n.get(xn).get("mixins").push((t=>class extends t{static shortHandSchema=iu({"grab-hand-location":{as:"grabOffset",type:"Vector3",stage:e.STORED_ON_EL},"grab-hand-direction":{as:"grabDirection",default:"0 1 0",type:"Vector3",stage:e.STORED_ON_EL},"grab-hand-radius":{as:"grabRadius",default:.01,stage:e.STORED_ON_EL},"grab-hand-length":{as:"grabLength",default:.03,stage:e.STORED_ON_EL},"grab-hand-handle-visibility":{as:"grabHandleVisible",type:"boolean",stage:e.STORED_ON_EL,map:{hidden:!1,visible:!0}}});static name="Grabbable";#Ae;#ge;tick(t,e,n,i,r){super.tick(t,e,n,i,r);const s=this.properties.grabTarget>=0;if((this.properties.grabHandleVisible&&s)!==this.#ge)if(this.#ge=this.properties.grabHandleVisible&&s,this.properties.grabHandleVisible&&s){const t=new _i(l,c);this.#Ae=t,t.position.copy(this.properties.grabOffset||o),t.scale.set(this.properties.grabRadius,this.properties.grabLength,this.properties.grabRadius),t.quaternion.setFromUnitVectors(h,this.properties.grabDirection),this.object.add(t)}else this.#Ae&&(this.object.remove(this.#Ae),this.#Ae.dispose(),this.#Ae=null)}}))}(gp,tp),window.addEventListener("click",(t=>t.target.closest("a")?.click()));let Ow={};ox(gp,tp),kw(),Ow=Hh;export{qd as ASSIGNED_AFTER_CONSTRUCTION,Xd as ASSIGNED_IN_CONSTRUCTOR,Jd as REQUIRES_RECONSTRUCT,Yd as STORED_ON_EL,hp as documentation,kw as elementCheck,lp as elementRegistry,$v as markAsDirty,Ap as patchElement,Zh as prettyPrintElement,Nw as printDocs,hu as queryParts,db as refreshTransform,ox as register,gp as registerShortHandElement,sb as registerTemplateToElement,cp as registeredElements,tp as schema,DA as setDracoPath,Ow as threeParts};
//# sourceMappingURL=short-hand-standalone.min.js.map
